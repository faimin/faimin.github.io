[{"categories":["å·¥å…·"],"content":"å·¥æ¬²å–„å…¶äº‹ï¼Œå¿…å…ˆåˆ©å…¶å™¨","date":"2022-08-29","objectID":"/%E5%B7%A5%E5%85%B7/","tags":["å·¥å…·"],"title":"å·¥å…·","uri":"/%E5%B7%A5%E5%85%B7/"},{"categories":["å·¥å…·"],"content":"ç®€ä»‹ ä¸ªäººå¹³æ—¶æ”¶è—çš„ä¸€äº›Macå¹³å°å¼€æºå…è´¹çš„å·¥å…·ï¼ŒåŸºæœ¬éƒ½æ”¯æŒhomebrewå®‰è£…ã€‚ ","date":"2022-08-29","objectID":"/%E5%B7%A5%E5%85%B7/:1:0","tags":["å·¥å…·"],"title":"å·¥å…·","uri":"/%E5%B7%A5%E5%85%B7/"},{"categories":["å·¥å…·"],"content":"æœç´¢å¼•æ“ devv Qwant Yandex phind grep.app startpage SearX ","date":"2022-08-29","objectID":"/%E5%B7%A5%E5%85%B7/:2:0","tags":["å·¥å…·"],"title":"å·¥å…·","uri":"/%E5%B7%A5%E5%85%B7/"},{"categories":["å·¥å…·"],"content":"è½¯ä»¶ ","date":"2022-08-29","objectID":"/%E5%B7%A5%E5%85%B7/:3:0","tags":["å·¥å…·"],"title":"å·¥å…·","uri":"/%E5%B7%A5%E5%85%B7/"},{"categories":["å·¥å…·"],"content":"åŒ…ç®¡ç† Homebrewï¼šMacç«¯çš„åŒ…ç®¡ç†å·¥å…·ï¼ŒPCç«¯çš„æœ‰Scoopã€Chocolateã€Winget ","date":"2022-08-29","objectID":"/%E5%B7%A5%E5%85%B7/:3:1","tags":["å·¥å…·"],"title":"å·¥å…·","uri":"/%E5%B7%A5%E5%85%B7/"},{"categories":["å·¥å…·"],"content":"ç»ˆç«¯ iTerm2 Alacritty WezTerm kitty WindTerm Tabby ","date":"2022-08-29","objectID":"/%E5%B7%A5%E5%85%B7/:3:2","tags":["å·¥å…·"],"title":"å·¥å…·","uri":"/%E5%B7%A5%E5%85%B7/"},{"categories":["å·¥å…·"],"content":"nvim Neovim - GUI vimr - GUI NvChad LazyVim ","date":"2022-08-29","objectID":"/%E5%B7%A5%E5%85%B7/:3:3","tags":["å·¥å…·"],"title":"å·¥å…·","uri":"/%E5%B7%A5%E5%85%B7/"},{"categories":["å·¥å…·"],"content":"æ•ˆç‡ PopClip Alfred alfred-workflows Hammerspoon -------------- è¾“å…¥æ³•æ§åˆ¶ ----------------- local function Chinese() -- æœç‹—è¾“å…¥æ³• hs.keycodes.currentSourceID(\"com.sogou.inputmethod.sogou.pinyin\") -- ç®€ä½“æ‹¼éŸ³ --hs.keycodes.currentSourceID(\"com.apple.inputmethod.SCIM.ITABC\") end local function English() -- ABC hs.keycodes.currentSourceID(\"com.apple.keylayout.ABC\") end -- app to expected ime config -- appå’Œå¯¹åº”çš„è¾“å…¥æ³• local app2Ime = { { '/Applications/System Preferences.app', 'English' }, { '/System/Library/CoreServices/Finder.app', 'Chinese' }, { '/Applications/iTerm.app', 'Chinese' }, { '/Applications/Visual Studio Code.app', 'Chinese' }, { '/Applications/Xcode.app', 'Chinese' }, { '/Applications/Microsoft Edge.app', 'Chinese' }, { '/Applications/Kim.app', 'Chinese' }, { '/Applications/WeChat.app', 'Chinese' }, { '/Applications/QQ.app', 'Chinese' }, { '/Applications/MarkText.app', 'Chinese' }, { '/Applications/Bob.app', 'Chinese' }, { '/Applications/NeteaseMusic.app', 'Chinese' }, } function updateFocusAppInputMethod() local ime = 'Chinese' local focusAppPath = hs.window.frontmostWindow():application():path() for index, app in pairs(app2Ime) do local appPath = app[1] local expectedIme = app[2] if focusAppPath == appPath then ime = expectedIme break end end if ime == 'English' then English() else Chinese() end end -- helper hotkey to figure out the app path and name of current focused window -- å½“é€‰ä¸­æŸçª—å£æŒ‰ä¸‹ctrl+command+.æ—¶ä¼šæ˜¾ç¤ºåº”ç”¨çš„è·¯å¾„ç­‰ä¿¡æ¯ hs.hotkey.bind({ 'ctrl', 'cmd' }, \".\", function() hs.alert.show(\"App path: \" .. hs.window.focusedWindow():application():path() .. \"\\n\" .. \"App name: \" .. hs.window.focusedWindow():application():name() .. \"\\n\" .. \"IM source id: \" .. hs.keycodes.currentSourceID()) end) -- Handle cursor focus and application's screen manage. -- çª—å£æ¿€æ´»æ—¶è‡ªåŠ¨åˆ‡æ¢è¾“å…¥æ³• function applicationWatcher(appName, eventType, appObject) if (eventType == hs.application.watcher.activated or eventType == hs.application.watcher.launched) then updateFocusAppInputMethod() end end appWatcher = hs.application.watcher.new(applicationWatcher) appWatcher:start() SwiftBar xbar DevToys OnlySwitch ","date":"2022-08-29","objectID":"/%E5%B7%A5%E5%85%B7/:3:4","tags":["å·¥å…·"],"title":"å·¥å…·","uri":"/%E5%B7%A5%E5%85%B7/"},{"categories":["å·¥å…·"],"content":"ç³»ç»Ÿä¼˜åŒ– Lemon Cleaner AppCleaner ","date":"2022-08-29","objectID":"/%E5%B7%A5%E5%85%B7/:3:5","tags":["å·¥å…·"],"title":"å·¥å…·","uri":"/%E5%B7%A5%E5%85%B7/"},{"categories":["å·¥å…·"],"content":"ç³»ç»Ÿç›‘æ§ Stats eul MenuMeters ","date":"2022-08-29","objectID":"/%E5%B7%A5%E5%85%B7/:3:6","tags":["å·¥å…·"],"title":"å·¥å…·","uri":"/%E5%B7%A5%E5%85%B7/"},{"categories":["å·¥å…·"],"content":"ä¸‹è½½ Motrix Free Download Manager gopeed you-get - ç½‘ç«™è§†é¢‘ä¸‹è½½å‘½ä»¤å·¥å…·ï¼Œå¦‚éœ€è§†é¢‘åˆå¹¶éœ€é¢å¤–å®‰è£…ffmpeg ","date":"2022-08-29","objectID":"/%E5%B7%A5%E5%85%B7/:3:7","tags":["å·¥å…·"],"title":"å·¥å…·","uri":"/%E5%B7%A5%E5%85%B7/"},{"categories":["å·¥å…·"],"content":"Office LibreOffice ","date":"2022-08-29","objectID":"/%E5%B7%A5%E5%85%B7/:3:8","tags":["å·¥å…·"],"title":"å·¥å…·","uri":"/%E5%B7%A5%E5%85%B7/"},{"categories":["å·¥å…·"],"content":"æµç¨‹å›¾ Draw.io asciiflow tlddraw ","date":"2022-08-29","objectID":"/%E5%B7%A5%E5%85%B7/:3:9","tags":["å·¥å…·"],"title":"å·¥å…·","uri":"/%E5%B7%A5%E5%85%B7/"},{"categories":["å·¥å…·"],"content":"Markdown MarkText typst ","date":"2022-08-29","objectID":"/%E5%B7%A5%E5%85%B7/:3:10","tags":["å·¥å…·"],"title":"å·¥å…·","uri":"/%E5%B7%A5%E5%85%B7/"},{"categories":["å·¥å…·"],"content":"é˜…è¯» WeRead - åˆ©ç”¨Rust Tauriæ‰“åŒ…çš„ APP Legado - Android æŠ¥çº¸/æœŸåˆŠ åä¸‡ä¸ªä¸ºä»€ä¹ˆ ","date":"2022-08-29","objectID":"/%E5%B7%A5%E5%85%B7/:3:11","tags":["å·¥å…·"],"title":"å·¥å…·","uri":"/%E5%B7%A5%E5%85%B7/"},{"categories":["å·¥å…·"],"content":"PDF Skim Edge Firefox Chrome ","date":"2022-08-29","objectID":"/%E5%B7%A5%E5%85%B7/:3:12","tags":["å·¥å…·"],"title":"å·¥å…·","uri":"/%E5%B7%A5%E5%85%B7/"},{"categories":["å·¥å…·"],"content":"æ’­æ”¾å™¨ æ”¶è´¹çš„å¯ä»¥è¯•è¯•Movist Proã€Infuse Pro IINA MPC-BE MusicFree - Flutter Music ç«™ç‚¹ ç½‘æ˜“äº‘éŸ³ä¹ MAC äº‘ç›˜ä¸Šä¼ å·¥å…· ","date":"2022-08-29","objectID":"/%E5%B7%A5%E5%85%B7/:3:13","tags":["å·¥å…·"],"title":"å·¥å…·","uri":"/%E5%B7%A5%E5%85%B7/"},{"categories":["å·¥å…·"],"content":"æˆªå›¾ Snipaste shottr flameshot eSearch Xnip iShot ","date":"2022-08-29","objectID":"/%E5%B7%A5%E5%85%B7/:3:14","tags":["å·¥å…·"],"title":"å·¥å…·","uri":"/%E5%B7%A5%E5%85%B7/"},{"categories":["å·¥å…·"],"content":"çª—å£ç®¡ç† Rectangle yabai ","date":"2022-08-29","objectID":"/%E5%B7%A5%E5%85%B7/:3:15","tags":["å·¥å…·"],"title":"å·¥å…·","uri":"/%E5%B7%A5%E5%85%B7/"},{"categories":["å·¥å…·"],"content":"æ–‡ä»¶å‹ç¼© The Unarchiver Keka PeaZip ","date":"2022-08-29","objectID":"/%E5%B7%A5%E5%85%B7/:3:16","tags":["å·¥å…·"],"title":"å·¥å…·","uri":"/%E5%B7%A5%E5%85%B7/"},{"categories":["å·¥å…·"],"content":"å±å¹•ä¿æŠ¤ Brooklyn ","date":"2022-08-29","objectID":"/%E5%B7%A5%E5%85%B7/:3:17","tags":["å·¥å…·"],"title":"å·¥å…·","uri":"/%E5%B7%A5%E5%85%B7/"},{"categories":["å·¥å…·"],"content":"é˜²ç«å¢™ Lulu ","date":"2022-08-29","objectID":"/%E5%B7%A5%E5%85%B7/:3:18","tags":["å·¥å…·"],"title":"å·¥å…·","uri":"/%E5%B7%A5%E5%85%B7/"},{"categories":["å·¥å…·"],"content":"ç¿»è¯‘ Bob EasyDict æ²‰æµ¸å¼åŒè¯­ç½‘é¡µç¿»è¯‘æ‰©å±• kiss-translator TTime pot-desktop tran ","date":"2022-08-29","objectID":"/%E5%B7%A5%E5%85%B7/:3:19","tags":["å·¥å…·"],"title":"å·¥å…·","uri":"/%E5%B7%A5%E5%85%B7/"},{"categories":["å·¥å…·"],"content":"çŠ¶æ€æ  HiddenBar - æŠ˜å å›¾æ ‡ Dozer ","date":"2022-08-29","objectID":"/%E5%B7%A5%E5%85%B7/:3:20","tags":["å·¥å…·"],"title":"å·¥å…·","uri":"/%E5%B7%A5%E5%85%B7/"},{"categories":["å·¥å…·"],"content":"TouchBar Pock MTMR ","date":"2022-08-29","objectID":"/%E5%B7%A5%E5%85%B7/:3:21","tags":["å·¥å…·"],"title":"å·¥å…·","uri":"/%E5%B7%A5%E5%85%B7/"},{"categories":["å·¥å…·"],"content":"Quick Look glance - All-in-one Quick Look plugin SouceCodeSyntaxHighlight QLMarkdown Mac-QuickLook ","date":"2022-08-29","objectID":"/%E5%B7%A5%E5%85%B7/:3:22","tags":["å·¥å…·"],"title":"å·¥å…·","uri":"/%E5%B7%A5%E5%85%B7/"},{"categories":["å·¥å…·"],"content":"é‚®ä»¶ Spark ","date":"2022-08-29","objectID":"/%E5%B7%A5%E5%85%B7/:3:23","tags":["å·¥å…·"],"title":"å·¥å…·","uri":"/%E5%B7%A5%E5%85%B7/"},{"categories":["å·¥å…·"],"content":"é”®ç›˜ KeyCastr - æ˜¾ç¤ºå½“å‰æŒ‰é”® Tickys - æ¨¡æ‹Ÿæœºæ¢°é”®ç›˜çš„å£°éŸ³ ","date":"2022-08-29","objectID":"/%E5%B7%A5%E5%85%B7/:3:24","tags":["å·¥å…·"],"title":"å·¥å…·","uri":"/%E5%B7%A5%E5%85%B7/"},{"categories":["å·¥å…·"],"content":"è¾“å…¥æ³•åˆ‡æ¢ KeyboardHolder æœç‹—è¾“å…¥æ³•åˆ‡æ¢åŠ©æ‰‹ ","date":"2022-08-29","objectID":"/%E5%B7%A5%E5%85%B7/:3:25","tags":["å·¥å…·"],"title":"å·¥å…·","uri":"/%E5%B7%A5%E5%85%B7/"},{"categories":["å·¥å…·"],"content":"å±å¹•å½•åˆ¶ LICEcap Kap GIFCapture ","date":"2022-08-29","objectID":"/%E5%B7%A5%E5%85%B7/:3:26","tags":["å·¥å…·"],"title":"å·¥å…·","uri":"/%E5%B7%A5%E5%85%B7/"},{"categories":["å·¥å…·"],"content":"ç›´æ’­ obs-studio ","date":"2022-08-29","objectID":"/%E5%B7%A5%E5%85%B7/:3:27","tags":["å·¥å…·"],"title":"å·¥å…·","uri":"/%E5%B7%A5%E5%85%B7/"},{"categories":["å·¥å…·"],"content":"è§†é¢‘ç¼–è¾‘ shotcut lossless-cut ","date":"2022-08-29","objectID":"/%E5%B7%A5%E5%85%B7/:3:28","tags":["å·¥å…·"],"title":"å·¥å…·","uri":"/%E5%B7%A5%E5%85%B7/"},{"categories":["å·¥å…·"],"content":"æ ¼å¼è½¬ç  handbrake ","date":"2022-08-29","objectID":"/%E5%B7%A5%E5%85%B7/:3:29","tags":["å·¥å…·"],"title":"å·¥å…·","uri":"/%E5%B7%A5%E5%85%B7/"},{"categories":["å·¥å…·"],"content":"NTFS NTFSTool mounty ","date":"2022-08-29","objectID":"/%E5%B7%A5%E5%85%B7/:3:30","tags":["å·¥å…·"],"title":"å·¥å…·","uri":"/%E5%B7%A5%E5%85%B7/"},{"categories":["å·¥å…·"],"content":"Hosts iHosts SwitchHosts ","date":"2022-08-29","objectID":"/%E5%B7%A5%E5%85%B7/:3:31","tags":["å·¥å…·"],"title":"å·¥å…·","uri":"/%E5%B7%A5%E5%85%B7/"},{"categories":["å·¥å…·"],"content":"RSS NetNewsWire Lettura mdSilo-app ","date":"2022-08-29","objectID":"/%E5%B7%A5%E5%85%B7/:3:32","tags":["å·¥å…·"],"title":"å·¥å…·","uri":"/%E5%B7%A5%E5%85%B7/"},{"categories":["å·¥å…·"],"content":"æ–‡ä»¶ä¼ è¾“ localsend FlyingCarpet ","date":"2022-08-29","objectID":"/%E5%B7%A5%E5%85%B7/:3:33","tags":["å·¥å…·"],"title":"å·¥å…·","uri":"/%E5%B7%A5%E5%85%B7/"},{"categories":["å·¥å…·"],"content":"U ç›˜ç³»ç»Ÿåˆ¶ä½œ Rufus Ventoy etcher ","date":"2022-08-29","objectID":"/%E5%B7%A5%E5%85%B7/:3:34","tags":["å·¥å…·"],"title":"å·¥å…·","uri":"/%E5%B7%A5%E5%85%B7/"},{"categories":["å·¥å…·"],"content":"æ•°æ®æ¢å¤ KeychainCracker ","date":"2022-08-29","objectID":"/%E5%B7%A5%E5%85%B7/:3:35","tags":["å·¥å…·"],"title":"å·¥å…·","uri":"/%E5%B7%A5%E5%85%B7/"},{"categories":["å·¥å…·"],"content":"ä»£ç† ClashX Tunnelblick - OpenVPN whistle ","date":"2022-08-29","objectID":"/%E5%B7%A5%E5%85%B7/:3:36","tags":["å·¥å…·"],"title":"å·¥å…·","uri":"/%E5%B7%A5%E5%85%B7/"},{"categories":["å·¥å…·"],"content":"æ”¶è´¹è½¯ä»¶æ¨è å¯ä»¥åˆ°è¿™é‡Œæ‰¾ ç‰¹(ç ´)åˆ«(è§£) ç‰ˆ Xee - å›¾ç‰‡æµè§ˆ Picture View - å›¾ç‰‡æµè§ˆ Kaleidoscope - æ–‡ä»¶diff ","date":"2022-08-29","objectID":"/%E5%B7%A5%E5%85%B7/:3:37","tags":["å·¥å…·"],"title":"å·¥å…·","uri":"/%E5%B7%A5%E5%85%B7/"},{"categories":["å·¥å…·"],"content":"å¼€å‘ ","date":"2022-08-29","objectID":"/%E5%B7%A5%E5%85%B7/:4:0","tags":["å·¥å…·"],"title":"å·¥å…·","uri":"/%E5%B7%A5%E5%85%B7/"},{"categories":["å·¥å…·"],"content":"ç‰ˆæœ¬ç®¡ç† Python pyenv pixi WebEnv/Node volta fnm nvm Ruby rbenv rvm Java sdkman jenv Flutter fvm Swift swiftly ","date":"2022-08-29","objectID":"/%E5%B7%A5%E5%85%B7/:4:1","tags":["å·¥å…·"],"title":"å·¥å…·","uri":"/%E5%B7%A5%E5%85%B7/"},{"categories":["å·¥å…·"],"content":"è°ƒè¯• LLVM Lookin LLDB - lldbæ’ä»¶ Chisel - lldbæ’ä»¶ injectionIII - hotreload OpenSim - è¯»å–æ¨¡æ‹Ÿå™¨æ²™ç›’ ","date":"2022-08-29","objectID":"/%E5%B7%A5%E5%85%B7/:4:2","tags":["å·¥å…·"],"title":"å·¥å…·","uri":"/%E5%B7%A5%E5%85%B7/"},{"categories":["å·¥å…·"],"content":"Mach-O MachOView MachOView MachO-Explorer XMachOViewer MachOExplorer MachO-Kit LinkMap bloaty - å¯¹æ¯”æ–‡ä»¶ä½“ç§¯å˜åŒ– ipsw dSYMTools go-macho ","date":"2022-08-29","objectID":"/%E5%B7%A5%E5%85%B7/:4:3","tags":["å·¥å…·"],"title":"å·¥å…·","uri":"/%E5%B7%A5%E5%85%B7/"},{"categories":["å·¥å…·"],"content":"é€†å‘ æ¯”è¾ƒæœ‰åçš„å¯èƒ½æ˜¯IDAå’ŒHopper Disassembler Ghidra Frida Cutter Hashcat ","date":"2022-08-29","objectID":"/%E5%B7%A5%E5%85%B7/:4:4","tags":["å·¥å…·"],"title":"å·¥å…·","uri":"/%E5%B7%A5%E5%85%B7/"},{"categories":["å·¥å…·"],"content":"Hex HexFriend ImHex hexyl ","date":"2022-08-29","objectID":"/%E5%B7%A5%E5%85%B7/:4:5","tags":["å·¥å…·"],"title":"å·¥å…·","uri":"/%E5%B7%A5%E5%85%B7/"},{"categories":["å·¥å…·"],"content":"å‘½ä»¤è¡Œ fig inshellisense starship - prompt nushell atuin - shell history fd - file search ripgrep - grep dust - du lsd - ls eza - ls bat - cat ugit - æ’¤é”€gitæ“ä½œ thefuck ipatool - ä¸‹è½½IPAæ–‡ä»¶ HTTPie - æŸ¥çœ‹ç½‘ç»œ zsh-autocomplete zsh-autosuggestions zsh-syntax-highlighting git-cliff - changelog erdtree - file-tree tokei - ç»Ÿè®¡ä»£ç è¡Œæ•° onefetch - Git information zoxide - jump ios-deploy joshuto - file manager yazi - file manager ","date":"2022-08-29","objectID":"/%E5%B7%A5%E5%85%B7/:4:6","tags":["å·¥å…·"],"title":"å·¥å…·","uri":"/%E5%B7%A5%E5%85%B7/"},{"categories":["å·¥å…·"],"content":"å¿«æ·æ‰“å¼€ç»ˆç«¯ OpenInTerminal FinderGo Go2Shell Alfred æ’ä»¶ ","date":"2022-08-29","objectID":"/%E5%B7%A5%E5%85%B7/:4:7","tags":["å·¥å…·"],"title":"å·¥å…·","uri":"/%E5%B7%A5%E5%85%B7/"},{"categories":["å·¥å…·"],"content":"å›¾ç‰‡å‹ç¼© ImageSmith - æ¨èï¼Œåˆšå‘å¸ƒæ—¶ç™½å«–åˆ°çš„ ğŸ˜ Imagenie Crunch TinyPNG4Mac ImageOptim Pngyu rimage oxipng ","date":"2022-08-29","objectID":"/%E5%B7%A5%E5%85%B7/:4:8","tags":["å·¥å…·"],"title":"å·¥å…·","uri":"/%E5%B7%A5%E5%85%B7/"},{"categories":["å·¥å…·"],"content":"æ£€æµ‹æ— ç”¨èµ„æºå’Œä»£ç  æ— ç”¨èµ„æº LSUnusedResources æ— ç”¨ä»£ç  periphery WBBlades Pecker Stencil Sitrep czkawka ","date":"2022-08-29","objectID":"/%E5%B7%A5%E5%85%B7/:4:9","tags":["å·¥å…·"],"title":"å·¥å…·","uri":"/%E5%B7%A5%E5%85%B7/"},{"categories":["å·¥å…·"],"content":"æ¨é€ PushDeer Knuff Pusher Easy APNs Provider PushNotifications ","date":"2022-08-29","objectID":"/%E5%B7%A5%E5%85%B7/:4:10","tags":["å·¥å…·"],"title":"å·¥å…·","uri":"/%E5%B7%A5%E5%85%B7/"},{"categories":["å·¥å…·"],"content":"Git Fork GitUI LazyGit å¼€æºçš„è¿˜æœ‰Xitã€GitUpï¼Œæ”¶è´¹çš„æœ‰Towerã€Sublime Mergeã€GitKraken ","date":"2022-08-29","objectID":"/%E5%B7%A5%E5%85%B7/:4:11","tags":["å·¥å…·"],"title":"å·¥å…·","uri":"/%E5%B7%A5%E5%85%B7/"},{"categories":["å·¥å…·"],"content":"æ•°æ®åº“ SQLiteBrowser DBeaver ","date":"2022-08-29","objectID":"/%E5%B7%A5%E5%85%B7/:4:12","tags":["å·¥å…·"],"title":"å·¥å…·","uri":"/%E5%B7%A5%E5%85%B7/"},{"categories":["å·¥å…·"],"content":"WWDC WWDC ","date":"2022-08-29","objectID":"/%E5%B7%A5%E5%85%B7/:4:13","tags":["å·¥å…·"],"title":"å·¥å…·","uri":"/%E5%B7%A5%E5%85%B7/"},{"categories":["å·¥å…·"],"content":"Docker OrbStack ","date":"2022-08-29","objectID":"/%E5%B7%A5%E5%85%B7/:4:14","tags":["å·¥å…·"],"title":"å·¥å…·","uri":"/%E5%B7%A5%E5%85%B7/"},{"categories":["å·¥å…·"],"content":"åˆ†è¾¨ç‡è°ƒæ•´ RDM ","date":"2022-08-29","objectID":"/%E5%B7%A5%E5%85%B7/:4:15","tags":["å·¥å…·"],"title":"å·¥å…·","uri":"/%E5%B7%A5%E5%85%B7/"},{"categories":["å·¥å…·"],"content":"Web æ‰“åŒ…æˆ MacAPP Pake ","date":"2022-08-29","objectID":"/%E5%B7%A5%E5%85%B7/:4:16","tags":["å·¥å…·"],"title":"å·¥å…·","uri":"/%E5%B7%A5%E5%85%B7/"},{"categories":["å·¥å…·"],"content":"ç½‘ç»œ thunder-client hoppscotch - Postwomen RapidAPI / Paw HTTPToolKit-Desktop cocoa-reset-client Stream Knot ","date":"2022-08-29","objectID":"/%E5%B7%A5%E5%85%B7/:4:17","tags":["å·¥å…·"],"title":"å·¥å…·","uri":"/%E5%B7%A5%E5%85%B7/"},{"categories":["å·¥å…·"],"content":"çˆ¬è™« EasySpider ","date":"2022-08-29","objectID":"/%E5%B7%A5%E5%85%B7/:4:18","tags":["å·¥å…·"],"title":"å·¥å…·","uri":"/%E5%B7%A5%E5%85%B7/"},{"categories":["å·¥å…·"],"content":"Xcode Plugin Json2Property quicktype-xcode CleverToolKit XCFormat EditKit Pro ","date":"2022-08-29","objectID":"/%E5%B7%A5%E5%85%B7/:4:19","tags":["å·¥å…·"],"title":"å·¥å…·","uri":"/%E5%B7%A5%E5%85%B7/"},{"categories":["å·¥å…·"],"content":"Xcode ç‰ˆæœ¬ç®¡ç† xcodes xcinfo xcode-install ","date":"2022-08-29","objectID":"/%E5%B7%A5%E5%85%B7/:4:20","tags":["å·¥å…·"],"title":"å·¥å…·","uri":"/%E5%B7%A5%E5%85%B7/"},{"categories":["å·¥å…·"],"content":"Xcode ç¼“å­˜æ¸…ç† DevCleaner ","date":"2022-08-29","objectID":"/%E5%B7%A5%E5%85%B7/:4:21","tags":["å·¥å…·"],"title":"å·¥å…·","uri":"/%E5%B7%A5%E5%85%B7/"},{"categories":["å·¥å…·"],"content":"VSCode æ’ä»¶ Shades of Purple - ä¸»é¢˜ Dracula - ä¸»é¢˜ Code Runner CodeLLDB clangd Error Lens GitLess Git Blame GitLens Git Graph Path Intellisense Thunder Client CodeSnap Comment Tranlate Markdown Editor Image Preview Paste JSON as Code Project Manager Bookmarks Todo Tree shellman Hex Editor Doxygen Documentation Generator Better Comments whatchanged - changelog Swift å¦‚æœæ²¡æœ‰ä»£ç è”æƒ³ï¼Œå¯èƒ½æ˜¯å› ä¸ºsourcekit-lspä¸æœ¬æœºSwiftä¸åœ¨åŒä¸€ç›®å½•ä¸‹ã€‚åœ¨/usr/local/binä¸‹å»ºç«‹ä¸€ä¸ªsourcekit-lspçš„è½¯é“¾æ¥å¯ä»¥è§£å†³ï¼šls -s $(xcrun --find sourcekit-lsp) /usr/local/bin/sourcekit-lspã€‚ å¦‚æœæ–­ç‚¹è°ƒè¯•æ— æ³•æ˜¾ç¤ºå˜é‡ï¼Œæ£€æŸ¥ä¸‹æ˜¯å¦å®‰è£…äº†llvmï¼Œå¦‚æœæ˜¯é‚£å¯èƒ½é»˜è®¤ç”¨çš„æ˜¯llvmçš„lldbã€‚æŠŠCodeLLDBçš„lldbæŒ‡å®šä¸ºXcodeçš„lldbï¼Œæˆ–è€…åœ¨.zshrcä¸­ç”¨Xcodeç‰ˆæœ¬è¦†ç›–llvmç‰ˆæœ¬ï¼š export PATH=\"/Applications/Xcode.app/Contents/Developer/usr/bin:$PATH\" ","date":"2022-08-29","objectID":"/%E5%B7%A5%E5%85%B7/:4:22","tags":["å·¥å…·"],"title":"å·¥å…·","uri":"/%E5%B7%A5%E5%85%B7/"},{"categories":["å·¥å…·"],"content":"Windows VC ç¯å¢ƒ VCRedist ","date":"2022-08-29","objectID":"/%E5%B7%A5%E5%85%B7/:4:23","tags":["å·¥å…·"],"title":"å·¥å…·","uri":"/%E5%B7%A5%E5%85%B7/"},{"categories":["å·¥å…·"],"content":"Windows æ¿€æ´» HEU_KMS_Activator ","date":"2022-08-29","objectID":"/%E5%B7%A5%E5%85%B7/:4:24","tags":["å·¥å…·"],"title":"å·¥å…·","uri":"/%E5%B7%A5%E5%85%B7/"},{"categories":["å·¥å…·"],"content":"å¸¸è§é—®é¢˜ VSCode å‡½æ•°å‚æ•°æ²¡æœ‰ä»£ç æç¤º å…³é—­é˜»æ­¢é€‰é¡¹ snippets_prevent_suggestions æ‰¾å›IDEAçš„copy reference lose copy reference ","date":"2022-08-29","objectID":"/%E5%B7%A5%E5%85%B7/:5:0","tags":["å·¥å…·"],"title":"å·¥å…·","uri":"/%E5%B7%A5%E5%85%B7/"},{"categories":["å·¥å…·"],"content":"è½¯ä»¶ç«™ AppStorrent éº¦æ°ªæœ open-source-mac-os-apps Xclient MacBL AlternativeTo NSANE FORUMS TorrentMac UUP dump MacYY(ç½‘ç«™å·²è½¬å–) MacWk(å·²å…³ç«™) ","date":"2022-08-29","objectID":"/%E5%B7%A5%E5%85%B7/:6:0","tags":["å·¥å…·"],"title":"å·¥å…·","uri":"/%E5%B7%A5%E5%85%B7/"},{"categories":["å·¥å…·"],"content":"å‚è€ƒ HellGithub è€èƒ¡çš„å‘¨åˆŠ ","date":"2022-08-29","objectID":"/%E5%B7%A5%E5%85%B7/:7:0","tags":["å·¥å…·"],"title":"å·¥å…·","uri":"/%E5%B7%A5%E5%85%B7/"},{"categories":["å®ç°åŸç†"],"content":"è®°å½•Swiftè¯­è¨€ä¸­çš„ä¸€äº›ç–‘æƒ‘","date":"2022-07-26","objectID":"/swift%E8%A7%A3%E6%83%91/","tags":["iOS","swift"],"title":"Swiftè§£æƒ‘","uri":"/swift%E8%A7%A3%E6%83%91/"},{"categories":["å®ç°åŸç†"],"content":"Swiftåˆ†æåˆ©å™¨ swiftc xxx.swift -emit-sil[gen] | xcrun swift-demangle \u003e xxxxSILGen.sil ","date":"2022-07-26","objectID":"/swift%E8%A7%A3%E6%83%91/:1:0","tags":["iOS","swift"],"title":"Swiftè§£æƒ‘","uri":"/swift%E8%A7%A3%E6%83%91/"},{"categories":["å®ç°åŸç†"],"content":"å¤‡å¿˜å½• å…¨å±€çš„å¸¸é‡æˆ–è€…å˜é‡éƒ½æ˜¯å»¶è¿Ÿè®¡ç®—çš„ï¼Œè·Ÿå»¶è¿ŸåŠ è½½å­˜å‚¨å±æ€§ç›¸ä¼¼ï¼Œä¸åŒçš„åœ°æ–¹åœ¨äºï¼Œå…¨å±€çš„å¸¸é‡æˆ–å˜é‡ä¸éœ€è¦æ ‡è®°lazyä¿®é¥°ç¬¦ã€‚å±€éƒ¨èŒƒå›´çš„å¸¸é‡å’Œå˜é‡ä¸å»¶è¿Ÿè®¡ç®—ï¼› æšä¸¾ç±»å‹ä¸æ”¯æŒå­˜å‚¨å±æ€§ï¼Œæƒ³å­˜å‚¨æ•°æ®å¯ä»¥ä½¿ç”¨æšä¸¾å…³è”çš„æ–¹å¼ï¼› ä¸ºç±»å®šä¹‰è®¡ç®—å‹ç±»å‹å±æ€§æ—¶ï¼Œå¯ä»¥æ”¹ç”¨å…³é”®å­—classæ¥æ”¯æŒå­ç±»å¯¹çˆ¶ç±»çš„å®ç°è¿›è¡Œé‡å†™ï¼› å¦‚æœä¸€ä¸ªè¢«æ ‡è®°ä¸ºlazyçš„å±æ€§åœ¨æ²¡æœ‰åˆå§‹åŒ–æ—¶å°±è¢«å¤šä¸ªçº¿ç¨‹è®¿é—®ï¼Œåˆ™æ— æ³•ä¿è¯è¯¥å±æ€§åªä¼šè¢«åˆå§‹åŒ–ä¸€æ¬¡ï¼Œä¹Ÿå°±æ˜¯è¯´lazyä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼› æˆ‘ä»¬å¯ä»¥ä¸ºé™¤äº†å»¶è¿Ÿè®¡ç®—å±æ€§ä¹‹å¤–çš„å…¶ä»–å­˜å‚¨å±æ€§æ·»åŠ å±æ€§è§‚å¯Ÿå™¨ï¼Œä¹Ÿå¯ä»¥é€šè¿‡é‡å†™å±æ€§çš„æ–¹å¼ä¸ºç»§æ‰¿çš„å±æ€§ï¼ˆåŒ…æ‹¬å­˜å‚¨å±æ€§å’Œè®¡ç®—å±æ€§ï¼‰æ·»åŠ å±æ€§è§‚å¯Ÿå™¨ï¼›ä¸éœ€è¦ä¸ºéé‡å†™çš„è®¡ç®—å±æ€§æ·»åŠ å±æ€§è§‚å¯Ÿå™¨ï¼Œå› ä¸ºå¯ä»¥é€šè¿‡å®ƒçš„setterç›´æ¥ç›‘æ§å’Œå“åº”å€¼çš„å˜åŒ–ï¼›å¦‚æœåœ¨ä¸€ä¸ªå±æ€§çš„didSetè§‚å¯Ÿå™¨é‡Œä¸ºå®ƒèµ‹å€¼ï¼Œè¿™ä¸ªå€¼ä¼šæ›¿æ¢è¯¥è§‚å¯Ÿå™¨ä¹‹å‰è®¾ç½®çš„å€¼ï¼› çˆ¶ç±»çš„å±æ€§åœ¨å­ç±»çš„æ„é€ å™¨ä¸­è¢«èµ‹å€¼æ—¶ï¼Œå®ƒåœ¨çˆ¶ç±»ä¸­çš„willSetå’ŒdidSetè§‚å¯Ÿå™¨ä¼šè¢«è°ƒç”¨ï¼Œéšåæ‰ä¼šè°ƒç”¨å­ç±»çš„è§‚å¯Ÿå™¨ã€‚åœ¨çˆ¶ç±»åˆå§‹åŒ–æ–¹æ³•è°ƒç”¨ä¹‹å‰ï¼Œå­ç±»ç»™å±æ€§èµ‹å€¼æ—¶ï¼Œè§‚å¯Ÿå™¨ä¸ä¼šè¢«è°ƒç”¨ã€‚ å­˜å‚¨å‹ç±»å‹å±æ€§å¯ä»¥æ˜¯å˜é‡æˆ–å¸¸é‡ï¼Œè®¡ç®—å‹ç±»å‹å±æ€§è·Ÿå®ä¾‹çš„è®¡ç®—å‹å±æ€§ä¸€æ ·åªèƒ½å®šä¹‰æˆå˜é‡å±æ€§ã€‚è·Ÿå®ä¾‹çš„å­˜å‚¨å‹å±æ€§ä¸åŒï¼Œå¿…é¡»ç»™å­˜å‚¨å‹ç±»å‹å±æ€§æŒ‡å®šé»˜è®¤å€¼ï¼Œå› ä¸ºç±»å‹æœ¬èº«æ²¡æœ‰æ„é€ å™¨ï¼Œä¹Ÿå°±æ— æ³•åœ¨åˆå§‹åŒ–è¿‡ç¨‹ä¸­ä½¿ç”¨æ„é€ å™¨ç»™ç±»å‹å±æ€§èµ‹å€¼ã€‚å­˜å‚¨å‹ç±»å‹å±æ€§æ˜¯å»¶è¿Ÿåˆå§‹åŒ–çš„ï¼Œå®ƒä»¬åªæœ‰åœ¨ç¬¬ä¸€æ¬¡è¢«è®¿é—®çš„æ—¶å€™æ‰ä¼šè¢«åˆå§‹åŒ–ï¼Œå³ä½¿å®ƒä»¬è¢«å¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®ï¼Œç³»ç»Ÿä¹Ÿä¿è¯åªä¼šå¯¹å…¶è¿›è¡Œä¸€æ¬¡åˆå§‹åŒ–ï¼Œå¹¶ä¸”ä¸éœ€è¦å¯¹å…¶ä½¿ç”¨lazyä¿®é¥°ç¬¦ã€‚ å¦‚æœå°†å±æ€§é€šè¿‡in-outæ–¹å¼ä¼ å…¥å‡½æ•°ï¼ŒwillSet å’Œ didSet ä¹Ÿä¼šè°ƒç”¨ï¼Œè¿™æ˜¯å› ä¸º in-outå‚æ•°é‡‡ç”¨äº†æ‹·å…¥æ‹·å‡ºæ¨¡å¼ï¼šå³åœ¨å‡½æ•°å†…éƒ¨ä½¿ç”¨çš„æ˜¯å‚æ•°çš„copyï¼Œå‡½æ•°ç»“æŸåï¼Œåˆå¯¹å‚æ•°é‡æ–°èµ‹å€¼ï¼› ","date":"2022-07-26","objectID":"/swift%E8%A7%A3%E6%83%91/:2:0","tags":["iOS","swift"],"title":"Swiftè§£æƒ‘","uri":"/swift%E8%A7%A3%E6%83%91/"},{"categories":["å®ç°åŸç†"],"content":"å€¼ç±»å‹çº¿ç¨‹å®‰å…¨ï¼Ÿ ä¸è¦äººäº‘äº¦äº‘ï¼Œè¿™ä¸ªè¯´æ³•æ˜¯æœ‰é—®é¢˜çš„ï¼Œæ€è€ƒä¸€ä¸‹ï¼šå‡å¦‚æˆ‘ä»¬æœ‰ä¸ªå˜é‡ var i = 1ï¼Œå¤šçº¿ç¨‹ä¿®æ”¹æ—¶ä¸éœ€è¦åŠ é”ï¼Ÿ åœ¨æœªä¼˜åŒ–çŠ¶æ€ä¸‹å€¼ç±»å‹å…¶å®é»˜è®¤æ˜¯åœ¨å †ä¸Šåˆ†é…çš„ï¼Œåªæ˜¯åœ¨SILä¼˜åŒ–é˜¶æ®µï¼Œç¼–è¯‘å™¨ä¼šæ ¹æ®ä¸Šä¸‹æ–‡æŠŠå¤§éƒ¨åˆ†å€¼ç±»å‹æ”¹ä¸ºåœ¨æ ˆä¸Šåˆ†é…ï¼Œåœ¨æ ˆä¸Šåˆ†é…çš„æƒ…å†µæ˜¯æ‰æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå› ä¸ºæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„æ ˆç©ºé—´ï¼Œä¸éœ€è¦è€ƒè™‘çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚ä½†æ˜¯å¯¹äºè¢«æ•è·çš„è¿™ç§æƒ…å†µæ˜¯æ²¡åŠæ³•ä¼˜åŒ–çš„ï¼Œä½ æƒ³æƒ³å¦‚æœæ”¾åˆ°æ ˆä¸Šåœ¨å‡ºä½œç”¨åŸŸåä¸å°±è¢«é‡Šæ”¾äº†å˜›ï¼Œæ‰€ä»¥è¿™ç§æƒ…å†µä¸ä¼šä¼˜åŒ–åˆ°æ ˆä¸Šï¼Œè€Œæ˜¯ç»§ç»­ç•™åœ¨å †ä¸Šï¼Œä¹Ÿå°±æ˜¯è¯´è¿™ç§åœºæ™¯ä¸‹å¤šçº¿ç¨‹æ“ä½œå€¼ç±»å‹æ˜¯ä¸å®‰å…¨çš„ï¼Œéœ€è¦åŠ é”æ¥é˜²æ­¢æ•°æ®ç«äº‰ã€‚ é‚£å€¼ç±»å‹çš„å®‰å…¨æ€§ä½“ç°åœ¨å“ªé‡Œå‘¢ï¼Ÿ æ˜¾å¼æ•è·ï¼šè¿™ç§æƒ…å†µä¼šå‘ç”Ÿå€¼ç±»å‹çš„æ‹·è´æ“ä½œï¼Œå³ç”Ÿæˆä¸€ä»½æ–°çš„å˜é‡ï¼Œæ‰€ä»¥æ˜¯å®‰å…¨çš„ å‡½æ•°ä¼ å‚æ—¶å€¼ç±»å‹ä¼šå‘ç”Ÿæ‹·è´ï¼Œæ‰€ä»¥æ˜¯å®‰å…¨çš„ let æ ‡è®°çš„å˜é‡æ˜¯ä¸å…è®¸ä¿®æ”¹çš„ï¼Œæ‰€ä»¥è¿™ç§ä¹Ÿæ˜¯å®‰å…¨çš„ ","date":"2022-07-26","objectID":"/swift%E8%A7%A3%E6%83%91/:3:0","tags":["iOS","swift"],"title":"Swiftè§£æƒ‘","uri":"/swift%E8%A7%A3%E6%83%91/"},{"categories":["å®ç°åŸç†"],"content":"é—­åŒ…ï¼ˆclosureï¼‰ closure-define é—­åŒ…å’Œå‡½æ•°éƒ½æ˜¯å¼•ç”¨ç±»å‹ å‡½æ•°ä¹Ÿæ˜¯ç‰¹æ®Šçš„é—­åŒ… Objective-Cä¸­çš„blocké»˜è®¤ä¼šæ•è·å¤–ç•Œå˜é‡ï¼Œæˆ‘ä»¬è¦æƒ³ä¿®æ”¹æ•è·çš„å€¼éœ€è¦æ·»åŠ __blockã€‚ å¯æ˜¯åœ¨Swiftä¸­ä¸å¤ªä¸€æ ·ï¼ŒSwiftä¸­çš„é—­åŒ…æ˜¯æ•è·å’Œå­˜å‚¨å…¶æ‰€åœ¨ä¸Šä¸‹æ–‡ä¸­ä»»æ„å¸¸é‡å’Œå˜é‡çš„å¼•ç”¨ å¼•ç”¨ å¼•ç”¨ï¼Œæ³¨æ„æ˜¯å¼•ç”¨ï¼Œå¦‚æœæƒ³è¦æ•è·å€¼ç±»å‹å˜é‡çš„å€¼ï¼Œéœ€è¦åœ¨é—­åŒ…ä¸­æ˜¾å¼å¼•ç”¨ã€‚ æˆ‘ä»¬æ¥ç®€å•åˆ†æä¸‹ï¼ŒSwiftæ•è·å¤–ç•Œä¸Šä¸‹æ–‡å˜é‡æ—¶ä¼šåœ¨å †ä¸Šå¼€è¾Ÿä¸€å—å†…å­˜project_box ï¼ˆä»”ç»†æƒ³æƒ³ï¼Œå¦‚æœæ˜¯åœ¨æ ˆä¸Šï¼Œå‡ºä½œç”¨åŸŸå°±ä¼šé‡Šæ”¾æ‰ï¼Œè¿˜æ€ä¹ˆå®ç°æ•è·çš„ç›®çš„ï¼Ÿï¼ï¼‰ï¼Œç„¶åä¸Šä¸‹æ–‡å˜é‡ä¼šè¢«åŒ…è£…æˆproject_box(å…ˆè¢«HeapObjectåŒ…è£…ä¸€ä¸‹ï¼ŒHeapObjectå†è¢«BoxåŒ…è£…ä¸€ä¸‹ï¼Œæœ€åæ•è·çš„æ˜¯Boxï¼Œå³æ•è·çš„ä¸Šä¸‹æ–‡å­˜å‚¨åœ¨å †ç©ºé—´)ï¼Œè¿™ä¸ªproject_boxä¼šè¢«æ”¾åˆ°é—­åŒ…çš„å‚æ•°åˆ—è¡¨åé¢ä¼ é€’è¿›æ¥ã€‚å˜é‡å±äºæ˜¯è¢«é—´æ¥æ•è·çš„ï¼Œæœ‰ç‚¹ç±»ä¼¼äºOCä¸­çš„__blockåŸç†ã€‚å½“ç„¶ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„å¤–ç•Œå˜é‡æ•è·éƒ½æ˜¯ç»è¿‡åŒ…è£…è¿‡çš„ï¼Œåªæœ‰åœ¨é—­åŒ…å†…å‘ç”Ÿä¿®æ”¹çš„å˜é‡æ‰ä¼šè¢«åŒ…è£…ï¼Œå®˜æ–¹æ–‡æ¡£ä¸­æœ‰æåˆ°ã€‚ æ³¨æ„ï¼š ä¸ºäº†ä¼˜åŒ–ï¼Œå¦‚æœä¸€ä¸ªå€¼ä¸ä¼šè¢«é—­åŒ…æ”¹å˜ï¼Œæˆ–è€…åœ¨é—­åŒ…åˆ›å»ºåä¸ä¼šæ”¹å˜ï¼ŒSwift å¯èƒ½ä¼šæ”¹ä¸ºæ•è·å¹¶ä¿å­˜ä¸€ä»½å¯¹å€¼çš„æ‹·è´ã€‚ struct HeapObject { var Kind: UInt64 var refcount: UInt64 } // è´Ÿè´£åŒ…è£…çš„ç»“æ„ä½“,ä¹Ÿå°±æ˜¯ç”¨æ¥åŒ…è£…æ•è·éœ€è¦æ›´æ–°çš„å€¼ struct Box { var refCounted: HeapObject // è¿™ä¸ªæ•è·çš„å€¼çš„ç±»å‹æ ¹æ®æ•è·çš„å€¼è¿›è¡Œåˆ†é…ï¼Œæ­¤å¤„è§„èŒƒæ“ä½œæ˜¯å†™æ³›å‹ // var value: Int var value: \u003cT\u003e } è€Œæ˜¾å¼æ•è·ï¼Œæ¯”å¦‚æ•è·å…¨å±€å˜é‡çš„åœºæ™¯ï¼Œç»è¿‡ç¼–è¯‘åå¯ä»¥å‘ç°ï¼Œå…¶å®æ˜¯æŠŠè¢«æ•è·çš„å˜é‡ä½œä¸ºé—­åŒ…å‡½æ•°çš„å‚æ•°æ”¾åˆ°äº†åŸæœ‰é—­åŒ…å‡½æ•°çš„åé¢ï¼Œè€Œå€¼ç±»å‹çš„å‡½æ•°å‚æ•°åœ¨ä¼ å‚è¿‡ç¨‹ä¸­ä¼šå‘ç”Ÿæ‹·è´æ“ä½œã€‚ ","date":"2022-07-26","objectID":"/swift%E8%A7%A3%E6%83%91/:4:0","tags":["iOS","swift"],"title":"Swiftè§£æƒ‘","uri":"/swift%E8%A7%A3%E6%83%91/"},{"categories":["å®ç°åŸç†"],"content":"Lazy è¿™é‡Œçš„lazyæŒ‡çš„æ˜¯é«˜é˜¶å‡½æ•°å‰é¢çš„lazyï¼Œè€Œéå±æ€§å£°æ˜ä¸­çš„lazyã€‚ ä½¿ç”¨lazyåå†æ‰§è¡Œé«˜é˜¶å‡½æ•°ï¼Œè¿”å›çš„å…¶å®æ˜¯ä¸€ä¸ªlazyå¯¹è±¡ï¼Œæ¯”å¦‚å¯¹ä¸€ä¸ªæ•°ç»„è¿›è¡ŒXXæ“ä½œï¼Œè¿”å›çš„æ˜¯ LazyXXSequence ç±»å‹ï¼Œè¿™ä¸ªç±»å‹ä¸­ä¼šä¿å­˜åŸå‡½æ•°çš„æ“ä½œè¡Œä¸ºå’ŒåŸå§‹æ•°æ®ï¼Œåªæœ‰åœ¨å¯¹è¿™ä¸ªlazyç±»å‹è¿›è¡Œæ“ä½œæ—¶æ‰ä¼šçœŸæ­£è¿›è¡Œå‡½æ•°æ“ä½œã€‚ swift_lazy ","date":"2022-07-26","objectID":"/swift%E8%A7%A3%E6%83%91/:5:0","tags":["iOS","swift"],"title":"Swiftè§£æƒ‘","uri":"/swift%E8%A7%A3%E6%83%91/"},{"categories":["å®ç°åŸç†"],"content":"Weakæœºåˆ¶ Swiftä¸­weakä¸Objective-Cä¸­çš„weakå®ç°æœºåˆ¶ä¸å¤ªä¸€æ ·ï¼ŒObjective-Cä¸­æ˜¯ä¸å…è®¸åœ¨ä¸€ä¸ªå¯¹è±¡é‡Šæ”¾è¿‡ç¨‹ä¸­å†è¢«å¼±å¼•ç”¨çš„ï¼Œè€ŒSwiftå´æ²¡æœ‰è¿™ä¸ªé™åˆ¶ã€‚ Swiftä¸­çš„å¼±å¼•ç”¨å¹¶æ²¡æœ‰å’ŒObjective-Cä¸€æ ·æ”¾åœ¨å…¨å±€çš„side tableè¡¨ä¸­ï¼ˆSwiftä¹Ÿä¸å­˜åœ¨è¿™ä¸ªå…¨å±€side tableï¼‰ï¼Œè€Œæ˜¯ç”±è‡ªèº«ç»“æ„ä¸­çš„ InlineRefCounts refCountsæ¥ç®¡ç†ï¼Œè¿™æ ·æ•ˆèƒ½ä¼šæ¯”Objective-Cé‚£ç§æŸ¥è¡¨çš„æ–¹å¼é«˜ä¸€äº›ã€‚ Swiftå¯¹è±¡åŸºæœ¬ç»“æ„å¦‚ä¸‹ï¼š // The members of the HeapObject header that are not shared by a // standard Objective-C instance #define SWIFT_HEAPOBJECT_NON_OBJC_MEMBERS \\ InlineRefCounts refCounts /// The Swift heap-object header. /// This must match RefCountedStructTy in IRGen. struct HeapObject { /// This is always a valid pointer to a metadata object. HeapMetadata const *__ptrauth_objc_isa_pointer metadata; SWIFT_HEAPOBJECT_NON_OBJC_MEMBERS; #ifndef __swift__ HeapObject() = default; // Initialize a HeapObject header as appropriate for a newly-allocated object. constexpr HeapObject(HeapMetadata const *newMetadata) : metadata(newMetadata) , refCounts(InlineRefCounts::Initialized) { } // Initialize a HeapObject header for an immortal object constexpr HeapObject(HeapMetadata const *newMetadata, InlineRefCounts::Immortal_t immortal) : metadata(newMetadata) , refCounts(InlineRefCounts::Immortal) { } #ifndef NDEBUG void dump() const SWIFT_USED; #endif #endif // __swift__ }; Swift å¼•ç”¨è®¡æ•°çš„å­˜å‚¨ç»“æ„åœ¨RefCount å¤´æ–‡ä»¶ æœ‰ä»‹ç»ï¼š //Objects initially start with no side table. They can gain a side table when: //* a weak reference is formed and pending future implementation: //* strong RC or unowned RC overflows (inline RCs will be small on 32-bit) //* associated object storage is needed on an object //* etc //Gaining a side table entry is a one-way operation; an object with a side //table entry never loses it. This prevents some thread races. //Strong and unowned variables point at the object. //Weak variables point at the object's side table. //Storage layout: HeapObject { isa InlineRefCounts { atomic\u003cInlineRefCountBits\u003e { strong RC + unowned RC + flags OR HeapObjectSideTableEntry* } } } HeapObjectSideTableEntry { SideTableRefCounts { object pointer atomic\u003cSideTableRefCountBits\u003e { strong RC + unowned RC + weak RC + flags } } } ä¸€èˆ¬æƒ…å†µä¸‹Swiftå¼•ç”¨ç±»å‹çš„å¯¹è±¡ç»“æ„ä¸­çš„InlineRefCountså¹¶ä¸ä¼šå¼€è¾ŸHeapObjectSideTableEntryå†…å­˜ï¼Œåªæœ‰åœ¨åˆ›å»ºweakå¼•ç”¨æ—¶ï¼Œä¼šå…ˆæŠŠå¯¹è±¡çš„å¼•ç”¨è®¡æ•°æ”¾åˆ°æ–°åˆ›å»ºçš„HeapObjectSideTableEntryä¸­å»ï¼Œå†æŠŠç©ºå‡ºæ¥çš„ç©ºé—´å­˜æ”¾ HeapObjectSideTableEntry çš„åœ°å€ï¼Œè€Œ runtime ä¼šé€šè¿‡ä¸€ä¸ªæ ‡å¿—ä½æ¥åŒºåˆ†å¯¹è±¡æ˜¯å¦æœ‰ HeapObjectSideTableEntryã€‚ å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸåœ¨ RefCount å¤´æ–‡ä»¶ ä¸­ä¹Ÿæœ‰è¯¦ç»†çš„è¯´æ˜ï¼š Object lifecycle state machine: LIVE without side table The object is alive. Object's refcounts are initialized as 1 strong, 1 unowned, 1 weak. No side table. No weak RC storage. Strong variable operations work normally. Unowned variable operations work normally. Weak variable load can't happen. Weak variable store adds the side table, becoming LIVE with side table. When the strong RC reaches zero deinit() is called and the object becomes DEINITING. LIVE with side table Weak variable operations work normally. Everything else is the same as LIVE. DEINITING without side table deinit() is in progress on the object. Strong variable operations have no effect. Unowned variable load halts in swift_abortRetainUnowned(). Unowned variable store works normally. Weak variable load can't happen. Weak variable store stores nil. When deinit() completes, the generated code calls swift_deallocObject. swift_deallocObject calls canBeFreedNow() checking for the fast path of no weak or unowned references. If canBeFreedNow() the object is freed and it becomes DEAD. Otherwise, it decrements the unowned RC and the object becomes DEINITED. DEINITING with side table Weak variable load returns nil. Weak variable store stores nil. canBeFreedNow() is always false, so it never transitions directly to DEAD. Everything else is the same as DEINITING. DEINITED without side table deinit() has completed but there are unowned references outstanding. Strong variable operations can't happen. Unowned variable store can't happen. Unowned variable load halts in swift_abortRetainUnowned(). Weak variable operations can't happen. When the unowned RC reaches zero, the object is freed and it becomes DEAD. DEINITED with si","date":"2022-07-26","objectID":"/swift%E8%A7%A3%E6%83%91/:6:0","tags":["iOS","swift"],"title":"Swiftè§£æƒ‘","uri":"/swift%E8%A7%A3%E6%83%91/"},{"categories":["å®ç°åŸç†"],"content":"struct åµŒå¥—ç±»å‹ä¼šå½±å“çˆ¶çº§ç»“æ„çš„å†…å­˜å ç”¨å—ï¼Ÿ ä¸ä¼šã€‚æœ€ç®€å•çš„éªŒè¯æ–¹æ³•å°±æ˜¯é€šè¿‡MemoryLayout\u003cType\u003e.sizeæ‰“å°ä¸€ä¸‹çˆ¶çº§ç»“æ„æ‰€å å†…å­˜å¤§å°å°±æ¸…æ¥šäº†ã€‚ä¹Ÿå°±æ˜¯è¯´åµŒå¥—åªæ˜¯èµ·åˆ°äº†å‘½åç©ºé—´çš„ä½œç”¨ï¼Œå¹¶ä¸ä¼šå½±å“å…¶ä»–ä¸œè¥¿ Arrayå­˜Anyç±»å‹çš„å…ƒç´ æ˜¯æ€ä¹ˆå†…å­˜å¯¹é½çš„ï¼Ÿ å…ƒç´ ä¼šè¢«åŒ…è£…æˆexistentialç±»å‹ï¼Œåˆæ­¥çŒœæµ‹åº”è¯¥å’Œæ•°ç»„ä¸­å­˜æ”¾éµå®ˆç›¸åŒåè®®çš„å…ƒç´ çš„å¤„ç†æ–¹å¼ç±»ä¼¼ã€‚ ä¸‹é¢æˆªå–å‡½æ•°åŸå‹ä¸ºarr.append(1); arr.append((100, 200)); arr.append(XX());çš„éƒ¨åˆ†SILä»£ç ï¼Œæ³¨æ„é‡Œé¢çš„init_existential_addrå­—çœ¼ï¼š store %6 to %3 : $*Array\u003cAny\u003e // id: %7 %8 = alloc_stack $Any // users: %17, %15, %11 %9 = integer_literal $Builtin.Int64, 1 // user: %10 %10 = struct $Int (%9 : $Builtin.Int64) // user: %12 %11 = init_existential_addr %8 : $*Any, $Int // user: %12 store %10 to %11 : $*Int // id: %12 %13 = begin_access [modify] [dynamic] %3 : $*Array\u003cAny\u003e // users: %16, %15 // function_ref Array.append(_:) %14 = function_ref @Swift.Array.append(__owned A) -\u003e () : $@convention(method) \u003cÏ„_0_0\u003e (@in Ï„_0_0, @inout Array\u003cÏ„_0_0\u003e) -\u003e () // user: %15 %15 = apply %14\u003cAny\u003e(%8, %13) : $@convention(method) \u003cÏ„_0_0\u003e (@in Ï„_0_0, @inout Array\u003cÏ„_0_0\u003e) -\u003e () end_access %13 : $*Array\u003cAny\u003e // id: %16 dealloc_stack %8 : $*Any // id: %17 %18 = alloc_stack $Any // users: %32, %30, %19 %19 = init_existential_addr %18 : $*Any, $(Int, Int) // users: %21, %20 %20 = tuple_element_addr %19 : $*(Int, Int), 0 // user: %24 %21 = tuple_element_addr %19 : $*(Int, Int), 1 // user: %27 %22 = integer_literal $Builtin.Int64, 100 // user: %23 %23 = struct $Int (%22 : $Builtin.Int64) // user: %24 store %23 to %20 : $*Int // id: %24 %25 = integer_literal $Builtin.Int64, 200 // user: %26 %26 = struct $Int (%25 : $Builtin.Int64) // user: %27 store %26 to %21 : $*Int // id: %27 %28 = begin_access [modify] [dynamic] %3 : $*Array\u003cAny\u003e // users: %31, %30 // function_ref Array.append(_:) %29 = function_ref @Swift.Array.append(__owned A) -\u003e () : $@convention(method) \u003cÏ„_0_0\u003e (@in Ï„_0_0, @inout Array\u003cÏ„_0_0\u003e) -\u003e () // user: %30 %30 = apply %29\u003cAny\u003e(%18, %28) : $@convention(method) \u003cÏ„_0_0\u003e (@in Ï„_0_0, @inout Array\u003cÏ„_0_0\u003e) -\u003e () end_access %28 : $*Array\u003cAny\u003e // id: %31 dealloc_stack %18 : $*Any // id: %32 %33 = alloc_stack $Any // users: %43, %41, %37 %34 = metatype $@thick XX.Type // user: %36 // function_ref XX.__allocating_init() %35 = function_ref @A.XX.__allocating_init() -\u003e A.XX : $@convention(method) (@thick XX.Type) -\u003e @owned XX // user: %36 %36 = apply %35(%34) : $@convention(method) (@thick XX.Type) -\u003e @owned XX // user: %38 %37 = init_existential_addr %33 : $*Any, $XX // user: %38 store %36 to %37 : $*XX // id: %38 %39 = begin_access [modify] [dynamic] %3 : $*Array\u003cAny\u003e // users: %42, %41 ","date":"2022-07-26","objectID":"/swift%E8%A7%A3%E6%83%91/:7:0","tags":["iOS","swift"],"title":"Swiftè§£æƒ‘","uri":"/swift%E8%A7%A3%E6%83%91/"},{"categories":["å®ç°åŸç†"],"content":"æšä¸¾ ","date":"2022-07-26","objectID":"/swift%E8%A7%A3%E6%83%91/:8:0","tags":["iOS","swift"],"title":"Swiftè§£æƒ‘","uri":"/swift%E8%A7%A3%E6%83%91/"},{"categories":["å®ç°åŸç†"],"content":"å†…å­˜å ç”¨ æ™®é€šçš„æšä¸¾ï¼ˆéå…³è”ç±»å‹ï¼‰è‡ªèº«åªå ç”¨1ä¸ªå­—èŠ‚ï¼Œä¸caseæ•°é‡æ— å…³ï¼› å¸¦å…³è”å€¼çš„æšä¸¾ï¼Œå…¶æ‰€å å†…å­˜å¤§å°ä¸ºæ‰€æœ‰caseä¸­å…³è”ç±»å‹å ç”¨å†…å­˜æœ€å¤§çš„é‚£ä¸ª(ç±»ä¼¼union)ï¼Œå†åŠ æšä¸¾è‡ªèº«çš„å¤§å°ï¼› ç‰¹æ®Šåœºæ™¯ï¼šåªæœ‰ä¸€ä¸ªcaseçš„æšä¸¾ï¼Œæšä¸¾æœ¬èº«æ‰€å ç”¨çš„å†…å­˜å¤§å°æ˜¯0ä¸ªå­—èŠ‚ï¼Œå¦‚æœå¸¦å…³è”å€¼ï¼Œé‚£æšä¸¾æ‰€å å†…å­˜å¤§å°åªåŒ…å«å…³è”å€¼æ‰€å å†…å­˜çš„å¤§å°ï¼Œä¸åŒ…å«æšä¸¾è‡ªèº«çš„å¤§å°ï¼› å¯¹äºæœ‰å…³è”å€¼çš„caseï¼Œå®ƒçš„caseå€¼ä¼šæ ¹æ®å®šä¹‰çš„é¡ºåºé»˜è®¤ä»0å¼€å§‹ç´¯åŠ 1ï¼›è€Œå…¶ä½™æ‰€æœ‰ä¸å¸¦å…³è”å€¼çš„caseï¼Œå®ƒä»¬çš„caseåœ°å€ç›¸åŒï¼Œéƒ½ç­‰äºæœ€åä¸€ä¸ªå¸¦å…³è”æˆå‘˜caseçš„å€¼+1ï¼ˆä¹Ÿå°±æ˜¯è¯´ä¸å¸¦å…³è”å€¼çš„caseåœ¨å¸¦å…³è”å€¼çš„caseåé¢ï¼‰ï¼› å…³è”å€¼æ˜¯ç›´æ¥å­˜å‚¨åœ¨æšä¸¾å˜é‡å†…å­˜é‡Œé¢çš„ï¼Œè€ŒåŸå§‹å€¼ä¸æ˜¯ï¼Œå®ƒæ˜¯é€šè¿‡xx.rawValueï¼ˆè®¡ç®—å±æ€§ï¼‰è®¿é—®çš„ï¼Œå› æ­¤å®ƒçš„åŸå§‹å€¼å®Œå…¨ä¸éœ€è¦å­˜å‚¨ï¼ˆæšä¸¾ä¹Ÿä¸æ”¯æŒå­˜å‚¨å±æ€§ï¼‰ï¼Œè€Œæ˜¯åœ¨è®¡ç®—å±æ€§å‡½æ•°çš„è¿”å›å€¼ä¸­ï¼Œå³å‡½æ•°ä¸­ã€‚rawValueè¿™ä¸ªè®¡ç®—å±æ€§æ˜¯ç¼–è¯‘å™¨å¸®æˆ‘ä»¬é»˜è®¤æ·»åŠ çš„ï¼Œå®ƒçš„è¿”å›å€¼é»˜è®¤æ˜¯æˆ‘ä»¬è®¾ç½®çš„åŸå§‹å€¼ï¼Œå‡å¦‚æˆ‘ä»¬è‡ªå·±å®ç°äº†è¿™ä¸ªè®¡ç®—å±æ€§ï¼Œç¼–è¯‘å™¨å°±ä¸ä¼šå¸®æˆ‘ä»¬é»˜è®¤æ·»åŠ äº†ï¼Œè€Œæ˜¯ä½¿ç”¨æˆ‘ä»¬è‡ªå·±çš„å®ç°ï¼› åµŒå¥—æšä¸¾ï¼šè¢«indirectæ ‡è®°çš„å¯¹è±¡ä¼šè¢«BoxPairåŒ…è£…æˆå¼•ç”¨ç±»å‹ï¼ˆæ”¾åˆ°å †ä¸Šï¼‰ï¼Œå’ŒRustä¸€æ ·çš„å¤„ç†æ–¹å¼ï¼ˆRustä¸­æ˜¯è¢«åŒ…è£…æˆBoxç±»å‹ï¼‰ï¼› ","date":"2022-07-26","objectID":"/swift%E8%A7%A3%E6%83%91/:8:1","tags":["iOS","swift"],"title":"Swiftè§£æƒ‘","uri":"/swift%E8%A7%A3%E6%83%91/"},{"categories":["å®ç°åŸç†"],"content":"æ´¾å‘æ–¹å¼ é™æ€æ´¾å‘ å‡½æ•°è¡¨æ´¾å‘ æ¶ˆæ¯æ´¾å‘ æ·»åŠ  @objc æ ‡è¯†ï¼Œç¼–è¯‘å™¨ä¼šç”Ÿæˆä¸¤ä»½å‡½æ•°å®ç°ï¼Œä¸€ä»½æ˜¯æ¶ˆæ¯æ´¾å‘çš„å‡½æ•°ä¾›OCè°ƒç”¨ï¼Œå¦ä¸€ä»½æ˜¯å‡½æ•°è¡¨æ´¾å‘æˆ–é™æ€æ´¾å‘çš„å‡½æ•°å®ç°ï¼›æ¶ˆæ¯æ´¾å‘é‚£ä¸ªå‡½æ•°å†…éƒ¨ä¼šè°ƒç”¨å¦ä¸€ä»½å®ç°ï¼Œæˆ‘è§‰å¾—å¯ä»¥ç®€å•ç†è§£ä¸º@objcåªæ˜¯ç¼–è¯‘å™¨å¸®æˆ‘ä»¬æš´æ¼äº†ä¸€ä¸ªOCæ¥å£è€Œå·²ï¼› å¤šä½¿ç”¨finalå…³é”®å­—ï¼Œä¸€ä¸ªç±»æ ‡è®°ä¸ºfinalåï¼Œé»˜è®¤çš„å‡½æ•°è¡¨æ´¾å‘ä¼šå˜æˆé™æ€æ´¾å‘ï¼Œä½†æ˜¯å®ƒä¸ä¼šå½±å“@objcè¿™ä¸ªæ¥å£çš„ç”Ÿæˆï¼›å‡½æ•°ç”¨finalæ ‡è®°åä¹Ÿä¼šå˜æˆé™æ€æ´¾å‘ï¼› åœ¨extensionä¸­çš„æ–¹æ³•æ˜¯é™æ€æ´¾å‘ï¼› protocolä¸­å£°æ˜çš„æ–¹æ³•å±äºå‡½æ•°è¡¨æ´¾å‘ï¼Œå³ä½¿åœ¨extensionä¸­æ·»åŠ äº†é»˜è®¤å®ç°ï¼Œå½“æˆ‘ä»¬åœ¨è°ƒç”¨æŸä¸ªå¯¹è±¡çš„è¿™ä¸ªåè®®æ–¹æ³•æ—¶é‡‡ç”¨çš„ä¹Ÿæ˜¯å‡½æ•°è¡¨æ´¾å‘ï¼›ä½†æ˜¯æˆ‘ä»¬è°ƒç”¨protocolçš„extensionä¸­çš„æŸä¸ªæœªä½œä¸ºåè®®å£°æ˜çš„æ–¹æ³•æ—¶ï¼Œé‡‡ç”¨çš„æ˜¯é™æ€æ´¾å‘çš„ç­–ç•¥ï¼› privateå‡½æ•°å¹¶æœªæ”¹å˜å‡½æ•°çš„æ´¾å‘æ–¹å¼ï¼ˆiOSæ‘¸é±¼å‘¨æŠ¥#73 ä¸­è¯´privateä¼šéšå¼finalå£°æ˜ï¼Œä½†æˆ‘æµ‹è¯•å‘ç°å®ƒå¹¶ä¸ä¼šæ”¹å˜å‡½æ•°çš„æ´¾å‘æ–¹å¼ï¼Œæ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥è‡ªå·±éªŒè¯ä¸€ä¸‹ï¼‰ï¼› ","date":"2022-07-26","objectID":"/swift%E8%A7%A3%E6%83%91/:9:0","tags":["iOS","swift"],"title":"Swiftè§£æƒ‘","uri":"/swift%E8%A7%A3%E6%83%91/"},{"categories":["å®ç°åŸç†"],"content":"any VS some // 1.æ³›å‹ func tFoo\u003cT: Equatable\u003e() -\u003e T { return 42 as! T } // 2.some func someFoo() -\u003e some Equatable { return 42 } // 3.any func anyFoo() -\u003e any Equatable { return 42 } someæ˜¯Swift 5.1æ–°åŠ çš„ã€‚anyæ˜¯Swift 5.6å¼•å…¥çš„ï¼Œç”¨æ¥ä¿®é¥°existential typeï¼Œåœ¨Swift5.7ä¸­è¿™ä¸ªä¿®é¥°è¡Œä¸ºå˜ä¸ºäº†å¼ºåˆ¶ï¼› someå…¶å®åªæ˜¯å¯¹æ³›å‹åè®®å‚æ•°çš„ä¸€ç§ç­‰ä»·ç®€åŒ–ï¼ˆå¦‚ä¸Šçš„1å’Œ2æ˜¯ç­‰ä»·çš„ï¼‰ï¼Œä¹Ÿå°±æ˜¯è¯´someåœ¨ç¼–è¯‘æœŸå°±å¯ä»¥ç¡®å®šå‡ºç±»å‹ï¼Œåœ¨æ–¹æ³•è°ƒç”¨ä¸Šå¯ä»¥åšåˆ°å‡½æ•°è¡¨æ´¾å‘ã€é™æ€æ´¾å‘ï¼› anyåˆ™æ˜¯ç±»ä¼¼ç›’å­çš„ç±»å‹ï¼Œå®ƒåŒ…è£…äº†éµå¾ªç‰¹å®šåè®®çš„ç±»å‹ã€‚è¿™ä¸ªboxç›’å­å…è®¸æˆ‘ä»¬å»å­˜å‚¨ä»»ä½•å…·ä½“ç±»å‹ï¼Œåªè¦è¯¥ç±»å‹éµå¾ªäº†ç‰¹å®šåè®®å³å¯ã€‚ æ€§èƒ½ï¼šç”±äºç¼–è¯‘å™¨æ— æ³•åœ¨ç¼–è¯‘æœŸç¡®å®šç›’å­å†…å¯¹è±¡çš„å…·ä½“ç±»å‹ä»¥åŠå†…å­˜åˆ†é…æ–¹å¼ï¼Œå¯¼è‡´åœ¨è¿è¡Œæ—¶ä¸å¾—ä¸é‡‡ç”¨åŠ¨æ€æ´¾å‘çš„æ–¹å¼å°†æ¶ˆæ¯æ´¾å‘åˆ°å…·ä½“çš„å¯¹è±¡ä¸Šï¼Œè¿™è‚¯å®šæ¯”é™æ€æ´¾å‘æ–¹å¼è¦æ…¢å¾ˆå¤šã€‚ ç”±äºexistential typeä½¿ç”¨ä¸Šå¤ªç®€å•ã€å¤ªæ–¹ä¾¿ï¼Œå¾ˆå®¹æ˜“ä¼šå‡ºç°æ»¥ç”¨çš„æƒ…å†µï¼Œä¸ºäº†æé†’å¼€å‘äººå‘˜æ€§èƒ½æŸå¤±è¿™ä¸€ç‚¹ï¼Œæ‰€ä»¥åœ¨Swift 5.7ä¸­è‹¹æœå¼ºåˆ¶è¦æ±‚å¯¹existential typeä½¿ç”¨anyæ¥æ ‡è®°ã€‚ æˆ‘ä»¬ä¸èƒ½ä½¿ç”¨==æ“ä½œæ¥æ¯”è¾ƒä¸¤ä¸ªexistential typeå®ä¾‹å¯¹è±¡ã€‚ some_vs_any æœ€åï¼Œæ ¹æ®ä¸‹é¢çš„ä¾‹å­ä½“ä¼šä¸€ä¸‹ï¼š // âœ… No compile error when changing the underlying data type var myCar: any Vehicle = Car() myCar = Bus() myCar = Car() â€‹ // ğŸ”´ Compile error in Swift 5.7: Use of protocol 'Vehicle' as a type must be written 'any Vehicle' func wash(_ vehicle: Vehicle) { // Wash the given vehicle } â€‹ // âœ… No compile error in Swift 5.7 func wash(_ vehicle: any Vehicle) { // Wash the given vehicle } // ğŸ”´ Compile error in Swift 5.7: Use of protocol 'Vehicle' as a type must be written 'any Vehicle' // ä¸€ä¸ªå‡½æ•°ä¸èƒ½è¿”å›å¤šç§ç±»å‹ç»“æœï¼Œè€Œ`some`åœ¨ç¼–è¯‘æœŸå°±å¯ä»¥ç¡®å®šç±»å‹ï¼Œæ‰€ä»¥ç¼–è¯‘å¤±è´¥ func createVehicle(isPublicTransport: Bool) -\u003e some Vehicle { if isPublicTransport { return Bus() } else { return Car() } } â€‹ // âœ… No compile error when returning different kind of concrete type func createAnyVehicle(isPublicTransport: Bool) -\u003e any Vehicle { if isPublicTransport { return Bus() } else { return Car() } } ","date":"2022-07-26","objectID":"/swift%E8%A7%A3%E6%83%91/:10:0","tags":["iOS","swift"],"title":"Swiftè§£æƒ‘","uri":"/swift%E8%A7%A3%E6%83%91/"},{"categories":["å®ç°åŸç†"],"content":"@objcæ–¹æ³•çš„æ´¾å‘æ–¹å¼ ä¸è€ƒè™‘@dynamicå…³é”®å­—æ ‡è®°çš„åœºæ™¯ï¼ˆè¢«@dynamicå’Œ@objcæ ‡è®°åä¼šå˜ä¸ºæ¶ˆæ¯æ´¾å‘ï¼‰ Swiftæ–¹æ³•è¢«@objcæ ‡è®°åï¼Œç¼–è¯‘å™¨ä¼šç”Ÿæˆ2ä»½æ¥å£ï¼šä¸€ä»½æ˜¯Swiftæ¥å£ï¼Œä¾›Swiftå†…éƒ¨è°ƒç”¨ï¼›å¦ä¸€ä»½æ˜¯OCæ¥å£ï¼Œç”¨äºç»™OCå±‚è°ƒç”¨ã€‚å…¶ä¸­Swiftçš„å‡½æ•°è°ƒç”¨é‡‡ç”¨çš„æ˜¯å‡½æ•°è¡¨æ´¾å‘ï¼ˆå‡½æ•°åœ¨sil_vtableä¸­ï¼‰ï¼Œè€ŒOCæ¥å£å†…éƒ¨å…¶å®æœ€ç»ˆè°ƒç”¨çš„è¿˜æ˜¯Swiftå‡½æ•°ï¼Œä¹Ÿå°±æ˜¯è¯´æ´¾å‘æ–¹å¼å¹¶æ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œè¿˜æ˜¯å‡½æ•°è¡¨æ´¾å‘ã€‚ åˆ›å»ºä¸€ä¸ªFooç±»ï¼Œå¹¶å®ç°ä¸€ä¸ª@objcæ ‡è®°çš„baræ–¹æ³•ï¼š import Foundation class Foo: NSObject { @objc func bar() { print(\"Hello from Swift!\") } } é€šè¿‡ swiftc Foo.swift -emit-sil | xcrun swift-demangle \u003e FooSILGen.silè½¬æ¢ä¸ºSILä»£ç å¦‚ä¸‹ï¼š æœ‰ç²¾ç®€ï¼Œåªä¿ç•™äº†barå‡½æ•°å’Œvtableç›¸å…³éƒ¨åˆ† sil_stage canonical import Builtin import Swift import SwiftShims import Foundation @objc @_inheritsConvenienceInitializers class Foo : NSObject { @objc func bar() override dynamic init() @objc deinit } // Foo.bar() sil hidden @Foo.Foo.bar() -\u003e () : $@convention(method) (@guaranteed Foo) -\u003e () { // %0 \"self\" // user: %1 bb0(%0 : $Foo): debug_value %0 : $Foo, let, name \"self\", argno 1, implicit // id: %1 %2 = integer_literal $Builtin.Word, 1 // user: %4 // function_ref _allocateUninitializedArray\u003cA\u003e(_:) %3 = function_ref @Swift._allocateUninitializedArray\u003cA\u003e(Builtin.Word) -\u003e ([A], Builtin.RawPointer) : $@convention(thin) \u003cÏ„_0_0\u003e (Builtin.Word) -\u003e (@owned Array\u003cÏ„_0_0\u003e, Builtin.RawPointer) // user: %4 %4 = apply %3\u003cAny\u003e(%2) : $@convention(thin) \u003cÏ„_0_0\u003e (Builtin.Word) -\u003e (@owned Array\u003cÏ„_0_0\u003e, Builtin.RawPointer) // users: %6, %5 %5 = tuple_extract %4 : $(Array\u003cAny\u003e, Builtin.RawPointer), 0 // user: %17 %6 = tuple_extract %4 : $(Array\u003cAny\u003e, Builtin.RawPointer), 1 // user: %7 %7 = pointer_to_address %6 : $Builtin.RawPointer to [strict] $*Any // user: %14 %8 = string_literal utf8 \"Hello from Swift!\" // user: %13 %9 = integer_literal $Builtin.Word, 17 // user: %13 %10 = integer_literal $Builtin.Int1, -1 // user: %13 %11 = metatype $@thin String.Type // user: %13 // function_ref String.init(_builtinStringLiteral:utf8CodeUnitCount:isASCII:) %12 = function_ref @Swift.String.init(_builtinStringLiteral: Builtin.RawPointer, utf8CodeUnitCount: Builtin.Word, isASCII: Builtin.Int1) -\u003e Swift.String : $@convention(method) (Builtin.RawPointer, Builtin.Word, Builtin.Int1, @thin String.Type) -\u003e @owned String // user: %13 %13 = apply %12(%8, %9, %10, %11) : $@convention(method) (Builtin.RawPointer, Builtin.Word, Builtin.Int1, @thin String.Type) -\u003e @owned String // user: %15 %14 = init_existential_addr %7 : $*Any, $String // user: %15 store %13 to %14 : $*String // id: %15 // function_ref _finalizeUninitializedArray\u003cA\u003e(_:) %16 = function_ref @Swift._finalizeUninitializedArray\u003cA\u003e(__owned [A]) -\u003e [A] : $@convention(thin) \u003cÏ„_0_0\u003e (@owned Array\u003cÏ„_0_0\u003e) -\u003e @owned Array\u003cÏ„_0_0\u003e // user: %17 %17 = apply %16\u003cAny\u003e(%5) : $@convention(thin) \u003cÏ„_0_0\u003e (@owned Array\u003cÏ„_0_0\u003e) -\u003e @owned Array\u003cÏ„_0_0\u003e // users: %26, %23 // function_ref default argument 1 of print(_:separator:terminator:) %18 = function_ref @default argument 1 of Swift.print(_: Any..., separator: Swift.String, terminator: Swift.String) -\u003e () : $@convention(thin) () -\u003e @owned String // user: %19 %19 = apply %18() : $@convention(thin) () -\u003e @owned String // users: %25, %23 // function_ref default argument 2 of print(_:separator:terminator:) %20 = function_ref @default argument 2 of Swift.print(_: Any..., separator: Swift.String, terminator: Swift.String) -\u003e () : $@convention(thin) () -\u003e @owned String // user: %21 %21 = apply %20() : $@convention(thin) () -\u003e @owned String // users: %24, %23 // function_ref print(_:separator:terminator:) %22 = function_ref @Swift.print(_: Any..., separator: Swift.String, terminator: Swift.String) -\u003e () : $@convention(thin) (@guaranteed Array\u003cAny\u003e, @guaranteed String, @guaranteed String) -\u003e () // user: %23 %23 = apply %22(%17, %19, %21) : $@convention(thin) (@guaranteed Array\u003cAny\u003e, @guaranteed String, @guaranteed String) -\u003e () release_value %21 : $String // id: %24 release_value %19 : $String // id: %25 release_value %17 : $Array\u003cAny\u003e // id: %26 %27 = tuple () // user: %28 return %27 : $() // id: %28 } // end sil function 'Foo.Foo.bar() -\u003e ()' // @objc Foo.bar() sil private [thunk] @@objc Foo.Foo.bar() -\u003e () : $@convention(objc_method) (Foo) -\u003e ()","date":"2022-07-26","objectID":"/swift%E8%A7%A3%E6%83%91/:11:0","tags":["iOS","swift"],"title":"Swiftè§£æƒ‘","uri":"/swift%E8%A7%A3%E6%83%91/"},{"categories":["å®ç°åŸç†"],"content":"æ¨èæ–‡ç«  Swift Intermediate Language (SIL) ä» SIL è§’åº¦çœ‹ Swift ä¸­çš„å€¼ç±»å‹ä¸å¼•ç”¨ç±»å‹ ä» SIL çœ‹ Swift å‡½æ•°æ´¾å‘æœºåˆ¶ iOSä¸‹çš„é—­åŒ…ä¸‹ç¯‡-Closure Swift æ€§èƒ½ä¼˜åŒ–(2)â€”â€”åè®®ä¸æ³›å‹çš„å®ç° Swift æ³›å‹åº•å±‚å®ç°åŸç† ã€è¯‘ã€‘Understanding the â€œsomeâ€ and â€œanyâ€ keywords in Swift 5.7 ã€è¯‘ã€‘What is the â€œsomeâ€ keyword in Swift? ã€è¯‘ã€‘What is the â€œanyâ€ keyword in Swift? ã€è¯‘ã€‘Whatâ€™s the difference between any and some in Swift 5.7? ã€è¯‘ã€‘Using the â€˜someâ€™ and â€˜anyâ€™ keywords to reference generic protocols in Swift 5 ã€è¯‘ã€‘What are primary associated types in Swift 5.7? ","date":"2022-07-26","objectID":"/swift%E8%A7%A3%E6%83%91/:12:0","tags":["iOS","swift"],"title":"Swiftè§£æƒ‘","uri":"/swift%E8%A7%A3%E6%83%91/"},{"categories":["å®ç°åŸç†"],"content":"Runtime AutoreleasePoolPage ã€SideTableMapã€AssociationsManager æ˜¯åœ¨map_images-\u003emap_images_nolock-\u003earr_init() å‡½æ•°ä¸­åˆå§‹åŒ–çš„ï¼› ä¸€ä¸ªç±»æœ€å¤šèƒ½æ·»åŠ 64ä¸ªåˆ†ç±»ï¼› ","date":"2022-06-09","objectID":"/ios%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/:1:0","tags":["iOS","runtime"],"title":"iOSæºç é˜…è¯»ç¬”è®°","uri":"/ios%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/"},{"categories":["å®ç°åŸç†"],"content":"dyldåŠ è½½æµç¨‹ å¼•è‡ªé£˜äº‘çš„dyldè¯¦è§£ ç¬¬ä¸€æ­¥ï¼šè®¾ç½®è¿è¡Œç¯å¢ƒ ç¬¬äºŒæ­¥ï¼šåŠ è½½å…±äº«ç¼“å­˜ ç¬¬ä¸‰æ­¥ï¼šå®ä¾‹åŒ–ä¸»ç¨‹åº ç¬¬å››æ­¥ï¼šåŠ è½½æ’å…¥çš„åŠ¨æ€åº“ ç¬¬äº”æ­¥ï¼šé“¾æ¥ä¸»ç¨‹åº ç¬¬å…­æ­¥ï¼šé“¾æ¥æ’å…¥çš„åŠ¨æ€åº“ ç¬¬ä¸ƒæ­¥ï¼šæ‰§è¡Œå¼±ç¬¦å·ç»‘å®š ç¬¬å…«æ­¥ï¼šæ‰§è¡Œåˆå§‹åŒ–æ–¹æ³•ï¼ˆruntimeå’Œç±»çš„åŠ è½½æ˜¯åœ¨è¿™ä¸€æ­¥ï¼‰ ç¬¬ä¹æ­¥ï¼šæŸ¥æ‰¾å…¥å£ç‚¹å¹¶è¿”å› å™è¿°ä¸€ä¸‹ï¼š é…ç½®ç¯å¢ƒå˜é‡ï¼Œå¼€å¯å…±äº«ç¼“å­˜ï¼Œæ¥ä¸‹æ¥æŠŠä¸»ç¨‹åºçš„å¯æ‰§è¡Œæ–‡ä»¶ï¼ˆmachoï¼‰åŠ è½½è¿›å†…å­˜ï¼Œæ£€æµ‹machoå†…çš„magicã€cpuç­‰å±æ€§ä»¥åŠå…¼å®¹æ€§ï¼Œå¦‚æœé€šè¿‡åˆ™åˆ›å»ºä¸€ä¸ªimageLoaderï¼Œç„¶åæ’å…¥åŠ¨æ€åº“ï¼Œé“¾æ¥ä¸»ç¨‹åºï¼ˆåŠ è½½è¿›æ‰€æœ‰ä¾èµ–åº“ï¼Œç„¶årebaseä¿®æ­£åç§»ã€rebindç»‘å®šç¬¦å·åœ°å€ï¼‰å’Œæ’å…¥çš„åŠ¨æ€åº“ï¼Œç„¶åå¼±ç¬¦å·ç»‘å®šï¼Œæ¥ä¸‹æ¥å°±æ˜¯è¿›å…¥çœŸæ­£çš„åˆå§‹åŒ–æ–¹æ³•ï¼Œå¦‚ä¸‹å›¾ï¼Œå½“dyldåŠ è½½åˆ°å¼€å§‹é“¾æ¥ä¸»ç¨‹åºçš„æ—¶å€™ï¼Œé€’å½’è°ƒç”¨recursiveInitializationå‡½æ•°ï¼› _objc_init recursiveInitialization è¿™ä¸ªå‡½æ•°ç¬¬ä¸€æ¬¡æ‰§è¡Œï¼Œä¼šèµ°åˆ° doInitialization -\u003e doModInitFunctions -\u003e libSystemInitializedï¼Œè¿›è¡Œlibsystemçš„åˆå§‹åŒ–ï¼› libsystem çš„åˆå§‹åŒ–ï¼Œå®ƒä¼šè°ƒç”¨èµ· libdispatch_initï¼Œlibdispatch çš„ init ä¼šè°ƒç”¨ _os_object_initï¼Œè¿™ä¸ªå‡½æ•°é‡Œé¢è°ƒç”¨äº† _objc_initï¼› _objc_init ä¸­æ³¨å†Œå¹¶ä¿å­˜äº†map_imagesã€load_imagesã€unmap_imageå‡½æ•°åœ°å€ï¼› æ³¨å†Œå®Œæ¯•ç»§ç»­å›åˆ° recursiveInitialization é€’å½’ä¸‹ä¸€æ¬¡è°ƒç”¨ï¼Œä¾‹å¦‚ libobjcï¼Œå½“ libobjc æ¥åˆ° recursiveInitialization è°ƒç”¨æ—¶ä¼šè§¦å‘libsystemï¼Œè°ƒç”¨åˆ°_objc_inité‡Œæ³¨å†Œå¥½çš„å›è°ƒå‡½æ•°è¿›è¡Œè°ƒç”¨ï¼Œå°±æ¥åˆ°äº†libobjcï¼Œè°ƒç”¨load_imagesã€‚ ","date":"2022-06-09","objectID":"/ios%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/:1:1","tags":["iOS","runtime"],"title":"iOSæºç é˜…è¯»ç¬”è®°","uri":"/ios%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/"},{"categories":["å®ç°åŸç†"],"content":"ç±»çš„åŠ è½½ read_imageï¼š åˆå§‹åŒ–gdb_objc_realized_classesè¡¨ï¼Œå®¹é‡æ˜¯ç±»æ€»æ•°é‡çš„ 4/3 å€ï¼Œè¿™ä¸ªè¡¨ç”¨æ¥å­˜æ”¾ä¸åœ¨å…±äº«ç¼“å­˜ä¸­å¹¶ä¸”éæ‡’åŠ è½½ç±»ã€‚æ¥ä¸‹æ¥ä»mach-oä¸­è¯»å–éæ‡’åŠ è½½ç±»ï¼ŒæŠŠä»mach-oä¸­è¯»å–çš„ç±»æŒ‡é’ˆè½¬æ¢æˆç±»åï¼Œå˜æˆå¯è¯†åˆ«çš„ç±»ï¼ˆåœ°å€ -\u003e ç±»åï¼‰ï¼Œç„¶ååŠ å…¥å‰é¢åˆ›å»ºçš„gdb_objc_realized_classes mapè¡¨ä¸­ï¼ˆè¿™ä¸ªè¡¨çš„ä½œç”¨æ˜¯åœ¨åé¢å¤„ç†ç±»æœ‰æ²¡æœ‰è¢«æ­£ç¡®çš„å¤„ç†ï¼‰ï¼ŒåŒæ—¶ä¹Ÿä¼šåŠ å…¥ allocatedClasses è¿™ä¸ªsetè¡¨ä¸­ï¼ˆè¿™ä¸ªè¡¨æ˜¯åœ¨ _objc_init ä¸­çš„ runtime_init å‡½æ•°ä¸­åˆå§‹åŒ–çš„ï¼Œå­˜å‚¨çš„æ˜¯å·²ç»åˆå§‹åŒ–è¿‡çš„ç±»ï¼‰ï¼›æ€»çš„æ¥è¯´ï¼Œè¿™ä¸€æ­¥å°±æ˜¯æŠŠç±»è¯»å–åˆ°å†…å­˜ï¼› æ¥ä¸‹æ¥å°±æ˜¯é‡ç‚¹æ–¹æ³•realizeClassWithoutSwiftï¼šåˆ›å»ºrwï¼ŒæŠŠroæ”¾åˆ°rwä¸­ï¼ˆæ–¹æ³•åˆ—è¡¨æ˜¯åœ¨åé¢æ”¾çš„ï¼‰ï¼Œé€’å½’æ‰§è¡ŒrealizeClassWithoutSwiftï¼Œå³é€’å½’è®¾ç½®rwï¼› è®¾ç½®ç±»ã€çˆ¶ç±»å’Œå…ƒç±»ï¼Œå…¶å®å°±æ˜¯ç”Ÿæˆä¸€ä¸ªåŒå‘é“¾è¡¨ï¼› methodizeClass ï¼š è·å–classçš„roä¸­çš„baseMethodsï¼Œé€šè¿‡prepareMethodListså‡½æ•°è¿›è¡Œæ–¹æ³•å‡åºæ’åºï¼Œç„¶å unttachedCategories::attachToClass ï¼Œè¿™é‡Œæ˜¯é‡å¤´æˆï¼Œ attachToClassä¸­ä¼šæ‰§è¡ŒattachCategoriesï¼Œåœ¨è¿™é‡Œé¢ä¼šåˆå§‹åŒ–rweï¼Œåœ¨è¿™è¿‡ç¨‹ä¸­ä¼šæŠŠroä¸­çš„æ–¹æ³•åˆ—è¡¨ã€å±æ€§åˆ—è¡¨ã€åè®®åˆ—è¡¨éƒ½å¤åˆ¶åˆ°rweä¸­ï¼Œç„¶åæ¥ç€ä¼šæŠŠcategoryä¸­çš„æ–¹æ³•åˆ—è¡¨ã€å±æ€§åˆ—è¡¨ã€åè®®åˆ—è¡¨ä¹Ÿä¼šå¸çº³è¿›å»ï¼Œæ­¤æ—¶ç±»æ‰ç®—åŠ è½½å®Œæˆï¼› æ–¹æ³•æ’åºçš„è¿™é‡Œæœ‰å‡ ä¸ªç»†èŠ‚ï¼šåœ¨methodizeClassä¸­é¦–æ¬¡ä»class_ro_wä¸­æ‹¿åˆ°basemethodsåå°±ç«‹å³åšäº†å‡åºæ’åºå¤„ç†ï¼Œè€Œåˆ†ç±»ä¸­çš„æ–¹æ³•æ’åºå‘ç”Ÿåœ¨attachCategoryæ–¹æ³•ä¸­ï¼Œä¹Ÿå°±æ˜¯è¯´ä»–ä»¬æ˜¯åˆ†å¼€å„è‡ªç‹¬ç«‹æ’åºçš„ï¼ˆç–‘é—®ï¼šæ²¡æœ‰æ•´åˆåˆ°ä¸€èµ·åå†æ’åºï¼Œé‚£æ€ä¹ˆç”¨çš„äºŒåˆ†æŸ¥æ‰¾ï¼Ÿï¼‰ã€‚ è§£ç­”ï¼š åªæœ‰ç±»å’Œåˆ†ç±»éƒ½å®ç°loadæ–¹æ³•ï¼Œæ‰ä¼šå­˜åœ¨load_imageé˜¶æ®µåˆ†ç±»æ–¹æ³•æ•´åˆåˆ°æ‰€å±ç±»çš„æ–¹æ³•åˆ—è¡¨ä¸­çš„æ“ä½œï¼Œä¹Ÿå°±æ˜¯è¯´åªæœ‰ç±»æˆ–è€…åˆ†ç±»ä¸­å®ç°loadæ–¹æ³•çš„æƒ…å†µï¼Œç±»çš„æ–¹æ³•åˆ—è¡¨å’Œåˆ†ç±»æ–¹æ³•éƒ½æ˜¯ç›´æ¥åœ¨ç¼–è¯‘æœŸå­˜æ”¾åœ¨class_ro_tä¸­çš„baseMethodsä¸­çš„ï¼›é‚£è¿™ç§æƒ…å†µæ€ä¹ˆèƒ½ä¿è¯åˆ†ç±»æ–¹æ³•åœ¨åŸå§‹ç±»æ–¹æ³•å‰é¢çš„ï¼Ÿè¿™åº”è¯¥æ˜¯ç¼–è¯‘å™¨è‡ªå·±åœ¨ç¼–è¯‘æœŸåšçš„å¤„ç†ï¼Œè®©åˆ†ç±»æ–¹æ³•åœ°å€æ¯”åŸå§‹ç±»çš„æ–¹æ³•åœ°å€è¦ä½ã€‚è€Œå¯¹äºäºŒåˆ†æŸ¥æ‰¾ï¼Œå…¶å®æ•´åˆåçš„æ–¹æ³•åˆ—è¡¨å…¶å®æ˜¯ä¸ªäºŒç»´æ•°ç»„ï¼Œå†…éƒ¨å­˜çš„æ˜¯æ’å¥½åºçš„ä¸€ç»´æ–¹æ³•åˆ—è¡¨ï¼ˆmethodizeClassé˜¶æ®µpreparemethodè¿›è¡Œæ–¹æ³•æ’åºï¼‰ï¼Œæ–¹æ³•æŸ¥æ‰¾å…ˆæ˜¯é¡ºåºéå†äºŒç»´æ•°ç»„ï¼Œå†åœ¨æœ‰åºçš„ä¸€ç»´æ–¹æ³•åˆ—è¡¨ä¸­è¿›è¡ŒäºŒåˆ†æŸ¥æ‰¾ã€‚ æ–¹æ³•æ·»åŠ é¡ºåºï¼šæ–°å»ºä¸ªæ•°ç»„ï¼Œå…ˆæŠŠç±»ä¸­class_ro_w basemethodsæ”¾åˆ°æ•°ç»„çš„åé¢ï¼Œç„¶åæŠŠåˆ†ç±»æ–¹æ³•æ”¾åˆ°æ•°ç»„å‰é¢ ä¸ºä»€ä¹ˆcategoryä¼šè¦†ç›–åŸæ¥çš„æ–¹æ³•ï¼Ÿ åœ¨map_imagesæ–¹æ³•çš„ attachCategories -\u003e attachLists åˆ†ç±»é™„åŠ åˆ°åŸæ¥çš„ç±»çš„æ–¹æ³•åˆ—è¡¨æ—¶ï¼Œä¼šå…ˆé‡æ–°å¼€è¾Ÿä¸€ä¸ªæ–°çš„æ•°ç»„ï¼ŒæŠŠåŸæ¥çš„æ–¹æ³•åˆ—è¡¨å€’åºéå†æ·»åŠ åˆ°æ–°æ•°ç»„çš„åé¢ï¼Œæ¥ç€å†æ­£åºéå†ï¼ŒæŠŠåˆ†ç±»çš„æ–¹æ³•æ·»åŠ åˆ°æ–°æ•°ç»„çš„å‰é¢ï¼ˆæ–¹æ³•åˆ—è¡¨çš„é¡ºåºä¸åŸæ¥çš„é¡ºåºä¸€è‡´ï¼‰ï¼› methodLists ç±»å’Œcategoryå®ç°loadå¯¹åŠ è½½çš„å½±å“ åªæœ‰ç±»å’Œåˆ†ç±»éƒ½å®ç°loadæ–¹æ³•ï¼Œæ‰ä¼šå‘ç”Ÿåœ¨load_imageé˜¶æ®µåˆ†ç±»æ–¹æ³•æ•´åˆåˆ°æ‰€å±ç±»çš„æ–¹æ³•åˆ—è¡¨ä¸­çš„æ“ä½œ; åªæœ‰ç±»æˆ–è€…åˆ†ç±»ä¸­å®ç°loadçš„æ—¶å€™ï¼Œç±»çš„æ–¹æ³•å’Œåˆ†ç±»æ–¹æ³•éƒ½æ˜¯ç›´æ¥åœ¨ç¼–è¯‘æœŸå­˜æ”¾åˆ°class_ro_tä¸­çš„baseMethodsä¸­çš„ã€‚é‚£è¿™ç§æƒ…å†µæ€ä¹ˆèƒ½ä¿è¯åˆ†ç±»æ–¹æ³•åœ¨åŸå§‹ç±»æ–¹æ³•å‰é¢çš„ï¼Ÿè¿™åº”è¯¥æ˜¯ç¼–è¯‘å™¨è‡ªå·±åœ¨ç¼–è¯‘æœŸåšçš„å¤„ç†ï¼Œè®©åˆ†ç±»æ–¹æ³•åœ°å€æ¯”åŸå§‹ç±»çš„æ–¹æ³•åœ°å€è¦ä½ï¼ˆæ–¹æ³•æ’åºç”¨çš„æ˜¯å‡åºæ’åºï¼‰ã€‚ è€Œå¯¹äºç±»å’Œåˆ†ç±»éƒ½å®ç°loadçš„åœºæ™¯ï¼Œå³åœ¨load_imageé˜¶æ®µæŠŠåˆ†ç±»æ–¹æ³•æ•´åˆåˆ°ç±»çš„æ–¹æ³•åˆ—è¡¨ä¸­çš„æƒ…å†µæ˜¯å¦‚ä½•è¿›è¡ŒäºŒåˆ†æŸ¥æ‰¾çš„å‘¢ï¼Ÿå…¶å®æ•´åˆåçš„æ–¹æ³•åˆ—è¡¨æ˜¯ä¸ªäºŒç»´æ•°ç»„ï¼Œå†…éƒ¨å­˜çš„æ˜¯æ’å¥½åºçš„ä¸€ç»´æ–¹æ³•åˆ—è¡¨ï¼ˆmethodizeClassé˜¶æ®µpreparemethodè¿›è¡Œçš„æ–¹æ³•å‡åºæ’åºï¼‰ï¼Œæ–¹æ³•æŸ¥æ‰¾æ—¶å…ˆæ˜¯é¡ºåºéå†äºŒç»´æ•°ç»„ï¼Œå†åœ¨æœ‰åºçš„ä¸€ç»´æ–¹æ³•åˆ—è¡¨ä¸­è¿›è¡ŒäºŒåˆ†æŸ¥æ‰¾ã€‚ ç»¼ä¸Šæ‰€è¿°ï¼Œä¸è¦åœ¨ç±»å’Œåˆ†ç±»ä¸­åŒæ—¶å®ç°loadæ–¹æ³•ä¹Ÿæ˜¯æå‡å¯åŠ¨é€Ÿåº¦çš„ä¸€ä¸ªç‚¹ï¼Œå½“ç„¶ï¼Œä¸ç”¨loadæœ€å¥½äº†ã€‚ ä¸ºä»€ä¹ˆä¼šæœ‰CleanMemoryå’ŒDirtyMemoryå‘¢ï¼Ÿ iOSè¿è¡Œè¿‡ç¨‹ä¸­ä¼šæ¶‰åŠå¯¹å†…å­˜è¿›è¡Œå¢åˆ æ”¹æŸ¥ï¼Œä¸ºäº†é˜²æ­¢å¯¹åŸå§‹æ•°æ®çš„ä¿®æ”¹ï¼Œæ‰€ä»¥æŠŠåŸæ¥çš„CleanMemory copyä¸€ä»½åˆ°rwä¸­ã€‚ æœ‰äº†rwä¸ºä»€ä¹ˆè¿˜è¦rweï¼ˆè„å†…å­˜ï¼‰ï¼Ÿå› ä¸ºä¸æ˜¯æ‰€æœ‰çš„ç±»åŠ è½½è¿›å†…å­˜æ—¶éœ€è¦è¿›è¡ŒåŠ¨æ€çš„æ’å…¥ã€åˆ é™¤ï¼Œå½“æˆ‘ä»¬æ·»åŠ ä¸€ä¸ªå±æ€§ã€ä¸€ä¸ªæ–¹æ³•ä¼šå¯¹å†…å­˜æ”¹åŠ¨å¾ˆå¤§ï¼Œå¯¹å†…å­˜çš„æ¶ˆè€—æœ‰ä¸€å®šå½±å“ï¼Œæ‰€ä»¥åªè¦æˆ‘ä»¬å¯¹ç±»è¿›è¡ŒåŠ¨æ€å¤„ç†äº†ï¼ˆæ¯”å¦‚æŠŠcategoryçš„æ–¹æ³•ã€å±æ€§ã€åè®®åˆå¹¶åˆ°ç±»ä¸­ï¼‰ï¼Œå°±ä¼šç”Ÿæˆä¸€ä¸ªrweã€‚ ä¸ºä»€ä¹ˆæ‰§è¡Œloadæ–¹æ³•æ—¶æ²¡æœ‰è§¦å‘initializeï¼Ÿ ä¸€å®šæ˜ç¡®initializeæ˜¯åœ¨é¦–æ¬¡å‘æ¶ˆæ¯æ—¶æ‰ä¼šè§¦å‘ï¼Œè€Œloadçš„æ‰§è¡Œæ˜¯é€šè¿‡å‡½æ•°æŒ‡é’ˆçš„æ–¹å¼è°ƒç”¨çš„ï¼Œæ²¡æœ‰èµ°æ¶ˆæ¯å‘é€æœºåˆ¶ï¼Œæ‰€ä»¥ä¸ä¼šè§¦å‘initializeã€‚ ä¸ºä»€ä¹ˆåœ¨å¯¹è±¡é‡Šæ”¾è¿‡ç¨‹ä¸­é€šè¿‡weakå˜é‡è·å–ä¸åˆ°è¿™ä¸ªå¯¹è±¡ï¼Ÿ åœ¨å…³è”çš„åœºæ™¯ä¸­ï¼Œæ¯”å¦‚Aå…³è”Bï¼ŒBå¼±æŒæœ‰Aï¼ŒAé‡Šæ”¾æ—¶ä¼šé‡Šæ”¾å…¶å…³è”çš„Bï¼Œå¯¼è‡´Bçš„deallocæ‰§è¡Œï¼Œç„¶åæˆ‘ä»¬åœ¨Bçš„deallocæ–¹æ³•ä¸­é€šè¿‡weakå˜é‡è¯»å–Aï¼Œå´å‘ç°è·å–åˆ°çš„æ˜¯nilï¼ˆæ ¹æ®é‡Šæ”¾æµç¨‹æ­¤æ—¶Aè¿˜æ²¡æœ‰freeæ‰ï¼‰ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆï¼Ÿ åˆ†æå¦‚ä¸‹ï¼š è¯»å–weakå˜é‡æ—¶æ‰§è¡Œçš„æ˜¯objc_loadWeakå‡½æ•°ï¼Œå†…éƒ¨æ‰§è¡Œå¤§æ¦‚æµç¨‹ä¸ºï¼šobjc_loadWeak -\u003e objc_loadWeakRetained -\u003e obj-\u003erootTryRetain() -\u003e rootRetain(true, RRVariant::Fast) ï¼Œåœ¨rootRetainä¸­å¦‚æœå½“å‰å¯¹è±¡æ­£åœ¨å¤„äºé‡Šæ”¾æµç¨‹ä¸­ï¼Œåˆ™è¿”å›nilã€‚å…·ä½“ä»£ç å¦‚ä¸‹ï¼š id objc_loadWeakRetained(id *location) { id obj; id result; Class cls; SideTable *table; retry: obj = *location; if (_objc_isTaggedPointerOrNil(obj)) return obj; table = \u0026SideTables()[obj]; table-\u003elock(); if (*location != obj) { table-\u003eunlock(); goto retry; } result = obj; cls = obj-\u003eISA(); if (! cls-\u003ehasCustomRR()) { // æ‰§è¡Œæ­¤é€»è¾‘ if (! obj-\u003erootTryRetain()) { result = nil; } } else { // æ‰§è¡Œä¸åˆ°çš„é€»è¾‘ï¼Œåˆ æ‰ } table-\u003eunlock(); return result; } ALWAYS_INLINE bool objc_object::rootTryRetain() { return rootRetain(true, RRVariant::Fast) ? true : false; } ALWAYS_INLINE id objc_object::rootRetain(bool tryRetain, objc_object::RRVariant variant) { if (slowpath(isTaggedPointer())) return (id)this; bool sideTableLocked = false; bool transcribeToSideTable = false; isa_t oldisa; isa_t newisa; oldisa = LoadExclusive(\u0026isa().bits); // ... do { transcribeToSideTable = false; newisa = oldisa; // å…³é”®é€»è¾‘ï¼š // å¦‚æœæ­£åœ¨é‡Šæ”¾ä¸­ï¼Œå¹¶ä¸”tryRetain=trueï¼Œåˆ™è¿”å›nil // don't check newisa.fast_rr; we already called any RR overrides if (slowpath(newisa.isDeallocating())) { ClearExclusive(\u0026isa().bits); if (sideTableLocked) { ASSERT(variant == RRVariant::Full); sidetable_unlock(); } if (slowpath(tryRetain)) { return nil; } else { return (id)this; } } uintptr_t carry; newisa.bits = addc(newisa.bits, RC_ONE, 0, \u0026carry); // extra_rc++ if (slowpath(carry)) { // newisa.extra_rc++ overflowed if (variant != RRVariant::Full) { ClearExclusive(\u0026isa().bits); return rootRetain_overflow(tryRetain); } // Leave half of the retain counts inline and // prepare to copy the other half to th","date":"2022-06-09","objectID":"/ios%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/:1:2","tags":["iOS","runtime"],"title":"iOSæºç é˜…è¯»ç¬”è®°","uri":"/ios%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/"},{"categories":["å®ç°åŸç†"],"content":"å¯¹è±¡é‡Šæ”¾æµç¨‹ è°ƒç”¨release -\u003e rootReleaseï¼Œå¼•ç”¨è®¡æ•°-1ï¼Œå½“å¼•ç”¨è®¡æ•°å˜ä¸º0æ—¶ï¼Œå°±ä¼šé€šè¿‡objc_msgSendè°ƒç”¨Objective-Cå¯¹è±¡çš„deallocæ–¹æ³•ï¼Œç„¶åè¿›å…¥åˆ°objc_object::rootDealloc()å‡½æ•°ï¼Œå‡½æ•°å†…éƒ¨ä¼šè¯»å–å½“å‰å¯¹è±¡çš„isaä¸­å­˜å‚¨çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬æ˜¯å¦æ˜¯éæŒ‡é’ˆã€æœ‰æ²¡æœ‰å¼±å¼•ç”¨ã€æˆå‘˜å˜é‡ã€å…³è”å¯¹è±¡ã€has_sidetable_rcï¼Œå¦‚æœéƒ½æ²¡æœ‰ä¼šç›´æ¥é‡Šæ”¾ï¼ˆfreeï¼‰ï¼Œå¦åˆ™ä¼šæ‰§è¡Œobjc_destructInstance(obj)ï¼Œè¿™ä¸ªå‡½æ•°çš„é€»è¾‘ä¸ºå…ˆé‡Šæ”¾æˆå‘˜å˜é‡ï¼Œæ¥ç€ç§»é™¤å…³è”å¯¹è±¡ï¼Œå†ç§»é™¤å¼±å¼•ç”¨ï¼ŒæŠŠå¼±å¼•ç”¨æŒ‡é’ˆç½®ä¸ºnilï¼Œæœ€åå†ä»SideTableçš„RefcountMap refcntsæˆå‘˜å˜é‡ä¸­ æŠŠå­˜å‚¨å½“å‰å¯¹è±¡å¼•ç”¨è®¡æ•°çš„è®°å½•ï¼ˆkey-valueï¼‰ä»å¼•ç”¨è®¡æ•°è¡¨ä¸­ç§»é™¤ï¼Œç±»ä¼¼äºä»å­—å…¸ä¸­æŠŠè¿™æ¡key-valueéƒ½åˆ é™¤ï¼ˆç–‘é—®ï¼šæ­¤æ—¶å¼•ç”¨è®¡æ•°å·²ç»æ˜¯0äº†ï¼Œé‚£æœ€åè¿™ä¸ªå¼•ç”¨è®¡æ•°è¡¨çš„å¤„ç†æ˜¯ä¸æ˜¯å¤šä½™çš„ï¼Œä»€ä¹ˆæƒ…å†µä¸‹ä¼šæ‰§è¡Œè¿›æ¥ï¼Ÿï¼Ÿï¼Ÿï¼‰ã€‚ åœ¨deallocæ–¹æ³•ä¸­å¦‚æœæœ‰å¯¹selfçš„å¼•ç”¨ï¼Œæ¯”å¦‚- (void)dealloc { id obj = self; }ï¼Œæ˜¯ä¸ä¼šå‘ç”Ÿå¼•ç”¨è®¡æ•°+1çš„ï¼Œruntimeå¤„ç†å¦‚ä¸‹ï¼š // æ˜¯å¦æ­£åœ¨é‡Šæ”¾ bool isDeallocating() { return extra_rc == 0 \u0026\u0026 has_sidetable_rc == 0; } // retainæœ€ç»ˆæ‰§è¡Œçš„å‡½æ•° ALWAYS_INLINE id objc_object::rootRetain(bool tryRetain, objc_object::RRVariant variant) { // çœç•¥ä»£ç  ... // åœ¨deallocä¸­è¿™é‡Œçš„æ‰§è¡Œç»“æœæ˜¯true if (slowpath(newisa.isDeallocating())) { ClearExclusive(\u0026isa.bits); if (sideTableLocked) { ASSERT(variant == RRVariant::Full); sidetable_unlock(); } if (slowpath(tryRetain)) { return nil; } else { return (id)this; } } // çœç•¥ä»£ç  ... } ","date":"2022-06-09","objectID":"/ios%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/:1:3","tags":["iOS","runtime"],"title":"iOSæºç é˜…è¯»ç¬”è®°","uri":"/ios%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/"},{"categories":["å®ç°åŸç†"],"content":"Weak weak_table_t æ˜¯å…¨å±€ä¿å­˜å¼±å¼•ç”¨çš„å“ˆå¸Œè¡¨ï¼Œå®ƒæ˜¯é€šè¿‡å¯¹objectåœ°å€åšhashè®¡ç®—ï¼Œç„¶åä»8ä¸ªSideTableæ•°ç»„ä¸­å–å‡ºå…¶ä¸­ä¸€å¼ ï¼Œç„¶åå†ä»SideTableä¸­è¯»å–åˆ°weak_tableã€‚weak_table_t æ˜¯ä»¥ object åœ°å€ä¸º keyï¼Œä»¥ weak_entry_t ä¸º valueã€‚ weak_entry_t æ˜¯ç”¨æ¥å­˜å‚¨æ‰€æœ‰æŒ‡å‘æŸä¸ªå¯¹è±¡çš„å¼±å¼•ç”¨å˜é‡çš„åœ°å€çš„ï¼Œé‡Œé¢æœ‰ä¸ªweak_referrer_tæ•°ç»„ï¼Œå®ƒå­˜å‚¨çš„å…¶å®æ˜¯å¼±å¼•ç”¨çš„æŒ‡é’ˆï¼Œå³æŒ‡é’ˆçš„æŒ‡é’ˆï¼Œè¿™ä¹ˆåšçš„ç›®çš„æ˜¯å¯ä»¥æŠŠå¼±å¼•ç”¨ç½®ä¸ºnilã€‚ weak_entry_t ä¸­æœ‰2ç§ç»“æ„ï¼Œå½“å­˜å‚¨çš„å¼±å¼•ç”¨æ•°é‡\u003c= 4ä¸ªçš„æ—¶å€™ç”¨çš„å…¶å®æ˜¯ä¸ªå®šé•¿æ•°ç»„ï¼Œ\u003e 4çš„æ—¶å€™æ‰ä¼šè½¬ä¸ºå“ˆå¸Œæ•°ç»„ã€‚ï¼ˆè¿™é‡Œä½¿ç”¨å“ˆå¸Œæ•°ç»„çš„åŸå› åº”è¯¥æ˜¯ä¸ºäº†å¤„ç†Bå¼±å¼•ç”¨Aï¼Œç„¶åBå…ˆé‡Šæ”¾äº†ï¼Œè¿™æ—¶é‚£ä¸ªå¼±å¼•ç”¨å¯èƒ½ä¹Ÿè¦ç½®ä¸ºnilï¼Œç”¨hashæ•°ç»„çš„è¯æŸ¥è¯¢é€Ÿåº¦ä¼šæ¯”è¾ƒå¿«ï¼‰ã€‚å¾€weak_entry_t ä¸­æ·»åŠ å¼±å¼•ç”¨å˜é‡æ—¶ï¼Œå³æ›´æ–°weak_referrer_té‡‡ç”¨çš„æ˜¯å®šå‘å¯»å€æ³•ï¼› å¾€weak_table ä¸­æ’å…¥weak_entry_tæ—¶ï¼Œå…ˆæ˜¯å¯¹objectåœ°å€å–hashä½œä¸ºå®ƒçš„indexï¼Œå¦‚æœè¿™ä¸ªindexä¸‹çš„ä½ç½®ä¸ä¸ºç©ºï¼Œåˆ™é€šè¿‡ä¸€ä¸ªç®—æ³•ï¼ˆindex = (index+1) \u0026 weak_table-\u003emaskï¼‰é‡æ–°è®¡ç®—ç”Ÿæˆä¸€ä¸ªæ–°çš„indexå†è¯»å–å¯¹åº”çš„ä½ç½®ï¼Œç›´åˆ°æ‰¾åˆ°ä¸€ä¸ªç©ºä½ç½®ï¼Œç„¶åæŠŠweak_entry_tæ”¾è¿›å»ï¼ŒåŒæ—¶æ›´æ–°å…ƒç´ æ•°é‡ã€‚è¿™ç§æ’å…¥æ–¹å¼å…¶å®ä¹Ÿæ˜¯å®šå‘å¯»å€æ³•ã€‚ hash å‡½æ•°ï¼Œä¸ mask åšä¸æ“ä½œï¼Œé˜²æ­¢ index è¶Šç•Œ; size_t begin = hash_pointer(referent) \u0026 weak_table-\u003emask; weak_hash_insert weak_table_t è¿˜æœ‰ä¸€ä¸ªæ‰©å®¹å’Œç¼©å®¹çš„å¤„ç†ï¼Œå½“å‰ä½¿ç”¨å®¹é‡å åˆ°æ€»å®¹é‡ï¼ˆmask + 1)çš„ 3/4 çš„æ—¶å€™ä¼šè¿›è¡Œæ‰©å®¹å¤„ç†ï¼Œæ‰©å¤§åˆ°ç°æœ‰æ€»å®¹é‡çš„2å€ã€‚ å½“æ€»å®¹é‡è¶…è¿‡1024ï¼Œè€Œå®é™…ä½¿ç”¨çš„ç©ºé—´ä½äºæ€»ç©ºé—´çš„ 1/16 æ—¶åˆ™ä¼šè¿›è¡Œå®¹é‡å‹ç¼©ï¼Œç¼©åˆ°ç°æœ‰æ€»å®¹é‡çš„1/8 ï¼ˆä¸ºä»€ä¹ˆæ˜¯å…«åˆ†ä¹‹ä¸€ï¼Ÿæ˜¯ä¸ºäº†ä¿è¯æ€»å®¹é‡æ˜¯ç°æœ‰ä½¿ç”¨å®¹é‡çš„2`å€ï¼‰ã€‚ ","date":"2022-06-09","objectID":"/ios%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/:2:0","tags":["iOS","runtime"],"title":"iOSæºç é˜…è¯»ç¬”è®°","uri":"/ios%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/"},{"categories":["å®ç°åŸç†"],"content":"@synchronizedåŸç† å…ˆä»å½“å‰çº¿ç¨‹çš„TLSä¸­å°è¯•è·å–SyncDataï¼ˆæœ¬èº«æ˜¯ä¸ªå•å‘é“¾è¡¨ï¼‰ï¼Œå¦‚æœå­˜åœ¨å¹¶ä¸”SyncDataä¸­çš„objectä¸ä¼ è¿›æ¥çš„objectç›¸åŒï¼Œåˆ™è¯´æ˜æ‰¾åˆ°å¯¹åº”çš„SyncDataäº†ã€‚æ›´æ–°é”æ•°é‡ï¼ˆlockCountï¼‰ï¼Œå¹¶è¿”å›SyncDataã€‚ ï¼ˆæ³¨æ„ï¼šä¸€æ¡çº¿ç¨‹çš„TLSä¸­åªèƒ½å­˜å”¯ä¸€ä¸€ä¸ªSyncDataï¼Œå‡å¦‚å·²ç»å­˜åœ¨äº†ä½†æ˜¯objectå¹¶ä¸ä¸è‡ªå·±ä¼ è¿›æ¥çš„ä¸€è‡´ï¼Œåˆ™åˆ›å»ºæ–°çš„SyncDataåå¹¶ä¸ä¼šæ›´æ–°åˆ°TLSä¸­ï¼Œè€Œæ˜¯ä¿å­˜åˆ° pthread_data ä¸­ï¼Œæœ‰ç‚¹å…ˆå…¥ä¸ºä¸»çš„æ„æ€ï¼‰ ä»pthread_dataä¸­è·å–SyncCacheï¼ˆé‡Œé¢å­˜ç€ä¸€ä¸ªSyncCacheItemæ•°ç»„ï¼ŒSyncCacheItemå­˜çš„æ˜¯SyncDataï¼‰ï¼Œå¦‚æœå­˜åœ¨åˆ™éå†SyncCacheItemæ•°ç»„ï¼Œå¦‚æœcacheItemä¸­çš„syncDataä¸­çš„objectä¸ä¼ è¿›æ¥çš„objectç›¸åŒï¼Œåˆ™æ›´æ–° item-\u003elockCount ï¼Œç„¶åè¿”å›SyncDataã€‚ èµ°åˆ°è¿™é‡Œå°±è¯´æ˜æ²¡æœ‰ä»thread cacheä¸­æ‰¾åˆ°åˆé€‚çš„SyncDataã€‚è¿™æ—¶å°±ä¼šä»å…¨å±€StripMap\u003cSyncList\u003e sDataLists è¡¨ä¸­è¯»å–ï¼Œå…ˆé€šè¿‡å¯¹è±¡objectçš„hashå€¼å–å‡ºä¸€ä¸ªSyncListï¼Œæ¥ç€æ‹¿åˆ°SyncListä¸­çš„SyncDataé“¾è¡¨ï¼Œç„¶åéå†æ•´ä¸ªé“¾è¡¨ã€‚ a. å¦‚æœå‘ç°ä¸objectåŒ¹é…çš„SyncDataåˆ™æ›´æ–°SyncDataä¸­çš„threadCountæ•°é‡ï¼Œç„¶åæŠŠæ‰¾åˆ°çš„è¿™ä¸ªSyncDataä¿å­˜åˆ°TLSæˆ–è€…pthread_dataä¸­çš„SyncCacheé‡Œé¢ï¼› b. å¦‚æœéå†åˆ°æœ€åä¹Ÿæ²¡å‘ç°åŒ¹é…çš„ï¼Œåˆ™æ‰¾åˆ°é“¾è¡¨ä¸­ç¬¬ä¸€ä¸ªæœªä½¿ç”¨ï¼ˆSyncDataä¸­çš„threadCount = 0ï¼‰çš„SyncDataï¼Œè¿›è¡Œå¤ç”¨ã€‚è¿™ä¸ªSyncDataä¹Ÿä¼šå’Œä¸Šé¢ä¸€æ ·è¿›è¡Œç¼“å­˜ï¼› c. å¦‚æœæ²¡æ‰¾åˆ°åŒ¹é…çš„ï¼Œä¹Ÿæ²¡æ‰¾åˆ°æœªä½¿ç”¨çš„ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªæ–°çš„SyncDataã€‚è¿™ä¸ªæ–°çš„SyncDataä¼šå…ˆä¿å­˜åˆ°SyncListä¸­ï¼Œç„¶åä¹Ÿä¼šå’Œä¸Šé¢ä¸€æ ·ä¿å­˜åˆ°TLSæˆ–è€…pthread_dataä¸­ä¸€ä»½ï¼Œå³æ–°åˆ›å»ºçš„æœ‰2ä»½ç¼“å­˜ã€‚ synchronized ","date":"2022-06-09","objectID":"/ios%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/:3:0","tags":["iOS","runtime"],"title":"iOSæºç é˜…è¯»ç¬”è®°","uri":"/ios%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/"},{"categories":["å®ç°åŸç†"],"content":"Associate åŸç† æ‰€æœ‰çš„å…³è”å¯¹è±¡éƒ½æ˜¯ç”±AssociationsManagerç®¡ç†çš„ï¼ŒAssociationsManageré‡Œé¢æ˜¯ç”±ä¸€ä¸ªé™æ€AssociationsHashMapæ¥å­˜å‚¨æ‰€æœ‰çš„å…³è”å¯¹è±¡ã€‚è¿™ç›¸å½“äºæŠŠæ‰€æœ‰å¯¹è±¡çš„å…³è”å¯¹è±¡éƒ½å­˜åœ¨ä¸€ä¸ªå…¨å±€hashMapé‡Œé¢ï¼ŒhashMapçš„keyæ˜¯è¿™ä¸ªå¯¹è±¡çš„æŒ‡é’ˆåœ°å€ï¼ˆä»»æ„ä¸¤ä¸ªä¸åŒå¯¹è±¡çš„æŒ‡é’ˆåœ°å€ä¸€å®šæ˜¯ä¸åŒçš„ï¼‰ï¼Œè€Œè¿™ä¸ªhashMapçš„valueåˆæ˜¯ä¸€ä¸ªObjectAssociationsMapï¼Œé‡Œé¢ä¿å­˜äº†å…³è”å¯¹è±¡çš„keyå’Œå¯¹åº”çš„valueå€¼ã€‚runtimeçš„é”€æ¯å¯¹è±¡å‡½æ•°objc_destructInstanceé‡Œé¢ä¼šåˆ¤æ–­è¿™ä¸ªå¯¹è±¡æœ‰æ²¡æœ‰å…³è”å¯¹è±¡ï¼Œå¦‚æœæœ‰ä¼šè°ƒç”¨_object_remove_assocationsåšå…³è”å¯¹è±¡çš„æ¸…ç†å·¥ä½œã€‚ åœ¨setå’Œgetæ—¶ï¼Œå³å¯¹å†…éƒ¨çš„mapè¿›è¡Œæ“ä½œæ—¶éƒ½ä¼šç”¨managerä¸­çš„spinlockï¼ˆåº•å±‚å…¶å®è¿˜æ˜¯unfair_lockï¼‰ï¼Œæ‰€ä»¥setã€getæ—¶ä¸€èˆ¬æƒ…å†µä¸‹æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ä½†æ˜¯å¯èƒ½æ˜¯ä¸ºäº†è¿½æ±‚æ€§èƒ½ï¼Œsetæ—¶æŠŠæ—§å¯¹è±¡çš„é‡Šæ”¾æ”¾åˆ°äº†é”å¤–ï¼Œatomic getæ—¶ä¸ºäº†ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œä¼šretainä¸€ä¸‹è®¿é—®å¯¹è±¡ï¼Œåœ¨é”å¤–åˆautoreleaseäº†ä¸€ä¸‹ï¼Œå¦‚æœä¸æ‰§è¡Œretainæ“ä½œå¯èƒ½ä¼šå‡ºç°æ•°æ®ç«äº‰ã€‚å¯ä»¥å‚è€ƒä¸‹è¿™ç¯‡æ–‡ç« : AssociatedObject æºç åˆ†æï¼šå¦‚ä½•å®ç°çº¿ç¨‹å®‰å…¨ï¼Ÿ Associate ","date":"2022-06-09","objectID":"/ios%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/:4:0","tags":["iOS","runtime"],"title":"iOSæºç é˜…è¯»ç¬”è®°","uri":"/ios%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/"},{"categories":["å®ç°åŸç†"],"content":"GCD å¯åˆ›å»ºçš„æœ€å¤§çº¿ç¨‹æ•°æ˜¯ 255 thread_pool_size = DISPATCH_WORKQ_MAX_PTHREAD_COUNT 255 è‡ªå®šä¹‰ä¸²è¡Œé˜Ÿåˆ—æ˜¯overcommitçš„ï¼Œå¹¶è¡Œé˜Ÿåˆ—ä¸æ˜¯overcommitçš„ è‡ªå®šä¹‰é˜Ÿåˆ—çš„ç›®æ ‡é˜Ÿåˆ—åœ¨åˆå§‹åŒ–æ—¶ä¼ å‚ä¸ºNULLï¼Œç„¶åä¼šä¸ºå…¶ä»_dispatch_root_queues ä¸­è·å–ä¸€ä¸ªæ ¹ç›®æ ‡é˜Ÿåˆ—ï¼›å½“ tq ä¸º NULLï¼Œå³å…¥å‚ç›®æ ‡é˜Ÿåˆ—ä¸º DISPATCH_TARGET_QUEUE_DEFAULTï¼ˆå€¼æ˜¯ NULLï¼‰ æ—¶ï¼Œ æ ¹æ® qos å’Œ overcommit ä» _dispatch_root_queues å…¨å±€çš„æ ¹é˜Ÿåˆ—æ•°ç»„ä¸­è·å–ä¸€ä¸ªæ ¹é˜Ÿåˆ—ä½œä¸ºæ–°é˜Ÿåˆ—çš„ç›®æ ‡é˜Ÿåˆ— if (!tq) { tq = _dispatch_get_root_queue( qos == DISPATCH_QOS_UNSPECIFIED ? DISPATCH_QOS_DEFAULT : qos, overcommit == _dispatch_queue_attr_overcommit_enabled)-\u003e_as_dq; if (unlikely(!tq)) { // å¦‚æœæœªå–å¾—ç›®æ ‡é˜Ÿåˆ—åˆ™ crash DISPATCH_CLIENT_CRASH(qos, \"Invalid queue attribute\"); } } dispatch_sync a. é¦–å…ˆå°†ä»»åŠ¡åŠ å…¥é˜Ÿåˆ— b. æ‰§è¡Œä»»åŠ¡block c. å°†ä»»åŠ¡ç§»å‡ºé˜Ÿåˆ— d. syncé‡Œé¢çš„å¤„ç†æœ€ç»ˆæ‰§è¡Œçš„æ˜¯barrierçš„å†…éƒ¨å‡½æ•° e. ä¼šæ­»é”çš„åŸå› ï¼šæ‰§è¡Œæ—¶ä¼šæ£€æŸ¥å½“å‰çº¿ç¨‹çš„çŠ¶æ€ï¼ˆæ˜¯å¦æ­£åœ¨ç­‰å¾…ï¼‰ï¼Œç„¶åä¸å½“å‰çš„çº¿ç¨‹çš„IDï¼ˆ_dispatch_tid_self()ï¼‰åšæ¯”è¾ƒï¼Œç›¸ç­‰çš„è¯åˆ™åˆ¤å®šä¸ºæ­»é”ã€‚ï¼ˆç›¸å…³å¤„ç†åœ¨ __DISPATCH_WAIT_FOR_QUEUE__ å‡½æ•°ä¸­ï¼‰ dispatch_async a. å°†å¼‚æ­¥ä»»åŠ¡ï¼ˆdispatch_queue ã€ blockï¼‰å°è£…ä¸º dispatch_continuation_t ç±»å‹ b. ç„¶åæ‰§è¡Œ _dispatch_continuation_async -\u003e dx_pushé€’å½’é‡å®šå‘åˆ°æ ¹é˜Ÿåˆ—ï¼Œç„¶åæ‰§è¡Œ_dispatch_root_queue_pokeè¿›è¡Œå‡ºé˜Ÿæ“ä½œï¼Œé€šè¿‡åˆ›å»ºçº¿ç¨‹æ‰§è¡Œ dx_invoke æ‰§è¡Œblockå›è°ƒï¼› dispatch_barrier_async a. å’Œdispatch_async æµç¨‹ä¸€æ ·ï¼Œåªæ˜¯é‡Œé¢æœ‰ä¸€ä¸ªwhileå¾ªç¯ï¼Œç­‰é˜Ÿåˆ—ä¸­çš„barrierå‰é¢çš„ä»»åŠ¡æ‰§è¡Œå®Œï¼Œæ‰æ‰§è¡Œåé¢çš„ï¼› b. è¿™é‡Œæœ‰ä¸ªä¼˜åŒ–æ˜¯ï¼šå°è£…æˆ dispatch_continuation_s ç»“æ„æ—¶ï¼Œä¼šå…ˆä»å½“å‰çº¿ç¨‹çš„TLSä¸­è·å–ä¸€ä¸‹ï¼Œè·å–ä¸åˆ°å†ä»å †ä¸Šåˆ›å»ºæ–°çš„ dispatch_group a. dispatch_groupå†…éƒ¨ç»´æŠ¤ç€ä¸€ä¸ªæ•°å€¼ï¼Œåˆå§‹å€¼ä¸º0ï¼Œenteræ—¶å‡4ï¼Œleaveæ—¶åŠ 4 https://juejin.cn/post/6902346229868019719#heading-4 b. ç­‰å¾…ç”¨çš„æ˜¯whileå¾ªç¯ï¼Œè€Œä¸æ˜¯ä¿¡å·é‡ dispatch_semaphore_t a. dispatch_semaphore_wait æ—¶é‡Œé¢å…¶å®æ˜¯èµ·äº†ä¸€ä¸ªdo-while å¾ªç¯ï¼Œä¸æ–­çš„å»æŸ¥è¯¢åŸå­å˜é‡çš„å€¼ï¼Œä¸æ»¡è¶³æ¡ä»¶æ—¶ä¼šä¸€ç›´å¾ªç¯ï¼Œå€Ÿæ­¤é˜»å¡æµç¨‹çš„è¿›è¡Œã€‚æœ‰ç‚¹åƒdispatch_once dispatch_group_async å†…éƒ¨å…¶å®æ˜¯å¯¹dispatch_async å’Œ dispatch_group_enter / dispatch_group_leave çš„å°è£… çº¿ç¨‹æ± å¤ç”¨åŸç† çº¿ç¨‹åˆ›å»ºåä»é˜Ÿåˆ—é‡Œå–å‡ºä»»åŠ¡æ‰§è¡Œï¼Œä»»åŠ¡æ‰§è¡Œåä½¿ç”¨ä¿¡å·é‡ä½¿å…¶ç­‰å¾…5ç§’é’Ÿï¼Œå¦‚æœåœ¨è¿™æœŸé—´å†æœ‰GCDä»»åŠ¡è¿‡æ¥ï¼Œä¼šå…ˆå°è¯•å”¤é†’çº¿ç¨‹ï¼Œè®©å®ƒç»§ç»­å·¥ä½œï¼Œå¦åˆ™ç­‰å¾…è¶…æ—¶åçº¿ç¨‹ä¼šè‡ªåŠ¨ç»“æŸï¼Œè¢«ç³»ç»Ÿé”€æ¯ã€‚ï¼ˆä¸æ˜¯tableviewä¸­çš„å¤ç”¨æ± æœºåˆ¶ï¼‰ static void * _dispatch_worker_thread(void *context) { ////////////////////////////////// // åˆ å‡äº†éƒ¨åˆ†ä»£ç  ////////////////////////////////// dispatch_queue_global_t dq = context; dispatch_pthread_root_queue_context_t pqc = dq-\u003edo_ctxt; int pending = os_atomic_dec2o(dq, dgq_pending, relaxed); // çº¿ç¨‹å­˜æ´»5ç§’é’Ÿ const int64_t timeout = 5ull * NSEC_PER_SEC; pthread_priority_t pp = _dispatch_get_priority(); dispatch_priority_t pri = dq-\u003edq_priority; // ä»é˜Ÿåˆ—ä¸­å–å‡ºä»»åŠ¡æ‰§è¡Œï¼Œæ‰§è¡Œå®Œåç­‰å¾…5ç§’é’Ÿ // å¦‚æœ5ç§’åæ²¡æœ‰è¢«å”¤é†’åˆ™è¿›å…¥è¶…æ—¶é€»è¾‘ï¼Œé˜Ÿåˆ—é‡Šæ”¾ï¼Œçº¿ç¨‹é€€å‡º do { // ä»»åŠ¡æ‰§è¡Œ _dispatch_root_queue_drain(dq, pri, DISPATCH_INVOKE_REDIRECTING_DRAIN); _dispatch_reset_priority_and_voucher(pp, NULL); } while (dispatch_semaphore_wait(\u0026pqc-\u003edpq_thread_mediator, dispatch_time(0, timeout)) == 0); #if DISPATCH_USE_INTERNAL_WORKQUEUE if (monitored) _dispatch_workq_worker_unregister(dq); #endif (void)os_atomic_inc2o(dq, dgq_thread_pool_size, release); _dispatch_root_queue_poke(dq, 1, 0); _dispatch_release(dq); // retained in _dispatch_root_queue_poke_slow return NULL; } dispatch_once dispatch_onceå‡½æ•°ä¸­çš„token (dispatch_once_t) ä¼šè¢«å¼ºè½¬ä¸ºdispatch_once_gate_tç±»å‹ï¼Œè€Œdispatch_once_gate_té‡Œé¢æ˜¯ä¸ªunionè”åˆä½“ç±»å‹ï¼Œå…¶ä¸­dgo_onceç”¨æ¥è®°å½•å½“å‰blockçš„æ‰§è¡ŒçŠ¶æ€ï¼Œæ‰§è¡Œå®ŒåçŠ¶æ€ä¼šè¢«æ ‡è®°ä¸ºDLOCK_ONCE_DONEã€‚ typedef struct dispatch_once_gate_s { union { dispatch_gate_s dgo_gate; uintptr_t dgo_once; }; } dispatch_once_gate_s, *dispatch_once_gate_t; æˆ‘ä»¬é¦–å…ˆè·å–dgo_onceå˜é‡çš„å€¼ï¼Œå¦‚æœæ˜¯DLOCK_ONCE_DONEï¼Œåˆ™è¡¨ç¤ºå·²ç»æ‰§è¡Œè¿‡äº†ï¼Œç›´æ¥returnæ‰ï¼› å¦‚æœæ˜¯DLOCK_ONCE_UNLOCKEDçŠ¶æ€ï¼Œåˆ™è¡¨ç¤ºé¦–æ¬¡æ‰§è¡Œï¼Œç„¶åä¼šæŠŠå½“å‰çš„çº¿ç¨‹idå­˜åˆ°dgo_onceå˜é‡ä¸­ï¼Œç„¶åå¼€å§‹æ‰§è¡Œblockä»»åŠ¡ï¼Œç»“æŸåä¼šæŠŠdgo_onceç½®ä¸ºDLOCK_ONCE_DONEï¼› å¦‚æœæœ‰å…¶ä»–çº¿ç¨‹æ‰§è¡Œè¿‡æ¥ï¼Œæ ¹æ®dgo_onceåˆ¤æ–­ï¼Œå‘ç°æ­£åœ¨æ‰§è¡Œä¸­ï¼Œåˆ™ä¼šè¿›å…¥ç­‰å¾…æµç¨‹ï¼Œç­‰å¾…å…¶å®æ˜¯å¯äº†ä¸ªfor (;;)æ— é™å¾ªç¯ï¼Œåœ¨å¾ªç¯ä¸­ä¸æ–­åœ°é€šè¿‡åŸå­æ“ä½œæŸ¥è¯¢dgo_onceçš„çŠ¶æ€ï¼Œç­‰å‘ç°å˜ä¸ºDLOCK_ONCE_DONEååˆ™é€€å‡ºå¾ªç¯ã€‚ dispatch_source_merge_data å¯¹åº”çš„ç»“æ„å®šä¹‰ // å®šä¹‰åœ¨ libdispatch ä»“åº“ä¸­çš„ init.c æ–‡ä»¶ä¸­ DISPATCH_VTABLE_INSTANCE(source, .do_type = DISPATCH_SOURCE_KEVENT_TYPE, .do_dispose = _dispatch_source_dispose, .do_debug = _dispatch_source_debug, .do_invoke = _dispatch_source_invoke, .dq_activate = _dispatch_source_activate, .dq_wakeup = _dispatch_source_wakeup, .dq_push = _dispatch_lane_push, ); æŠŠä»»åŠ¡åŒ…è£…æˆdispatch_continuation_tå¯¹è±¡ï¼Œæ¯æ¬¡dispatch_source_merge_dataæ—¶å¯¹å†…éƒ¨å˜é‡è¿›è¡ŒåŸå­æ€§çš„ADDã€ORã€REPLACEç­‰æ“ä½œï¼Œå¹¶æ‰§è¡Œdx_wakeupå‡½æ•°ï¼Œdx_wakeupæ˜¯ä¸ªå®å®šä¹‰ï¼Œå…¶å®è°ƒç”¨çš„æ˜¯_dispatch_source_wakeupï¼Œwakeupè¿™ä¸ªå‡½æ•°å…¶å®æ˜¯ä¸€ä¸ªå…¥é˜Ÿæ“ä½œï¼Œä½†å¹¶ä¸æ˜¯æ¯æ¬¡éƒ½ä¼šè¿›è¡Œå…¥é˜Ÿï¼ˆæ­¤å¤„è¿˜æœªå®Œå…¨çœ‹æ˜ç™½ o(â•¯â–¡â•°)o ï¼‰ï¼Œæ¥ç€ä¼šæ‰§è¡Œ_dispatch_main_queue_drain -\u003e _dispatch_continuation_pop_inlineå‡ºé˜Ÿæ“ä½œï¼Œæµç¨‹åŸºæœ¬å’Œdispatch_asyncä¸€è‡´ã€‚ ","date":"2022-06-09","objectID":"/ios%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/:5:0","tags":["iOS","runtime"],"title":"iOSæºç é˜…è¯»ç¬”è®°","uri":"/ios%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/"},{"categories":["å®ç°åŸç†"],"content":"NSTimer timeræ·»åŠ åˆ°runloopçš„è¿‡ç¨‹ï¼š å¦‚æœæ˜¯commonMode ï¼Œä¼šè¢«æ·»åŠ åˆ°runloopæŒæœ‰çš„ä¸€ä¸ª_commonModeItems é›†åˆä¸­ï¼Œ ç„¶åè°ƒç”¨ __CFRunLoopAddItemToCommonModes å‡½æ•°ï¼ŒæŠŠtimeræ·»åŠ åˆ°runloopModeå¯¹è±¡æŒæœ‰çš„_timersæ•°ç»„ä¸­ ï¼ŒåŒæ—¶ä¹Ÿä¼šæŠŠmodeNameæ·»åŠ åˆ°runloopTimerçš„ _rlModes ä¸­ï¼Œè®°å½•runloopTimeréƒ½èƒ½åœ¨å“ªç§runloop modeä¸‹æ‰§è¡Œï¼› å¦‚æœæ˜¯æ™®é€šmodeï¼Œåˆ™å…ˆè·å–è¿™ä¸ªrunloopModeå¯¹è±¡ï¼ŒæŠŠrunloopModeçš„nameæ·»åŠ åˆ°runloopTimeræŒæœ‰çš„ _rlModesé›†åˆä¸­ï¼Œç„¶åè°ƒç”¨ __CFRepositionTimerInMode å‡½æ•°ï¼ŒæŠŠrunloopTimeræ’å…¥runloopModeæŒæœ‰çš„ _timers æ•°ç»„ä¸­ï¼ˆå¦‚æœæ•°ç»„ä¸­å·²ç»å­˜åœ¨äº†ï¼Œåˆ™å…ˆåšç§»é™¤æ“ä½œï¼‰ï¼› ä¸Šé¢æ·»åŠ å®Œæˆåï¼Œä¼šè°ƒç”¨ __CFRepositionTimerInMode å‡½æ•°ï¼Œç„¶åè°ƒç”¨ __CFArmNextTimerInModeï¼Œå†è°ƒç”¨ mk_timer_arm å‡½æ•°æŠŠ CFRunLoopModeRef çš„ _timerPort å’Œä¸€ä¸ªæ—¶é—´ç‚¹æ³¨å†Œåˆ°ç³»ç»Ÿä¸­ï¼Œç­‰å¾…ç€ mach_msg å‘æ¶ˆæ¯å”¤é†’ä¼‘çœ ä¸­çš„ runloop èµ·æ¥æ‰§è¡Œåˆ°è¾¾æ—¶é—´çš„è®¡æ—¶å™¨ã€‚ï¼ˆmacOS å’Œ iOS ä¸‹éƒ½æ˜¯ä½¿ç”¨ mk_timer æ¥å”¤é†’ runloopï¼‰ï¼› æ¯æ¬¡è®¡æ—¶å™¨éƒ½ä¼šè°ƒç”¨ __CFArmNextTimerInMode å‡½æ•°æ³¨å†Œè®¡æ—¶å™¨çš„ä¸‹æ¬¡æ‰§è¡Œæ—¶é—´ï¼ˆè¿™ä¸ªæ—¶é—´æ˜¯åŸºäºæœ¬æ¬¡æ‰§è¡Œçš„ç†è®ºæ—¶é—´å åŠ å¾—åˆ°çš„ï¼Œè€Œéå½“å‰çš„çœŸå®æ—¶é—´ï¼Œä¹Ÿå°±æ˜¯è¯´å‡å¦‚æœ¬æ¬¡æ‰§è¡Œæ»åäº†ï¼Œä¸ä¼šå½±å“ä¸‹æ¬¡ç†è®ºä¸Šè¦æ‰§è¡Œçš„æ—¶é—´ç‚¹ï¼‰ï¼Œä¼‘çœ ä¸­çš„runloop é€šè¿‡å½“å‰runloop modeçš„ _timerPort ç«¯å£å”¤é†’ï¼Œç„¶ååœ¨æœ¬æ¬¡runloopå¾ªç¯ä¸­åœ¨ _CFRunloopDoTimers å‡½æ•°ä¸­å¾ªç¯è°ƒç”¨ __CFRunLoopDoTimer å‡½æ•°ï¼Œæ‰§è¡Œè¾¾åˆ°è§¦å‘æ—¶é—´çš„timerçš„ _callout å‡½æ•°ã€‚ __CFRUNLOOP_IS_CALLING_OUT_TO_A_TIMER_CALLBACK_FUNCTION__(rlt-\u003e_callout, rlt, context_info); æ˜¯æ‰§è¡Œè®¡æ—¶å™¨çš„ _callout å‡½æ•°ã€‚ NSTimer ä¸å‡†æ—¶é—®é¢˜ é€šè¿‡ä¸Šé¢çš„ NSTimer æ‰§è¡Œæµç¨‹å¯çœ‹åˆ°è®¡æ—¶å™¨çš„è§¦å‘å›è°ƒå®Œå…¨ä¾èµ– runloop çš„è¿è¡Œï¼ˆmacOS å’Œ iOS ä¸‹éƒ½æ˜¯ä½¿ç”¨ mk_timer æ¥å”¤é†’ runloopï¼‰ï¼Œä½¿ç”¨ NSTimer ä¹‹å‰å¿…é¡»æ³¨å†Œåˆ° run loopï¼Œä½†æ˜¯ run loop ä¸ºäº†èŠ‚çœèµ„æºå¹¶ä¸ä¼šåœ¨éå¸¸å‡†ç¡®çš„æ—¶é—´ç‚¹è°ƒç”¨è®¡æ—¶å™¨ï¼Œå¦‚æœä¸€ä¸ªä»»åŠ¡æ‰§è¡Œæ—¶é—´è¾ƒé•¿ï¼ˆä¾‹å¦‚æœ¬æ¬¡ run loop å¾ªç¯ä¸­ source0 äº‹ä»¶æ‰§è¡Œæ—¶é—´è¿‡é•¿æˆ–è€…è®¡æ—¶å™¨è‡ªèº«å›è°ƒæ‰§è¡Œæ—¶é—´è¿‡é•¿ï¼Œéƒ½ä¼šå¯¼è‡´è®¡æ—¶å™¨ä¸‹æ¬¡æ­£å¸¸æ—¶é—´ç‚¹çš„å›è°ƒè¢«å»¶åæˆ–è€…å»¶åæ—¶é—´è¿‡é•¿çš„è¯åˆ™ç›´æ¥å¿½ç•¥è¿™æ¬¡å›è°ƒï¼ˆè®¡æ—¶å™¨å›è°ƒæ‰§è¡Œä¹‹å‰ä¼šåˆ¤æ–­å½“å‰çš„æ‰§è¡ŒçŠ¶æ€ !__CFRunLoopTimerIsFiring(rlt)ï¼Œå¦‚æœæ˜¯è®¡æ—¶å™¨è‡ªèº«å›è°ƒæ‰§è¡Œæ—¶é—´è¿‡é•¿å¯¼è‡´ä¸‹æ¬¡å›è°ƒè¢«å¿½ç•¥çš„æƒ…å†µå¤§æ¦‚ä¸æ­¤æ ‡è¯†æœ‰å…³ ï¼‰ï¼‰ï¼Œé‚£ä¹ˆå½“é”™è¿‡ä¸€ä¸ªæ—¶é—´ç‚¹ååªèƒ½ç­‰åˆ°ä¸‹ä¸€ä¸ªæ—¶é—´ç‚¹æ‰§è¡Œï¼Œå¹¶ä¸ä¼šå»¶åæ‰§è¡Œï¼ˆNSTimer æä¾›äº†ä¸€ä¸ª tolerance å±æ€§ç”¨äºè®¾ç½®å®½å®¹åº¦ï¼Œå³å½“å‰æ—¶é—´ç‚¹å·²ç»è¿‡äº†è®¡æ—¶å™¨çš„æœ¬æ¬¡è§¦å‘ç‚¹ï¼Œä½†æ˜¯è¶…è¿‡çš„æ—¶é—´é•¿åº¦å°äº tolerance çš„è¯ï¼Œé‚£ä¹ˆæœ¬æ¬¡è®¡æ—¶å™¨å›è°ƒè¿˜å¯ä»¥æ­£å¸¸æ‰§è¡Œï¼Œä¸è¿‡æ˜¯ä¸å‡†æ—¶çš„å»¶åæ‰§è¡Œã€‚ tolerance çš„å€¼é»˜è®¤æ˜¯ 0ï¼Œæœ€å¤§å€¼çš„è¯æ˜¯è®¡æ—¶å™¨é—´éš”æ—¶é—´_interval çš„ä¸€åŠï¼Œå¯ä»¥æ ¹æ®è‡ªèº«çš„æƒ…å†µé…Œæƒ…è®¾ç½® tolerance çš„å€¼ã€‚ ï¼ˆNSTimer ä¸æ˜¯ä¸€ç§å®æ—¶æœºåˆ¶ï¼Œä»¥ main run loop æ¥è¯´å®ƒè´Ÿè´£äº†æ‰€æœ‰çš„ä¸»çº¿ç¨‹äº‹ä»¶ï¼Œä¾‹å¦‚ UI ç•Œé¢çš„æ“ä½œï¼Œè´Ÿè´£çš„è¿ç®—ä½¿å½“å‰ run loop æŒç»­çš„æ—¶é—´è¶…è¿‡äº†è®¡æ—¶å™¨çš„é—´éš”æ—¶é—´ï¼Œé‚£ä¹ˆè®¡æ—¶å™¨ä¸‹ä¸€æ¬¡å›è°ƒå°±è¢«å»¶åï¼Œè¿™æ ·å°±é€ æˆ timer çš„ä¸å‡†æ—¶ï¼Œè®¡æ—¶å™¨æœ‰ä¸ªå±æ€§å«åš tolerance (å®½å®¹åº¦)ï¼Œæ ‡ç¤ºäº†å½“æ—¶é—´ç‚¹åˆ°åï¼Œå®¹è®¸æœ‰å¤šå°‘æœ€å¤§è¯¯å·®ã€‚å¦‚æœå»¶åæ—¶é—´è¿‡é•¿çš„è¯ä¼šç›´æ¥å¯¼è‡´è®¡æ—¶å™¨æœ¬æ¬¡å›è°ƒè¢«å¿½ç•¥ã€‚ï¼‰ ","date":"2022-06-09","objectID":"/ios%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/:6:0","tags":["iOS","runtime"],"title":"iOSæºç é˜…è¯»ç¬”è®°","uri":"/ios%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/"},{"categories":["å®ç°åŸç†"],"content":"æ¨èæ–‡ç«  æ·±å…¥æµ…å‡º GCD ä¹‹ dispatch_queue iOSä¹‹æ­¦åŠŸç§˜ç±â‘§: ç±»å’Œåˆ†ç±»åŠ è½½è¿‡ç¨‹ iOS ä»æºç è§£æRun Loop (å…«)ï¼šRun Loop ä¸ AutoreleasePoolã€NSTimerã€PerformSelector ç³»åˆ— ","date":"2022-06-09","objectID":"/ios%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/:7:0","tags":["iOS","runtime"],"title":"iOSæºç é˜…è¯»ç¬”è®°","uri":"/ios%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/"},{"categories":["å¼€å‘ç¯å¢ƒ"],"content":"é—®é¢˜ ","date":"2024-01-30","objectID":"/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/:1:0","tags":["å¼€å‘ç¯å¢ƒ","å‰ç«¯"],"title":"å‰ç«¯å¼€å‘ç¯å¢ƒé…ç½®","uri":"/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/"},{"categories":["å¼€å‘ç¯å¢ƒ"],"content":"Python12 ç§»é™¤ distutils åŒ…ï¼Œå¯¼è‡´ pnpm æ‰§è¡Œå¤±è´¥ â¯ pnpm add canvas -D Packages: +804 +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ Progress: resolved 804, reused 804, downloaded 0, added 0, done node_modules/.pnpm/canvas@2.11.2_encoding@0.1.13/node_modules/canvas: Running install script, failed in 1.7s .../node_modules/canvas install$ node-pre-gyp install --fallback-to-build --update-binary â”‚ node-pre-gyp info it worked if it ends with ok â”‚ node-pre-gyp info using node-pre-gyp@1.0.11 â”‚ node-pre-gyp info using node@20.11.0 | darwin | arm64 â”‚ node-pre-gyp http GET https://github.com/Automattic/node-canvas/releases/download/v2.11.2/canvas-v2.11.2-node-v115-darwin-unknown-arâ€¦ â”‚ node-pre-gyp ERR! install response status 404 Not Found on https://github.com/Automattic/node-canvas/releases/download/v2.11.2/canvaâ€¦ â”‚ node-pre-gyp WARN Pre-built binaries not installable for canvas@2.11.2 and node@20.11.0 (node-v115 ABI, unknown) (falling back to soâ€¦ â”‚ node-pre-gyp WARN Hit error response status 404 Not Found on https://github.com/Automattic/node-canvas/releases/download/v2.11.2/canâ€¦ â”‚ gyp info it worked if it ends with ok â”‚ gyp info using node-gyp@9.4.1 â”‚ gyp info using node@20.11.0 | darwin | arm64 â”‚ gyp info ok â”‚ gyp info it worked if it ends with ok â”‚ gyp info using node-gyp@9.4.1 â”‚ gyp info using node@20.11.0 | darwin | arm64 â”‚ gyp info find Python using Python version 3.12.1 found at \"/Users/zero_d_saber/.pyenv/versions/3.12.1/bin/python\" â”‚ gyp info spawn /Users/zero_d_saber/.pyenv/versions/3.12.1/bin/python â”‚ gyp info spawn args [ â”‚ gyp info spawn args '/Users/zero_d_saber/.volta/tools/image/packages/pnpm/lib/node_modules/pnpm/dist/node_modules/node-gyp/gyp/gypâ€¦ â”‚ gyp info spawn args 'binding.gyp', â”‚ gyp info spawn args '-f', â”‚ gyp info spawn args 'make', â”‚ gyp info spawn args '-I', â”‚ gyp info spawn args '/Users/zero_d_saber/Dev/Tauri/solid-pnpm/node_modules/.pnpm/canvas@2.11.2_encoding@0.1.13/node_modules/canvasâ€¦ â”‚ gyp info spawn args '-I', â”‚ gyp info spawn args '/Users/zero_d_saber/.volta/tools/image/packages/pnpm/lib/node_modules/pnpm/dist/node_modules/node-gyp/addon.gâ€¦ â”‚ gyp info spawn args '-I', â”‚ gyp info spawn args '/Users/zero_d_saber/Library/Caches/node-gyp/20.11.0/include/node/common.gypi', â”‚ gyp info spawn args '-Dlibrary=shared_library', â”‚ gyp info spawn args '-Dvisibility=default', â”‚ gyp info spawn args '-Dnode_root_dir=/Users/zero_d_saber/Library/Caches/node-gyp/20.11.0', â”‚ gyp info spawn args '-Dnode_gyp_dir=/Users/zero_d_saber/.volta/tools/image/packages/pnpm/lib/node_modules/pnpm/dist/node_modules/nâ€¦ â”‚ gyp info spawn args '-Dnode_lib_file=/Users/zero_d_saber/Library/Caches/node-gyp/20.11.0/\u003c(target_arch)/node.lib', â”‚ gyp info spawn args '-Dmodule_root_dir=/Users/zero_d_saber/Dev/Tauri/solid-pnpm/node_modules/.pnpm/canvas@2.11.2_encoding@0.1.13/nâ€¦ â”‚ gyp info spawn args '-Dnode_engine=v8', â”‚ gyp info spawn args '--depth=.', â”‚ gyp info spawn args '--no-parallel', â”‚ gyp info spawn args '--generator-output', â”‚ gyp info spawn args 'build', â”‚ gyp info spawn args '-Goutput_dir=.' â”‚ gyp info spawn args ] â”‚ Traceback (most recent call last): â”‚ File \"/Users/zero_d_saber/.volta/tools/image/packages/pnpm/lib/node_modules/pnpm/dist/node_modules/node-gyp/gyp/gyp_main.py\", lineâ€¦ â”‚ import gyp # noqa: E402 â”‚ ^^^^^^^^^^ â”‚ File \"/Users/zero_d_saber/.volta/tools/image/packages/pnpm/lib/node_modules/pnpm/dist/node_modules/node-gyp/gyp/pylib/gyp/__init__â€¦ â”‚ import gyp.input â”‚ File \"/Users/zero_d_saber/.volta/tools/image/packages/pnpm/lib/node_modules/pnpm/dist/node_modules/node-gyp/gyp/pylib/gyp/input.pyâ€¦ â”‚ from distutils.version import StrictVersion â”‚ ModuleNotFoundError: No module named 'distutils' â”‚ gyp ERR! configure error â”‚ gyp ERR! stack Error: `gyp` failed with exit code: 1 â”‚ gyp ERR! stack at ChildProcess.onCpExit (/Users/zero_d_saber/.volta/tools/image/packages/pnpm/lib/node_modules/pnpm/dist/node_moâ€¦ â”‚ gyp ERR! stack at ChildProcess.emit (node:events:","date":"2024-01-30","objectID":"/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/:1:1","tags":["å¼€å‘ç¯å¢ƒ","å‰ç«¯"],"title":"å‰ç«¯å¼€å‘ç¯å¢ƒé…ç½®","uri":"/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/"},{"categories":["å¼€å‘ç¯å¢ƒ"],"content":"yarn4 moduleæ‰¾ä¸åˆ° yarn4 node_modules è§£å†³æ–¹æ¡ˆ yarn config set nodeLinker node-modules ","date":"2024-01-30","objectID":"/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/:1:2","tags":["å¼€å‘ç¯å¢ƒ","å‰ç«¯"],"title":"å‰ç«¯å¼€å‘ç¯å¢ƒé…ç½®","uri":"/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/"},{"categories":["å­¦ä¹ ç¬”è®°"],"content":"è®°å½•React Nativeå­¦ä¹ è¿‡ç¨‹ä¸­çš„ä¸€ç‚¹æ”¶è·","date":"2024-01-14","objectID":"/reactnativenote/","tags":["ReactNative"],"title":"React Nativeç¬”è®°","uri":"/reactnativenote/"},{"categories":["å­¦ä¹ ç¬”è®°"],"content":"Qï¼šJSONè½¬JavaScriptå¯¹è±¡æ—¶è‡ªå®šä¹‰key const jsonString = '{\"componentName\":\"abc\",\"theme\":\"light\",\"debugMode\":\"1\"}' const obj = JSON.parse(jsonString, function(k, v){ if (k == 'theme') { // ç»™è‡ªå®šä¹‰çš„å±æ€§èµ‹å€¼ this.custom = v; // è¿”å›undefinedä¼šæŠŠå½“å‰è¿™ä¸ªkeyä»å¯¹è±¡ä¸­ç§»é™¤ return undefined; } else if (k == '') { console.log(\"å®å„¿å§\"); } return v; }); console.log(obj); ","date":"2024-01-14","objectID":"/reactnativenote/:1:0","tags":["ReactNative"],"title":"React Nativeç¬”è®°","uri":"/reactnativenote/"},{"categories":["å­¦ä¹ ç¬”è®°"],"content":"Qï¼šå¯¹è±¡å¦‚ä½•åˆ¤ç©ºï¼Ÿ let obj; console.log(obj == null); // true console.log(obj == undefined); // true console.log(obj == false); // false ","date":"2024-01-14","objectID":"/reactnativenote/:2:0","tags":["ReactNative"],"title":"React Nativeç¬”è®°","uri":"/reactnativenote/"},{"categories":["å­¦ä¹ ç¬”è®°"],"content":"Qï¼š?? ä¸ || åŒºåˆ« ?? åªæœ‰å½“valueæ˜¯nullã€undefinedæ—¶æ‰ä¼šå–åé¢çš„å€¼ï¼Œè€Œ || åˆ™è®¤ä¸ºnullã€undefinedã€0ã€\"\"ã€false è¿™äº›éƒ½æ˜¯falseã€‚ ","date":"2024-01-14","objectID":"/reactnativenote/:3:0","tags":["ReactNative"],"title":"React Nativeç¬”è®°","uri":"/reactnativenote/"},{"categories":["å­¦ä¹ ç¬”è®°"],"content":"Qï¼šJSæ•°ç»„å–å€¼éœ€è¦æ³¨æ„è¶Šç•Œé—®é¢˜å—ï¼Ÿ ä¸éœ€è¦ï¼ŒJSçš„æ•°ç»„ä¸ä¼šå‘ç”Ÿè¶Šç•Œçš„å¼‚å¸¸ï¼Œæˆ‘ä»¬ä½¿ç”¨æ—¶åªéœ€å…³æ³¨æ•°ç»„æ˜¯å¦ undefinedçš„é—®é¢˜ã€‚ const arr = [] console.log(arr[0]) // undefined undefinedé—®é¢˜ï¼š undefined è§£å†³åŠæ³•ï¼š const arr = undefined console.log(arr?.[0]) // undefined ","date":"2024-01-14","objectID":"/reactnativenote/:4:0","tags":["ReactNative"],"title":"React Nativeç¬”è®°","uri":"/reactnativenote/"},{"categories":["å­¦ä¹ ç¬”è®°"],"content":"Qï¼šJSä¸­å¦‚ä½•åˆ¤æ–­ä¸€ä¸ªå˜é‡æ˜¯æ•°ç»„è¿˜æ˜¯å¯¹è±¡ï¼Ÿ const arr = [] const obj = {} console.log(Array.isArray(arr)) // true ","date":"2024-01-14","objectID":"/reactnativenote/:5:0","tags":["ReactNative"],"title":"React Nativeç¬”è®°","uri":"/reactnativenote/"},{"categories":["å­¦ä¹ ç¬”è®°"],"content":"Qï¼š\u003c\u003e vs React.flagment ç›¸åŒç‚¹ï¼š éƒ½å¯ä»¥åŒ…è£¹å­å…ƒç´  éƒ½ä¸æ¸²æŸ“ä»»ä½•çœŸå®çš„DOMæ ‡ç­¾ æ€§èƒ½æå‡ ä¸åŒç‚¹ï¼š React.flagmentæ”¯æŒè®¾ç½®keyå±æ€§ fragmentå¯ä»¥è§£å†³æˆ‘ä»¬ä»€ä¹ˆé—®é¢˜ï¼Ÿ mapå‡½æ•°ä¸­çš„ç»„ä»¶éœ€è¦è®¾ç½®keyå±æ€§ï¼Œ\u003c\u003e å¹¶ä¸æ”¯æŒè®¾ç½®å±æ€§ï¼Œè€Œæˆ‘ä»¬åˆä¸æƒ³å¢åŠ DOMèŠ‚ç‚¹ï¼Œæ­¤æ—¶React.fragmentå°±å¯ä»¥å¤§å±•èº«æ‰‹äº†ï¼š \u003cText style={style} numberOfLines={numberOfLines}\u003e {icons?.map(({ width, height, url }, index) =\u003e { return ( \u003cReact.fragment key={index.toString()}\u003e \u003cImage style={styles.iconImg} resizeMode={'contain'} source={{ uri: url, }} /\u003e \u003cText\u003e\u0026nbsp;\u003c/Text\u003e \u003c/React.Fragment\u003e ); })} {props.children ?? ''} \u003c/Text\u003e ","date":"2024-01-14","objectID":"/reactnativenote/:6:0","tags":["ReactNative"],"title":"React Nativeç¬”è®°","uri":"/reactnativenote/"},{"categories":["å­¦ä¹ ç¬”è®°"],"content":"Qï¼šhookå‡½æ•°ä¸è®©åœ¨å‡½æ•°ä¸­ä½¿ç”¨æ€ä¹ˆåŠï¼Ÿ ä½¿ç”¨useMutation export function useQueryProviderNextPage() { const bookId = 123 const dispatch = useAppDispatch(); return useMutation( (params: IParams) =\u003e { return request({ method: 'POST', url: '/a/b/c', params: { id: bookId, currentPage: params.currentPage ?? 2, }, }); }, { onSuccess: (response) =\u003e { if (response) { dispatch(updateProviderList(response.data)); } }, onError: (response) =\u003e { console.log('--- è¯·æ±‚å¤±è´¥---', console.log(JSON.stringify(response))); }, }, ); } const fetchNextPageMutation = useQueryNextPage(); // è°ƒç”¨ fetchNextPageMutation.mutate({ currentPage: (section?.currentPage ?? 1) + 1, bookId: section?.id, }); ","date":"2024-01-14","objectID":"/reactnativenote/:7:0","tags":["ReactNative"],"title":"React Nativeç¬”è®°","uri":"/reactnativenote/"},{"categories":["å­¦ä¹ ç¬”è®°"],"content":"Qï¼šListEmptyComponets ä¸èƒ½é“ºæ»¡ï¼š ç»™SectionListè®¾ç½®å¦‚ä¸‹å±æ€§: contentContainerStyle={{ flexGrow: 1, }} ","date":"2024-01-14","objectID":"/reactnativenote/:8:0","tags":["ReactNative"],"title":"React Nativeç¬”è®°","uri":"/reactnativenote/"},{"categories":["å­¦ä¹ ç¬”è®°"],"content":"Qï¼šæ¡ä»¶æ¸²æŸ“ React ä¸­æ¡ä»¶æ¸²æŸ“çš„ N ç§æ–¹æ³• åœ¨å†™ç»„ä»¶æ—¶ä¸è¦ç”¨{ åˆ¤æ–­æ¡ä»¶ \u0026\u0026 ç»„ä»¶ }è¿™ç§å†™æ³•ï¼Œå› ä¸ºå‡å¦‚å‰é¢çš„æ¡ä»¶æ˜¯falseï¼Œé‚£è¿™ä¸ªç»“æœå°±æ˜¯ { false } ï¼Œç„¶è€Œè¿™å¹¶ä¸æ˜¯ä¸€ä¸ªåˆæ³•çš„ç»„ä»¶ï¼Œåœ¨æŸäº›åœºæ™¯ä¸‹ä¼šæŠ¥é”™ã€‚å»ºè®®ä½¿ç”¨{ åˆ¤æ–­æ¡ä»¶ ? ç»„ä»¶ : null }è¿™ç§æ–¹å¼ã€‚ ","date":"2024-01-14","objectID":"/reactnativenote/:9:0","tags":["ReactNative"],"title":"React Nativeç¬”è®°","uri":"/reactnativenote/"},{"categories":["é¢è¯•"],"content":"é¢è¯•å‡†å¤‡","date":"2022-10-25","objectID":"/%E9%9D%A2%E8%AF%95%E8%B5%84%E6%96%99/","tags":["é¢è¯•"],"title":"é¢è¯•èµ„æ–™","uri":"/%E9%9D%A2%E8%AF%95%E8%B5%84%E6%96%99/"},{"categories":["é¢è¯•"],"content":"ä¼˜ç§€æ–‡ç«  ","date":"2022-10-25","objectID":"/%E9%9D%A2%E8%AF%95%E8%B5%84%E6%96%99/:1:0","tags":["é¢è¯•"],"title":"é¢è¯•èµ„æ–™","uri":"/%E9%9D%A2%E8%AF%95%E8%B5%84%E6%96%99/"},{"categories":["é¢è¯•"],"content":"UI iOSè§¦æ‘¸äº‹ä»¶å…¨å®¶æ¡¶ ç§»åŠ¨ç«¯æ¸²æŸ“åŸç†æµ…æ iOSæ¸²æŸ“åŸç† ","date":"2022-10-25","objectID":"/%E9%9D%A2%E8%AF%95%E8%B5%84%E6%96%99/:1:1","tags":["é¢è¯•"],"title":"é¢è¯•èµ„æ–™","uri":"/%E9%9D%A2%E8%AF%95%E8%B5%84%E6%96%99/"},{"categories":["é¢è¯•"],"content":"Runtime iOSæºç é˜…è¯»ç¬”è®° dyldè¯¦è§£ iOSä¹‹æ­¦åŠŸç§˜ç± Blockçš„æœ¬è´¨ Blockæ•è·å®ä½“å¼•ç”¨ ","date":"2022-10-25","objectID":"/%E9%9D%A2%E8%AF%95%E8%B5%84%E6%96%99/:1:2","tags":["é¢è¯•"],"title":"é¢è¯•èµ„æ–™","uri":"/%E9%9D%A2%E8%AF%95%E8%B5%84%E6%96%99/"},{"categories":["é¢è¯•"],"content":"Memory iOS Memoryå†…å­˜è¯¦è§£ ","date":"2022-10-25","objectID":"/%E9%9D%A2%E8%AF%95%E8%B5%84%E6%96%99/:1:3","tags":["é¢è¯•"],"title":"é¢è¯•èµ„æ–™","uri":"/%E9%9D%A2%E8%AF%95%E8%B5%84%E6%96%99/"},{"categories":["é¢è¯•"],"content":"Performance å¸¦ä½ æ‰“é€ ä¸€å¥—APMç›‘æ§ç³»ç»Ÿ iOS APPåŒ…ç˜¦èº«çœŸæ²¡ä½ æƒ³çš„é‚£ä¹ˆéš¾ï¼Œéš¾å¾—æ˜¯ä¸šåŠ¡ï¼ï¼ï¼ ","date":"2022-10-25","objectID":"/%E9%9D%A2%E8%AF%95%E8%B5%84%E6%96%99/:1:4","tags":["é¢è¯•"],"title":"é¢è¯•èµ„æ–™","uri":"/%E9%9D%A2%E8%AF%95%E8%B5%84%E6%96%99/"},{"categories":["é¢è¯•"],"content":"Crash iOS crashåˆ†ç±»ï¼šMachå¼‚å¸¸ã€Unixä¿¡å·å’ŒNSExceptionå¼‚å¸¸ iOSå´©æºƒç›‘æ§ä¸åˆ†æ ä½ çœŸçš„æ‡‚iOSçš„å¼‚å¸¸æ•è·å—ï¼Ÿ iOS Crashå´©æºƒå¼‚å¸¸æ•è· ","date":"2022-10-25","objectID":"/%E9%9D%A2%E8%AF%95%E8%B5%84%E6%96%99/:1:5","tags":["é¢è¯•"],"title":"é¢è¯•èµ„æ–™","uri":"/%E9%9D%A2%E8%AF%95%E8%B5%84%E6%96%99/"},{"categories":["é¢è¯•"],"content":"Network è®¡ç®—æœºç½‘ç»œå¤ªéš¾äº†ï¼Ÿäº†è§£è¿™ä¸€ç¯‡å°±å¤Ÿäº† ã€ŒæŸ¥ç¼ºè¡¥æ¼ã€å·©å›ºä½ çš„HTTPçŸ¥è¯†ä½“ç³» WebæŠ€æœ¯ï¼ˆäº”ï¼‰ï¼šHTTP/2 æ˜¯å¦‚ä½•è§£å†³HTTP/1.1 æ€§èƒ½ç“¶é¢ˆçš„ï¼Ÿ WebæŠ€æœ¯ï¼ˆå…­ï¼‰ï¼šQUIC æ˜¯å¦‚ä½•è§£å†³TCP æ€§èƒ½ç“¶é¢ˆçš„ï¼Ÿ ","date":"2022-10-25","objectID":"/%E9%9D%A2%E8%AF%95%E8%B5%84%E6%96%99/:1:6","tags":["é¢è¯•"],"title":"é¢è¯•èµ„æ–™","uri":"/%E9%9D%A2%E8%AF%95%E8%B5%84%E6%96%99/"},{"categories":["é¢è¯•"],"content":"Swift ä» SIL è§’åº¦çœ‹ Swift ä¸­çš„å€¼ç±»å‹ä¸å¼•ç”¨ç±»å‹ ä» SIL çœ‹ Swift å‡½æ•°æ´¾å‘æœºåˆ¶ iOSä¸‹çš„é—­åŒ…ä¸‹ç¯‡-Closure Swift æ€§èƒ½ä¼˜åŒ–(2)â€”â€”åè®®ä¸æ³›å‹çš„å®ç° Swift æ³›å‹åº•å±‚å®ç°åŸç† ","date":"2022-10-25","objectID":"/%E9%9D%A2%E8%AF%95%E8%B5%84%E6%96%99/:1:7","tags":["é¢è¯•"],"title":"é¢è¯•èµ„æ–™","uri":"/%E9%9D%A2%E8%AF%95%E8%B5%84%E6%96%99/"},{"categories":["é¢è¯•"],"content":"ä¸šåŠ¡ iOSç›´æ’­æµç¨‹æ¦‚è¿° ","date":"2022-10-25","objectID":"/%E9%9D%A2%E8%AF%95%E8%B5%84%E6%96%99/:1:8","tags":["é¢è¯•"],"title":"é¢è¯•èµ„æ–™","uri":"/%E9%9D%A2%E8%AF%95%E8%B5%84%E6%96%99/"},{"categories":["é¢è¯•"],"content":"ç®—æ³• ","date":"2022-10-25","objectID":"/%E9%9D%A2%E8%AF%95%E8%B5%84%E6%96%99/:2:0","tags":["é¢è¯•"],"title":"é¢è¯•èµ„æ–™","uri":"/%E9%9D%A2%E8%AF%95%E8%B5%84%E6%96%99/"},{"categories":["é¢è¯•"],"content":"å¿«é€Ÿæ’åº class Solution { func sortArray(_ nums: [Int]) -\u003e [Int] { let left = 0, right = nums.count - 1 var arr = nums quickSort(\u0026arr, left, right) return arr } func quickSort(_ nums: inout [Int], _ low: Int, _ high: Int) { guard low \u003c high else { return } let randomIndex = Int.random(in: (low...high)) let pivot = nums[randomIndex] // æŠŠéšæœºé€‰æ‹©çš„æ•°æ”¾åˆ°æœ€å‰é¢ nums.swapAt(low, randomIndex) var left = low, right = high while left \u003c right { while left \u003c right, pivot \u003c= nums[right] { right -= 1 } while left \u003c right, nums[left] \u003c= pivot { left += 1 } if left \u003c right { nums.swapAt(left, right) } } // æŠŠpivotäº¤æ¢å›æ¥ nums.swapAt(left, low) quickSort(\u0026nums, low, left - 1) quickSort(\u0026nums, left + 1, high) } } ","date":"2022-10-25","objectID":"/%E9%9D%A2%E8%AF%95%E8%B5%84%E6%96%99/:2:1","tags":["é¢è¯•"],"title":"é¢è¯•èµ„æ–™","uri":"/%E9%9D%A2%E8%AF%95%E8%B5%84%E6%96%99/"},{"categories":["é¢è¯•"],"content":"äºŒå‰æ ‘éå† é€’å½’ /// traversals ä¸ºè¾“å‡ºçš„æ•°ç»„ func preorder(_ node: TreeNode?) { guard let node = node else { return } /// å‰åºéå† traversals.append(node.val) preorder(node.left) preorder(node.right) /// ä¸­åºéå† preorder(node.left) traversals.append(node.val) preorder(node.right) /// ååºéå† preorder(node.left) preorder(node.right) traversals.append(node.val) } è¿­ä»£ å‰åºéå† func preorderIteration(_ root: TreeNode?) { var st: [TreeNode?] = [root] while !st.isEmpty { guard node = st.removeLast() else { continue } traversals.append(node.val) st.insert(node.right, at: 0) st.insert(node.left, at: 0) } } ä¸­åºéå† func inorderIteration(_ root: TreeNode?) { var st: [TreeNode?] = [] var cur: TreeNode? = root while cur != nil || !st.isEmpty { if cur != nil { st.append(cur) cur = cur?.left } else { let lastNode = st.popLast() traversals.append(lastNode!.val) cur = lastNode?.right } } } ååºéå† func postorderIteration(_ root: TreeNode?) { var st: [TreeNode?] = [root] while !st.isEmpty { let node = st.removeFirst() if node != nil { traversals.append(node!.val) } else { continue } st.insert(node?.left, at: 0) st.insert(node?.right, at: 0) } traversals = traversals.reversed() } é¢œè‰²æ ‡è®° å‰åº ä¸­â†’å·¦â†’å³ æŒ‰ç…§ å³â†’å·¦â†’ä¸­ ä¸­åº å·¦â†’ä¸­â†’å³ æŒ‰ç…§ å³â†’ä¸­â†’å·¦ ååº å·¦â†’å³â†’ä¸­ æŒ‰ç…§ ä¸­â†’å³â†’å·¦ func inorderTraversal(_ root: TreeNode?) -\u003e [Int] { var traversals = [Int]() var stack = [(root, false)] while !stack.isEmpty { let (node, isVisted) = stack.removeLast() guard let node == node else { continue } if isVisted { traversals.append(node.val) continue } // ------ é€†åºæ·»åŠ  ------ ///å‰åºéå† stack.append((node.right, false)) stack.append((node.left, false)) stack.append((node, true)) ///ä¸­åºéå† stack.append((node.right, false)) stack.append((node, true)) stack.append((node.left, false)) ///ååºéå† stack.append((node, true)) stack.append((node.right, false)) stack.append((node.left, false)) } return traversals } ","date":"2022-10-25","objectID":"/%E9%9D%A2%E8%AF%95%E8%B5%84%E6%96%99/:2:2","tags":["é¢è¯•"],"title":"é¢è¯•èµ„æ–™","uri":"/%E9%9D%A2%E8%AF%95%E8%B5%84%E6%96%99/"},{"categories":["é¢è¯•"],"content":"å †æ’åº // å †æ’åº func sortArray(_ nums: [Int]) -\u003e [Int] { var nums = nums var endIndex = nums.count - 1 // 1.æŠŠå½“å‰æ•°ç»„æ„å»ºæˆä¸€ä¸ªå¤§é¡¶å † // 2.æ¥ç€ç¬¬ä¸€ä¸ªå€¼ä¸æœ€åä¸€ä¸ªå€¼è°ƒæ¢(æŠŠæœ€å¤§å€¼æ”¾åˆ°æœ€å) // 3.ç„¶åæŠŠåˆ¨é™¤æœ€åæœ€å¤§å€¼çš„æ•°ç»„é‡æ–°æ„å»ºæˆå¤§é¡¶æ¨ï¼Œ // 4.å†ç„¶åé€’å½’æ‰§è¡Œä¸Šé¢çš„æµç¨‹ repeat { buildMaxHeap(\u0026nums, endIndex) (nums[endIndex], nums[0]) = (nums[0], nums[endIndex]) endIndex = endIndex - 1 } while(endIndex \u003e 0) return nums } // æŠŠæ•°ç»„æ„å»ºæˆå¤§é¡¶å † private func buildMaxHeap(_ nums: inout [Int], _ endIndex: Int) { var parentIndex = endIndex \u003e\u003e 1 while parentIndex \u003e= 0 { let parentValue = nums[parentIndex] var minNodeIndex = parentIndex let leftChildIndex = parentIndex * 2 + 1 if endIndex \u003e= leftChildIndex \u0026\u0026 nums[leftChildIndex] \u003e parentValue { minNodeIndex = leftChildIndex } let rightChildIndex = parentIndex * 2 + 2 if rightChildIndex \u003c= endIndex \u0026\u0026 nums[rightChildIndex] \u003e nums[minNodeIndex] { minNodeIndex = rightChildIndex } // å¦‚æœçˆ¶èŠ‚ç‚¹ä¸æ˜¯æœ€å¤§çš„å€¼ï¼Œé‚£ä¹ˆä¸æœ€å¤§å€¼è¿›è¡Œäº¤æ¢ï¼Œä¿è¯å †é¡¶æ˜¯æœ€å¤§å€¼ if minNodeIndex != parentIndex { (nums[minNodeIndex], nums[parentIndex]) = (nums[parentIndex], nums[minNodeIndex]) } parentIndex = parentIndex - 1 } } ","date":"2022-10-25","objectID":"/%E9%9D%A2%E8%AF%95%E8%B5%84%E6%96%99/:2:3","tags":["é¢è¯•"],"title":"é¢è¯•èµ„æ–™","uri":"/%E9%9D%A2%E8%AF%95%E8%B5%84%E6%96%99/"},{"categories":["é¢è¯•"],"content":"åŸºæ•°ï¼ˆæ¡¶ï¼‰æ’åº // åŸºæ•°æ’åº func radixSort(_ nums: [Int]) -\u003e [Int] { // æœ€ç»ˆç»“æœ var resultArray = nums //é€šè¿‡åŸºæ•°æ’åºå®ç° var maxDigit = 0 //æœ€å¤§ä½æ•° var digit = 0 //å½“å‰æ‰€åœ¨ä½æ•°(ä¸ªåç™¾åƒä¸‡) var maxValue = 0 repeat { //1ã€å»ºç«‹20ä¸ªæ¡¶((-9 - 9)ä¸€ä¸ªæ•°å­—ä¸€ä¸ªæ¡¶),è´Ÿæ•°æ”¾åœ¨å‰10ä¸ªæ¡¶,æ­£æ•°æ”¾åˆ°å10ä¸ªæ¡¶ var buckets = [[Int]]() for _ in 0 ..\u003c 20 { buckets.append([Int]()) } //2ã€æŒ‰æ¯ä¸ªä½ä¸Šçš„å€¼æ”¾å…¥å¯¹åº”çš„æ¡¶ä¸­ //let digit10n = NSDecimalNumber(decimal: pow(Decimal(10), digit)).intValue let digit10n = Int(pow(Double(10), Double(digit))) for num in resultArray { let mod = num / digit10n % 10 //å–å¾—æŸä½ä¸Šçš„å€¼ buckets[mod + 10].append(num) //é¦–æ¬¡éå†æ—¶è·å–åˆ°æ•°ç»„ä¸­çš„æœ€å¤§å€¼ï¼Œåé¢è¦ç”¨å®ƒè®¡ç®—æœ€å¤§ä½æ•°æ˜¯å¤šå°‘ä½ if digit == 0 { maxValue = max(maxValue, abs(num)) } } //resultArray.removeAll() //3ã€äºŒç»´æ•°ç»„é™ç»´æˆä¸€ç»´æ•°ç»„ï¼Œç”¨äºäºŒæ¬¡é€’å½’ resultArray = buckets.flatMap {$0} // è®¡ç®—ç»å¯¹å€¼æœ€å¤§çš„æ•°çš„ä½æ•° if digit == 0 { var tempMaxValue = maxValue while tempMaxValue != 0 { tempMaxValue = tempMaxValue / 10 maxDigit = maxDigit + 1 } } //4ã€è¿›ä½ digit = digit + 1 } while (digit \u003c maxDigit) return resultArray } ","date":"2022-10-25","objectID":"/%E9%9D%A2%E8%AF%95%E8%B5%84%E6%96%99/:2:4","tags":["é¢è¯•"],"title":"é¢è¯•èµ„æ–™","uri":"/%E9%9D%A2%E8%AF%95%E8%B5%84%E6%96%99/"},{"categories":["é¢è¯•"],"content":"å¯»æ‰¾ä¸¤ä¸ªViewçš„æœ€è¿‘å…¬å…±çˆ¶è§†å›¾ - (__kindof MAS_VIEW *)mas_closestCommonSuperview:(MAS_VIEW *)view { MAS_VIEW *closestCommonSuperview = self; MAS_VIEW *secondViewSuperview = view; while (closestCommonSuperview != secondViewSuperview) { closestCommonSuperview = closestCommonSuperview == nil ? view : closestCommonSuperview.superview; secondViewSuperview = secondViewSuperview == nil ? self : secondViewSuperview.superview; } return closestCommonSuperview; } ","date":"2022-10-25","objectID":"/%E9%9D%A2%E8%AF%95%E8%B5%84%E6%96%99/:2:5","tags":["é¢è¯•"],"title":"é¢è¯•èµ„æ–™","uri":"/%E9%9D%A2%E8%AF%95%E8%B5%84%E6%96%99/"},{"categories":["é¢è¯•"],"content":"leetcode #42 æ¥é›¨æ°´ #142 ç¯å½¢é“¾è¡¨II #206 åè½¬é“¾è¡¨ #92 åè½¬é“¾è¡¨II #405 åè¿›åˆ¶è½¬åå…­è¿›åˆ¶ #215 æ•°ç»„ä¸­ç¬¬Kä¸ªæœ€å¤§çš„å…ƒç´  #é¢è¯•é¢˜02.08 ç¯è·¯æ£€æµ‹ ","date":"2022-10-25","objectID":"/%E9%9D%A2%E8%AF%95%E8%B5%84%E6%96%99/:2:6","tags":["é¢è¯•"],"title":"é¢è¯•èµ„æ–™","uri":"/%E9%9D%A2%E8%AF%95%E8%B5%84%E6%96%99/"},{"categories":["ç¼–è¯‘é“¾æ¥"],"content":"ç¬”è®° å†…å­˜åˆ†ä¸ºä¸å¯è®¿é—®åŒºåŸŸã€.textã€.dataã€.bssã€å †åŒºã€å…±äº«åº“ã€.stackã€å†…æ ¸åŒºï¼› å…¨å±€å˜é‡ã€é™æ€å˜é‡åœ¨æ•°æ®æ®µï¼Œå…¶ä¸­å·²åˆå§‹åŒ–å¹¶ä¸”åˆå§‹åŒ–å€¼ä¸ä¸º0çš„.dataæ®µï¼Œåˆå§‹åŒ–ä¸º0æˆ–è€…æœªåˆå§‹åŒ–çš„åœ¨.bssæ®µï¼Œå‡½æ•°ä¸­çš„å˜é‡ï¼ˆå³æŒ‡ä»¤ï¼‰æ”¾åœ¨äº†.textæ®µï¼› mainå‡½æ•°ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å‘½ä»¤è¡Œå‚æ•°ä¸ªæ•°ï¼Œç¬¬äºŒä¸ªæ˜¯å‘½ä»¤è¡Œå‚æ•°ï¼› .bsså ç”¨çš„æ˜¯è™šæ‹Ÿå†…å­˜çš„ç©ºé—´ï¼Œä¸å ç”¨mach-oæ–‡ä»¶çš„ç©ºé—´ï¼› mach-oçš„headerä¸­è®°å½•äº†.bssè¦å å¤šå°‘ç©ºé—´ï¼› mach-oä¸­å‡½æ•°å­˜çš„æ˜¯åç§»é‡ï¼Œpcå¯„å­˜å™¨ä¸­å­˜çš„æ˜¯ä¸‹ä¸€è¡ŒæŒ‡ä»¤çš„åœ°å€ï¼Œè·³è½¬æ—¶éœ€è¦ç”¨å½“å‰çš„æŒ‡ä»¤åç§» + pcæŒ‡ä»¤åœ°å€ï¼Œæ‰æ˜¯æˆ‘ä»¬è¦è·³è½¬åˆ°çš„å‡½æ•°åœ°å€ï¼› é“¾æ¥æ—¶åªå¤„ç†mach-oæ–‡ä»¶ä¸­çš„globalç¬¦å·ï¼Œä¸å¤„ç†localç¬¦å·ï¼ˆæ¯”å¦‚æ–‡ä»¶ä¸­çš„staticå˜é‡ï¼‰ï¼› é“¾æ¥è¿‡ç¨‹ï¼š a. æŒ‰å±æ€§ï¼ˆæ¯”å¦‚.data / .textï¼‰åˆå¹¶æ‰€æœ‰mach-oæ–‡ä»¶çš„æ®µï¼ˆå³åˆå¹¶åŒåsectionä¸ºsegmentï¼‰ -\u003e å¹¶è°ƒæ•´æ®µåç§»å’Œæ®µé•¿åº¦ -\u003e åˆå¹¶ç¬¦å·è¡¨ -\u003e è¿›è¡Œç¬¦å·è§£æ -\u003e åˆ†é…å†…å­˜åœ°å€ï¼› b.ç”±äºç¼–è¯‘è¿‡ç¨‹ä¸­ä¸ä¼šç»™ç¬¦å·åˆ†é…åœ°å€ï¼Œæ‰€ä»¥é“¾æ¥é˜¶æ®µè¦è¿›è¡Œç¬¦å·é‡å®šä½ï¼ˆæ•°æ®ç¬¦å·æ›¿æ¢æˆçœŸæ­£çš„åœ°å€ï¼Œå‡½æ•°ç¬¦å·æ›¿æ¢æˆä¸ä¸‹ä¸€è¡ŒæŒ‡ä»¤åœ°å€çš„åç§»é‡ï¼‰ï¼› ","date":"2022-09-22","objectID":"/%E7%A8%8B%E5%BA%8F%E5%91%98%E7%9A%84%E8%87%AA%E6%88%91%E4%BF%AE%E5%85%BB%E7%AC%94%E8%AE%B0/:1:0","tags":["iOS","ç¼–è¯‘é“¾æ¥"],"title":"ã€Šç¨‹åºå‘˜çš„è‡ªæˆ‘ä¿®å…»ã€‹ç¬”è®°","uri":"/%E7%A8%8B%E5%BA%8F%E5%91%98%E7%9A%84%E8%87%AA%E6%88%91%E4%BF%AE%E5%85%BB%E7%AC%94%E8%AE%B0/"},{"categories":["ç¼–è¯‘é“¾æ¥"],"content":"è§†é¢‘ ","date":"2022-09-22","objectID":"/%E7%A8%8B%E5%BA%8F%E5%91%98%E7%9A%84%E8%87%AA%E6%88%91%E4%BF%AE%E5%85%BB%E7%AC%94%E8%AE%B0/:2:0","tags":["iOS","ç¼–è¯‘é“¾æ¥"],"title":"ã€Šç¨‹åºå‘˜çš„è‡ªæˆ‘ä¿®å…»ã€‹ç¬”è®°","uri":"/%E7%A8%8B%E5%BA%8F%E5%91%98%E7%9A%84%E8%87%AA%E6%88%91%E4%BF%AE%E5%85%BB%E7%AC%94%E8%AE%B0/"},{"categories":["äº‹ä»¶å“åº”é“¾"],"content":"childControllerçš„nextResponderæ˜¯è°ï¼Ÿ","date":"2022-09-19","objectID":"/nextresponder/","tags":["iOS","äº‹ä»¶å“åº”é“¾"],"title":"NextResponder","uri":"/nextresponder/"},{"categories":["äº‹ä»¶å“åº”é“¾"],"content":"åœ¨è¿™é‡Œå°±ä¸ä»‹ç»äº‹ä»¶å“åº”é“¾äº†ï¼Œæƒ³å¿…å¤§å®¶å¾ˆæ¸…æ¥šï¼Œå¦‚æœæœ‰æœ‹å‹å°è±¡æ¨¡ç³Šäº†ï¼Œæ¨èçœ‹çœ‹iOSè§¦æ‘¸äº‹ä»¶å…¨å®¶æ¡¶è¿™ç¯‡æ–‡ç« ã€‚ é‚£å†™ç‚¹å•¥å‘¢ï¼Ÿå’±ä»¬èŠç‚¹ä¸Šæ–‡ä¸­çš„å‡ å¤„ä¸ä¸¥è°¨çš„åœ°æ–¹ï¼šè§†å›¾çš„nextResponderæ˜¯è°ã€‚ ","date":"2022-09-19","objectID":"/nextresponder/:0:0","tags":["iOS","äº‹ä»¶å“åº”é“¾"],"title":"NextResponder","uri":"/nextresponder/"},{"categories":["äº‹ä»¶å“åº”é“¾"],"content":"è§†å›¾çš„nextResponderæ˜¯è°ï¼Ÿ UIView è‹¥è§†å›¾æ˜¯æ§åˆ¶å™¨çš„æ ¹è§†å›¾ï¼Œåˆ™å…¶nextResponderä¸ºæ§åˆ¶å™¨å¯¹è±¡ï¼›å¦åˆ™ï¼Œå…¶nextResponderä¸ºçˆ¶è§†å›¾ã€‚ ä»¥ä¸Šè¯´æ³•ä¸€èˆ¬æƒ…å†µä¸‹æ˜¯æ²¡é—®é¢˜çš„ï¼Œä½†æ˜¯å¯¹äºæ§åˆ¶å™¨æ·»åŠ å­æ§åˆ¶å™¨çš„åœºæ™¯ç¡®æ˜¯ä¸ç¬¦åˆçš„ã€‚ ä»…ä»…æŠŠæ§åˆ¶å™¨çš„è§†å›¾æ·»åŠ åˆ°çˆ¶è§†å›¾ä¸Šï¼Œåˆ™è§†å›¾çš„ä¸‹ä¸€ä¸ªå“åº”è€…å°±æ˜¯çˆ¶è§†å›¾ï¼Œè€Œä¸æ˜¯æ§åˆ¶å™¨ã€‚ unaddchildcontroller æŠŠå­æ§åˆ¶å™¨ä¹Ÿæ·»åŠ åˆ°çˆ¶æ§åˆ¶å™¨ä¸Šï¼Œå­æ§åˆ¶å™¨çš„ä¸‹ä¸€å“åº”è€…æ˜¯çˆ¶æ§åˆ¶å™¨çš„è·Ÿè§†å›¾ï¼Œè€Œä¸æ˜¯çˆ¶æ§åˆ¶å™¨ã€‚ addchildcontroller ","date":"2022-09-19","objectID":"/nextresponder/:1:0","tags":["iOS","äº‹ä»¶å“åº”é“¾"],"title":"NextResponder","uri":"/nextresponder/"},{"categories":["äº‹ä»¶å“åº”é“¾"],"content":"æ¨è iOSè§¦æ‘¸äº‹ä»¶å…¨å®¶æ¡¶ ","date":"2022-09-19","objectID":"/nextresponder/:2:0","tags":["iOS","äº‹ä»¶å“åº”é“¾"],"title":"NextResponder","uri":"/nextresponder/"},{"categories":[],"content":"æˆ‘ ç¬¦ç°è¶…ï¼Œèœé¸¡ç¨‹åºå‘˜ä¸€æš ","date":"2022-08-26","objectID":"/about/whoami/:1:0","tags":[],"title":"è‡ªæˆ‘ç®€ä»‹","uri":"/about/whoami/"},{"categories":[],"content":"æŠ€æœ¯æ ˆ æœ‰å‘å…¨æ ˆå‘å±•çš„æƒ³æ³•ï¼Œæ­£åœ¨ä¿®è¡Œä¸­ Objective-C Swift Lua JavaScript ReactNative Shell ä¼šç‚¹C++ï¼Œå–œæ¬¢Rustã€Flutter, å­¦ä¹ ä¸­â€¦ ","date":"2022-08-26","objectID":"/about/whoami/:2:0","tags":[],"title":"è‡ªæˆ‘ç®€ä»‹","uri":"/about/whoami/"},{"categories":[],"content":"å…´è¶£çˆ±å¥½ å–œæ¬¢çƒ­è¡€ç³»å’Œæ²»æ„ˆç³»åŠ¨æ¼« å–œæ¬¢æ”¶è—å„ç§å·¥å…· çˆ±çæŠ˜è…¾ å–œæ¬¢å°è¯•æ–°æŠ€æœ¯ å–œæ¬¢æƒ³åŠæ³•è§£å†³é¡¹ç›®ä¸­çš„é—®é¢˜ ","date":"2022-08-26","objectID":"/about/whoami/:3:0","tags":[],"title":"è‡ªæˆ‘ç®€ä»‹","uri":"/about/whoami/"},{"categories":[],"content":"ä¼˜ç¼ºç‚¹ å¤„å¥³åº§ï¼Œæœ‰ç‚¹å°å¼ºè¿«ç—‡ï¼›ä¹¡ä¸‹äººï¼Œè¸å®ç¨³é‡ï¼Œèƒ½åƒè‹¦ï¼› ","date":"2022-08-26","objectID":"/about/whoami/:4:0","tags":[],"title":"è‡ªæˆ‘ç®€ä»‹","uri":"/about/whoami/"},{"categories":["æ··ç¼–"],"content":"CocoaPodsç»„ä»¶ä¸­Swiftä¸Objective-Cæ··ç¼–","date":"2020-11-04","objectID":"/swift%E4%B8%8Eobjective-c%E6%B7%B7%E7%BC%96/","tags":["iOS","swift"],"title":"Swiftä¸Objective-Cæ··ç¼–","uri":"/swift%E4%B8%8Eobjective-c%E6%B7%B7%E7%BC%96/"},{"categories":["æ··ç¼–"],"content":"å‰è¨€ æœ¬æ–‡æ˜¯ç¬”è€…åœ¨è§£å†³æ··ç¼–æ—¶çš„ä¸€äº›è®°å½•ï¼Œæœ‰äº›ä¸œè¥¿å¯èƒ½å·²ç»å‘ç”Ÿäº†å˜åŒ–ã€‚è€Œä¸”ç”±äºåªæ˜¯éšæ‰‹è®°å½•ï¼Œå†™çš„æ¯”è¾ƒä¹±ï¼Œå„ä½çœ‹å®˜è§è°…~~~ ç¬”è€…è´Ÿè´£çš„ä¸šåŠ¡æ˜¯ä»¥podæ¨¡å—çš„å½¢å¼å­˜åœ¨äºå·¥ç¨‹ä¸­çš„ï¼Œæ‰€ä»¥ä»¥ä¸‹è°ƒç ”çš„æ–¹æ¡ˆåªé’ˆå¯¹äºpodä¸­çš„æ··ç¼–åœºæ™¯ï¼Œåœ¨MMä¸»å·¥ç¨‹æ··ç¼–å‡ ä¹æ˜¯æ— ç¼ï¼Œæ²¡ä»€ä¹ˆå¯è¯´çš„ã€‚ã€‚ã€‚ æ¨èå¤§å®¶æµè§ˆä¸‹ CocoaPodsï¼ˆpodfile \u0026 podspecï¼‰ çš„ APIï¼Œæ²¡å‡ ä¸ªï¼ŒèŠ±è´¹ä¸äº†å‡ åˆ†é’Ÿï¼Œä½†æ˜¯å´èƒ½å¸®åŠ©å¤§å®¶å°‘è¸©å¾ˆå¤šçš„å‘ï¼Œä¸€æœ¬ä¸‡åˆ©~ ","date":"2020-11-04","objectID":"/swift%E4%B8%8Eobjective-c%E6%B7%B7%E7%BC%96/:1:0","tags":["iOS","swift"],"title":"Swiftä¸Objective-Cæ··ç¼–","uri":"/swift%E4%B8%8Eobjective-c%E6%B7%B7%E7%BC%96/"},{"categories":["æ··ç¼–"],"content":"å‰æœŸæ–¹æ¡ˆ æš‚æ—¶é‡‡ç”¨æŠ˜ä¸­æ–¹æ¡ˆï¼ŒæŠŠSwiftç‹¬ç«‹æˆä¸€ä¸ªpodï¼Œç„¶åä¸šåŠ¡podå†å¼•ç”¨Swift podã€‚ç›®çš„æ˜¯å‡å°‘ä¾èµ–ï¼Œé¿å…å¼•ç”¨ä¸è§„èŒƒçš„repoã€‚ å¦‚æœæ‰“ç®—åœ¨åŒä¸€podä¸­æ··ç¼–ï¼Œåªè¦æŠŠä½ ä¾èµ–çš„åº“éƒ½æ”¯æŒmoduleå³å¯ï¼Œè€Œä¸”éœ€è¦ä¿®æ”¹ä¸€ä¸‹ä½ ä»¬å¼•ç”¨å¤–éƒ¨repoå¤´æ–‡ä»¶çš„å½¢å¼ï¼Œæ¯”å¦‚ #import \"SDWebImage.h\" æ”¹ä¸º #import \u003cSDWebImage/SDWebImage.h\u003e åœ¨MMä¸»å·¥ç¨‹ä¸­åˆ›å»ºä¸ªæ–°çš„Swiftæ–‡ä»¶ï¼ˆç©ºæ–‡ä»¶å³å¯ï¼‰ï¼Œè®©Xcodeè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªbridge-headerï¼Œç›®çš„æ˜¯è¥é€ ä¸€ä¸ªSwiftç¯å¢ƒï¼ˆä¹‹å‰ä¸€ç›´æƒ³ä¸ä¿®æ”¹ä¸»å·¥ç¨‹è€Œåªåœ¨podä¸­è¥é€ ï¼Œä½†æ˜¯å¾ˆé—æ†¾ï¼Œæœ€åä»¥å¤±è´¥å‘Šç»ˆï¼‰ï¼› ç”±äºæ··ç¼–podä¸­ä¾èµ–çš„repoéœ€è¦æ”¯æŒmoduleï¼Œä½†æ˜¯MMä¸­çš„podæ°´å¹³å‚å·®ä¸é½ï¼Œå¤§éƒ¨åˆ†éƒ½æ²¡æœ‰æ”¯æŒmoduleï¼Œè¿™å°±é™åˆ¶æˆ‘ä»¬åœ¨ä¸šåŠ¡podä¸­æ··ç¼–æ—¶ç¼–è¯‘å¤±è´¥ã€‚è€Œè®©podä¸€ä¸‹å­éƒ½æ”¯æŒmoduleæ˜¯ä¸€ä¸ªä¸å¤ªç°å®çš„è¦æ±‚ï¼Œæ‰€ä»¥æˆ‘ä»¬æš‚æ—¶é‡‡ç”¨äº†ä¸€ç§æŠ˜ä¸­çš„æ–¹æ¡ˆï¼› æŠŠSwiftå•ç‹¬æ”¾ä¸€ä¸ªpodä¸­å»ï¼Œè®©Swiftå°½é‡å°‘çš„ä¾èµ–å…¶ä»–repoï¼Œç„¶åä¸šåŠ¡podå†ä¾èµ–Swift repoæ¥è°ƒç”¨Swiftä»£ç ï¼› ","date":"2020-11-04","objectID":"/swift%E4%B8%8Eobjective-c%E6%B7%B7%E7%BC%96/:2:0","tags":["iOS","swift"],"title":"Swiftä¸Objective-Cæ··ç¼–","uri":"/swift%E4%B8%8Eobjective-c%E6%B7%B7%E7%BC%96/"},{"categories":["æ··ç¼–"],"content":"è¸©å‘è®°å½• podä¸­ä¸æ”¯æŒbridging-headerï¼Œæ‰€ä»¥æ··ç¼–podä¸­è¦æƒ³å¼•ç”¨OCç±»ï¼Œpodéœ€è¦æ”¯æŒmodule æ··ç¼–çš„Swiftåº“éœ€è¦æ‰“æˆframeworkå½¢å¼æ‰å¯ä»¥ç¼–è¯‘æˆåŠŸï¼Œæ¯”å¦‚RxCocoaã€PromiseKit é™äºè‹¹æœæœ¬èº«æœºåˆ¶å’Œç°æœ‰äºŒè¿›åˆ¶æ–¹æ¡ˆå®ç°é—®é¢˜ï¼Œä¸æ”¯æŒ :modular_headers =\u003e trueï¼Œæ‰€ä»¥ä½¿ç”¨:modular_headers =\u003e true æ—¶ä¸´æ—¶éœ€è¦æ·»åŠ å‚æ•°:use_source_code =\u003e trueï¼Œåˆ‡æ¢ä¸ºä»£ç ç¼–è¯‘ï¼› Swiftä¸OCæ··ç¼–çš„podæ‰€ä¾èµ–çš„åº“éœ€è¦æ”¹ä¸ºåŠ¨æ€åº“ï¼Œæ¯”å¦‚ZDFlexLayoutå†…éƒ¨ä¸ºSwiftä¸OCæ··ç¼–çš„ï¼Œä¾èµ–äº†Yogaï¼Œéœ€è¦æŠŠYogaç¼–ä¸ºåŠ¨æ€åº“ã€‚ æŠ¥é”™å¦‚ä¸‹å›¾ undefine_symbol å®é™…æ“ä½œ è·¨æ¨¡å—å¼•ç”¨æ—¶éœ€è¦æŠŠè¦æš´éœ²ç»™å¤–éƒ¨çš„ç±»æˆ–è€…å‡½æ•°çš„è®¿é—®æƒé™è®¾ç½®ä¸º publicï¼Œå¹¶æ ‡è®°ä¸º @objcï¼ŒåŒæ—¶éœ€è¦ç»§æ‰¿è‡ªNSObjectç±» pod ä¸­å¼•ç”¨å…¶ä»–podéƒ½æ˜¯é€šè¿‡ @import è¯­æ³• Swiftä¾èµ–çš„repoéœ€è¦moduleåŒ–ï¼Œ æœ‰3ç§æ–¹å¼ï¼š i: åœ¨podfileä¸­è®©æ‰€æœ‰çš„repoå¼€å¯modular: use_modular_headers! ii: åªç»™æŸå‡ ä¸ªrepoå¼€å¯modularï¼Œä¸¾ä¸ªä¾‹å­ï¼špod 'SDWebImage', :modular_headers =\u003e true iii: è®©repoè‡ªå·±å¼€å¯moduleæ”¯æŒï¼Œéœ€è¦åœ¨podspecä¸­ä¿®æ”¹ä¸‹è®¾ç½®ï¼šspec.pod_target_xcconfig = { 'DEFINES_MODULE' =\u003e 'YES' } , è¿™ä¸ªè®¾ç½®ä¸ç®¡ä½ å¼€ä¸å¼€å¯modularå¼€å…³ï¼Œéƒ½ä¼šè‡ªåŠ¨åˆ›å»ºmodule å¦‚æœpodspecä¸­ä¸è®¾ç½®DEFINES_MODULE=trueï¼Œé»˜è®¤æ˜¯ä¸ä¼šç”Ÿæˆmoduleçš„ï¼Œå“ªæ€•ä½ åœ¨podspecä¸­è®¾ç½®äº†module_mapä¹Ÿä¸è¡Œï¼Œé™¤éä½ åœ¨podfileä¸­æ‰‹åŠ¨å¼€å¯modular_hearä½ è‡ªå·±çš„modulemapæ‰ä¼šç”Ÿæ•ˆ å¦‚æœä½ æ‰‹åŠ¨åˆ›å»ºäº†modulemapå°±ä¸è¦è®¾ç½®DEFINES_MODULE=trueäº†ï¼Œå› ä¸ºç¬”è€…å‘ç°å¼€å¯DEFINES_MODULEåå®ƒè¿˜ä¼šè‡ªå·±å†ç”Ÿæˆä¸€ä»½xxx-umbralleræ–‡ä»¶ã€‚ æ¨èè®©CocoaPodså¸®æˆ‘ä»¬åˆ›å»ºmodulemapï¼Œå¦‚éä½ ç‰¹åˆ«æ‡‚modulemapï¼Œä¸å»ºè®®è‡ªå·±æ‰‹åŠ¨åˆ›å»ºã€‚ åªéœ€è¦æŠŠSwiftç”¨åˆ°çš„OCç±»æ”¾åˆ°umbrellaä¸­ï¼ˆåé¢è¯´æ§åˆ¶æ–¹æ³•ï¼‰ ","date":"2020-11-04","objectID":"/swift%E4%B8%8Eobjective-c%E6%B7%B7%E7%BC%96/:3:0","tags":["iOS","swift"],"title":"Swiftä¸Objective-Cæ··ç¼–","uri":"/swift%E4%B8%8Eobjective-c%E6%B7%B7%E7%BC%96/"},{"categories":["æ··ç¼–"],"content":"åŒä¸€æ··ç¼–podå†…OCè°ƒç”¨Swift åœ¨å¤´æ–‡ä»¶ä¸­å¼•å…¥ #import \u003cmodule-name\u003e-Swift.h\"ï¼Œç„¶åå°±å¯ä»¥è°ƒç”¨Swiftç±»äº† oc_import_swift ","date":"2020-11-04","objectID":"/swift%E4%B8%8Eobjective-c%E6%B7%B7%E7%BC%96/:4:0","tags":["iOS","swift"],"title":"Swiftä¸Objective-Cæ··ç¼–","uri":"/swift%E4%B8%8Eobjective-c%E6%B7%B7%E7%BC%96/"},{"categories":["æ··ç¼–"],"content":"åŒä¸€æ··ç¼–podå†…Swiftè°ƒç”¨OC åŒä¸€podä¸­ï¼ŒæŠŠocç±»å¼•ç”¨æ”¾å…¥umbrellaä¸­ï¼ˆé»˜è®¤å°±æœ‰äº†ï¼‰ï¼Œç„¶åéœ€è¦è¿™ä¸ªæ–‡ä»¶èƒ½è¢«æ‰¾åˆ°ã€‚ ä¸€ç§æ–¹å¼æ˜¯ä¿®æ”¹æ­¤æ–‡ä»¶çš„membershipä¸ºpublicï¼Œç›®çš„æ˜¯ä¸ºäº†æŠŠå®ƒç§»åˆ°public headerä¸­å»ï¼ˆé™æ€åº“å½¢å¼podä¸­çš„æ–‡ä»¶é»˜è®¤éƒ½æ˜¯projectçš„ï¼ŒåŠ¨æ€åº“å½¢å¼çš„podæ‰ä¼šåŒºåˆ†publicã€privateã€projectï¼‰ ä¿®æ”¹èµ·æ¥æˆæœ¬æ¯”è¾ƒé«˜ï¼Œä¸æ¨è member_ship header ç¬¬äºŒç§æ–¹å¼æ˜¯æŠŠè¿™ä¸ªæ–‡ä»¶çš„è·¯å¾„åŒ…å«æœç´¢è·¯å¾„ä¸­ï¼Œå¯ä»¥é€šè¿‡è®¾ç½®podspecä¸­çš„ spec.header_dirå‚æ•° header_dir å¯ä»¥æ˜¯ä»»æ„åå­—, ç¬”è€…ä¸€èˆ¬ä¼šè®¾ç½®ä¸º./ï¼Œå³å½“å‰æ–‡ä»¶å¤¹ è¿™ä¸ªé€‰é¡¹ä¹Ÿä¸æ˜¯ä¸‡èƒ½çš„ï¼Œä½ ä¼šå‘ç°å°±ç®—è®¾ç½®äº†è¿™ä¸ªé€‰é¡¹ï¼Œä¹Ÿä¼šå‡ºç°æŠ¥é”™çš„é—®é¢˜ã€‚å»ºè®®ä¸šåŠ¡æ–¹çš„podå¦‚æ— å¿…è¦ï¼ŒæŠŠç±»éƒ½æ”¾åˆ°private_header_files ä¸­ï¼Œå‡å°‘umbrella ä¸­çš„å¤´æ–‡ä»¶æ•°é‡ã€‚ å¦‚ä¸‹è®¾ç½® header_dir_set é™æ€åº“ä¸­çš„importéœ€è¦æ˜¯å…¨è·¯å¾„çš„ï¼Œè€ŒåŠ¨æ€åº“ä¸­çš„æœç´¢è·¯å¾„ä¼šè¢«flattenï¼Œæ‰€ä»¥åŠ¨æ€åº“ä¸ä¼šå‡ºç°æ­¤é—®é¢˜ ä¸è¿‡è¿™é‡Œæœ‰ç‚¹éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè®¾ç½® header_dir åéœ€è¦åŒæ—¶è®¾ç½® module_nameï¼Œå¦åˆ™ modulename é»˜è®¤ä¼šå– header_dir çš„å€¼ã€‚ã€‚ã€‚ å…¶å®å®˜æ–¹æ–‡æ¡£ä¸Šéƒ½æœ‰æåˆ°ï¼Œæƒ­æ„§ module_name ","date":"2020-11-04","objectID":"/swift%E4%B8%8Eobjective-c%E6%B7%B7%E7%BC%96/:5:0","tags":["iOS","swift"],"title":"Swiftä¸Objective-Cæ··ç¼–","uri":"/swift%E4%B8%8Eobjective-c%E6%B7%B7%E7%BC%96/"},{"categories":["æ··ç¼–"],"content":"è§£æƒ‘ ä¸ºä»€ä¹ˆèƒ½å¤Ÿæ··ç¼–ï¼Ÿ èƒ½å¤Ÿäº’ç›¸è°ƒç”¨çš„ç±»éƒ½éœ€è¦ç»§æ‰¿NSObject Swiftä¸­çš„ç±»å’ŒObjective-Cä¸­çš„ç±»åº•å±‚å…ƒæ•°æ®ï¼ˆclass metadataï¼‰æ˜¯å…±ç”¨çš„ // objc4-818.2 // objc-runtime-new.h typedef struct objc_class *Class; typedef struct objc_object *id; struct objc_object { private: isa_t isa; // ... }; struct objc_class : objc_object { // Class ISA; Class superclass; cache_t cache; // formerly cache pointer and vtable class_data_bits_t bits; // class_rw_t * plus custom rr/alloc flags // ... }; struct swift_class_t : objc_class { uint32_t flags; uint32_t instanceAddressOffset; uint32_t instanceSize; uint16_t instanceAlignMask; uint16_t reserved; uint32_t classSize; uint32_t classAddressOffset; void *description; // ... void *baseAddress() { return (void *)((uint8_t *)this - classAddressOffset); } }; 1. XCode9 \u0026 Cocopoads 1.5 ä¹‹åï¼Œä¸æ˜¯å·²ç»æ”¯æŒæŠŠSwiftç¼–è¯‘ä¸ºé™æ€åº“äº†å—ï¼Œä¸ºä»€ä¹ˆä¼šæŠ¥é”™å‘¢ï¼Ÿ ç¬¬ä¸‰æ–¹åº“å¯¹äºæŠŠæ··ç¼–podç¼–è¯‘ä¸ºé™æ€åº“æ”¯æŒçš„ä¸å¥½ï¼Œè¿™ä¸æ˜¯è‹¹æœçš„é”…ï¼Œè€Œæ˜¯ä¸‰æ–¹åº“æœªè¿›è¡ŒåŠæ—¶çš„é€‚é…ï¼ŒåƒKingfisherã€RxCocoaéƒ½æœ‰é—®é¢˜ è¿™ä¸¤ä¸ªåº“ç¬”è€…å·²ç»æäº†pr æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œç°å·²åˆå…¥ä¸»åˆ†æ”¯ï¼Œä» RxCocoa 6.1.0ã€Kingfisher 6.1.0 å¼€å§‹éƒ½å·²æ”¯æŒç¼–è¯‘ä¸ºé™æ€åº“; RxCocoa #2281 Kingfisher #1608 2. ä¸ºä»€ä¹ˆæ”¹ä¸ºåŠ¨æ€åº“å°±å¯ä»¥æ­£å¸¸ç¼–è¯‘é€šè¿‡äº†ï¼Ÿ é™æ€åº“éœ€è¦ä½¿ç”¨ç»å¯¹è·¯å¾„å¼•ç”¨ï¼Œè€ŒåŠ¨æ€åº“å¼ºåˆ¶æŠŠå¤´æ–‡ä»¶å¹³é“ºäº†ï¼Œæ‰€ä»¥åŠ¨æ€åº“èƒ½å¼•åˆ°ï¼Œé™æ€åº“å¼•ä¸åˆ° å¯ä»¥è‡ªå·±éªŒè¯ä¸€ä¸‹ï¼Œæ”¹æˆ #import \"\u003cmodule-name\u003e/xxxx.h\" ä¹‹åä½ å†ç¼–è¯‘ä¸€ä¸‹ 3. ä¸ºä»€ä¹ˆè®¾ç½® header_dir ç¼–è¯‘å°±ä¸æŠ¥é”™äº†ï¼Ÿ é»˜è®¤æƒ…å†µä¸‹ä½¿ç”¨çš„æ˜¯æ™®é€šçš„header ï¼Œè®¾ç½®header_dirä¹‹åï¼Œpodä¼šä»¥header_dirä¸ºåç§°åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œç„¶åæŠŠæ‰€æœ‰publicå‡ºæ¥çš„å¤´æ–‡ä»¶å¼•ç”¨æ”¾é‡Œé¢ï¼Œumbrellaå¼•ç”¨å¤´æ–‡ä»¶çš„æ—¶å€™å…¶å®æŒ‡å‘çš„éƒ½æ˜¯è¿™é‡Œï¼› è§æºç  header_dir_code 4. podä¸­æ²¡æœ‰bridging-headerä¸ºä»€ä¹ˆSwiftè¿˜èƒ½å¼•ç”¨Objective-Cç±»ï¼Ÿ podä¸­umbrellaæ–‡ä»¶å…¶å®å°±ç›¸å½“äºæ˜¯ä¸»å·¥ç¨‹ä¸­çš„bridging-headerã€‚ 5. ä¸ºä»€ä¹ˆXcodeç”Ÿæˆçš„hmapå¯¹æˆ‘ä»¬çš„é¡¹ç›®å¹¶æ²¡èµ·åˆ°ä»€ä¹ˆä½œç”¨ï¼Ÿ ä¸Šé¢å·²ç»æåˆ°é™æ€åº“çš„å½¢å¼ä¸‹æˆ‘ä»¬çš„ç±»æ–‡ä»¶çš„membershipæ˜¯projectï¼Œhmapç”Ÿæˆçš„æ˜¯#import \"xx.h\"å½¢å¼çš„å¼•ç”¨è·¯å¾„çš„cacheï¼Œè€Œæˆ‘ä»¬é€šå¸¸å¼•ç”¨åº“æ–‡ä»¶çš„æ–¹å¼ä¸º#import \u003cA/B.h\u003eï¼Œè¿™å°±å¯¼è‡´æˆ‘ä»¬çš„å¼•ç”¨æ ¹æœ¬å°±æ²¡åŠæ³•å‘½ä¸­hmapä¸­çš„æ˜ å°„ç¼“å­˜ï¼ˆpcmï¼‰ï¼Œæ‰€ä»¥æœ€ç»ˆè¿˜æ˜¯ä¼šèµ°search_pathçš„æŸ¥æ‰¾é€»è¾‘ã€‚è€Œä¸”ç”±äºXcodeä¸­çš„USE_HEADERMAPè®¾ç½®é»˜è®¤æ˜¯å¼€å¯çš„ï¼ŒXcodeåœ¨ç¼–è¯‘æœŸè¿˜ä¼šè‡ªåŠ¨åˆ›å»ºå¯¹æˆ‘ä»¬ç”¨å¤„ä¸å¤§çš„hmapï¼Œè€Œè¿™ä¸ªè¿‡ç¨‹é—´æ¥æ‹–æ…¢äº†æˆ‘ä»¬çš„ç¼–è¯‘é€Ÿåº¦ã€‚ 6. publicã€privateã€projectåŒºåˆ« Public: The interface is finalized and meant to be used by your productâ€™s clients. A public header is included in the product as readable source code without restriction. Private: The interface isnâ€™t intended for your clients or itâ€™s in early stages of development. A private header is included in the product, but itâ€™s marked â€œprivateâ€. Thus the symbols are visible to all clients, but clients should understand that theyâ€™re not supposed to use them. Project: The interface is for use only by implementation files in the current project. A project header is not included in the target, except in object code. The symbols are not visible to clients at all, only to you. Projectå’ŒPrivateçš„æƒé™æˆ–è€…è¯´æ˜¯ä½œç”¨åŸºæœ¬ä¸€è‡´ï¼Œéƒ½æ˜¯ç§æœ‰åŒ–çš„ä¸€ç§æ–¹å¼ï¼Œåªæ˜¯Projectæƒé™çš„å¤´æ–‡ä»¶æ˜¯ä¸ä¼šæ”¾åˆ°ç¼–è¯‘äº§ç‰©ä¸­çš„ï¼Œæ³¨æ„è¯´çš„æ˜¯å¤´æ–‡ä»¶ï¼Œè€ŒPrivateå¤´æ–‡ä»¶ä¼šæ”¾åˆ°ç¼–è¯‘äº§ç‰©ä¸­ï¼Œåªæ˜¯å‘Šè¯‰ç¼–è¯‘å™¨ä¸è¦æš´æ¼ç»™å¤–ç•Œã€‚CocoaPodsæ˜¯é€šè¿‡Pods-\u003eHeaders-\u003ePublic/Privateç›®å½•ç®¡ç†å¤´æ–‡ä»¶çš„å¼•ç”¨ï¼Œæ¥æ§åˆ¶å¯¹æŸä¸€æ–‡ä»¶çš„è®¿é—®æƒé™çš„ã€‚ ","date":"2020-11-04","objectID":"/swift%E4%B8%8Eobjective-c%E6%B7%B7%E7%BC%96/:6:0","tags":["iOS","swift"],"title":"Swiftä¸Objective-Cæ··ç¼–","uri":"/swift%E4%B8%8Eobjective-c%E6%B7%B7%E7%BC%96/"},{"categories":["æ··ç¼–"],"content":"æ¨èè®¾ç½® podspecä¸­åœ¨ä¸æŒ‡å®šprivate_header_filesæˆ–project_header_filesçš„æ—¶å€™source_filesè·¯å¾„ä¸‹çš„æ–‡ä»¶é»˜è®¤å…¨éƒ½æ˜¯publicçš„ï¼Œè€Œpublicçš„å¤´æ–‡ä»¶é»˜è®¤éƒ½ä¼šæ”¾åˆ°umbrellaä¸­ï¼Œè¿™æ ·å¾ˆå®¹æ˜“å¯¼è‡´umbrellaä¸­å¤´æ–‡ä»¶çˆ†ç‚¸ï¼Œå°¤å…¶æ˜¯ä¸šåŠ¡podï¼ˆæ¯”å¦‚æˆ‘ä»¬çš„ç›´æ’­ä¸šåŠ¡æœ‰2300å¤šä¸ªå¤´æ–‡ä»¶ï¼‰ï¼Œç‰¹åˆ«å½±å“ç¼–è¯‘é€Ÿåº¦ã€‚ è§£å†³åŠæ³•ï¼šæŠŠé‚£äº›æš´éœ²ç»™swiftçš„å¤´æ–‡ä»¶æ”¾åˆ°public_header_filesä¸­ï¼Œå…¶ä»–çš„å¤´æ–‡ä»¶åˆ™é»˜è®¤å˜æˆprojectç±»å‹ã€‚æˆ–è€…æ˜¯æŠŠå…¨éƒ¨å¤´æ–‡ä»¶é»˜è®¤æŒ‡å®šä¸ºprivate_header_filesæˆ–project_header_filesï¼Œç„¶åæŠŠéœ€è¦å…¬å¼€çš„æ”¾åˆ°public_header_filesä¸­ï¼Œå°½é‡å‡å°‘umbrellaä¸­å¤´æ–‡ä»¶çš„æ•°é‡ã€‚ è´´ä¸€ä¸‹ä¾›å‚è€ƒçš„Swift podspecï¼Œè¯·æŒ‰éœ€ä¿®æ”¹ Pod::Spec.new do |spec| spec.name = \"foo\" spec.version = \"0.0.1\" spec.summary = \"foo\" spec.description = \u003c\u003c-DESC æˆ‘æ˜¯ä¸€åªå°æŸ¯åŸº DESC spec.homepage = \"https://foo/bar/abc\" spec.license = \"MIT\" spec.platform = :ios, \"12.0\" spec.source = { :git =\u003e \"https://foo/bar/abc.git\", :tag =\u003e \"#{spec.version}\" } spec.swift_versions = ['5.1'] publicHeaders = Dir[\"Source/Room/PublicHeaders/*.h\"] privateHeaders = Dir[\"Source/Room/**/*.{h}\"] - publicHeaders spec.source_files = 'Source/Room/**/*.{h,m,swift}' spec.public_header_files = publicHeaders # ä¸‹é¢è¿™è¡Œå¯æœ‰å¯æ— ï¼Œè®¾ç½®çš„è¯ä¼šæ”¾åˆ°privateä¸­ï¼Œä¸è®¾ç½®åˆ™ç­‰ä»·äº `spec.project_header_files = privateHeaders`ï¼Œä¼šæ”¾åˆ°projectä¸­ # spec.private_header_files = privateHeaders spec.module_name = spec.name spec.header_dir = \"./\" spec.pod_target_xcconfig = { 'DEFINES_MODULE' =\u003e 'YES', } spec.dependency 'RxCocoa' spec.dependency 'Cartography', '~\u003e 4.0.0' spec.dependency 'ZDFlexLayoutKit' end CocoaPods éªšæ“ä½œï¼š ç”¨è¸©å‘ä¸­æåˆ°çš„RxCocoaåšä¾‹å­ï¼Œä¸ºäº†ç¼–è¯‘æˆåŠŸï¼Œæˆ‘ä»¬éœ€è¦æŠŠå®ƒæŒ‡å®šä¸ºåŠ¨æ€åº“ï¼Œè€Œå…¶ä»–çš„ä¿æŒä¸å˜ï¼Œè¿™ç§éœ€æ±‚æˆ‘ä»¬å¯ä»¥åœ¨ pre_install é˜¶æ®µåŠ¨æ€ä¿®æ”¹ç¼–è¯‘æ¨¡å¼ï¼šæŠŠdynamic_frameworkæ•°ç»„ä¸­çš„repoç¼–è¯‘ä¸ºframeworkï¼Œå…¶ä»–æœªæŒ‡å®šçš„é»˜è®¤è¿˜æ˜¯é™æ€åº“ã€‚ pre_install do |installer| #ä»¥frameworkå½¢å¼å­˜åœ¨çš„pod dynamic_frameworks = ['RxSwift', 'RxCocoa', 'RxRelay'] Pod::Installer::Xcode::TargetValidator.send(:define_method, :verify_no_static_framework_transitive_dependencies) {} installer.pod_targets.each do |pod| if dynamic_frameworks.include?(pod.name) def pod.build_type; Pod::BuildType.dynamic_framework end end end end pre_install do |installer| #ä»¥é™æ€åº“å½¢å¼å­˜åœ¨çš„pod static_library = ['Masonry', 'SDWebImage'] Pod::Installer::Xcode::TargetValidator.send(:define_method, :verify_no_static_framework_transitive_dependencies) {} installer.pod_targets.each do |pod| if static_library.include?(pod.name) def pod.build_type; Pod::BuildType.static_library end end end end ","date":"2020-11-04","objectID":"/swift%E4%B8%8Eobjective-c%E6%B7%B7%E7%BC%96/:7:0","tags":["iOS","swift"],"title":"Swiftä¸Objective-Cæ··ç¼–","uri":"/swift%E4%B8%8Eobjective-c%E6%B7%B7%E7%BC%96/"},{"categories":["æ··ç¼–"],"content":"å‚è€ƒ importing_objective-c_into_swift importing_swift_into_objective-c https://www.rubydoc.info/gems/cocoapods-core/Pod/BuildType https://github.com/CocoaPods/CocoaPods/pull/7724 PromiseKit.podspec 6.15.3 ä»é¢„ç¼–è¯‘çš„è§’åº¦ç†è§£Swiftä¸Objective-CåŠæ··ç¼–æœºåˆ¶ ","date":"2020-11-04","objectID":"/swift%E4%B8%8Eobjective-c%E6%B7%B7%E7%BC%96/:8:0","tags":["iOS","swift"],"title":"Swiftä¸Objective-Cæ··ç¼–","uri":"/swift%E4%B8%8Eobjective-c%E6%B7%B7%E7%BC%96/"},{"categories":["CI"],"content":"Jenkinsè¸©å‘è®°å½•","date":"2020-04-18","objectID":"/jenkins_note/","tags":["CI","jenkins"],"title":"Jenkinsç¬”è®°","uri":"/jenkins_note/"},{"categories":["CI"],"content":"1ã€homebrewå®‰è£…çš„Jenkinsæ— æ³•é€šè¿‡IPè®¿é—® è¿™æ˜¯å› ä¸ºbrewæŠŠjenkinså¯åŠ¨çš„ç›‘å¬åœ°å€è®¾ç½®ä¸ºäº†127.0.0.1ï¼Œæ”¹ä¸º0.0.0.0å³å¯å®ç°è®¿é—® jenkinsé…ç½®æ‰€åœ¨è·¯å¾„ï¼š~/Library/LaunchAgents/homebrew.mxcl.jenkins.plist jenkins_config_address ","date":"2020-04-18","objectID":"/jenkins_note/:1:0","tags":["CI","jenkins"],"title":"Jenkinsç¬”è®°","uri":"/jenkins_note/"},{"categories":["CI"],"content":"2ã€jenkinsè„šæœ¬ä¸­æ— æ³•ä½¿ç”¨podã€brewç­‰å‘½ä»¤ éœ€è¦åœ¨è„šæœ¬å¼€å¤´æ·»åŠ  -l #!/usr/bin/env sh -l export LANG=en_US.UTF-8 export LANGUAGE=en_US.UTF-8 export LC_ALL=en_US.UTF-8 ","date":"2020-04-18","objectID":"/jenkins_note/:2:0","tags":["CI","jenkins"],"title":"Jenkinsç¬”è®°","uri":"/jenkins_note/"},{"categories":["CI"],"content":"3ã€æ„å»ºä¸­ç”Ÿæˆçš„æ•°æ®æ— æ³•ä¼ é€’ç»™æ„å»ºé˜¶æ®µ è§£å†³ï¼šæŠŠæ•°æ®å†™å…¥æ–‡ä»¶ï¼Œç„¶åé€šè¿‡Jenkinsä¸­çš„FILEè·å– å†™æ–‡ä»¶ # åˆ›å»ºä¸‹è½½åœ°å€æ—¥å¿—æ–‡ä»¶ download_urls=\"${EXPORT_DIR}/DownLoadURLs.log\" if [[ ! -f ${download_urls} ]]; then touch ${download_urls} fi # æ¸…ç©ºæ–‡ä»¶ echo \"\" \u003e ${download_urls} echo \"åŒ…åç§°ï¼š${application_name} \u003cbr/\u003e\" \u003e\u003e ${download_urls} è¯»æ–‡ä»¶ Jenkinsæ‰“åŒ…ç»“æœï¼š\u003cbr/\u003e\u003chr/\u003e ${FILE, path=\"${PACKAGE_DIR}/${branch}/Package/DownLoadURLs.log\"} \u003cbr/\u003e\u003chr/\u003e é¡¹ç›®åç§°ï¼š$PROJECT_NAME\u003cbr/\u003e\u003chr/\u003e æ„å»ºç¼–å·ï¼š$BUILD_NUMBER\u003cbr/\u003e\u003chr/\u003e æ„å»ºçŠ¶æ€ï¼š$BUILD_STATUS\u003cbr/\u003e\u003chr/\u003e è§¦å‘åŸå› ï¼š${CAUSE}\u003cbr/\u003e\u003chr/\u003e æ„å»ºæ—¥å¿—åœ°å€ï¼š\u003ca href=\"${BUILD_URL}console\"\u003e${BUILD_URL}console/\u003c/a\u003e\u003cbr/\u003e\u003chr/\u003e æ„å»ºåœ°å€ï¼š\u003ca href=\"$BUILD_URL\"\u003e$BUILD_URL\u003c/a\u003e\u003cbr/\u003e\u003chr/\u003e å˜æ›´é›†:${JELLY_SCRIPT,template=\"html\"}\u003cbr/\u003e\u003chr/\u003e ","date":"2020-04-18","objectID":"/jenkins_note/:3:0","tags":["CI","jenkins"],"title":"Jenkinsç¬”è®°","uri":"/jenkins_note/"},{"categories":["CI"],"content":"4ã€è‡ªåŠ¨è¾“å…¥ æ¯”å¦‚è‡ªåŠ¨è¾“å…¥ Y # è¾“å…¥ä¸€æ¬¡ echo Y # è¾“å…¥ä»»æ„æ¬¡ yes Y ","date":"2020-04-18","objectID":"/jenkins_note/:4:0","tags":["CI","jenkins"],"title":"Jenkinsç¬”è®°","uri":"/jenkins_note/"},{"categories":["CI"],"content":"5ã€å¡«å……å¯†ç  ä½¿ç”¨echo åŠ  -S è§£å†³ echo \"å¯†ç \" | sudo -S gem install cocoapods ","date":"2020-04-18","objectID":"/jenkins_note/:5:0","tags":["CI","jenkins"],"title":"Jenkinsç¬”è®°","uri":"/jenkins_note/"},{"categories":["CI"],"content":"6ã€ä»æ„å»ºæ—¥å¿—ä¸­è¿‡æ»¤æ—¥å¿— æ¯”å¦‚ä¿®æ”¹æ„å»ºåç§°å’Œæ„å»ºæè¿° # æ„å»ºåç§°ï¼ˆç¼–å· + åˆ†æ”¯ + å½“å‰ç™»å½•ç”¨æˆ·ï¼‰ ${BUILD_NUMBER}_${branch##*/}_${BUILD_LOG_MULTILINE_REGEX,showTruncatedLines=\"false\", maxMatches=1,regex=\"Started by user.*\"} # ä»æ„å»ºæ—¥å¿—ä¸­æå–æè¿° ${BUILD_LOG_MULTILINE_REGEX,showTruncatedLines=\"false\", regex=\"BID:.*|Version:.*|commitId:.*\"} è·å–ç™»å½•ç”¨æˆ·åçš„å¦ä¸€ç§æ–¹å¼ï¼Œéœ€è¦æ‰“å¼€Set jenkins user build variables #${BUILD_NUMBER}_${PROJECT_BRANCH}_${BUILD_USER} ","date":"2020-04-18","objectID":"/jenkins_note/:6:0","tags":["CI","jenkins"],"title":"Jenkinsç¬”è®°","uri":"/jenkins_note/"},{"categories":["CI"],"content":"Jenkinsæ’ä»¶æ¨è æ’ä»¶é•œåƒï¼š http://mirror.esuni.jp/jenkins/updates/update-center.json Blue Ocean Pipeline Priority Sorter Plugin Extented Choice Parameter Plugin-In Git Parameter Plug-In List Git Branches Parameter Environment Injector Credentials Plugin CocoaPods Jenkins Integration Keychains and Provisioning Profiles Management Xcode Integration Safe Restart Plugin ","date":"2020-04-18","objectID":"/jenkins_note/:7:0","tags":["CI","jenkins"],"title":"Jenkinsç¬”è®°","uri":"/jenkins_note/"},{"categories":["CI"],"content":"Shell Tipsï¼š æ‰§è¡Œå‡ºé”™æ—¶è‡ªåŠ¨æ‰§è¡Œåé¢çš„å‘½ä»¤ï¼ˆ||ï¼‰ï¼š xcodebuild archive || echo \"æ‰§è¡Œå¤±è´¥\" è®¾ç½®é»˜è®¤å€¼ï¼šPROJECT_DIR=${project_path:-$WORKSPACE} #å¦‚æœå‚æ•°æœªè®¾ç½®å–é»˜è®¤å€¼ ","date":"2020-04-18","objectID":"/jenkins_note/:8:0","tags":["CI","jenkins"],"title":"Jenkinsç¬”è®°","uri":"/jenkins_note/"},{"categories":["CI"],"content":"å‚è€ƒèµ„æ–™ï¼š Updating Homebrewâ€™s â€œhttpListenAddressâ€ Default for Jenkins Shell åä¸‰é—® ","date":"2020-04-18","objectID":"/jenkins_note/:9:0","tags":["CI","jenkins"],"title":"Jenkinsç¬”è®°","uri":"/jenkins_note/"},{"categories":["å®ç°åŸç†"],"content":"ç®€æå‡ ä¸ª Promise å¼€æºåº“çš„å®ç° Promiseæ€æƒ³çš„å¼€æºåº“å…¶å®æœ‰å¾ˆå¤šï¼Œè¿™é‡Œä»…ç®€å•åˆ†æä¸‹Boltsã€PromiseKitã€promises ","date":"2019-02-13","objectID":"/promise%E6%BA%90%E7%A0%81%E7%AE%80%E6%9E%90/:0:0","tags":["iOS","promise"],"title":"Promiseæºç ç®€æ","uri":"/promise%E6%BA%90%E7%A0%81%E7%AE%80%E6%9E%90/"},{"categories":["å®ç°åŸç†"],"content":"ä¸€ã€ Bolts Facebookå‡ºå“ BFTaskåŸç†ï¼š æ¯ä¸ªBFTaskè‡ªå·±éƒ½ç»´æŠ¤ç€ä¸€ä¸ªä»»åŠ¡æ•°ç»„ï¼Œå½“taskæ‰§è¡ŒcontinueWithBlock:åï¼ˆä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„BFTaskï¼‰ï¼ŒcontinueWithBlock:å¸¦çš„é‚£ä¸ªblockä¼šè¢«åŠ å…¥åˆ°ä»»åŠ¡æ•°ç»„ä¸­ï¼Œæ¯å½“æœ‰ç»“æœè¿”å›æ—¶ï¼Œä¼šæ‰§è¡ŒtrySetResult:æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•ä¸­ä¼šæ‹¿åˆ°taskå®ƒè‡ªå·±ç»´æŠ¤çš„é‚£ä¸ªä»»åŠ¡æ•°ç»„ï¼Œç„¶åå–å‡ºå…¶ä¸­çš„æ‰€æœ‰ä»»åŠ¡blockï¼Œç„¶åéå†æ‰§è¡Œã€‚ /// å†…éƒ¨ç»´æŠ¤çš„ä»»åŠ¡æ•°ç»„ @property (nonatomic, strong) NSMutableArray *callbacks; /// `continueWithBlock:`æ–¹æ³• - (BFTask *)continueWithExecutor:(BFExecutor *)executor block:(BFContinuationBlock)block cancellationToken:(nullable BFCancellationToken *)cancellationToken { // åˆ›å»ºä¸€ä¸ªæ–°çš„`BFTaskCompletionSource`ï¼Œåˆ›å»ºå®ƒæ—¶ï¼Œå®ƒé‡Œé¢ä¼š`new`ä¸€ä¸ª`task`å¯¹è±¡ï¼Œæœ€å`return`çš„ä¹Ÿæ˜¯è¿™ä¸ª`task` // è¿™ä¸ªä¸æ˜¯å•ä¾‹æ–¹æ³•ï¼Œæ‰€ä»¥æ­¤å¤„åˆ›å»ºçš„`task`æ˜¯ä¸€ä¸ªæ–°å¯¹è±¡ BFTaskCompletionSource *tcs = [BFTaskCompletionSource taskCompletionSource]; // (1) // åˆ›å»ºä¸€ä¸ªä»»åŠ¡`block`ï¼Œåé¢ä¼šæŠŠæ‰§è¡Œè¿™ä¸ª`block`çš„æ“ä½œåŠ å…¥åˆ°æ•°ç»„ä¸­ï¼Œå½“å›è°ƒæ—¶ä¼šæ‰§è¡Œè¿™ä¸ª`block`é‡Œé¢çš„æ“ä½œ // P.S. ä¸‹é¢é™„ä¸€å¼ æŠŠè¿™ä¸ªblockæŠ˜å åçš„å›¾ç‰‡ dispatch_block_t executionBlock = ^{ //(N.0) if (cancellationToken.cancellationRequested) { [tcs cancel]; return; } // æŠŠå½“å‰ç±»ï¼ˆ`task`å¯¹è±¡ï¼‰ä½œä¸ºå‚æ•°è¿›è¡Œå›è°ƒ //(N.1) id result = nil; #pragma clang diagnostic push #pragma clang diagnostic ignored \"-Wdeprecated-declarations\" if (BFTaskCatchesExceptions()) { @try { result = block(self); } @catch (NSException *exception) { NSLog(@\"[Bolts] Warning: `BFTask` caught an exception in the continuation block.\" @\" This behavior is discouraged and will be removed in a future release.\" @\" Caught Exception: %@\", exception); tcs.exception = exception; return; } } else { result = block(self); } #pragma clang diagnostic pop // å¦‚æœå›è°ƒç»“æœè¿”å›çš„æ˜¯`BFTask`ç±»å‹ if ([result isKindOfClass:[BFTask class]]) { // ä¸‹é¢`block`ä¸­çš„`task`å°±æ˜¯ä¸Šé¢çš„`result` id (^setupWithTask) (BFTask *) = ^id(BFTask *task) { //(N.3) if (cancellationToken.cancellationRequested || task.cancelled) { [tcs cancel]; #pragma clang diagnostic push #pragma clang diagnostic ignored \"-Wdeprecated-declarations\" } else if (task.exception) { tcs.exception = task.exception; #pragma clang diagnostic pop } else if (task.error) { tcs.error = task.error; } else { tcs.result = task.result; } return nil; }; BFTask *resultTask = (BFTask *)result; /// å¦‚æœ`continueWithBlock:`ä¸­çš„`block`å›è°ƒè¿”å›çš„`task`æ˜¯`complete`çŠ¶æ€ï¼Œåˆ™ç›´æ¥åˆ° (N.3)ï¼ŒæŠŠä»»åŠ¡çš„ç»“æœä¼ é€’åˆ°ä¸Šé¢æ–°åˆ›å»ºçš„é‚£ä¸ª`BFTask`å¯¹è±¡çš„`result`å±æ€§ä¸­,å¦åˆ™å°±ç»§ç»­æ‰§è¡Œ`continueWithBlock:`æ¥ç›‘æµ‹ä»»åŠ¡çŠ¶æ€ if (resultTask.completed) { setupWithTask(resultTask); //(N.2) } else { [resultTask continueWithBlock:setupWithTask]; //(N.4) } } else { tcs.result = result; } }; // å¦‚æœæ˜¯æœªå®ŒæˆçŠ¶æ€ï¼Œåˆ™æŠŠæ“ä½œåŠ å…¥åˆ°æ•°ç»„ä¸­ï¼Œå»¶åæ‰§è¡Œï¼›å¦åˆ™å°±ç«‹å³æ‰§è¡Œ BOOL completed; @synchronized(self.lock) { //(2.0) completed = self.completed; if (!completed) { // æŠŠä»»åŠ¡æ·»åŠ åˆ°æ•°ç»„ä¸­ [self.callbacks addObject:[^{ [executor execute:executionBlock]; } copy]]; } } if (completed) { //(2.1) [executor execute:executionBlock]; } return tcs.task; } ","date":"2019-02-13","objectID":"/promise%E6%BA%90%E7%A0%81%E7%AE%80%E6%9E%90/:1:0","tags":["iOS","promise"],"title":"Promiseæºç ç®€æ","uri":"/promise%E6%BA%90%E7%A0%81%E7%AE%80%E6%9E%90/"},{"categories":["å®ç°åŸç†"],"content":"äºŒã€ PromiseKit é¦–å…ˆï¼Œè®©æˆ‘ä»¬çœ‹çœ‹åˆ›å»ºPromiseçš„æºç  + (instancetype)promiseWithResolver:(void (^)(PMKResolver))block { // (2) PMKPromise *this = [self alloc]; // (3) åˆå§‹åŒ–promise this-\u003e_promiseQueue = PMKCreatePromiseQueue(); this-\u003e_handlers = [NSMutableArray new]; @try { block(^(id result){ // (4) ç«‹å³å¼€å§‹åŸå§‹ä»»åŠ¡ï¼ˆå®ƒä¼ è¿‡å»çš„å‚æ•°è¿˜æ˜¯ä¸€ä¸ª`PMKResolver`ç±»å‹çš„blockï¼Œè¿™ä¸ªblockä¼šåœ¨PMKRejecteræˆ–è€…PMKFulfillerç±»å‹çš„blockæ‰§è¡Œå›è°ƒæ—¶æ‰§è¡Œï¼‰ \"void (^PMKResolver)(id)\" if (PMKGetResult(this)) return PMKLog(@\"PromiseKit: Warning: Promise already resolved\"); PMKResolve(this, result); // (7) resultä¸ºç”¨æˆ·åœ¨`new:`æ–¹æ³•ä¸­è¿”å›çš„æ•°æ®ç»“æœ,è€Œthisåˆ™æ˜¯ä¸Šé¢ä¸€å¼€å§‹æ—¶åˆå§‹åŒ–çš„é‚£ä¸ªpromise. æ‰§è¡Œåˆ°è¿™é‡Œåæ¥ä¸‹æ¥ä¼šåˆ°(8),å›è°ƒåˆ°(9)é‚£ä¸ªblock,è¿™ä¸ªblockä¸­ä¼šéå†`handlers`æ•°ç»„ä¸­çš„`handler()` block, }); } @catch (id e) { // at this point, no pointer to the Promise has been provided // to the user, so we canâ€™t have any handlers, so all we need // to do is set _result. Technically using PMKSetResult is // not needed either, but this seems better safe than sorry. PMKSetResult(this, NSErrorFromException(e)); } return this; } + (instancetype)new:(void(^)(PMKFulfiller, PMKRejecter))block { // (1) return [self promiseWithResolver:^(PMKResolver resolve) { id rejecter = ^(id error){ // (5-1) å¤±è´¥çš„block if (error == nil) { error = NSErrorFromNil(); } else if (IsPromise(error) \u0026\u0026 [error rejected]) { // this is safe, acceptable and (basically) valid } else if (!IsError(error)) { id userInfo = @{NSLocalizedDescriptionKey: [error description], PMKUnderlyingExceptionKey: error}; error = [NSError errorWithDomain:PMKErrorDomain code:PMKInvalidUsageError userInfo:userInfo]; } resolve(error); }; id fulfiller = ^(id result){ // (5-2) æˆåŠŸçš„block if (IsError(result)) PMKLog(@\"PromiseKit: Warning: PMKFulfiller called with NSError.\"); resolve(result); // (6) å½“ç”¨æˆ·æ‰§è¡Œ`PMKFulfiller`ç±»å‹çš„blockæ—¶,ä¼šå›è°ƒåˆ°è¿™é‡Œ,æ­¤æ–¹æ³•æ‰§è¡Œ(4)ä¸­çš„é‚£ä¸ªå‚æ•°block,å³æ‰§è¡Œ(7) }; block(fulfiller, rejecter); // (5-3) æŠŠæˆåŠŸå’Œå¤±è´¥çš„blockä½œä¸ºå‚æ•°ï¼Œæ‰§è¡Œå›è°ƒåŸä»»åŠ¡ï¼ˆe.g demoä¸­çš„ç½‘ç»œè¯·æ±‚ä»»åŠ¡ï¼‰ }]; } static void PMKResolve(PMKPromise *this, id result) { void (^set)(id) = ^(id r){ // (9) handleå›è°ƒæ‰§è¡Œ(10) NSArray *handlers = PMKSetResult(this, r); for (void (^handler)(id) in handlers) handler(r); }; if (IsPromise(result)) { PMKPromise *next = result; dispatch_barrier_sync(next-\u003e_promiseQueue, ^{ id nextResult = next-\u003e_result; if (nextResult == nil) { // ie. pending [next-\u003e_handlers addObject:^(id o){ PMKResolve(this, o); }]; } else set(nextResult); }); } else set(result); // (8) } è°ƒç”¨new:æ–¹æ³•æ—¶ä¼šè°ƒç”¨promiseWithResolver:æ–¹æ³•ï¼Œåœ¨é‡Œé¢è¿›è¡Œä¸€äº›åˆå§‹åŒ–promiseçš„å·¥ä½œï¼šåˆ›å»ºäº†ä¸€ä¸ªGCDå¹¶å‘é˜Ÿåˆ—å’Œä¸€ä¸ªæ•°ç»„ï¼Œå¹¶ç«‹å³å›è°ƒnew:åé¢çš„é‚£ä¸ªå‚æ•°blockï¼Œå³ï¼šç«‹å³æ‰§è¡Œï¼Œç”Ÿæˆä¸€ä¸ªæˆåŠŸfulfillerå’Œå¤±è´¥rejecterçš„blockï¼Œè¿™ä¸ªblockå°†ç”±ç”¨æˆ·æ§åˆ¶å›è°ƒæ“ä½œçš„æ—¶æœºã€‚ ä¸‹é¢çœ‹ä¸€ä¸‹thençš„å®ç°ï¼š - (PMKPromise *(^)(id))then { // 1 // æ­¤å¤„`then`æœ¬èº«å°±æ˜¯ä¸€ä¸ªblockï¼šï¼ˆPMKPromise *(^then)(id param)ï¼‰ï¼Œæ­¤æ–¹æ³•ç±»ä¼¼äºgetteræ–¹æ³• // è¿”å›ä¸€ä¸ª`(PMKPromise *(^)(id))`ç±»å‹çš„blockï¼Œè¿™ä¸ªblockæ‰§è¡Œåï¼Œè¿”å›ä¸€ä¸ªPMKPromise // ä¸‹é¢æ•´ä¸ªéƒ½æ˜¯ä¸€ä¸ªthen `block`ï¼Œå½“æ‰§è¡Œthençš„æ—¶å€™ä¼šè°ƒç”¨ `self.thenOn(dispatch_get_main_queue(), block)`ï¼Œè¿”å›ä¸€ä¸ªPromiseç±»å‹çš„ç»“æœ return ^(id block){ return self.thenOn(dispatch_get_main_queue(), block); }; } - (PMKResolveOnQueueBlock)thenOn { return [self resolved:^(id result) { if (IsPromise(result)) return ((PMKPromise *)result).thenOn; if (IsError(result)) return ^(dispatch_queue_t q, id block) { return [PMKPromise promiseWithValue:result]; }; return ^(dispatch_queue_t q, id block) { // HACK we seem to expose some bug in ARC where this block can // be an NSStackBlock which then gets deallocated by the time // we get around to using it. So we force it to be malloc'd. block = [block copy]; return dispatch_promise_on(q, ^{ return pmk_safely_call_block(block, result); }); }; } pending:^(id result, PMKPromise *next, dispatch_queue_t q, id block, void (^resolve)(id)) { if (IsError(result)) PMKResolve(next, result); else dispatch_async(q, ^{ resolve(pmk_safely_call_block(block, result)); // (11) }); }]; } - (id)resolved:(PMKResolveOnQueueBlock(^)(id result))mkresolvedCallback pending:(void(^)(id result, PMKPromise *next, dispatch_queue_t q, id block, void (^resolver)(id)))mkpendingCallback { __block PMKResolveOnQueueBlock callBlock; __block id result; dispatch_sync(_promiseQueue, ^{ if ((result = _result)) // æœ‰ç»“æœçš„æƒ…å†µä¸‹ç›´æ¥è¿”å› retur","date":"2019-02-13","objectID":"/promise%E6%BA%90%E7%A0%81%E7%AE%80%E6%9E%90/:2:0","tags":["iOS","promise"],"title":"Promiseæºç ç®€æ","uri":"/promise%E6%BA%90%E7%A0%81%E7%AE%80%E6%9E%90/"},{"categories":["å®ç°åŸç†"],"content":"ä¸‰ã€ Promises googleå‡ºå“ åŸç†ï¼š è¿™ä¸ªå¼€æºåº“çš„æ€è·¯å…¶å®ä¸BFTaskå¾ˆç›¸ä¼¼ï¼Œæ¯æ¬¡promiseæ‰§è¡Œthenæ–¹æ³•æ—¶éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„promiseå¯¹è±¡ï¼ŒåŒæ—¶ä¼šåˆ›å»ºä¸€ä¸ªè§‚å¯Ÿè€…ï¼ˆblockå¯¹è±¡ï¼‰ï¼Œè¿™ä¸ªè§‚å¯Ÿè€…ä¼šæŒæœ‰è¿™ä¸ªæ–°çš„promiseï¼Œå½“ï¼ˆæ—§ï¼‰promiseå¯¹è±¡fulfilledæˆ–è€…rejectedçš„æ—¶å€™ï¼Œä¼šæŠŠfulfilledæˆ–è€…rejectedæ‹¿åˆ°çš„valueç»™æ–°promiseã€‚ å…ˆçœ‹ä¸‹promiseçš„åˆå§‹åŒ–æ–¹æ³•: - (instancetype)initPending { self = [super init]; if (self) { dispatch_group_enter(FBLPromise.dispatchGroup); } return self; } é¦–å…ˆè¿›å…¥ä¸€ä¸ªå•ä¾‹dispatch_group_tä¸­ï¼Œä¸ºå•¥ç”¨dispatch_group_tå‘¢ï¼Ÿå› ä¸ºåé¢çš„thenæ–¹æ³•å¯ä»¥åœ¨å…¶ä»–é˜Ÿåˆ—å¤„ç†ï¼Œè€Œä¸”dispatch_group_tæœ‰åŒæ­¥é˜Ÿåˆ—çš„åŠŸèƒ½ï¼Œåé¢ä½œè€…æ¯æ¬¡åˆå§‹åŒ–ä¸€ä¸ªpromiseéƒ½ä¼šenteråˆ°dispatch_group_tä¸­ï¼Œfulfilledæˆ–è€…rejectedæ—¶å†leaveã€‚ æ¥ä¸‹æ¥çœ‹çœ‹æœ€é‡è¦åŒæ—¶ä¹Ÿæ˜¯ç²¾åæ‰€åœ¨çš„thenæ–¹æ³•ï¼š - (instancetype)initPending { // (0) self = [super init]; if (self) { dispatch_group_enter(FBLPromise.dispatchGroup); } return self; } - (FBLPromise *)onQueue:(dispatch_queue_t)queue then:(FBLPromiseThenWorkBlock)work { return [self chainOnQueue:queue chainedFulfill:work chainedReject:nil]; // (1) } - (FBLPromise *)chainOnQueue:(dispatch_queue_t)queue chainedFulfill:(FBLPromiseChainedFulfillBlock)chainedFulfill chainedReject:(FBLPromiseChainedRejectBlock)chainedReject { // é¦–å…ˆnewä¸€ä¸ªæ–°çš„promiseå¯¹è±¡ FBLPromise *newPromise = [[FBLPromise alloc] initPending]; // (2) // è¿™ä¸ªblockå…¶å®å°±æ˜¯æŠ½ç¦»çš„ä¸€ä¸ªæ–¹æ³•ï¼Œé¿å…å†™é‡å¤ä»£ç ã€‚ // å½“promiseè¢«fulfilledæˆ–è€…rejectedæ—¶éƒ½ä¼šè°ƒç”¨ï¼› // ç»“åˆä¸‹é¢æ–¹æ³•blockä¸­çš„å®ç°å¯ä»¥çœ‹å‡ºï¼Œå¦‚æœthenBlockï¼ˆchainedFulfillï¼‰å­˜åœ¨ï¼Œåˆ™å…ˆæ‰§è¡ŒchainedFulfillè¿™ä¸ªblockï¼ˆå…¶å®å°±æ˜¯mapä¸€ä¸‹è¿™ä¸ªvalueå€¼ï¼‰é‡æ–°ç”Ÿæˆä¸€ä¸ªvalueå€¼ï¼ˆvalueå€¼ä¹Ÿå¯èƒ½ä¸ä¼šå˜åŒ–ï¼Œä¸»è¦è¿˜å¾—çœ‹mapå‡½æ•°é‡Œæœ‰æ²¡æœ‰æ”¹å˜valueï¼‰ï¼›æ¥ä¸‹æ¥æŠŠè¿™ä¸ªé‡æ–°èµ‹å€¼çš„valueæ‰”ç»™resolverBlockï¼ŒresolverBlockä¼šæŠŠè¿™ä¸ªæ–°çš„valueç»™newPromiseï¼ŒnewPromiseä¼šè°ƒç”¨fulfilledæ–¹æ³•ï¼Œå¦‚æœæ­¤æ—¶newPromiseä¹Ÿæœ‰è®¢é˜…è€…(è¢«thenè¿‡)ï¼Œåˆ™å°±ä¼šæŠŠè¿™ä¸ªæ–°valueä¼ é€’ç»™ä¸‹ä¸€ä¸ªnewNewPromise ... // å¦‚æœthençš„æ—¶å€™promiseå·²ç»ç»“æŸäº†ï¼Œåˆ™ç›´æ¥æŠŠç»“æœè¿”å›ç»™è®¢é˜…è€…,å³è°ƒç”¨thenBlockã€‚ __auto_type resolver = ^(id __nullable value) { if ([value isKindOfClass:[FBLPromise class]]) { // (8) [(FBLPromise *)value observeOnQueue:queue fulfill:^(id __nullable value) { [newPromise fulfill:value]; } reject:^(NSError *error) { [newPromise reject:error]; }]; } else { [newPromise fulfill:value]; // (8) } }; [self observeOnQueue:queue fulfill:^(id __nullable value) { value = chainedFulfill ? chainedFulfill(value) : value; // (7) resolver(value); } reject:^(NSError *error) { id value = chainedReject ? chainedReject(error) : error; // (7) resolver(value); }]; return promise; } - (void)observeOnQueue:(dispatch_queue_t)queue fulfill:(FBLPromiseOnFulfillBlock)onFulfill reject:(FBLPromiseOnRejectBlock)onReject { @synchronized(self) { // (3) switch (_state) { // é»˜è®¤çš„stateï¼Œå³å¾…å¤„ç†çš„äº‹ä»¶ case FBLPromiseStatePending: { // å¦‚æœpromiseå¯¹è±¡è¿˜æ²¡æœ‰è§‚å¯Ÿè€…æ•°ç»„ï¼Œnewä¸€ä¸ª // è¿™é‡Œä¸ºä»€ä¹ˆéœ€è¦è§‚å¯Ÿè€…æ•°ç»„å‘¢ï¼Ÿå› ä¸ºä¸€ä¸ªPromiseå¯ä»¥è¢«thenå¾ˆå¤šæ¬¡ if (!_observers) { _observers = [[NSMutableArray alloc] init]; } // å½“äº‹ä»¶è¢«å¤„ç†æ—¶ä¼šæ‰§è¡Œä¸‹é¢block __auto_type observer = ^(FBLPromiseState state, id __nullable resolution) { dispatch_group_async(FBLPromise.dispatchGroup, queue, ^{ switch (state) { // (6) case FBLPromiseStatePending: break; case FBLPromiseStateFulfilled: onFulfill(resolution); break; case FBLPromiseStateRejected: onReject(resolution); break; } }); }; [_observers addObject:observer]; // (4) break; } // å½“å‰promiseå·²ç»ç»“æŸ case FBLPromiseStateFulfilled: { dispatch_group_async(FBLPromise.dispatchGroup, queue, ^{ onFulfill(self-\u003e_value); }); break; } // å½“å‰promiseå·²ç»ç»“æŸ case FBLPromiseStateRejected: { dispatch_group_async(FBLPromise.dispatchGroup, queue, ^{ onReject(self-\u003e_error); }); break; } } } } - (void)fulfill:(nullable id)value { if ([value isKindOfClass:[NSError class]]) { [self reject:(NSError *)value]; } else { @synchronized(self) { if (_state == FBLPromiseStatePending) { _state = FBLPromiseStateFulfilled; _value = value; _pendingObjects = nil; for (FBLPromiseObserver observer in _observers) { observer(_state, _value); // (5) } _observers = nil; // äº‹ä»¶ç»“æŸï¼Œleave group dispatch_group_leave(FBLPromise.dispatchGroup); } } } } - (void)reject:(NSError *)error { NSAssert([error isKindOfClass:[NSError class]], @\"Invalid error type.\"); if (![error isKindOfClass:[NSError class]]) { // Give up on invalid error type in Release mode. @throw error; // NOLINT } @synchronized(self) { if (_state == FBLPromiseStatePending) { _state = FBLPromiseStateRejected; _error = error; _pendingObjects = nil; for (FBLPromiseObserver observer in ","date":"2019-02-13","objectID":"/promise%E6%BA%90%E7%A0%81%E7%AE%80%E6%9E%90/:3:0","tags":["iOS","promise"],"title":"Promiseæºç ç®€æ","uri":"/promise%E6%BA%90%E7%A0%81%E7%AE%80%E6%9E%90/"},{"categories":["å®ç°åŸç†"],"content":"å‚è€ƒï¼š iOSå¦‚ä½•ä¼˜é›…çš„å¤„ç†â€œå›è°ƒåœ°ç‹±Callback hellâ€(ä¸€)â€”â€”ä½¿ç”¨PromiseKit ","date":"2019-02-13","objectID":"/promise%E6%BA%90%E7%A0%81%E7%AE%80%E6%9E%90/:4:0","tags":["iOS","promise"],"title":"Promiseæºç ç®€æ","uri":"/promise%E6%BA%90%E7%A0%81%E7%AE%80%E6%9E%90/"},{"categories":["å®ç°åŸç†"],"content":"æ¢ç´¢blockå˜é‡æ•è·çš„åŸç†","date":"2018-08-17","objectID":"/block%E6%8D%95%E8%8E%B7%E5%8E%9F%E7%90%86%E6%8E%A2%E7%A9%B6/","tags":["iOS","block"],"title":"Blockæ•è·åŸç†æ¢ç©¶","uri":"/block%E6%8D%95%E8%8E%B7%E5%8E%9F%E7%90%86%E6%8E%A2%E7%A9%B6/"},{"categories":["å®ç°åŸç†"],"content":"æ¢ç´¢blockæ•è·å¤–ç•Œå˜é‡çš„åŸç† åœ¨æ­¤ä¹‹å‰å…ˆä»‹ç»ä¸€ä¸‹block åŸºæœ¬è¯­æ³•ï¼š BlockSyntax Block Syntax // Block as a local variable returnType (^blockName)(parameterTypes) = ^returnType(parameters) {...}; // Block as a property @property (nonatomic, copy) returnType (^blockName)(parameterTypes); // Block as a method parameter - (void)someMethodThatTakesABlock:(returnType (^)(parameterTypes))blockName; // Block as an argument to a method call [someObject someMethodThatTakesABlock: ^returnType (parameters) {...}]; // Block as typedef typedef returnType (^TypeName)(parameterTypes); TypeName blockName = ^returnType(parameters) {...}; å¯¹Object-Cæ–‡ä»¶æ‰§è¡Œ xcrun -sdk iphonesimulator clang -fobjc-arc -fobjc-runtime=ios -rewrite-objc fileName.m æ“ä½œæ¥è·å–ä¼ªä»£ç ï¼Œä»…ä¾›æŠ€æœ¯æ¢ç©¶ã€‚ å…ˆæŠŠ__block_implç»“æ„ä½“æ‹¿å‡ºæ¥æ”¾åœ¨æœ€å‰é¢ï¼Œæœ€ç»ˆblockè°ƒç”¨æ—¶éƒ½ä¼šè¢«å¼ºè½¬æˆè¿™ç§ç±»å‹ï¼Œä¸‹é¢å¥½å¤šåœ°æ–¹ä¼šç”¨åˆ°ã€‚ struct __block_impl { void *isa; int Flags; int Reserved; void *FuncPtr; }; isaæŒ‡é’ˆï¼šæŒ‡å‘ä¸€ä¸ªç±»å¯¹è±¡ï¼Œåœ¨éGCæ¨¡å¼ä¸‹æœ‰ä¸‰ç§ç±»å‹ï¼š_NSConcreteStackBlockã€_NSConcreteGlobalBlockã€_NSConcreteMallocBlockï¼› Flagsï¼šblockçš„è´Ÿè½½ä¿¡æ¯ï¼ˆå¼•ç”¨è®¡æ•°å’Œç±»å‹ä¿¡æ¯ï¼‰ï¼ŒæŒ‰ä½å­˜å‚¨ï¼› Reservedï¼šä¿ç•™å˜é‡ï¼› FuncPtrï¼šæŒ‡å‘blockå‡½æ•°åœ°å€çš„æŒ‡é’ˆã€‚ descriptorï¼šæ˜¯ç”¨äºæè¿°å½“å‰è¿™ä¸ª block çš„é™„åŠ ä¿¡æ¯çš„ï¼ŒåŒ…æ‹¬ç»“æ„ä½“çš„å¤§å°ï¼Œéœ€è¦ capture å’Œ dispose çš„å˜é‡åˆ—è¡¨ç­‰ã€‚ç»“æ„ä½“å¤§å°éœ€è¦ä¿å­˜æ˜¯å› ä¸ºï¼Œæ¯ä¸ª block å› ä¸ºä¼š capture ä¸€äº›å˜é‡ï¼Œè¿™äº›å˜é‡ä¼šåŠ åˆ° __main_block_impl_0 è¿™ä¸ªç»“æ„ä½“ä¸­ï¼Œä½¿å…¶ä½“ç§¯å˜å¤§ã€‚ æ¥ä¸‹æ¥è¿›å…¥æ­£é¢˜ï¼š p.sï¼šä»¥ä¸‹Objective-Cçš„ä»£ç éƒ½å¤„åœ¨ARCç¯å¢ƒä¸‹ ","date":"2018-08-17","objectID":"/block%E6%8D%95%E8%8E%B7%E5%8E%9F%E7%90%86%E6%8E%A2%E7%A9%B6/:0:0","tags":["iOS","block"],"title":"Blockæ•è·åŸç†æ¢ç©¶","uri":"/block%E6%8D%95%E8%8E%B7%E5%8E%9F%E7%90%86%E6%8E%A2%E7%A9%B6/"},{"categories":["å®ç°åŸç†"],"content":"1ã€ä¸åŠ __blockçš„æƒ…å†µ: #import \u003cFoundation/Foundation.h\u003e int main(int argc, char *argv[]) { @autoreleasepool { NSMutableArray *mutArr = [NSMutableArray array]; void(^block)() = ^{ [mutArr addObject:@2]; }; block(); } } æ‰§è¡Œclangæ“ä½œåçš„C++ä»£ç : // å®šä¹‰blockçš„ç»“æ„ä½“ struct __main_block_impl_0 { struct __block_impl impl; struct __main_block_desc_0* Desc; NSMutableArray *mutArr; __main_block_impl_0(void *fp, struct __main_block_desc_0 *desc, NSMutableArray *_mutArr, int flags=0) : mutArr(_mutArr) { impl.isa = \u0026_NSConcreteStackBlock; impl.Flags = flags; impl.FuncPtr = fp; Desc = desc; } }; // ä»¥ä¸‹ä¸ºè°ƒç”¨`block`æ—¶æ‰§è¡Œçš„æ–¹æ³• // æ­¤`mutArr`æ˜¯åœ¨æœ€åˆå®šä¹‰`block`æ—¶ ä¸ºç»“æ„ä½“ä¼ è¿›å»çš„å±€éƒ¨å˜é‡`mutArr`çš„å€¼ static void __main_block_func_0(struct __main_block_impl_0 *__cself) { // bound by copy:è¿™é‡Œçš„æ³¨é‡Šè¡¨ç¤ºï¼Œblockå¯¹å®ƒå¼•ç”¨çš„å±€éƒ¨å˜é‡åšäº†åªè¯»æ‹·è´ï¼Œä¹Ÿå°±æ˜¯è¯´blockå¼•ç”¨çš„æ˜¯å±€éƒ¨å˜é‡çš„å‰¯æœ¬ã€‚ NSMutableArray *mutArr = __cself-\u003emutArr; // bound by copy ((void (*)(id, SEL, ObjectType))(void *)objc_msgSend)((id)mutArr, sel_registerName(\"addObject:\"), (id)((NSNumber *(*)(Class, SEL, int))(void *)objc_msgSend)(objc_getClass(\"NSNumber\"), sel_registerName(\"numberWithInt:\"), 2)); } // blockçš„copyå‡½æ•° static void __main_block_copy_0(struct __main_block_impl_0*dst, struct __main_block_impl_0*src) { _Block_object_assign((void*)\u0026dst-\u003emutArr, (void*)src-\u003emutArr, 3/*BLOCK_FIELD_IS_OBJECT*/); } static void __main_block_dispose_0(struct __main_block_impl_0*src) { _Block_object_dispose((void*)src-\u003emutArr, 3/*BLOCK_FIELD_IS_OBJECT*/); } static struct __main_block_desc_0 { size_t reserved; size_t Block_size; void (*copy)(struct __main_block_impl_0*, struct __main_block_impl_0*); void (*dispose)(struct __main_block_impl_0*); } __main_block_desc_0_DATA = { 0, sizeof(struct __main_block_impl_0), __main_block_copy_0, __main_block_dispose_0}; int main(int argc, char *argv[]) { /* @autoreleasepool */ { __AtAutoreleasePool __autoreleasepool; NSMutableArray *mutArr = ((NSMutableArray *(*)(id, SEL))(void *)objc_msgSend)((id)objc_getClass(\"NSMutableArray\"), sel_registerName(\"array\")); // å¯ä»¥çœ‹å‡ºblockå˜é‡å®é™…ä¸Šå°±æ˜¯ä¸€ä¸ªæŒ‡å‘ç»“æ„ä½“`__main_block_impl_0`çš„æŒ‡é’ˆ,è€Œç»“æ„ä½“çš„ç¬¬ä¸‰ä¸ªå…ƒç´ æ˜¯å±€éƒ¨å˜é‡mutArrçš„å€¼ // æ­¤å¤„æ•è·çš„ç›´æ¥å°±æ˜¯`mutArr`å±€éƒ¨å˜é‡ void(*block)() = ((void (*)())\u0026__main_block_impl_0((void *)__main_block_func_0, \u0026__main_block_desc_0_DATA, mutArr, 570425344)); // ä¸‹é¢è°ƒç”¨`block`çš„æ–¹æ³•å®è´¨å…¶å®æ˜¯: æŒ‡å‘ç»“æ„ä½“çš„æŒ‡é’ˆ`block`è®¿é—®å…¶`FuncPtr`å…ƒç´ (å³,åœ¨å®šä¹‰blockæ—¶ä¸º`FuncPtr`å…ƒç´ ä¼ è¿›å»çš„`__main_block_func_0`æ–¹æ³•) ((void (*)(__block_impl *))((__block_impl *)block)-\u003eFuncPtr)((__block_impl *)block); } } static struct IMAGE_INFO { unsigned version; unsigned flag; } _OBJC_IMAGE_INFO = { 0, 2 }; ","date":"2018-08-17","objectID":"/block%E6%8D%95%E8%8E%B7%E5%8E%9F%E7%90%86%E6%8E%A2%E7%A9%B6/:1:0","tags":["iOS","block"],"title":"Blockæ•è·åŸç†æ¢ç©¶","uri":"/block%E6%8D%95%E8%8E%B7%E5%8E%9F%E7%90%86%E6%8E%A2%E7%A9%B6/"},{"categories":["å®ç°åŸç†"],"content":"2ã€æ·»åŠ __blockçš„æƒ…å†µ: #import \u003cFoundation/Foundation.h\u003e int main(int argc, char *argv[]) { @autoreleasepool { __block NSMutableArray *mutArr = [NSMutableArray array]; void(^block)() = ^{ [mutArr addObject:@2]; }; [mutArr addObject:@\"hello\"]; block(); } } æ‰§è¡Œclangåçš„C++ä»£ç : // ç”±ä¸‹é¢çš„ä»£ç å¯çŸ¥: `__block`çš„ä½œç”¨å°±æ˜¯å®šä¹‰ä¸€ä¸ªæ–°çš„ç»“æ„ä½“æ¥åŒ…è£¹åŸæ¥çš„å˜é‡ // å®šä¹‰ä¸€ä¸ªä¿å­˜å˜é‡çš„ç»“æ„ä½“ ï¼ˆè¢«__blockæ ‡è®°çš„å˜é‡ä¼šè¢«è½¬åŒ–ä¸ºè¿™ç§æ ¼å¼çš„ç»“æ„ä½“å¯¹è±¡ï¼‰ struct __Block_byref_mutArr_0 { void *__isa; __Block_byref_mutArr_0 *__forwarding; int __flags; int __size; void (*__Block_byref_id_object_copy)(void*, void*); void (*__Block_byref_id_object_dispose)(void*); NSMutableArray *mutArr; }; // block ç»“æ„ä½“ struct __main_block_impl_0 { struct __block_impl impl; struct __main_block_desc_0* Desc; // åŒ…å«æ•è·çš„å±€éƒ¨å˜é‡çš„ç»“æ„ä½“æŒ‡é’ˆ __Block_byref_mutArr_0 *mutArr; // by ref __main_block_impl_0(void *fp, struct __main_block_desc_0 *desc, __Block_byref_mutArr_0 *_mutArr, int flags=0) : mutArr(_mutArr-\u003e__forwarding) { impl.isa = \u0026_NSConcreteStackBlock; impl.Flags = flags; impl.FuncPtr = fp; Desc = desc; } }; // åœ¨blockå†…éƒ¨å¯¹`mutArr`æ“ä½œ (blockå›è°ƒæ—¶æ‰§è¡Œçš„å‡½æ•°) static void __main_block_func_0(struct __main_block_impl_0 *__cself) { // æ‹¿åˆ° åŒ…å«æ•è·çš„å±€éƒ¨å˜é‡ çš„ç»“æ„ä½“æŒ‡é’ˆ __Block_byref_mutArr_0 *mutArr = __cself-\u003emutArr; // bound by ref // é€šè¿‡ä¸Šé¢çš„ç»“æ„ä½“æŒ‡é’ˆä¸€æ­¥æ­¥æ‹¿åˆ°`mutArr`æ•°ç»„ ((void (*)(id, SEL, ObjectType))(void *)objc_msgSend)((id)(mutArr-\u003e__forwarding-\u003emutArr), sel_registerName(\"addObject:\"), (id)((NSNumber *(*)(Class, SEL, int))(void *)objc_msgSend)(objc_getClass(\"NSNumber\"), sel_registerName(\"numberWithInt:\"), 2)); } static void __main_block_copy_0(struct __main_block_impl_0*dst, struct __main_block_impl_0*src) { _Block_object_assign((void*)\u0026dst-\u003emutArr, (void*)src-\u003emutArr, 8/*BLOCK_FIELD_IS_BYREF*/); } static void __main_block_dispose_0(struct __main_block_impl_0*src) { _Block_object_dispose((void*)src-\u003emutArr, 8/*BLOCK_FIELD_IS_BYREF*/); } static struct __main_block_desc_0 { size_t reserved; size_t Block_size; void (*copy)(struct __main_block_impl_0*, struct __main_block_impl_0*); void (*dispose)(struct __main_block_impl_0*); } __main_block_desc_0_DATA = { 0, sizeof(struct __main_block_impl_0), __main_block_copy_0, __main_block_dispose_0}; // mainå‡½æ•° int main(int argc, char *argv[]) { /* @autoreleasepool */ { __AtAutoreleasePool __autoreleasepool; // è¿™é‡Œå¯ä»¥çœ‹åˆ°ç»“æ„ä½“ä¸­çš„ __forwarding æŒ‡é’ˆå…¶å®æŒ‡å‘çš„å°±æ˜¯å…¶è‡ªèº« __attribute__((__blocks__(byref))) __Block_byref_mutArr_0 mutArr = {(void*)0,(__Block_byref_mutArr_0 *)\u0026mutArr, 33554432, sizeof(__Block_byref_mutArr_0), __Block_byref_id_object_copy_131, __Block_byref_id_object_dispose_131, ((NSMutableArray *(*)(id, SEL))(void *)objc_msgSend)((id)objc_getClass(\"NSMutableArray\"), sel_registerName(\"array\"))}; // ä¸ä¸åŠ __blockå·®ä¸å¤š,`block`å˜é‡è¿˜æ˜¯ä¸€ä¸ªæŒ‡å‘`__main_block_impl_0`ç»“æ„ä½“çš„æŒ‡é’ˆ,åŒºåˆ«åœ¨äºç¬¬ä¸‰ä¸ªå‚æ•°å˜äº†. ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯åŒ…å«å±€éƒ¨å˜é‡`mutArr`çš„ç»“æ„ä½“æŒ‡é’ˆ. // å³blockæ•è·çš„æ˜¯æŒæœ‰`mutArr`çš„ç»“æ„ä½“æŒ‡é’ˆ void(*block)() = ((void (*)())\u0026__main_block_impl_0((void *)__main_block_func_0, \u0026__main_block_desc_0_DATA, (__Block_byref_mutArr_0 *)\u0026mutArr, 570425344)); // åœ¨blockå¤–éƒ¨å¯¹`mutArr`æ“ä½œ // // æ­¤å¤„å¯¹`mutArr`æ•°ç»„å¯¹è±¡è¿›è¡Œæ“ä½œ,è·å–`mutArr`ä¹Ÿæ˜¯å’Œ`block`å†…éƒ¨çš„è·å–æ–¹æ³•ä¸€æ ·, // éƒ½æ˜¯é€šè¿‡æŒæœ‰`mutArr`çš„ç»“æ„ä½“ä¸€æ­¥æ­¥è·å–åˆ°`mutArr`æ•°ç»„, // // è¿™é‡Œè¦ç»è¿‡ __forwarding æ¥è·å–`mutArr`çš„åŸå› æ˜¯ï¼š // __block æ ‡è®°çš„å˜é‡æœ‰å¯èƒ½è¢«copyåˆ°å †ä¸Šï¼Œ__forwarding çš„ä½œç”¨å°±æ˜¯åœ¨è¢«copyåˆ°å †ä¸Šæ—¶ä¿®æ”¹æŒ‡å‘ï¼Œä½¿æ ˆå’Œå †ä¸Šçš„ __forwarding éƒ½æŒ‡å‘å †ä¸Šçš„é‚£ä¸ªå‰¯æœ¬ï¼Œè¿™æ ·å°±ä¿è¯äº†blockå†…å¤–æ“ä½œçš„éƒ½æ˜¯åŒä¸€ä»½å†…å­˜ã€‚ // å…·ä½“çš„copyå®ç°å¯ä»¥å‚è§ä¸‹é¢çš„ `_Block_byref_copy` å‡½æ•° // // æ‰€ä»¥,åœ¨blockå†…å¤–,æ“ä½œçš„éƒ½æ˜¯åŒä¸€ä¸ª`mutArr`å¯¹è±¡.éƒ½æ˜¯é€šè¿‡åŒ…å«`mutArr`å¯¹è±¡çš„`__Block_byref_mutArr_0`ç»“æ„ä½“å¯¹å…¶è¿›è¡Œé—´æ¥æ“ä½œå¤„ç†çš„ // è¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆæ·»åŠ `__block`åè¿˜èƒ½æ”¹å˜åŸæ¥çš„å¯¹è±¡çš„åŸå›  // // PS: å½“æˆ‘ä»¬ç”¨__block æ ‡è®°ä¸€ä¸ªå˜é‡ä»¥åï¼Œå½“æˆ‘ä»¬ç”¨åˆ°è¿™ä¸ªå˜é‡æ—¶éƒ½ä¸æ˜¯ç›´æ¥ä½¿ç”¨è¿™ä¸ªå˜é‡äº†ï¼Œè€Œæ˜¯å˜æˆäº†é€šè¿‡`__Block_byref`æ¥æ“ä½œè¿™ä¸ªå˜é‡ ((void (*)(id, SEL, ObjectType))(void *)objc_msgSend)((id)(mutArr.__forwarding-\u003emutArr), sel_registerName(\"addObject:\"), (id)(NSString *)\u0026__NSConstantStringImpl__var_folders_4t_ldgq93v932g220vwkl7c1fk40000gn_T_BlockTest_b07809_mi_0); ((void (*)(__block_impl *))((__block_impl *)block)-\u003eFuncPtr)((__block_impl *)block); } } static struct IMAGE_INFO { unsigned version; unsigned flag; } _OBJC_IMAGE_INFO = { 0, 2 }; // __block å˜é‡è¢«copyåˆ°å †ä¸Šæ—¶çš„å…·ä½“å®ç° static struct Block_byref *_Block_byref_copy(const void *arg) { struct Block_byref *src = (struct Block_byref *)arg; if ((src-\u003eforwarding-","date":"2018-08-17","objectID":"/block%E6%8D%95%E8%8E%B7%E5%8E%9F%E7%90%86%E6%8E%A2%E7%A9%B6/:2:0","tags":["iOS","block"],"title":"Blockæ•è·åŸç†æ¢ç©¶","uri":"/block%E6%8D%95%E8%8E%B7%E5%8E%9F%E7%90%86%E6%8E%A2%E7%A9%B6/"},{"categories":["å®ç°åŸç†"],"content":"3ã€é™æ€å˜é‡: #import \u003cFoundation/Foundation.h\u003e int main(int argc, char *argv[]) { @autoreleasepool { static NSString *myString = @\"111\"; void(^block)() = ^{ [myString stringByAppendingString:@\"222\"]; myString = @\"444\"; NSLog(@\"%@\", myString); }; [myString stringByAppendingString:@\"333\"]; block(); } } clangä¹‹åçš„C++ä»£ç ï¼š struct __main_block_impl_0 { struct __block_impl impl; struct __main_block_desc_0* Desc; // æ³¨æ„è¿™é‡Œ, å¤–é¢çš„é™æ€å˜é‡è¢«æ•è·äº†,ä¸è¿‡æ•è·çš„æ˜¯å¯¹è±¡çš„æŒ‡é’ˆ NSString **myString; __main_block_impl_0(void *fp, struct __main_block_desc_0 *desc, NSString **_myString, int flags=0) : myString(_myString) { impl.isa = \u0026_NSConcreteStackBlock; impl.Flags = flags; impl.FuncPtr = fp; Desc = desc; } }; static void __main_block_func_0(struct __main_block_impl_0 *__cself) { NSString **myString = __cself-\u003emyString; // bound by copy // é€šè¿‡å¯¹`myString`æŒ‡é’ˆè¿›è¡Œå–å€¼æ“ä½œ(*myString),æ‹¿åˆ° myString ((NSString *(*)(id, SEL, NSString *))(void *)objc_msgSend)((id)(*myString), sel_registerName(\"stringByAppendingString:\"), (NSString *)\u0026__NSConstantStringImpl__var_folders_4t_ldgq93v932g220vwkl7c1fk40000gn_T_BlockTest_dac7fc_mi_1); // ç”±ä¸‹é¢çš„ä¼ªä»£ç å¯ä»¥çœ‹å‡º,ç”±äº`myString`æ˜¯æŒ‡é’ˆ,æ‰€ä»¥é€šè¿‡`*`æ“ä½œæ¥è·å–åˆ°åŸæ¥çš„å˜é‡, // ç„¶åå†å¯¹å…¶è¿›è¡Œé‡æ–°èµ‹å€¼æ“ä½œ (*myString) = (NSString *)\u0026__NSConstantStringImpl__var_folders_4t_ldgq93v932g220vwkl7c1fk40000gn_T_BlockTest_121621_mi_2; NSLog((NSString *)\u0026__NSConstantStringImpl__var_folders_4t_ldgq93v932g220vwkl7c1fk40000gn_T_BlockTest_dac7fc_mi_2, (*myString)); } static void __main_block_copy_0(struct __main_block_impl_0*dst, struct __main_block_impl_0*src) { _Block_object_assign((void*)\u0026dst-\u003emyString, (void*)src-\u003emyString, 3/*BLOCK_FIELD_IS_OBJECT*/); } static void __main_block_dispose_0(struct __main_block_impl_0*src) { _Block_object_dispose((void*)src-\u003emyString, 3/*BLOCK_FIELD_IS_OBJECT*/); } static struct __main_block_desc_0 { size_t reserved; size_t Block_size; void (*copy)(struct __main_block_impl_0*, struct __main_block_impl_0*); void (*dispose)(struct __main_block_impl_0*); } __main_block_desc_0_DATA = { 0, sizeof(struct __main_block_impl_0), __main_block_copy_0, __main_block_dispose_0}; int main(int argc, char *argv[]) { /* @autoreleasepool */ { __AtAutoreleasePool __autoreleasepool; static NSString *myString = (NSString *)\u0026__NSConstantStringImpl__var_folders_4t_ldgq93v932g220vwkl7c1fk40000gn_T_BlockTest_dac7fc_mi_0; // blockæ•è·çš„æ˜¯é™æ€å˜é‡çš„æŒ‡é’ˆ void(*block)() = ((void (*)())\u0026__main_block_impl_0((void *)__main_block_func_0, \u0026__main_block_desc_0_DATA, \u0026myString, 570425344)); ((NSString *(*)(id, SEL, NSString *))(void *)objc_msgSend)((id)myString, sel_registerName(\"stringByAppendingString:\"), (NSString *)\u0026__NSConstantStringImpl__var_folders_4t_ldgq93v932g220vwkl7c1fk40000gn_T_BlockTest_dac7fc_mi_3); ((void (*)(__block_impl *))((__block_impl *)block)-\u003eFuncPtr)((__block_impl *)block); } } static struct IMAGE_INFO { unsigned version; unsigned flag; } _OBJC_IMAGE_INFO = { 0, 2 }; ","date":"2018-08-17","objectID":"/block%E6%8D%95%E8%8E%B7%E5%8E%9F%E7%90%86%E6%8E%A2%E7%A9%B6/:3:0","tags":["iOS","block"],"title":"Blockæ•è·åŸç†æ¢ç©¶","uri":"/block%E6%8D%95%E8%8E%B7%E5%8E%9F%E7%90%86%E6%8E%A2%E7%A9%B6/"},{"categories":["å®ç°åŸç†"],"content":"4ã€å…¨å±€å˜é‡: #import \u003cFoundation/Foundation.h\u003e NSString *myString = @\"111\"; int main(int argc, char *argv[]) { @autoreleasepool { void(^block)() = ^{ [myString stringByAppendingString:@\"222\"]; myString = @\"444\"; NSLog(@\"%@\", myString); }; [myString stringByAppendingString:@\"333\"]; block(); } } clangæ“ä½œæ‰§è¡Œä¹‹åçš„C++ä¼ªä»£ç : NSString *myString = (NSString *)\u0026__NSConstantStringImpl__var_folders_4t_ldgq93v932g220vwkl7c1fk40000gn_T_BlockTest_938f32_mi_0; // blockç»“æ„ä½“å¹¶æ²¡æœ‰æ•è·å…¨å±€å˜é‡ struct __main_block_impl_0 { struct __block_impl impl; struct __main_block_desc_0* Desc; __main_block_impl_0(void *fp, struct __main_block_desc_0 *desc, int flags=0) { impl.isa = \u0026_NSConcreteStackBlock; impl.Flags = flags; impl.FuncPtr = fp; Desc = desc; } }; static void __main_block_func_0(struct __main_block_impl_0 *__cself) { // ä¸‹é¢ä¸‰ä¸ªå‡½æ•°éƒ½æ˜¯åœ¨ç”¨åˆ°å…¨å±€å˜é‡`myString`çš„æ—¶å€™ç›´æ¥ä»å†…å­˜å»è·å– ((NSString *(*)(id, SEL, NSString *))(void *)objc_msgSend)((id)myString, sel_registerName(\"stringByAppendingString:\"), (NSString *)\u0026__NSConstantStringImpl__var_folders_4t_ldgq93v932g220vwkl7c1fk40000gn_T_BlockTest_938f32_mi_1); myString = (NSString *)\u0026__NSConstantStringImpl__var_folders_4t_ldgq93v932g220vwkl7c1fk40000gn_T_BlockTest_938f32_mi_2; NSLog((NSString *)\u0026__NSConstantStringImpl__var_folders_4t_ldgq93v932g220vwkl7c1fk40000gn_T_BlockTest_938f32_mi_3, myString); } static struct __main_block_desc_0 { size_t reserved; size_t Block_size; } __main_block_desc_0_DATA = { 0, sizeof(struct __main_block_impl_0)}; // mainå‡½æ•° int main(int argc, char *argv[]) { /* @autoreleasepool */ { __AtAutoreleasePool __autoreleasepool; void(*block)() = ((void (*)())\u0026__main_block_impl_0((void *)__main_block_func_0, \u0026__main_block_desc_0_DATA)); ((NSString *(*)(id, SEL, NSString *))(void *)objc_msgSend)((id)myString, sel_registerName(\"stringByAppendingString:\"), (NSString *)\u0026__NSConstantStringImpl__var_folders_4t_ldgq93v932g220vwkl7c1fk40000gn_T_BlockTest_938f32_mi_4); ((void (*)(__block_impl *))((__block_impl *)block)-\u003eFuncPtr)((__block_impl *)block); } } static struct IMAGE_INFO { unsigned version; unsigned flag; } _OBJC_IMAGE_INFO = { 0, 2 }; ","date":"2018-08-17","objectID":"/block%E6%8D%95%E8%8E%B7%E5%8E%9F%E7%90%86%E6%8E%A2%E7%A9%B6/:4:0","tags":["iOS","block"],"title":"Blockæ•è·åŸç†æ¢ç©¶","uri":"/block%E6%8D%95%E8%8E%B7%E5%8E%9F%E7%90%86%E6%8E%A2%E7%A9%B6/"},{"categories":["å®ç°åŸç†"],"content":"æ€»ç»“: å±€éƒ¨å˜é‡ï¼š ä¸åŠ __block: blockå†…éƒ¨æ•è·çš„æ˜¯å±€éƒ¨å˜é‡çš„å€¼ï¼Œè€Œä¸”å¦‚æœå±€éƒ¨å˜é‡æ˜¯æ•°å€¼ç±»å‹ï¼ˆæ¯”å¦‚intï¼‰ä¸ä¼šæœ‰__main_block_copy_0 å’Œ __main_block_dispose_0 ä¸¤ä¸ªå‡½æ•°ï¼Œå¦‚æœæ˜¯å¼•ç”¨ç±»å‹ï¼ˆæ¯”å¦‚NSArrayï¼‰åˆ™ä¼šæœ‰è¿™ä¸ªå‡½æ•°ï¼Œè¯´æ˜å¯¹äºå€¼ç±»å‹å˜é‡æ˜¯ç›´æ¥å®šä¹‰æ–°å˜é‡å¹¶èµ‹å€¼ç›¸åŒï¼Œå¯¹äºå¼•ç”¨ç±»å‹å˜é‡æ˜¯å®šä¹‰ä¸€ä¸ªæ–°å˜é‡å¹¶copyè¿™ä¸ªå¯¹è±¡çš„æŒ‡é’ˆã€‚ æ·»åŠ __block: åŸæ¥çš„å±€éƒ¨å˜é‡ä¼šè¢«æ”¾å…¥åˆ°ä¸€ä¸ª__Block_byref_å˜é‡å_0ç±»å‹çš„ç»“æ„ä½“ä¸­ï¼Œç„¶åblockå†…éƒ¨å½“æ•è·å±€éƒ¨å˜é‡æ—¶å…¶å®æ˜¯æ•è·çš„æ˜¯è¿™ä¸ªç»“æ„ä½“çš„æŒ‡é’ˆï¼Œå½“è·å–åŸæ¥çš„å±€éƒ¨å˜é‡æ—¶(ä¸ç®¡æ˜¯åœ¨blockå†…è¿˜æ˜¯blockå¤–)ï¼Œå…¶å®éƒ½æ˜¯é€šè¿‡è¿™ä¸ªç»“æ„ä½“æˆ–è€…è¿™ä¸ªç»“æ„ä½“æŒ‡é’ˆæ¥æ‹¿åˆ°åŸæ¥çš„å±€éƒ¨å˜é‡å†è¿›è¡Œæ“ä½œçš„ã€‚è¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆæ·»åŠ __blockåå¯ä»¥å¯¹blockå†…æ•è·çš„å±€éƒ¨å˜é‡è¿›è¡Œé‡æ–°èµ‹å€¼ç­‰æ“ä½œã€‚ é™æ€å˜é‡ï¼š blockç›´æ¥æ•è·çš„æ˜¯é™æ€å˜é‡çš„æŒ‡é’ˆï¼Œå‰åéƒ½æ˜¯å¯¹æŒ‡é’ˆè¿›è¡Œæ“ä½œã€‚ å…¨å±€å˜é‡ï¼ˆæˆ– å…¨å±€é™æ€å˜é‡ï¼‰ï¼š blockå¹¶æ²¡æœ‰æ•è·å˜é‡ï¼Œè€Œæ˜¯åœ¨ç»“æ„ä½“çš„æ‰§è¡Œæ–¹æ³•ä¸­ç›´æ¥ä½¿ç”¨äº†å…¨å±€å˜é‡ï¼Œæ˜¯åœ¨æ‰§è¡Œæ—¶æ‰å»å–å€¼ï¼Œä¸€ç›´éƒ½æ˜¯è·å–å˜é‡çš„æœ€æ–°å€¼ã€‚è€Œä¸”ç»†å¿ƒç‚¹æˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œå¯¹äºæ²¡æœ‰æ•è·å…¨å±€å˜é‡çš„blockä¸­ä¹Ÿæ²¡æœ‰__main_block_copy_0 å’Œ __main_block_dispose_0 ä¸¤ä¸ªå‡½æ•°ï¼ˆç”¨äºåœ¨è°ƒç”¨å‰åä¿®æ”¹ç›¸åº”å˜é‡çš„å¼•ç”¨è®¡æ•°ï¼‰ï¼Œå³æ²¡æœ‰å‘ç”Ÿcopyæ“ä½œã€‚ å…¶ä»– ARCç¯å¢ƒä¸‹ï¼šåœ¨å•ç‹¬å£°æ˜blockçš„æ—¶å€™ï¼Œblockè¿˜æ˜¯ä¼šåœ¨æ ˆä¸Šçš„ï¼›å½“blockä½œä¸ºå‚æ•°è¿”å›çš„æ—¶å€™ï¼Œblockä¹Ÿä¼šè‡ªåŠ¨è¢«ç§»åˆ°å †ä¸Šï¼›åœ¨ARCä¸‹ï¼Œåªè¦æŒ‡é’ˆè¿‡ä¸€ä¸‹strongæŒ‡é’ˆï¼Œæˆ–è€…ç”±å‡½æ•°è¿”å›éƒ½ä¼šæŠŠblockç§»åŠ¨åˆ°å †ä¸Šã€‚ __main_block_copy_0 ä¸­çš„ _Block_object_assign å‡½æ•°ç›¸å½“äºretainå®ä¾‹æ–¹æ³•ï¼Œä½¿ block çš„æˆå‘˜å˜é‡æŒæœ‰æ•è·åˆ°çš„å¯¹è±¡ã€‚ __main_block_dispose_0 ä¸­çš„ _Block_object_dispose å‡½æ•°ç›¸å½“äº release å®ä¾‹æ–¹æ³•ï¼Œé‡Šæ”¾ block çš„æˆå‘˜å˜é‡æŒæœ‰çš„å¯¹è±¡ã€‚ Objective-C ä¸­çš„3ç§blockï¼š __NSStackBlock__ã€__NSMallocBlockã€__NSGloballBlock ä¼šåœ¨ä¸‹é¢çš„æƒ…å†µä¸‹å‡ºç°ï¼š æ¡ä»¶ ARC MRC æ•è·å¤–éƒ¨å˜é‡ __NSStackBlock__ __NSMallocBlock__ __NSStackBlock__ æœªæ•è·å¤–éƒ¨å˜é‡ __NSGlobalBlock__ __NSGlobalBlock__ åœ¨ ARC ä¸­ï¼Œæ•è·äº†å¤–éƒ¨å˜é‡çš„blockçš„ç±»å‹ä¼šæ˜¯__NSStackBlock__ æˆ–è€… __NSMallocBlock__ï¼Œå¦‚æœ block è¢«èµ‹å€¼ç»™äº†æŸä¸ªå˜é‡ï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ä¼šæ‰§è¡Œ_Block_copyï¼Œå°†åŸæœ‰çš„ __NSStackBlock__ å˜æˆ __NSMallocBlock__ï¼›ä½†æ˜¯å¦‚æœ block æ²¡æœ‰è¢«èµ‹å€¼ç»™æŸä¸ªå˜é‡ï¼Œé‚£å®ƒçš„ç±»å‹å°±æ˜¯__NSStackBlock__ï¼›æ²¡æœ‰æ•è·å¤–éƒ¨å˜é‡çš„ block çš„ç±»åˆ™æ˜¯ __NSGlobalBlock__ ï¼Œæ—¢ä¸åœ¨æ ˆä¸Šï¼Œä¹Ÿä¸åœ¨å †ä¸Šï¼Œå®ƒç±»ä¼¼äº C è¯­è¨€å‡½æ•°ä¸€æ ·ï¼Œä¼šåœ¨ä»£ç æ®µä¸­ã€‚ åœ¨MRCä¸­ï¼Œæ•è·äº†å¤–éƒ¨å˜é‡çš„ block çš„ç±»ä¼šæ˜¯__NSStackBlock__ï¼Œæ”¾ç½®åœ¨æ ˆä¸Šï¼›æ²¡æœ‰æ•è·å¤–éƒ¨å˜é‡çš„ block ä¸ ARC ç¯å¢ƒä¸‹çš„æƒ…å†µæ˜¯ç›¸åŒçš„ï¼Œç±»å‹æ˜¯__NSGlobalBlock__ï¼Œæ”¾ç½®åœ¨ä»£ç æ®µä¸­ã€‚ ","date":"2018-08-17","objectID":"/block%E6%8D%95%E8%8E%B7%E5%8E%9F%E7%90%86%E6%8E%A2%E7%A9%B6/:5:0","tags":["iOS","block"],"title":"Blockæ•è·åŸç†æ¢ç©¶","uri":"/block%E6%8D%95%E8%8E%B7%E5%8E%9F%E7%90%86%E6%8E%A2%E7%A9%B6/"},{"categories":["å®ç°åŸç†"],"content":"æ¨èæ–‡ç« ï¼š æ¯”æˆ‘å†™çš„å¥½ Blockæœ¬è´¨ ","date":"2018-08-17","objectID":"/block%E6%8D%95%E8%8E%B7%E5%8E%9F%E7%90%86%E6%8E%A2%E7%A9%B6/:6:0","tags":["iOS","block"],"title":"Blockæ•è·åŸç†æ¢ç©¶","uri":"/block%E6%8D%95%E8%8E%B7%E5%8E%9F%E7%90%86%E6%8E%A2%E7%A9%B6/"},{"categories":["å®ç°åŸç†"],"content":"å‚è€ƒæ–‡ç« : è°ˆObjective-C Blockçš„å®ç° iOSä¸­çš„blockæ˜¯å¦‚ä½•æŒæœ‰å¯¹è±¡çš„ æ·±å…¥åˆ†æObjective-C blockã€weakselfã€strongselfå®ç°åŸç† block-copy ","date":"2018-08-17","objectID":"/block%E6%8D%95%E8%8E%B7%E5%8E%9F%E7%90%86%E6%8E%A2%E7%A9%B6/:7:0","tags":["iOS","block"],"title":"Blockæ•è·åŸç†æ¢ç©¶","uri":"/block%E6%8D%95%E8%8E%B7%E5%8E%9F%E7%90%86%E6%8E%A2%E7%A9%B6/"},{"categories":["Tips"],"content":"ä»£ç æŠ€å·§","date":"2018-07-11","objectID":"/codetips/","tags":["iOS","tips"],"title":"ä»£ç æŠ€å·§","uri":"/codetips/"},{"categories":["Tips"],"content":"1. GNU-Cçš„èµ‹å€¼æ‰©å±• å³ä½¿ç”¨({...})çš„å½¢å¼ã€‚è¿™ç§å½¢å¼çš„è¯­å¥å¯ä»¥ç±»ä¼¼å¾ˆå¤šè„šæœ¬è¯­è¨€ï¼Œåœ¨é¡ºæ¬¡æ‰§è¡Œä¹‹åï¼Œä¼šå°†æœ€åä¸€æ¬¡çš„è¡¨è¾¾å¼çš„å€¼ä½œä¸ºè¿”å›å€¼ã€‚ æ³¨æ„ï¼šè¿™ä¸ªä¸æ˜¯æ‡’åŠ è½½ RETURN_VALUE_RECEIVER = {( // do whatever you want ... RETURN_VALUE; // è¿”å›å€¼ )}; REMenu è¿™ä¸ªå¼€æºåº“ä¸­å°±ä½¿ç”¨äº†è¿™ç§è¯­æ³•ï¼Œå¦‚ä¸‹ï¼š _titleLabel = ({ UILabel *label = [[UILabel alloc] initWithFrame:titleFrame]; label.isAccessibilityElement = NO; label.contentMode = UIViewContentModeCenter; label.textAlignment = (NSInteger)self.item.textAlignment == -1 ? self.menu.textAlignment : self.item.subtitleTextAlignment; label.backgroundColor = [UIColor clearColor]; label.autoresizingMask = UIViewAutoresizingFlexibleWidth; label; }); ä½¿ç”¨è¿™ç§è¯­æ³•çš„å…¶ä¸­ä¸€ä¸ªä¼˜ç‚¹æ˜¯ç»“æ„é²œæ˜ç´§å‡‘ï¼Œè€Œä¸”ç”±äºä¸ç”¨æ‹…å¿ƒå—é‡Œé¢çš„å˜é‡åæ±¡æŸ“å¤–é¢å˜é‡åçš„é—®é¢˜ã€‚ ","date":"2018-07-11","objectID":"/codetips/:1:0","tags":["iOS","tips"],"title":"ä»£ç æŠ€å·§","uri":"/codetips/"},{"categories":["Tips"],"content":"2. caseè¯­å¥ä¸­ä½¿ç”¨èŒƒå›´è¡¨è¾¾å¼ GCCå¯¹C11æ ‡å‡†çš„è¯­æ³•æ‰©å±• æ¯”å¦‚ï¼Œcase 1 ... 5 å°±è¡¨ç¤ºå€¼å¦‚æœåœ¨ 1~5 çš„èŒƒå›´å†…åˆ™æ»¡è¶³æ¡ä»¶ã€‚ è¿™é‡Œï¼Œçœç•¥å· ... å°±ä½œä¸ºä¸€ä¸ªèŒƒå›´æ“ä½œç¬¦ï¼Œå…¶å·¦å³ä¸¤ä¸ªæ“ä½œæ•°ä¹‹é—´è‡³å°‘è¦ç”¨ä¸€ä¸ªç©ºç™½ç¬¦è¿›è¡Œåˆ†å‰²ï¼Œå¦‚æœå†™æˆ 1...5 è¿™ç§å½¢å¼ä¼šå¼•å‘è¯æ³•è§£æé”™è¯¯ã€‚èŒƒå›´æ“ä½œç¬¦çš„æ“ä½œæ•°å¯ä»¥æ˜¯ä»»ä¸€æ•´æ•°ç±»å‹ï¼ŒåŒ…æ‹¬å­—ç¬¦ç±»å‹ã€‚ å¦å¤–ï¼ŒèŒƒå›´æ“ä½œç¬¦çš„åšæ“ä½œæ•°çš„å€¼åº”è¯¥å°äºæˆ–ç­‰äºå³æ“ä½œæ•°ï¼Œå¦åˆ™è¯¥èŒƒå›´è¡¨è¾¾å¼å°±ä¼šæ˜¯ä¸€ä¸ªç©ºæ¡ä»¶èŒƒå›´ï¼Œæ°¸è¿œä¸æˆç«‹ã€‚ #include \u003cstdio.h\u003e int main(int argc, const char * argv[]) { int a = 1; const int c = 10; switch(a) { // è¿™æ¡caseè¯­å¥æ˜¯åˆæ³•çš„ï¼Œå¹¶ä¸”ä¸case 1ç­‰æ•ˆ case 1 ... 1: printf(\"a = %d\\n\", a); break; // è¿™æ¡caseè¯­å¥ä¸­çš„èŒƒå›´æ“ä½œç¬¦çš„å·¦æ“ä½œæ•°â¼¤äºå³æ“ä½œæ•°ï¼Œ // å› æ­¤å®ƒæ˜¯â¼€ä¸ªç©ºæ¡ä»¶èŒƒå›´ï¼Œè¿™æ¡caseè¯­å¥ä¸‹çš„é€»è¾‘æ°¸è¿œä¸ä¼šè¢«æ‰§â¾ case 2 ... 1: puts(\"Hello, world!\"); break; // ä½¿â½¤constä¿®é¥°çš„å¯¹è±¡ä¹Ÿå¯ä½œä¸ºèŒƒå›´æ“ä½œç¬¦çš„æ“ä½œæ•° case 8 ... c: puts(\"Wow!\"); break; default: break; } char ch = 'A'; switch(ch) { // ä»'A'åˆ°'Z'çš„ASCIIç èŒƒå›´ case 'A' ... 'Z': printf(\"The letter is: %c\\n\", ch); break; // ä»'0'åˆ°'9'çš„ASCIIç èŒƒå›´ case '0' ... '9': printf(\"The digit is: %c\\n\", ch); break; default: break; } } ","date":"2018-07-11","objectID":"/codetips/:2:0","tags":["iOS","tips"],"title":"ä»£ç æŠ€å·§","uri":"/codetips/"},{"categories":["Tips"],"content":"3. __auto_type GCCå¯¹C11æ ‡å‡†çš„è¯­æ³•æ‰©å±• #if defined(__cplusplus) #define var auto #define let auto const #else #define var __auto_type #define let const __auto_type #endif ä¾‹å¦‚ï¼š let block = ^NSString *(NSString *name, NSUInteger age) { return [NSString stringWithFormat:@\"%@ + %ld\", name, age]; }; let result = block(@\"foo\", 100); // no warning ","date":"2018-07-11","objectID":"/codetips/:3:0","tags":["iOS","tips"],"title":"ä»£ç æŠ€å·§","uri":"/codetips/"},{"categories":["Tips"],"content":"4. ç»“æ„ä½“çš„åˆå§‹åŒ– // ä¸åŠ (CGRect)å¼ºè½¬ä¹Ÿä¸ä¼šwarning GRect rect1 = {1, 2, 3, 4}; CGRect rect2 = {.origin.x=5, .size={10, 10}}; // {5, 0, 10, 10} CGRect rect3 = {1, 2}; // {1, 2, 0, 0} ","date":"2018-07-11","objectID":"/codetips/:4:0","tags":["iOS","tips"],"title":"ä»£ç æŠ€å·§","uri":"/codetips/"},{"categories":["Tips"],"content":"5. æ•°ç»„çš„ä¸‹æ ‡åˆå§‹åŒ– const int numbers[] = { [1] = 3, [2] = 2, [3] = 1, [5] = 12306 }; // {0, 3, 2, 1, 0, 12306} è¿™ä¸ªç‰¹æ€§å¯ä»¥ç”¨æ¥åšæšä¸¾å€¼å’Œå­—ç¬¦ä¸²çš„æ˜ å°„ typedef NS_ENUM(NSInteger, Type){ Type1, Type2 }; const NSString *TypeNameMapping[] = { [Type1] = @\"Type1\", [Type2] = @\"Type2\" }; åˆå¦‚ UITableView+FDIndexPathHeightCacheä¸­çš„ä¾‹å­ï¼š // All methods that trigger height cache's invalidation SEL selectors[] = { @selector(reloadData), @selector(insertSections:withRowAnimation:), @selector(deleteSections:withRowAnimation:), @selector(reloadSections:withRowAnimation:), @selector(moveSection:toSection:), @selector(insertRowsAtIndexPaths:withRowAnimation:), @selector(deleteRowsAtIndexPaths:withRowAnimation:), @selector(reloadRowsAtIndexPaths:withRowAnimation:), @selector(moveRowAtIndexPath:toIndexPath:) }; for (NSUInteger index = 0; index \u003c sizeof(selectors) / sizeof(SEL); ++index) { SEL originalSelector = selectors[index]; SEL swizzledSelector = NSSelectorFromString([@\"fd_\" stringByAppendingString:NSStringFromSelector(originalSelector)]); Method originalMethod = class_getInstanceMethod(self, originalSelector); Method swizzledMethod = class_getInstanceMethod(self, swizzledSelector); method_exchangeImplementations(originalMethod, swizzledMethod); } ","date":"2018-07-11","objectID":"/codetips/:5:0","tags":["iOS","tips"],"title":"ä»£ç æŠ€å·§","uri":"/codetips/"},{"categories":["Tips"],"content":"6. è‡ªå¸¦æç¤ºçš„keypathå® #define keypath2(OBJ, PATH) \\ (((void)(NO \u0026\u0026 ((void)OBJ.PATH, NO)), # PATH)) ","date":"2018-07-11","objectID":"/codetips/:6:0","tags":["iOS","tips"],"title":"ä»£ç æŠ€å·§","uri":"/codetips/"},{"categories":["Tips"],"content":"7. é€—å·è¡¨è¾¾å¼ é€—å·è¡¨è¾¾å¼å–åå€¼ï¼Œä½†å‰å€¼çš„è¡¨è¾¾å¼å‚ä¸è¿ç®—ï¼Œå¯ç”¨voidå¿½ç•¥ç¼–è¯‘å™¨è­¦å‘Š int a = ((void)(1+2), 2); // a == 2 äºæ˜¯ä¸Šé¢çš„keypathå®çš„è¾“å‡ºç»“æœæ˜¯#PATHä¹Ÿå°±æ˜¯ä¸€ä¸ªcå­—ç¬¦ä¸² ","date":"2018-07-11","objectID":"/codetips/:7:0","tags":["iOS","tips"],"title":"ä»£ç æŠ€å·§","uri":"/codetips/"},{"categories":["Tips"],"content":"8. Cå‡½æ•°é‡è½½æ ‡ç¤ºç¬¦ RTRootNavigationController ä¸­æœ‰ç”¨åˆ°è¿™ä¸ªæŠ€å·§ __attribute((overloadable)) NSInteger ZD_SumFunc(NSInteger a, NSInteger b) { return a + b; } __attribute((overloadable)) NSInteger ZD_SumFunc(NSInteger a, NSInteger b, NSInteger c) { return a + b + c; } ","date":"2018-07-11","objectID":"/codetips/:8:0","tags":["iOS","tips"],"title":"ä»£ç æŠ€å·§","uri":"/codetips/"},{"categories":["Tips"],"content":"9. å‚æ•°ä¸ªæ•° // æœ€å¤šæ”¯æŒ10ä¸ªå‚æ•° #define COUNT_PARMS2(_a1, _a2, _a3, _a4, _a5, _a6, _a7, _a8, _a9, _a10, RESULT, ...) RESULT #define COUNT_PARMS(...) COUNT_PARMS2(__VA_ARGS__, 10, 9, 8, 7, 6, 5, 4, 3, 2, 1) int count = COUNT_PARMS(1,2,3,4,5,6); // é¢„å¤„ç†æ—¶count == 6 ","date":"2018-07-11","objectID":"/codetips/:9:0","tags":["iOS","tips"],"title":"ä»£ç æŠ€å·§","uri":"/codetips/"},{"categories":["Tips"],"content":"10. åŒåå…¨å±€å˜é‡æˆ–è€…å…¨å±€å‡½æ•°å…±å­˜ // ä¸‹é¢äºŒè€…å¯ä»¥å¹¶å­˜ NSDictionary *ZDInfoDict = nil; __attribute__((weak)) NSDictionary *ZDInfoDict = nil; ","date":"2018-07-11","objectID":"/codetips/:10:0","tags":["iOS","tips"],"title":"ä»£ç æŠ€å·§","uri":"/codetips/"},{"categories":["Tips"],"content":"11. å·æ¢æ¢æŸ± class Test { dynamic func foo() { print(\"bar\") } } extension Test { @_dynamicReplacement(for: foo()) func new_foo() { print(\"bar new\") foo() // calls previous implementation } } Test().foo() // bar new æœ‰2ç‚¹éœ€è¦è¯´æ˜ï¼š æ ‡æ³¨dynamicå…³é”®å­— åœ¨å·¥ç¨‹ä¸­è¿è¡Œï¼Œplaygroundä¸æ”¯æŒ ","date":"2018-07-11","objectID":"/codetips/:11:0","tags":["iOS","tips"],"title":"ä»£ç æŠ€å·§","uri":"/codetips/"},{"categories":["Tips"],"content":"12. ç§»èŠ±æ¥æœ¨ @_silgen_name(\"backtrace\") internal func swift_backtrace(_ callstacks: UnsafeMutableRawPointer, _ counts: Int) -\u003e Int @_silgen_name(\"backtrace_symbols\") internal func swift_backtrace_symbols(_ callstacks: UnsafeRawPointer, _ counts: Int) -\u003e UnsafeMutablePointer\u003cUnsafePointer\u003cCChar\u003e\u003e? //------------------------------------------------ static func callstack() -\u003e [String] { var callstack = [UnsafeMutableRawPointer?](repeating: nil, count: 128) let frames = swift_backtrace(\u0026callstack, callstack.count) var callstackArr: [String] = [] if let symbols = swift_backtrace_symbols(\u0026callstack, frames) { for frame in 0..\u003cframes { let symbol = String(cString: symbols[frame]) callstackArr.append(symbol) } free(symbols) os_log(\"å †æ ˆä¿¡æ¯ =\u003e %@\", log: .apmLog, type: .info, callstackArr) } return callstackArr } ","date":"2018-07-11","objectID":"/codetips/:12:0","tags":["iOS","tips"],"title":"ä»£ç æŠ€å·§","uri":"/codetips/"},{"categories":["Tips"],"content":"13. Swiftç±»åè§£æ # xcrun swift-demangle _TtC11NewWolfKill22WKRoomControlMenuModel $ xcrun swift-demangle \u003cyour-mangled-symbol\u003e ","date":"2018-07-11","objectID":"/codetips/:13:0","tags":["iOS","tips"],"title":"ä»£ç æŠ€å·§","uri":"/codetips/"},{"categories":["Tips"],"content":"14. é˜Ÿåˆ—æ ¡éªŒ methodThatCallsBackOnMain(completion: { result in // ç¡®ä¿åœ¨ä¸»é˜Ÿåˆ—ä¸­è°ƒç”¨ dispatchPrecondition(.onQueue(.main)) // process `result` // ... }) ","date":"2018-07-11","objectID":"/codetips/:14:0","tags":["iOS","tips"],"title":"ä»£ç æŠ€å·§","uri":"/codetips/"},{"categories":["Tips"],"content":"15. æŒ‡é’ˆè°ƒç”¨Swiftå‡½æ•° https://github.com/apple/swift/issues/70630 public class Printable { public init (from sender : String) { print (\"Hello from \\(sender)!\") } public init (from sender : String, as name : String = \"Bastie\") { // ğŸ†˜ in result of init with one parameter unusable default value \"Bastie\" from init method print (\"Hello from \\(name)?\") } } let fn = Printable.init(from:as:) let _ = fn(\"Sebastian\") // or let _ = Printable.init(from:as:)(\"Sebastian\") ","date":"2018-07-11","objectID":"/codetips/:15:0","tags":["iOS","tips"],"title":"ä»£ç æŠ€å·§","uri":"/codetips/"},{"categories":["Tips"],"content":"16. ä½¿ç”¨mapç®€åŒ–ä»£ç  https://github.com/ReactiveX/RxSwift/pull/2549 é‡æ„å‰ï¼š let disposable: Disposable if let onDisposed = onDisposed { disposable = Disposables.create(with: onDisposed) } else { disposable = Disposables.create() } é‡æ„åï¼š let disposable: Disposable = onDisposed.map( Disposables.create(with:) ) ?? Disposables.create() ","date":"2018-07-11","objectID":"/codetips/:16:0","tags":["iOS","tips"],"title":"ä»£ç æŠ€å·§","uri":"/codetips/"},{"categories":["Tips"],"content":"17. Assert assertä¼šå¯¼è‡´ç¨‹åºé€€å‡ºï¼Œä¸‹é¢è¿™ç§æ–¹å¼ä¸ä¼šä½¿ç¨‹åºé€€å‡ºè€Œåªæ˜¯è®©IDEæ–­åœ¨æŒ‡å®šä½ç½®ï¼Œç±»ä¼¼äºæ‰“æ–­ç‚¹é‚£ç§æ•ˆæœ // é€‚ç”¨äºæ‰€æœ‰æ¶æ„ __builtin_debugtrap() å¦‚æœæ˜¯æ¨¡æ‹Ÿå™¨ï¼Œå¯ä»¥ä½¿ç”¨å†…è”æ±‡ç¼–çš„æ–¹å¼ asm(\"int3\") å¦‚æœæ˜¯winå¹³å°ï¼Œå¯ä»¥ç”¨ __debugbreak() è´´æ®µæ ·ä¾‹ï¼š // MARK: - ZDAssert #if DEBUG #ifndef ZDAssert #define ZDAssert(condition, format, ...) do { \\ _Pragma(\"clang diagnostic push\") \\ _Pragma(\"clang diagnostic ignored \\\"-Wobjc-literal-conversion\\\"\") \\ if (condition) break; \\ if (format) printf(\"\\n%s\\n\\n\", [[NSString stringWithFormat:format, ##__VA_ARGS__] UTF8String]); \\ _Pragma(\"clang diagnostic pop\") \\ __builtin_debugtrap(); \\ } while(0); #endif #else #ifndef ZDAssert #define ZDAssert(condition, format, ...) #endif #endif è¿™é‡Œå»ºè®®åŠ ä¸Šä¸€ä¸ªæ¡ä»¶â€“åªåœ¨è°ƒè¯•æœŸé—´èµ·ä½œç”¨ï¼Œå› ä¸ºåœ¨éè°ƒè¯•é˜¶æ®µæ‰§è¡Œåˆ°è¿™ä¸ªtrapç¨‹åºä¼šæŒ‚æ‰ï¼Œä»£ç å¦‚ä¸‹ï¼š import Darwin // See http://developer.apple.com/library/mac/#qa/qa1361/_index.html @objc public class func isDebuggerAttached() -\u003e Bool { var info = kinfo_proc() var mib = [CTL_KERN, KERN_PROC, KERN_PROC_PID, getpid()] var size = MemoryLayout\u003ckinfo_proc\u003e.stride let junk = sysctl(\u0026mib, u_int(mib.count), \u0026info, \u0026size, nil, 0) assert(junk == 0) let isDebuggerAttaced = info.kp_proc.p_flag \u0026 P_TRACED != 0 return isDebuggerAttaced } ","date":"2018-07-11","objectID":"/codetips/:17:0","tags":["iOS","tips"],"title":"ä»£ç æŠ€å·§","uri":"/codetips/"},{"categories":["Tips"],"content":"18. ä¿è¯å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸ Swift withExtendedLifetime() var owningReference = Instance() ... withExtendedLifetime(owningReference) { dosomething(...) } // Assuming: No stores to owned occur for the dynamic lifetime of // the withExtendedLifetime invocation. Objective-C åœ¨ Objective-C ARC ä¸­ä½ å¯ä»¥ä½¿ç”¨Â __attribute__((objc_precise_lifetime))Â æˆ–è€…Â NS_VALID_UNTIL_END_OF_SCOPEÂ æ¥æ ‡æ³¨å˜é‡ä»¥è¾¾åˆ°ç±»ä¼¼çš„æ•ˆæœã€‚ ","date":"2018-07-11","objectID":"/codetips/:18:0","tags":["iOS","tips"],"title":"ä»£ç æŠ€å·§","uri":"/codetips/"},{"categories":["Tips"],"content":"19. åŒºé—´åˆ¤æ–­ åˆ¤æ–­æŸä¸€ä¸ªå€¼xæ˜¯å¦åœ¨åŒºé—´[min, max]å†…Â ç¬¬ä¸€ä¸ª (x - minx) å¦‚æœ x \u003c minx çš„è¯ï¼Œå¾—åˆ°çš„ç»“æœ \u003c 0 ï¼Œå³é«˜ä½ä¸º 1ï¼Œç¬¬äºŒä¸ªåˆ¤æ–­åŒç†ï¼Œå¦‚æœè¶…è¿‡èŒƒå›´ï¼Œé«˜ä½ä¹Ÿä¸º 1ï¼Œä¸¤ä¸ªæ¡ä»¶è¿›è¡Œæ¯”ç‰¹æˆ–è¿ç®—ä»¥åï¼Œåªæœ‰ä¸¤ä¸ªé«˜ä½éƒ½æ˜¯ 0 ï¼Œæœ€ç»ˆæ‰ä¸ºçœŸ if (( (x - minx) | (maxx - x) ) \u003e= 0) ... ","date":"2018-07-11","objectID":"/codetips/:19:0","tags":["iOS","tips"],"title":"ä»£ç æŠ€å·§","uri":"/codetips/"},{"categories":["Tips"],"content":"20. é€šè¿‡å¼‚æˆ–æ··æ·†key é€šè¿‡å¼‚æˆ–çš„æ–¹å¼ï¼ˆå­—ç¬¦ä¸²æ­£å¸¸ä¼šè¿›å…¥å¸¸é‡åŒºï¼Œä½†æ˜¯é€šè¿‡å¼‚æˆ–çš„æ–¹å¼ç¼–è¯‘å™¨ä¼šç›´æ¥æ¢ç®—æˆå¼‚æ­¥ç»“æœï¼‰ #define ENCRYPT_KEY 0xAC static NSString * AES_KEY(){ unsigned char key[] = { (ENCRYPT_KEY ^ 'd'), (ENCRYPT_KEY ^ 'e'), (ENCRYPT_KEY ^ 'm'), (ENCRYPT_KEY ^ 'o'), (ENCRYPT_KEY ^ '_'), (ENCRYPT_KEY ^ 'A'), (ENCRYPT_KEY ^ 'E'), (ENCRYPT_KEY ^ 'S'), (ENCRYPT_KEY ^ '_'), (ENCRYPT_KEY ^ '\\0'), }; unsigned char * p = key; while (((*p) ^= ENCRYPT_KEY) != '\\0') { p++; } return [NSString stringWithUTF8String:(const char *)key]; } ","date":"2018-07-11","objectID":"/codetips/:20:0","tags":["iOS","tips"],"title":"ä»£ç æŠ€å·§","uri":"/codetips/"},{"categories":["Tips"],"content":"21. å¦ç±»çš„NSTimerç ´ç¯æ–¹æ¡ˆ blockç»“æ„ä¸­æœ‰ä¸ªç§æœ‰çš„å‡½æ•°ï¼šinvokeã€‚ @implementation NSTimer (ZDUtility) + (instancetype)zd_fireSecondsFromNow:(NSTimeInterval)delay block:(dispatch_block_t)block { return [self scheduledTimerWithTimeInterval:delay target:block selector:@selector(invoke) userInfo:nil repeats:NO]; } @end ","date":"2018-07-11","objectID":"/codetips/:21:0","tags":["iOS","tips"],"title":"ä»£ç æŠ€å·§","uri":"/codetips/"},{"categories":["Tips"],"content":"å‚è€ƒ objcéä¸»æµä»£ç æŠ€å·§ Even Swiftier Objective-C ã€ŠCè¯­è¨€ç¼–ç¨‹é­”æ³•ä¹¦ã€‹ GCCä¸­çš„å¼±ç¬¦å·ä¸å¼ºç¬¦å· swift: SIL 30-tips-to-make-you-a-better-ios-developer C/C++è°ƒè¯•æŠ€å·§-debugbreak Swift ä¸­çš„ ARC æœºåˆ¶: ä»åŸºç¡€åˆ°è¿›é˜¶ Cè¯­è¨€æœ‰ä»€ä¹ˆå¥‡æ·«æŠ€å·§ iOS æ‘¸é±¼å‘¨æŠ¥ #56 ","date":"2018-07-11","objectID":"/codetips/:21:1","tags":["iOS","tips"],"title":"ä»£ç æŠ€å·§","uri":"/codetips/"},{"categories":["Tips"],"content":"CocoaPodsç¬”è®° ","date":"2016-11-21","objectID":"/cocoapods_tips/:0:0","tags":["iOS","cocoaPods","tips"],"title":"CocoaPodsç¬”è®°","uri":"/cocoapods_tips/"},{"categories":["Tips"],"content":"1ã€The master repo requires CocoaPods 1.0.0 - (currently using 0.38.2) å‚è€ƒï¼šhttp://blog.cocoapods.org/Sharding/ å®‰è£…1.0ä¹‹å‰ï¼ˆe.gï¼šv0.38.2ï¼‰ç‰ˆæœ¬çš„pod sudo gem install cocoapods -v 0.38.2 ä¹‹ååœ¨æ‰§è¡Œpod setupæ—¶ï¼Œç”±äºpodå·¥å…·å·²ç»å‡çº§åˆ°1.xxç‰ˆæœ¬äº†ï¼Œpodç®—æ³•ä»¥åŠSpecsåº“ä¸­çš„æ–‡ä»¶ç»“æ„å·²ç»æ”¹å˜ï¼Œæ‰€ä»¥å®ƒä¼šé»˜è®¤æ‹‰å–æ–°ç‰ˆæœ¬çš„Specsåº“ï¼Œè¿™æ ·å°±ä¼šå‡ºç°æ—§ç‰ˆæœ¬podæ–°ç‰ˆæœ¬Specsåº“çš„æƒ…å†µï¼Œå½“æ‰§è¡Œpod installçš„æ—¶å€™ä¼šå‘ç”Ÿæ‰¾ä¸åˆ°xxxç¬¬ä¸‰æ–¹åº“çš„æƒ…å†µã€‚ è§£å†³æ­¤é—®é¢˜çš„æ–¹æ¡ˆæ˜¯éœ€è¦åœ¨Podfileä¸­æŒ‡å®šsourceæºåœ°å€ï¼š source \"https://github.com/CocoaPods/Old-Specs\" å¹¶æŠŠæœ¬åœ°çš„Specsåº“åˆ‡æ¢åˆ°æ—§ç‰ˆæœ¬ï¼š cd ~/.cocoapods/repos/master/ git fetch origin master git checkout v0.32.1 æœ€åï¼Œåœ¨æ‰§è¡Œpod installçš„æ—¶å€™éœ€è¦æ·»åŠ ä¸Š--no-repo-updateæ ‡è¯†ï¼Œå› ä¸º1.0ä¹‹å‰çš„podç‰ˆæœ¬åœ¨æ‰§è¡Œpod installçš„æ—¶å€™ä¼šé»˜è®¤å…ˆæ›´æ–°å‡çº§æœ¬åœ°Specsåº“æ–‡ä»¶ã€‚ ä»¥ä¸‹2å¼ å›¾åˆ†åˆ«æ˜¯æ—§ç‰ˆæœ¬çš„specåº“å’Œæ–°ç‰ˆæœ¬specåº“çš„ç»“æ„ï¼Œå¤§å®¶å¯ä»¥å¯¹æ¯”ä¸€ä¸‹äºŒè€…çš„ç»“æ„ï¼š oldSpec newSpec ","date":"2016-11-21","objectID":"/cocoapods_tips/:1:0","tags":["iOS","cocoaPods","tips"],"title":"CocoaPodsç¬”è®°","uri":"/cocoapods_tips/"},{"categories":["Tips"],"content":"2ã€File not found with include; use â€œquoatesâ€ instead åœ¨targetä¸­æ‰‹åŠ¨è®¾ç½®Always Search User Pathsä¸ºYESï¼Œä¹Ÿå¯ä»¥é€šè¿‡podåŠ¨æ€è®¾ç½®ï¼ˆæ¨èï¼‰ post_install do |installer| installer.pods_project.targets.each do |target| target.build_configurations.each do |config| config.build_settings['ALWAYS_SEARCH_USER_PATHS'] = 'YES' end end end ","date":"2016-11-21","objectID":"/cocoapods_tips/:2:0","tags":["iOS","cocoaPods","tips"],"title":"CocoaPodsç¬”è®°","uri":"/cocoapods_tips/"},{"categories":["Tips"],"content":"3ã€Cannot create __weak reference in file using manual reference counting https://github.com/ReactiveCocoa/ReactiveCocoa/issues/2761 @mdiep å¯¹å‡ºç°æ­¤é—®é¢˜çš„åŸå› çš„è§£é‡Šï¼šIn Xcode 7.3, __weak causes errors in files compiled as -fno-objc-arc. Since RAC uses __weak, you cannot use it in those files without setting the Weak References in Manual Retain Release setting to YES. If youâ€™re using a .pch that imports RAC, youâ€™re more likely to see this error. é”™è¯¯æ ·å¼å¦‚ä¸‹å›¾æ‰€ç¤º reactiveCocoa_issue_2761 æœ‰3ç§è§£å†³åŠæ³•ï¼š 1ï¼‰ä¿®æ”¹æºç ï¼šæŠŠ.hæ–‡ä»¶ä¸­æŠ¥é”™çš„__weakæ ‡è¯†åˆ é™¤ï¼ˆä¸èƒ½åˆ é™¤.mæ–‡ä»¶ä¸­çš„ï¼Œå¦åˆ™ä¼šå‘ç”Ÿå†…å­˜é—®é¢˜ï¼‰ 2ï¼‰åœ¨å¼•å…¥ReactiveCocoaçš„åœ°æ–¹æ·»åŠ macroåˆ¤æ–­æ ‡è¯†ï¼š #if __has_feature(objc_arc) #import \u003cReactiveCocoa/ReactiveCocoa.h\u003e #endif 3ï¼‰è®¾ç½®å·¥ç¨‹æ–‡ä»¶ï¼šè®¾ç½®Weak References in Manual Retain Releaseä¸ºYES weak reference in manual ","date":"2016-11-21","objectID":"/cocoapods_tips/:3:0","tags":["iOS","cocoaPods","tips"],"title":"CocoaPodsç¬”è®°","uri":"/cocoapods_tips/"},{"categories":["Tips"],"content":"4ã€â€œThe validator for Swift projects uses Swift 3.0 by default, if you are using a different version of swift you can use a .swift-version file to set the version for you Pod. For example to use Swift 2.3, run: echo \"2.3\" \u003e .swift-version:â€ å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š SwiftVersionError è§£å†³åŠæ³•ï¼š æŠŠpodçš„å¼•ç”¨æ–¹å¼ç”±:gitæ–¹å¼æ”¹ä¸ºæŒ‡å®šç‰ˆæœ¬å·çš„æ–¹å¼ã€‚ ","date":"2016-11-21","objectID":"/cocoapods_tips/:4:0","tags":["iOS","cocoaPods","tips"],"title":"CocoaPodsç¬”è®°","uri":"/cocoapods_tips/"},{"categories":["Tips"],"content":"5ã€åœ¨podçš„pchæ–‡ä»¶ä¸­æ·»åŠ å¼•ç”¨æ—¶ï¼Œæ¯”å¦‚ s.prefix_header_contents = '#import \"DDDefine.h\"' ä¸èƒ½æ·»åŠ è‡ªå·±å·¥ç¨‹ä¸­çš„æ–‡ä»¶ï¼Œæ‰§è¡Œpod lib lintæ—¶ï¼Œå®ƒä¼šä¸€ç›´æŠ¥æ‰¾ä¸åˆ°ä½ æƒ³å¼•å…¥çš„æ–‡ä»¶çš„é”™è¯¯ã€‚ ä½†æ˜¯ä½ å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ å…¶ä»–podä¸­çš„æ–‡ä»¶ï¼Œæˆ–è€…iOSè‡ªå·±APIä¸­çš„åº“æ–‡ä»¶ã€‚ ","date":"2016-11-21","objectID":"/cocoapods_tips/:5:0","tags":["iOS","cocoaPods","tips"],"title":"CocoaPodsç¬”è®°","uri":"/cocoapods_tips/"},{"categories":["Tips"],"content":"6ã€CocoaPodså¸è½½ æœ‰çš„æ—¶å€™ä¸å°å¿ƒæŠŠpodSpecå‡çº§åˆ°äº†1.x ç‰ˆæœ¬ï¼Œç„¶åpod searchå°±ä¸èƒ½ç”¨äº†ï¼Œç„¶åé€šè¿‡åˆ‡æ¢åˆ†æ”¯checkoutåˆ°v0.32.1ï¼Œä½†æ˜¯pod searchè¿˜æ˜¯æŠ¥é”™ï¼š $ pod search ZDTableView [!] Unable to load a specification for the plugin `/Users/fuxianchao/.rvm/gems/ruby-2.2.1/gems/cocoapods-deintegrate-1.0.0.beta.1` â€•â€•â€• MARKDOWN TEMPLATE â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€• Command /Users/fuxianchao/.rvm/gems/ruby-2.2.1/bin/pod search ZDTableView Report * What did you do? * What did you expect to happen? * What happened instead? Stack CocoaPods : 0.38.2 Ruby : ruby 2.2.1p85 (2015-02-26 revision 49769) [x86_64-darwin14] RubyGems : 2.4.8 Host : Mac OS X 10.12.2 (16C67) Xcode : 8.2.1 (8C1002) Git : git version 2.11.0 Ruby lib dir : /Users/fuxianchao/.rvm/rubies/ruby-2.2.1/lib Repositories : cocoapods - https://github.com/CocoaPods/Old-Specs @ 6e256ccc84aad851d401fabb79b2c0f9e09bb875 DDSpec - http://10.255.223.213/ios-code/DDSpec.git @ 941bed4b0c03090e13ecb7ee16a1eafa77969785 master - https://github.com/CocoaPods/Specs.git @ 2d939ca0abb4172b9ef087d784b43e0696109e7c Plugins cocoapods-keys : 1.7.0 cocoapods-playgrounds : 0.1.0 cocoapods-plugins : 0.4.2 cocoapods-search : 1.0.0.beta.1 cocoapods-stats : 0.5.3 cocoapods-trunk : 0.6.4 cocoapods-try : 0.4.5 Error NoMethodError - undefined method `all' for Pod::Platform:Class /Users/fuxianchao/.rvm/gems/ruby-2.2.1/gems/cocoapods-search-1.0.0.beta.1/lib/cocoapods-search/command/search.rb:34:in `initialize' /Users/fuxianchao/.rvm/gems/ruby-2.2.1@global/gems/claide-0.9.1/lib/claide/command.rb:334:in `new' /Users/fuxianchao/.rvm/gems/ruby-2.2.1@global/gems/claide-0.9.1/lib/claide/command.rb:334:in `parse' /Users/fuxianchao/.rvm/gems/ruby-2.2.1@global/gems/claide-0.9.1/lib/claide/command.rb:330:in `parse' /Users/fuxianchao/.rvm/gems/ruby-2.2.1@global/gems/claide-0.9.1/lib/claide/command.rb:308:in `run' /Users/fuxianchao/.rvm/gems/ruby-2.2.1/gems/cocoapods-0.38.2/lib/cocoapods/command.rb:48:in `run' /Users/fuxianchao/.rvm/gems/ruby-2.2.1/gems/cocoapods-0.38.2/bin/pod:44:in `\u003ctop (required)\u003e' /Users/fuxianchao/.rvm/gems/ruby-2.2.1/bin/pod:23:in `load' /Users/fuxianchao/.rvm/gems/ruby-2.2.1/bin/pod:23:in `\u003cmain\u003e' /Users/fuxianchao/.rvm/gems/ruby-2.2.1/bin/ruby_executable_hooks:15:in `eval' /Users/fuxianchao/.rvm/gems/ruby-2.2.1/bin/ruby_executable_hooks:15:in `\u003cmain\u003e' â€•â€•â€• TEMPLATE END â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€• [!] Oh no, an error occurred. Search for existing GitHub issues similar to yours: https://github.com/CocoaPods/CocoaPods/search?q=undefined+method+%60all%27+for+Pod%3A%3APlatform%3AClass\u0026type=Issues If none exists, create a ticket, with the template displayed above, on: https://github.com/CocoaPods/CocoaPods/issues/new Be sure to first read the contributing guide for details on how to properly submit a ticket: https://github.com/CocoaPods/CocoaPods/blob/master/CONTRIBUTING.md Don't forget to anonymize any private data! è¿™æ—¶å€™æˆ‘çš„åšæ³•é€šå¸¸å°±æ˜¯å¸è½½pod ï¼Œç„¶åé‡æ–°å®‰è£…ã€‚ $ which pod //å¾—åˆ°path $ sudo rm -rf \u003cpath\u003e // å¾ªç¯éå†å¸è½½podç»„ä»¶ï¼ˆå¦‚æœæ˜¯å®‰è£…åœ¨äº†ç”¨æˆ·ç›®å½•ä¸‹ï¼Œé‚£å°±å»æ‰å‘½ä»¤ä¸­çš„sudoï¼‰ $ for i in `gem list | grep pod | awk '{print $1}'`; do sudo gem uninstall $i; done æœ‰çš„æ—¶å€™å¯¹äºæ–°ç³»ç»Ÿç›´æ¥è°ƒç”¨gem install cocoapods æ˜¯ä¸è¡Œçš„ï¼Œæç¤ºé”™è¯¯ï¼Œæ­¤ç§æƒ…å†µå°±ç”¨ä¸‹é¢çš„å‘½ä»¤ï¼š // å®‰è£…æŒ‡å®šç‰ˆæœ¬çš„pod sudo gem install -n /usr/local/bin cocoapods -v 1.2.0 // å¸è½½ sudo gem uninstall -n /usr/local/bin cocoapods -v 1.2.0 ","date":"2016-11-21","objectID":"/cocoapods_tips/:6:0","tags":["iOS","cocoaPods","tips"],"title":"CocoaPodsç¬”è®°","uri":"/cocoapods_tips/"},{"categories":["Tips"],"content":"7ã€Library not found for -lAFNetworking è¿™ç§æƒ…å†µçš„è§£å†³æ–¹æ¡ˆæ˜¯è®¾ç½®project -\u003e build setting -\u003e library search patchs é‡Œæ·»åŠ  $(inherited) æ ‡è¯†ã€‚ ","date":"2016-11-21","objectID":"/cocoapods_tips/:7:0","tags":["iOS","cocoaPods","tips"],"title":"CocoaPodsç¬”è®°","uri":"/cocoapods_tips/"},{"categories":["Tips"],"content":"8ã€Cannot synthesize weak property because the current deployment target does not support weak refernces refer: http://stackoverflow.com/questions/37160688/set-deployment-target-for-cocoapodss-pod è§£å†³æ–¹æ¡ˆï¼š post_install do |installer| installer.pods_project.targets.each do |target| target.build_configurations.each do |config| if target.name == 'DDKit' config.build_settings['ENABLE_STRICT_OBJC_MSGSEND'] = 'NO' elsif target.name == 'PulsingHalo' config.build_settings['IPHONEOS_DEPLOYMENT_TARGET'] = '9.2' end end end end æˆ–è€…é”™è¯¯æç¤ºä¸ºï¼šCannot synthesize weak property in file using manual reference counting post_install do |installer| installer.pods_project.targets.each do |target| target.build_configurations.each do |config| if target.name == 'ReactiveCocoa' config.build_settings['CLANG_ENABLE_OBJC_WEAK'] = 'YES' end end end end ","date":"2016-11-21","objectID":"/cocoapods_tips/:8:0","tags":["iOS","cocoaPods","tips"],"title":"CocoaPodsç¬”è®°","uri":"/cocoapods_tips/"},{"categories":["Tips"],"content":"9ã€Cocoapods debug æˆ‘ä»¬å¯ä»¥ç”¨ pry æ¥è°ƒè¯• podfile ï¼Œå³è°ƒè¯• rubyï¼Œä½¿ç”¨ä¹‹å‰å…ˆå®‰è£… gem install pry æ¥ä¸‹æ¥åœ¨ podfile ä¸­å¯¼å…¥ require 'pry'ï¼Œç„¶ååœ¨ä½ æƒ³æ‰“æ–­ç‚¹è°ƒè¯•çš„åœ°æ–¹æ·»åŠ ä¸€è¡Œä»£ç  binding.pryï¼Œè¿™æ ·å°±å¯ä»¥åœ¨æ¯æ¬¡æ‰§è¡Œpod install or pod update çš„æ—¶å€™æ–­åœ¨è¿™å¥ä»£ç çš„ä½ç½®ï¼Œæˆ‘ä»¬å°±å¯ä»¥è°ƒè¯•äº†ï¼› ","date":"2016-11-21","objectID":"/cocoapods_tips/:9:0","tags":["iOS","cocoaPods","tips"],"title":"CocoaPodsç¬”è®°","uri":"/cocoapods_tips/"},{"categories":["Tips"],"content":"10ã€è‡ªåŠ¨æ·»åŠ modulemapçš„æ”¯æŒ å¦‚æœæˆ‘ä»¬æƒ³ä»¥@importçš„æ–¹å¼å¼•ç”¨ä¸€ä¸ªä¸æ”¯æŒmodulemapçš„repoï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥è®©CocoaPodsè‡ªåŠ¨ç”Ÿæˆmodulemapï¼Œè¯­æ³•å¦‚ä¸‹ï¼š pod 'MLFilterKit', '1.9.705', :modular_headers =\u003e true è¿™ä¸ªå¯ä»¥è§£å†³éƒ¨åˆ†repoä¸­ @import æŠ¥é”™çš„é—®é¢˜ï¼› ","date":"2016-11-21","objectID":"/cocoapods_tips/:10:0","tags":["iOS","cocoaPods","tips"],"title":"CocoaPodsç¬”è®°","uri":"/cocoapods_tips/"},{"categories":["Tips"],"content":"11ã€ä¸ºCocoaPodså¼€å¯å¢é‡ç¼–è¯‘æ¨¡å¼ï¼š å¼€å¯å¢é‡ç¼–è¯‘æ¨¡å¼åï¼Œpost_installã€pre_install ä¸­çš„æŸäº›è®¾ç½®ä¼šæŠ¥é”™ï¼Œå› ä¸ºå·¥ç¨‹é…ç½®çš„å±‚çº§ç»“æ„å‘ç”Ÿäº†å˜åŒ–ï¼› install! 'cocoapods', :generate_multiple_pod_projects =\u003e true, :incremental_installation =\u003e true ","date":"2016-11-21","objectID":"/cocoapods_tips/:11:0","tags":["iOS","cocoaPods","tips"],"title":"CocoaPodsç¬”è®°","uri":"/cocoapods_tips/"},{"categories":["Tips"],"content":"12ã€é™æ€åº“å’ŒåŠ¨æ€åº“å…±å­˜çš„è®¾ç½®ï¼š # https://www.rubydoc.info/gems/cocoapods/Pod # https://github.com/facebook/flipper/issues/254 # https://github.com/facebook/flipper/blob/master/docs/getting-started.md $dynamic_framework = ['LayoutInspector', 'PromiseKit', 'Yoga', 'YogaKit'] pre_install do |installer| # installer.pod_targets.each do |pod| # if $dynamic_framework.include?(pod.name) # pod.instance_variable_set(:@host_requires_frameworks, true) # end # end Pod::Installer::Xcode::TargetValidator.send(:define_method, :verify_no_static_framework_transitive_dependencies) {} installer.pod_targets.each do |pod| if not $dynamic_framework.include?(pod.name) def pod.build_type; #Pod::Target::BuildType.static_library Pod::BuildType.static_library end end end end pre_install do |installer| $dynamic_framework = ['RxSwift'] Pod::Installer::Xcode::TargetValidator.send(:define_method,:verify_no_static_framework_transitive_dependencies) {} installer.pod_targets.each do |pod| if $dynamic_framework.include?(pod.name) def pod.build_type; Pod::BuildType.dynamic_framework end end end end ","date":"2016-11-21","objectID":"/cocoapods_tips/:12:0","tags":["iOS","cocoaPods","tips"],"title":"CocoaPodsç¬”è®°","uri":"/cocoapods_tips/"},{"categories":["Tips"],"content":"13ã€ä½¿ç”¨Rubyå¿«é€Ÿè®¾ç½®å¤´æ–‡ä»¶ https://github.com/mxcl/PromiseKit/blob/6.15.3/PromiseKit.podspec s.subspec 'CorePromise' do |ss| hh = Dir['Sources/*.h'] - Dir['Sources/*+Private.h'] cc = Dir['Sources/*.swift'] - ['Sources/SwiftPM.swift'] cc \u003c\u003c 'Sources/{after,AnyPromise,GlobalState,dispatch_promise,hang,join,PMKPromise,when,race}.m' cc += hh ss.source_files = cc ss.public_header_files = hh ss.preserve_paths = 'Sources/AnyPromise+Private.h', 'Sources/PMKCallVariadicBlock.m', 'Sources/NSMethodSignatureForBlock.m' end ","date":"2016-11-21","objectID":"/cocoapods_tips/:13:0","tags":["iOS","cocoaPods","tips"],"title":"CocoaPodsç¬”è®°","uri":"/cocoapods_tips/"},{"categories":["Tips"],"content":"å‚è€ƒï¼š podspec è¯­æ³•æŒ‡å— podfile è¯­æ³•æŒ‡å— å¼€å¯ Cocoapods æ–°é€‰é¡¹ï¼ŒåŠ å¿«é¡¹ç›®ç´¢å¼•é€Ÿåº¦ Flipper ","date":"2016-11-21","objectID":"/cocoapods_tips/:13:1","tags":["iOS","cocoaPods","tips"],"title":"CocoaPodsç¬”è®°","uri":"/cocoapods_tips/"},{"categories":["å®ç°åŸç†"],"content":"ç®€æ`ReactiveCocoa`ä¸­çš„å‡ ä¸ªå‡½æ•°","date":"2016-10-01","objectID":"/reactivecocoa%E9%83%A8%E5%88%86%E7%AE%80%E6%9E%90/","tags":["iOS","reactive"],"title":"ReactiveCocoaéƒ¨åˆ†ç®€æ","uri":"/reactivecocoa%E9%83%A8%E5%88%86%E7%AE%80%E6%9E%90/"},{"categories":["å®ç°åŸç†"],"content":"ç®€æReactiveCocoaä¸­çš„å‡ ä¸ªå‡½æ•° ","date":"2016-10-01","objectID":"/reactivecocoa%E9%83%A8%E5%88%86%E7%AE%80%E6%9E%90/:0:0","tags":["iOS","reactive"],"title":"ReactiveCocoaéƒ¨åˆ†ç®€æ","uri":"/reactivecocoa%E9%83%A8%E5%88%86%E7%AE%80%E6%9E%90/"},{"categories":["å®ç°åŸç†"],"content":"flattenMap ä¸ map æ¨èæ–‡ç« ï¼š RAC æ ¸å¿ƒå…ƒç´ ä¸ä¿¡å·æµ ç»†è¯´ ReactiveCocoa çš„å†·ä¿¡å·ä¸çƒ­ä¿¡å·ï¼ˆä¸‰ï¼‰ï¼šæ€ä¹ˆå¤„ç†å†·ä¿¡å·ä¸çƒ­ä¿¡å· map å’Œ flatten æ˜¯åŸºäº flattenMap, è€Œ flattenMap æ˜¯åŸºäº bind:, æ‰€ä»¥åœ¨æ­¤ä¹‹å‰å…ˆæ¥çœ‹çœ‹ bind å‡½æ•°ã€‚ å…·ä½“æ¥çœ‹æºç ï¼ˆä¸ºæ–¹ä¾¿ç†è§£ï¼Œå»æ‰äº†æºä»£ç ä¸­ RACDisposable, @synchronized, @autoreleasepool ç›¸å…³ä»£ç  )ã€‚å½“æ–°ä¿¡å· N è¢«å¤–éƒ¨è®¢é˜…æ—¶ï¼Œä¼šè¿›å…¥ä¿¡å· N çš„ didSubscribeBlock (1)ï¼Œä¹‹åè®¢é˜…åŸä¿¡å· O (2)ï¼Œå½“åŸä¿¡å· O æœ‰å€¼è¾“å‡ºåå°±ç”¨ bind å‡½æ•°ä¼ å…¥çš„ bindBlock å°†å…¶å˜æ¢æˆä¸­é—´ä¿¡å· M (3), å¹¶é©¬ä¸Šå¯¹å…¶è¿›è¡Œè®¢é˜… (4)ï¼Œæœ€åå°†ä¸­é—´ä¿¡å· M çš„è¾“å‡ºä½œä¸ºæ–°ä¿¡å· N çš„è¾“å‡º (5)ã€‚å³ï¼šå½“æ–°ç”Ÿæˆçš„ä¿¡å·è¢«è®¢é˜…æ—¶ï¼Œæºä¿¡å·ä¹Ÿä¼šç«‹å³è¢«è®¢é˜…ã€‚ - (RACSignal *)bind:(RACStreamBindBlock (^)(void))block { return [RACSignal createSignal:^(id\u003cRACSubscriber\u003e subscriber) {// (1) RACStreamBindBlock bindingBlock = block(); // (MARK: æ­¤å¤„æ‰§è¡Œ block å›è°ƒ, ç”Ÿæˆä¸€ä¸ª bindingBlock) [self subscribeNext:^(id x) {// (2) BOOL stop = NO; id middleSignal = bindingBlock(x, \u0026stop); // (3) map ä¸ flatten ç»“æœä¸åŒï¼Œé—®é¢˜å°±å‡ºåœ¨è¿™é‡Œ if (middleSignal != nil) { RACDisposable *disposable = [middleSignal subscribeNext:^(id x) {// (4) [subscriber sendNext:x]; // (5) } error:^(NSError *error) { [subscriber sendError:error]; } completed:^{ [subscriber sendCompleted]; }]; } } error:^(NSError *error) { [subscriber sendError:error]; } completed:^{ [subscriber sendCompleted]; }]; return nil }]; } flattenMap å…¶å®å°±æ˜¯å¯¹ bind: æ–¹æ³•è¿›è¡Œäº†ä¸€äº›å®‰å…¨æ£€æŸ¥ï¼Œå®ƒæœ€ç»ˆè¿”å›çš„æ˜¯ bindBlock æ‰§è¡Œåç”Ÿæˆçš„é‚£ä¸ªä¸­é—´ signal åˆè¢«è®¢é˜…åä¼ é€’å‡ºçš„å€¼çš„ä¿¡å·ï¼Œè€Œ map æ–¹æ³•è¿”å›çš„æ˜¯ bindBlock çš„æ‰§è¡Œç»“æœç”Ÿæˆçš„é‚£ä¸ªä¿¡å·ï¼Œæ²¡æœ‰å†åŠ å·¥å¤„ç†ï¼ˆå³è¢«è®¢é˜…ï¼Œå†å‘é€å€¼ï¼‰ - (instancetype)flattenMap:(RACStream * (^)(id value))block { Class class = self.class; return [[self bind:^{ /// @return è¿”å›çš„æ˜¯ RACStreamBindBlock /// @discussion /// /// è·Ÿ `bindï¼š` æ–¹æ³•ä¸­çš„ä»£ç å¯¹åº”èµ·æ¥å¦‚ä¸‹ï¼š /// BOOL stop = NO; /// id middleSignal = bindingBlock(x, \u0026stop); /// /// ä¸ä¸Šé¢ `bind:` å‡½æ•°ä¸­çš„ (3) å¯¹åº”èµ·æ¥, /// å¯ä»¥çœ‹å‡º bindBlock ä¸­çš„ x æ˜¯åŸä¿¡å·è¢« subscribe åä¼ å‡ºçš„å€¼ï¼Œå³å¯¹åº”ä¸‹é¢çš„ value /// ä¹Ÿå³ flattenMap block ä¸­æ‰§è¡Œåä¼ å‡ºçš„å€¼ï¼Œ /// å³ä¸Šé¢çš„ (RACStream * (^ block)(id value)) ä¸­çš„ value /// flattenMap: åçš„é‚£ä¸ª block å…¶å®ä¸ bind: åçš„ block åŸºæœ¬æ˜¯ä¸€æ ·çš„ï¼Œå‚æ•°éƒ½æ˜¯åŸä¿¡å·å‘å‡ºçš„å€¼ï¼Œè¿”å›å€¼éƒ½æ˜¯ RACStreamï¼Œå·®åˆ«å°±æ˜¯ä¸€ä¸ª bool å‚æ•°ï¼Œæ‰€ä»¥è¯´ï¼ŒflattenMap å…¶å®å°±æ˜¯å¯¹ bind æ–¹æ³•è¿›è¡Œäº†ä¸€äº›å®‰å…¨æ£€æŸ¥ /// ç»¼ä¸Šæ‰€è¿°ï¼š*flattenMap æ–¹æ³•ä¸­ä¼ è¿›æ¥çš„é‚£ä¸ª block å‚æ•°å€¼å°±æ˜¯åŸä¿¡å·è¢«è®¢é˜…åå‘é€çš„å€¼* return ^(id value, BOOL *stop) { // ä¸‹é¢è¿™ä¸ª value å¹¶ä¸æ˜¯ flattenMap åé¢ block ä¸­çš„é‚£ä¸ª valueï¼ˆåŸä¿¡å·è¢«è®¢é˜…åå‘å‡ºå»çš„å€¼ï¼‰ï¼Œè€Œæ˜¯åŸä¿¡å·å‘å‡ºçš„å€¼è¢«è½¬æ¢ä¸ºä¸­é—´ä¿¡å·åï¼Œåˆè¢«è®¢é˜…åå‘å‡ºå»çš„å€¼ã€‚ id stream = block(value) ?: [class empty]; NSCAssert([stream isKindOfClass:RACStream.class], @\"Value returned from -flattenMap: is not a stream: %@\", stream); return stream; }; }] setNameWithFormat:@\"[%@] -flattenMap:\", self.name]; } map: ä¸‹é¢æ˜¯ map æ–¹æ³•çš„æºç ï¼Œå¯ä»¥çœ‹å‡ºï¼Œmap åªæ˜¯å¯¹ flattenMap ä¼ å‡ºçš„ vaueï¼ˆå³åŸä¿¡å·ä¼ å‡ºçš„å€¼ï¼‰è¿›è¡Œäº† mapBlock æ“ä½œï¼Œå¹¶æ²¡æœ‰å†è¿›è¡Œè®¢é˜…æ“ä½œï¼Œå³å¹¶ä¸åƒ bindï¼š ä¸€æ ·å†æ¬¡å¯¹åŸä¿¡å·è¿›è¡Œ bindBlock åç”Ÿæˆçš„ä¸­é—´ä¿¡å·è¿›è¡Œè®¢é˜…ã€‚ - (instancetype)map:(id (^)(id value))block { NSCParameterAssert(block != nil); Class class = self.class; return [[self flattenMap:^(id value) { return [class return:block(value)]; }] setNameWithFormat:@\"[%@] -map:\", self.name]; } flatten: è¯¥æ“ä½œä¸»è¦ä½œç”¨äºä¿¡å·çš„ä¿¡å·ã€‚åŸä¿¡å· O ä½œä¸ºä¿¡å·çš„ä¿¡å·ï¼Œåœ¨è¢«è®¢é˜…æ—¶è¾“å‡ºçš„æ•°æ®å¿…ç„¶ä¹Ÿæ˜¯ä¸ªä¿¡å· (signalValue)ï¼Œè¿™å¾€å¾€ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ã€‚å½“æˆ‘ä»¬æ‰§è¡Œ [O flatten] æ“ä½œæ—¶ï¼Œå› ä¸º flatten å†…éƒ¨è°ƒç”¨äº† flattenMap (1)ï¼ŒflattenMap é‡Œå¯¹åº”çš„ä¸­é—´ä¿¡å·å°±æ˜¯åŸä¿¡å· O è¾“å‡ºçš„ signalValue (2)ã€‚æŒ‰ç…§ä¹‹å‰åˆ†æçš„ç»éªŒï¼Œåœ¨ flattenMap æ“ä½œä¸­æ–°ä¿¡å· N è¾“å‡ºçš„ç»“æœå°±æ˜¯å„ä¸­é—´ä¿¡å· M è¾“å‡ºçš„é›†åˆã€‚å› æ­¤åœ¨ flatten æ“ä½œä¸­æ–°ä¿¡å· N è¢«è®¢é˜…æ—¶è¾“å‡ºçš„å€¼å°±æ˜¯åŸä¿¡å· O çš„å„ä¸ªå­ä¿¡å·è¾“å‡ºå€¼çš„é›†åˆã€‚ - (instancetype)flatten { return [self flattenMap:^(RACSignal *signalValue) {// (1) /// è¿”å›å€¼ä½œä¸º bind: ä¸­çš„ä¸­é—´ä¿¡å· return signalValue; // (2) }; } å°ç»“ï¼š flatten ä¸ map ä¹‹é—´çš„åŒºåˆ«ï¼šflatten å’Œ map åé¢çš„ block è¿”å›ç»“æœå…¶å®æœ€ç»ˆéƒ½ä¼šå˜ä¸º bind: æ–¹æ³•ä¸­çš„ä¸­é—´ä¿¡å·ï¼Œä½†æ˜¯ flatten: çš„ block æ˜¯ç›´æ¥æŠŠåŸä¿¡å·å‘å‡ºçš„å€¼è¿”å›æ¥ä½œä¸ºä¸­é—´ä¿¡å·çš„ï¼Œæ‰€ä»¥ä¸­é—´ä¿¡å·è¢«è®¢é˜…ï¼Œå…¶å®å°±æ˜¯åŸä¿¡å·å‘å‡ºçš„å€¼åˆè¢«è®¢é˜…ï¼Œè¿™ä¹Ÿå°±æ˜¯ flatten: èƒ½æ‹¿åˆ°ä¿¡å·ä¸­çš„ä¿¡å·ä¸­çš„å€¼çš„åŸå› ã€‚ è€Œ map: åé¢çš„ block æ˜¯æŠŠåŸä¿¡å·å‘å‡ºçš„å€¼åŠ å·¥å¤„ç†äº†çš„ï¼Œåˆç”Ÿæˆäº†ä¸€ä¸ªæ–°çš„ä¿¡å·ï¼Œå³ map: æ–¹æ³• block è¿”å›çš„ä¸­é—´ä¿¡å·å·²ç»ä¸æ˜¯åŸæ¥çš„ä¿¡å·ä¸­çš„ä¿¡å·äº†ï¼Œè€Œæ˜¯æŠŠåŸä¿¡å·å‘å‡ºçš„å€¼ä½œä¸ºå®ƒçš„åŒ…å«å€¼çš„ä¸€ä¸ªæ–°çš„ä¿¡å·ï¼Œå®ƒè¢«è®¢é˜…æ—¶ï¼Œå‘é€çš„æ˜¯åŸä¿¡å·å‘å‡ºçš„é‚£ä¸ªå€¼ï¼Œè¿™å°±æ˜¯ map æ‹¿ä¸åˆ°åŸä¿¡å·ä¸­çš„ä¿¡å·çš„åŸå› ã€‚ è¯´ç™½äº†å°±æ˜¯ flatten: æ“ä½œçš„å§‹ç»ˆæ˜¯åŸæ¥çš„ä¿¡å·ï¼Œè€Œ map: ä¼šç”Ÿæˆä¸€ä¸ªåŒ…å«åŸä¿¡å·å‘é€å€¼çš„æ–°ä¿¡å·ã€‚ ","date":"2016-10-01","objectID":"/reactivecocoa%E9%83%A8%E5%88%86%E7%AE%80%E6%9E%90/:1:0","tags":["iOS","reactive"],"title":"ReactiveCocoaéƒ¨åˆ†ç®€æ","uri":"/reactivecocoa%E9%83%A8%E5%88%86%E7%AE%80%E6%9E%90/"},{"categories":["å®ç°åŸç†"],"content":"multicast - (RACMulticastConnection *)multicast:(RACSubject *)subject; å½“ RACSignal ç±»çš„å®ä¾‹è°ƒç”¨ - (RACMulticastConnection *)multicast:(RACSubject *)subject æ—¶ï¼Œä»¥ self å’Œ subject ä½œä¸ºæ„é€ å‚æ•°åˆ›å»ºä¸€ä¸ª RACMulticastConnection å®ä¾‹ã€‚ RACMulticastConnection æ„é€ çš„æ—¶å€™ï¼Œä¿å­˜ source å’Œ subject ä½œä¸ºæˆå‘˜å˜é‡ï¼Œåˆ›å»ºä¸€ä¸ª RACSerialDisposable å¯¹è±¡ï¼Œç”¨äºå–æ¶ˆè®¢é˜…ã€‚ å½“ RACMulticastConnection ç±»çš„å®ä¾‹è°ƒç”¨ - (RACDisposable *)connect è¿™ä¸ªæ–¹æ³•çš„æ—¶å€™ï¼Œåˆ¤æ–­æ˜¯å¦æ˜¯ç¬¬ä¸€æ¬¡ã€‚å¦‚æœæ˜¯çš„è¯ ç”¨ _signal è¿™ä¸ªæˆå‘˜å˜é‡ï¼ˆRACSubject ç±»å‹ï¼‰æ¥è®¢é˜… sourceSignalï¼Œ ä¹‹åè¿”å› self.serialDisposableï¼Œå¦åˆ™ç›´æ¥è¿”å› self.serialDisposable ã€‚ RACMulticastConnection çš„ signal åªè¯»å±æ€§ï¼Œå°±æ˜¯ä¸€ä¸ªçƒ­ä¿¡å·ï¼Œè®¢é˜…è¿™ä¸ªçƒ­ä¿¡å·å°±é¿å…äº†å„ç§å‰¯ä½œç”¨çš„é—®é¢˜ã€‚å®ƒä¼šåœ¨ - (RACDisposable *)connect ç¬¬ä¸€æ¬¡è°ƒç”¨åï¼Œæ ¹æ® sourceSignal çš„è®¢é˜…ç»“æœæ¥ä¼ é€’äº‹ä»¶ã€‚ æƒ³è¦ç¡®ä¿ç¬¬ä¸€æ¬¡è®¢é˜…å°±èƒ½æˆåŠŸè®¢é˜… sourceSignal ï¼Œå¯ä»¥ä½¿ç”¨ - (RACSignal *)autoconnect è¿™ä¸ªæ–¹æ³•ï¼Œå®ƒä¿è¯äº†ç¬¬ä¸€ä¸ªè®¢é˜…è€…è§¦å‘ sourceSignal çš„è®¢é˜…ï¼Œä¹Ÿä¿è¯äº†å½“è¿”å›çš„ä¿¡å·æ‰€æœ‰è®¢é˜…è€…éƒ½å…³é—­è¿æ¥å sourceSignal è¢«æ­£ç¡®å…³é—­è¿æ¥ã€‚ è¿™é‡Œé¢è®¢é˜… sourceSignal æ˜¯é‡ç‚¹ï¼Œ_signal æ˜¯ä¸€ä¸ª RACSubject ç±»å‹ï¼Œå®ƒé‡Œé¢ç»´æŠ¤ç€ä¸€ä¸ªå¯å˜æ•°ç»„ï¼Œæ¯å½“å®ƒè¢«è®¢é˜…æ—¶ï¼Œä¼šæŠŠæ‰€æœ‰çš„è®¢é˜…è€…ä¿å­˜åˆ°è¿™ä¸ªæ•°ç»„ä¸­ã€‚å½“ connection.signalï¼ˆå³ _signalï¼‰è¢«è®¢é˜…æ—¶ï¼Œå…¶å®æ˜¯ _signal è¢«è®¢é˜…äº†ã€‚ç”±äº _signal æ˜¯ RACSubject ç±»å‹å¯¹è±¡ï¼Œä¸” _signal ä¹Ÿæ˜¯ä¿¡å·ï¼Œå®ƒé‡Œé¢é‡å†™äº†è®¢é˜…æ–¹æ³•ï¼Œæ‰€ä»¥ä¼šæ‰§è¡Œå®ƒè‡ªå·±çš„ subscribe: æ–¹æ³•ï¼Œæ‰§è¡Œæ­¤æ–¹æ³•ä¹‹å‰è®¢é˜…è€…å‚æ•°æ˜¯ RACSubscriber ç±»å‹ï¼Œä½†æ˜¯åœ¨è¿™ä¸ª subscribe æ–¹æ³•ä¸­ï¼Œåˆå§‹åŒ–äº†ä¸€ä¸ª RACPassthroughSubscriber å®ä¾‹å¯¹è±¡ï¼Œä½¿å®ƒä½œä¸ºæ–°çš„è®¢é˜…è€…ï¼ˆå…¶å®å°±æ˜¯å¯¹è®¢é˜…è€…è¿›è¡Œäº†ä¸€å±‚åŒ…è£…ï¼‰ï¼Œå¹¶æŠŠå®ƒå­˜å…¥äº† subject ç»´æŠ¤çš„é‚£ä¸ªè®¢é˜…è€…æ•°ç»„é‡Œï¼ˆåŸæ¥çš„ è®¢é˜…è€… å’Œ ä¿¡å· è¢« RACPassthroughSubscriber å®ä¾‹ä¿å­˜äº†ï¼‰ï¼Œæ‰€ä»¥æ•°ç»„ä¸­æœ€ç»ˆä¿å­˜çš„æ˜¯ RACPassthroughSubscriber ç±»å‹çš„è®¢é˜…è€…ï¼Œç„¶åå®ƒå‘é€æ¶ˆæ¯çš„æ—¶å€™è°ƒçš„è¿˜æ˜¯å®ƒæŒæœ‰çš„ subject å¯¹è±¡è¿›è¡Œå‘é€æ¶ˆæ¯ã€‚ å½“ RACMulticastConnection è°ƒç”¨ connect æ–¹æ³•æ—¶ï¼Œæºä¿¡å· sourceSignal è¢« _signal è®¢é˜…ï¼Œå³æ‰§è¡Œ [sourceSignal subscribe:subject] æ–¹æ³•ï¼Œç„¶åæ‰§è¡Œè®¢é˜… subscribeNext:block å›è°ƒï¼Œåœ¨å›è°ƒä¸­æ‰§è¡Œ sendNext:ï¼Œç”±äºè®¢é˜…è€…æ˜¯ RACSubject ç±»å‹çš„å®ä¾‹å¯¹è±¡ï¼Œå®ƒé‡Œé¢ä¹Ÿä¼šæ‰§è¡Œ sendNext: æ–¹æ³•ï¼Œæ­¤æ–¹æ³•ä¸­ä¼šéå†å®ƒçš„æ•°ç»„ä¸­çš„è®¢é˜…è€…ä¾æ¬¡å‘é€æ¶ˆæ¯ã€‚ connect æ—¶è®¢é˜…è€…æ˜¯ RACSubject å‘é€çš„ sendNext:ï¼Œsubject ä¼šæ‹¿åˆ°å®ƒé‚£ä¸ªè®¢é˜…è€…æ•°ç»„éå†ï¼Œå–å‡ºå…¶ä¸­çš„ RACPassthroughSubscriber å¯¹è±¡ï¼Œç„¶åç”¨ RACPassthroughSubscriber å¯¹è±¡ä¸­çš„çœŸå®çš„è®¢é˜…è€…å»å‘é€æ•°æ®ã€‚ ","date":"2016-10-01","objectID":"/reactivecocoa%E9%83%A8%E5%88%86%E7%AE%80%E6%9E%90/:2:0","tags":["iOS","reactive"],"title":"ReactiveCocoaéƒ¨åˆ†ç®€æ","uri":"/reactivecocoa%E9%83%A8%E5%88%86%E7%AE%80%E6%9E%90/"},{"categories":["å®ç°åŸç†"],"content":"RACCommand ç›´æ¥ä¸Šæºç : - (id)initWithEnabled:(RACSignal *)enabledSignal signalBlock:(RACSignal * (^)(id input))signalBlock { NSCParameterAssert(signalBlock != nil); self = [super init]; if (self == nil) return nil; _activeExecutionSignals = [[NSMutableArray alloc] init]; _signalBlock = [signalBlock copy]; // ç›‘å¬ `activeExecutionSignals` æ•°ç»„ RACSignal *newActiveExecutionSignals = [[[[[self rac_valuesAndChangesForKeyPath:@keypath(self.activeExecutionSignals) options:NSKeyValueObservingOptionNew observer:nil] reduceEach:^(id _, NSDictionary *change) { NSArray *signals = change[NSKeyValueChangeNewKey]; if (signals == nil) { return [RACSignal empty]; } // æŠŠæ•°ç»„è½¬æ¢ä¸ºä¿¡å·å‘é€å‡ºå» return [signals.rac_sequence signalWithScheduler:RACScheduler.immediateScheduler]; }] concat] // æŠŠå„ä¸ªä¿¡å·ä¸­çš„ä¿¡å·è¿æ¥èµ·æ¥ publish] // å¹¿æ’­å‡ºå»ï¼Œå¯ä»¥è¢«å¤šä¸ªè®¢é˜…è€…è®¢é˜… autoconnect]; // æœ‰è®¢é˜…äº†å†å‘é€å¹¿æ’­ // æŠŠä¸Šé¢çš„ä¿¡å· `map` ä¸€ä¸‹, å½“å‡ºç°é”™è¯¯çš„æ—¶å€™è½¬æ¢æˆ `empty` ç©ºä¿¡å·, å¹¶åœ¨ä¸»çº¿ç¨‹ä¸Šä¼ é€’ _executionSignals = [[[newActiveExecutionSignals map:^(RACSignal *signal) { return [signal catchTo:[RACSignal empty]]; }] deliverOn:RACScheduler.mainThreadScheduler] setNameWithFormat:@\"%@ -executionSignals\", self]; // å…ˆé€šè¿‡ `ignoreValues` æ–¹æ³•å±è”½æ‰ `sendNext:` çš„ç»“æœï¼Œåªä¿ç•™ `sendError:` å’Œ `sendCompleted` ç»“æœï¼Œç„¶åå†é€šè¿‡ `catch:` æ–¹æ³•æ‹¿åˆ°æ‰€æœ‰çš„ `sendError:` ç»“æœï¼Œå‘é€ç»™è®¢é˜…è€…ã€‚ // æ­¤å¤„ç”¨çš„æ˜¯ `flattenMap`ï¼Œå¯ä»¥ç›´æ¥è·å–åˆ°é”™è¯¯ä¿¡æ¯ã€‚ RACMulticastConnection *errorsConnection = [[[newActiveExecutionSignals flattenMap:^(RACSignal *signal) { return [[signal ignoreValues] catch:^(NSError *error) { return [RACSignal return:error]; }]; }] deliverOn:RACScheduler.mainThreadScheduler] publish]; _errors = [errorsConnection.signal setNameWithFormat:@\"%@ -errors\", self]; [errorsConnection connect]; // æ ¹æ®æ‰§è¡Œä¿¡å·çš„æ•°é‡åˆ¤æ–­ `RACCommand` å½“å‰æ˜¯å¦æ­£åœ¨æ‰§è¡Œ RACSignal *immediateExecuting = [RACObserve(self, activeExecutionSignals) map:^(NSArray *activeSignals) { return @(activeSignals.count \u003e 0); }]; // æ˜¯å¦æ­£åœ¨æ‰§è¡Œ _executing = [[[[[immediateExecuting deliverOn:RACScheduler.mainThreadScheduler] // This is useful before the first value arrives on the main thread. startWith:@NO] distinctUntilChanged] replayLast] setNameWithFormat:@\"%@ -executing\", self]; // å¦‚æœå…è®¸å¹¶å‘æ‰§è¡Œï¼Œè¿”å› `YES`ï¼Œå¦åˆ™åè½¬ `immediateExecuting` ä¿¡å·çš„ç»“æœ RACSignal *moreExecutionsAllowed = [RACSignal if:RACObserve(self, allowsConcurrentExecution) then:[RACSignal return:@YES] else:[immediateExecuting not]]; if (enabledSignal == nil) { enabledSignal = [RACSignal return:@YES]; } else { enabledSignal = [[[enabledSignal startWith:@YES] takeUntil:self.rac_willDeallocSignal] replayLast]; } _immediateEnabled = [[RACSignal combineLatest:@[enabledSignal, moreExecutionsAllowed]] and]; _enabled = [[[[[self.immediateEnabled take:1] concat:[[self.immediateEnabled skip:1] deliverOn:RACScheduler.mainThreadScheduler]] distinctUntilChanged] replayLast] setNameWithFormat:@\"%@ -enabled\", self]; return self; } // ä½¿ç”¨æ—¶ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šå»ç”Ÿæˆä¸€ä¸ª RACCommand å¯¹è±¡ï¼Œå¹¶ä¼ å…¥ä¸€ä¸ªè¿”å› signal å¯¹è±¡çš„ blockã€‚æ¯æ¬¡ RACCommand execute æ‰§è¡Œæ“ä½œæ—¶ï¼Œéƒ½ä¼šé€šè¿‡ä¼ å…¥çš„è¿™ä¸ª signal block ç”Ÿæˆä¸€ä¸ªæ‰§è¡Œä¿¡å· E (1)ï¼Œå¹¶å°†è¯¥ä¿¡å·æ·»åŠ åˆ° RACCommand å†…éƒ¨ä¿¡å·æ•°ç»„ activeExecutionSignals ä¸­ (2)ï¼ŒåŒæ—¶å°†ä¿¡å· E ç”±å†·ä¿¡å·è½¬æˆçƒ­ä¿¡å· (3)ï¼Œæœ€åè®¢é˜…è¯¥çƒ­ä¿¡å· (4)ï¼Œå¹¶å°†å…¶è¿”å› (5)ã€‚ - (RACSignal *)execute:(id)input { RACSignal *signal = self.signalBlock(input); //ï¼ˆ1ï¼‰ RACMulticastConnection *connection = [[signal subscribeOn:RACScheduler.mainThreadScheduler] multicast:[RACReplaySubject subject]]; // (3) @weakify(self); [self addActiveExecutionSignal:connection.signal]; // (2) [connection.signal subscribeError:^(NSError *error) { @strongify(self); [self removeActiveExecutionSignal:connection.signal]; } completed:^{ @strongify(self); [self removeActiveExecutionSignal:connection.signal]; }]; [connection connect]; // (4) return [connection.signal]; // (5) } æ¥ä¸‹æ¥å†æ¥ç®€å•è¯´è¯´ RACCommand ä¸­ç”¨åˆ°çš„å‡ ä¸ªå‡½æ•° // ä»¥ä¸‹æ˜¯å¯¹ `allowsConcurrentExecution` å±æ€§çš„å¤„ç†æ–¹æ³•ï¼Œåˆ©ç”¨äº†å±æ€§çš„åŸå­æ€§ï¼Œé˜²æ­¢èµ„æºç«äº‰ï¼Œå€¼å¾—å­¦ä¹  @property (atomic, assign) BOOL allowsConcurrentExecution; @property (atomic, copy, readonly) NSArray *activeExecutionSignals; { // The mutable array backing `activeExecutionSignals`. // // This should only be used while synchronized on `self`. NSMutableArray *_activeExecutionSignals; // Atomic backing variable for `allowsConcurrentExecut","date":"2016-10-01","objectID":"/reactivecocoa%E9%83%A8%E5%88%86%E7%AE%80%E6%9E%90/:3:0","tags":["iOS","reactive"],"title":"ReactiveCocoaéƒ¨åˆ†ç®€æ","uri":"/reactivecocoa%E9%83%A8%E5%88%86%E7%AE%80%E6%9E%90/"},{"categories":["å®ç°åŸç†"],"content":"æ¨è FRPCheatSheeta ","date":"2016-10-01","objectID":"/reactivecocoa%E9%83%A8%E5%88%86%E7%AE%80%E6%9E%90/:4:0","tags":["iOS","reactive"],"title":"ReactiveCocoaéƒ¨åˆ†ç®€æ","uri":"/reactivecocoa%E9%83%A8%E5%88%86%E7%AE%80%E6%9E%90/"},{"categories":["å­¦ä¹ ç¬”è®°"],"content":"å‡½æ•° ç»“æ„ä½“å’Œæšä¸¾æ˜¯å€¼ç±»å‹ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œå€¼ç±»å‹çš„å±æ€§ä¸èƒ½åœ¨å®ƒçš„å®ä¾‹æ–¹æ³•ä¸­è¢«ä¿®æ”¹ï¼Œä½†æ˜¯å¦‚æœä½ ç¡®å®éœ€è¦åœ¨æŸä¸ªå…·ä½“çš„æ–¹æ³•ä¸­ä¿®æ”¹ç»“æ„ä½“æˆ–è€…æšä¸¾çš„å±æ€§ï¼Œå¯ä»¥åœ¨æ–¹æ³•funcå‰æ·»åŠ mutatingå…³é”®å­—ï¼Œç„¶åå°±å¯ä»¥ä¿®æ”¹å®ƒçš„å±æ€§äº†ï¼Œå¹¶ä¸”å®ƒåšçš„ä»»ä½•æ”¹å˜åœ¨æ–¹æ³•ç»“æŸæ—¶è¿˜ä¼šä¿ç•™åœ¨åŸå§‹ç»“æ„ä½“ä¸­ã€‚ æ–¹æ³•ä¸å‡½æ•°çš„åŒºåˆ«ï¼šæ–¹æ³•æ˜¯ä¸æŸäº›ç‰¹å®šç±»å‹ç›¸å…³è”çš„å‡½æ•°ï¼Œå³æ–¹æ³•å°±æ˜¯å‡½æ•°ï¼Œåªæ˜¯è¿™ä¸ªå‡½æ•°ä¸æŸä¸ªç±»å‹ç›¸å…³è”ç½¢äº†ã€‚ ","date":"2016-03-01","objectID":"/swift%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/:1:0","tags":["iOS","swift"],"title":"Swiftå­¦ä¹ ç¬”è®°","uri":"/swift%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"},{"categories":["å­¦ä¹ ç¬”è®°"],"content":"é—­åŒ… é—­åŒ…è¡¨è¾¾å¼è¯­æ³•ï¼š { (parameters) -\u003e returnType in statements //å‡½æ•°ä½“ } é—­åŒ…è¡¨è¾¾å¼å‚æ•°å¯ä»¥æ˜¯ in-out å‚æ•°ï¼Œä½†æ˜¯ä¸èƒ½è®¾ç½®é»˜è®¤å€¼ï¼›ä¹Ÿå¯ä»¥ä½¿ç”¨å…·åçš„å¯å˜å‚æ•°ï¼ˆè¯‘è€…æ³¨ï¼šå¯å˜å‚æ•°éœ€è¦æ”¾åœ¨å‚æ•°åˆ—è¡¨æœ€åï¼Œå› ä¸ºå¦‚æœå¯å˜å‚æ•°ä¸æ”¾åœ¨å‚æ•°åˆ—è¡¨çš„æœ€åä¸€ä½çš„è¯ï¼Œè°ƒç”¨é—­åŒ…çš„æ—¶å€™ç¼–è¯‘å™¨å°†æŠ¥é”™ï¼‰ï¼›å…ƒç»„ä¹Ÿå¯ä»¥ä½œä¸ºå‚æ•°è¿”å›ã€‚ ç±»å‹æ¨æ–­ï¼šå› ä¸ºæ‰€æœ‰çš„ç±»å‹éƒ½å¯ä»¥è¢«æ­£ç¡®æ¨æ–­ï¼Œæ­¤æ—¶ï¼Œé—­åŒ…ä¸­çš„è¿”å›ç®­å¤´ï¼ˆ-\u003eï¼‰å’Œå›´ç»•åœ¨å‚æ•°å‘¨å›´çš„æ‹¬å·å¯ä»¥è¢«çœç•¥: reversedName = names.sorted(by: { s1, s2 in return s1 \u003e s2 }) å•è¡¨è¾¾å¼é—­åŒ…éšå¼è¿”å›(é—­åŒ…éšå¼è¿”å›å•è¡Œè¡¨è¾¾å¼)ï¼šå•è¡Œè¡¨è¾¾å¼å¯ä»¥é€šè¿‡çœç•¥returnå…³é”®å­—æ¥éšå¼è¿”å›å½“è¡Œè¡¨è¾¾å¼çš„ç»“æœï¼Œå¦‚sortå‡½æ•°çš„ä¾‹å­å¯ä»¥æ”¹å†™ä¸º: reversedName = names.sorted(by: { s1, s2 in s1 \u003e s2 }) å‚æ•°åç§°ç¼©å†™ï¼šå¦‚æœä½ åœ¨é—­åŒ…è¡¨è¾¾å¼ä¸­ä½¿ç”¨å‚æ•°åç§°ç¼©å†™ï¼Œé‚£ä¹ˆä½ å¯ä»¥åœ¨é—­åŒ…å®šä¹‰ä¸­çœç•¥å‚æ•°åˆ—è¡¨ï¼Œå¹¶ä¸”å¯¹åº”å‚æ•°åç§°ç¼©å†™çš„ç±»å‹ä¼šé€šè¿‡å‚æ•°ç±»å‹è‡ªè¡Œè¿›è¡Œæ¨æ–­å‡ºæ¥ã€‚inå…³é”®å­—ä¹ŸåŒæ ·å¯ä»¥è¢«çœç•¥ï¼Œå› ä¸ºæ­¤æ—¶é—­åŒ…è¡¨è¾¾å¼å®Œå…¨ç”±é—­åŒ…å‡½æ•°ä½“æ„æˆï¼š reversedName = names.sorted(by: { $0 \u003e $1 }) è¿ç®—ç¬¦æ–¹æ³•ï¼šSwiftçš„Stringç±»å‹å®šä¹‰äº†å…³äºå¤§äºå·\u003eçš„å­—ç¬¦ä¸²å®ç°ï¼Œå…¶ä½œä¸ºä¸€ä¸ªå‡½æ•°æ¥å—ä¸¤ä¸ªStringç±»å‹çš„å‚æ•°å¹¶è¿”å›Boolç±»å‹çš„å€¼ï¼š reversedName = names.sorted(by: \u003e ) å°¾éšé—­åŒ…ï¼šå¦‚æœä½ éœ€è¦å°†ä¸€ä¸ªå¾ˆé•¿çš„é—­åŒ…è¡¨è¾¾å¼ä½œä¸ºæœ€åä¸€ä¸ªå‚æ•°ä¼ é€’ç»™å‡½æ•°æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ å°¾éšé—­åŒ… æ¥å¢å¼ºå‡½æ•°å¯è¯»æ€§ã€‚ å°¾éšé—­åŒ…æ˜¯ä¸€ä¸ªä¹¦å†™åœ¨å‡½æ•°æ‹¬å·ä¹‹åçš„é—­åŒ…è¡¨è¾¾å¼ï¼Œå‡½æ•°æ”¯æŒå°†å…¶ä½œä¸ºæœ€åä¸€ä¸ªå‚æ•°è°ƒç”¨ï¼Œåœ¨ä½¿ç”¨å°¾éšé—­åŒ…æ—¶ï¼Œä½ ä¸ç”¨å†™å‡ºä»–çš„å‚æ•°æ ‡ç­¾ï¼š func someFunctionThatTakesAClosure(closure: () -\u003e Void) { // å‡½æ•°ä½“éƒ¨åˆ† } // ä»¥ä¸‹æ˜¯æ²¡æœ‰ç”¨å°¾éšé—­åŒ…è¿›è¡Œå‡½æ•°è°ƒç”¨ someFunctionThatTakesAClosure(closure: { // é—­åŒ…ä¸»ä½“éƒ¨åˆ† }) // ä»¥ä¸‹æ˜¯ä½¿ç”¨å°¾éšé—­åŒ…è¿›è¡Œå‡½æ•°è°ƒç”¨ï¼Œçœç•¥æ‰äº†å‚æ•°æ ‡ç­¾ `closure` someFunctionThatTakesAClosure() { // é—­åŒ…ä¸»ä½“éƒ¨åˆ† } æ‰€ä»¥sorted(by:)æ–¹æ³•çš„å‚æ•°å­—ç¬¦ä¸²æ’åºé—­åŒ…å¯ä»¥æ”¹å†™ä¸ºï¼š reversedName = names.sorted() { $0 \u003e $1 } å¦‚æœé—­åŒ…è¡¨è¾¾å¼æ˜¯å‡½æ•°æˆ–è€…æ–¹æ³•çš„å”¯ä¸€å‚æ•°ï¼Œåˆ™å½“ä½ ä½¿ç”¨å°¾éšé—­åŒ…æ—¶ï¼Œç”šè‡³å¯ä»¥æŠŠ()çœç•¥æ‰ï¼š // å»æ‰å°æ‹¬å· reversedName = names.sorted { $0 \u003e $1 } å½“ä¸€ä¸ªé—­åŒ…ä½œä¸ºå‚æ•°ä¼ åˆ°ä¸€ä¸ªå‡½æ•°ä¸­ï¼Œä½†æ˜¯è¿™ä¸ªé—­åŒ…åœ¨å‡½æ•°è¿”å›ä¹‹åæ‰è¢«æ‰§è¡Œï¼Œæˆ‘ä»¬ç§°è¯¥é—­åŒ…ä»å‡½æ•°ä¸­é€ƒé€¸ã€‚å½“ ä½ å®šä¹‰æ¥å—é—­åŒ…ä½œä¸ºå‚æ•°çš„å‡½æ•°æ—¶ï¼Œä½ å¯ä»¥åœ¨å‚æ•°åä¹‹å‰æ ‡æ³¨@escapingï¼Œç”¨æ¥æŒ‡æ˜è¿™ä¸ªé—­åŒ…æ˜¯å…è®¸â€œé€ƒé€¸â€å‡º è¿™ä¸ªå‡½æ•°çš„ã€‚å°†ä¸€ä¸ªé—­åŒ…æ ‡è®°ä¸º @escaping æ„å‘³ç€ä½ å¿…é¡»åœ¨é—­åŒ…ä¸­æ˜¾ç¤ºçš„å¼•ç”¨ self ã€‚ è‡ªåŠ¨é—­åŒ…ï¼š è‡ªåŠ¨é—­åŒ…æ˜¯ä¸€ç§è‡ªåŠ¨åˆ›å»ºçš„é—­åŒ…ï¼Œç”¨äºåŒ…è£…ä¼ é€’ç»™å‡½æ•°ä½œä¸ºå‚æ•°çš„è¡¨è¾¾å¼ã€‚è‡ªåŠ¨é—­åŒ…ä¸æ¥å—ä»»ä½•å‚æ•°(e.g. () -\u003e T )ï¼Œå½“å®ƒè¢«è°ƒç”¨çš„æ—¶å€™ï¼Œä¼šè¿”å›è¢«åŒ…è£…åœ¨å…¶ä¸­çš„è¡¨è¾¾å¼çš„å€¼ï¼Œè¿™ç§ä¾¿åˆ©è¯­æ³•è®©ä½ èƒ½å¤Ÿçœç•¥é—­åŒ…çš„èŠ±æ‹¬å·ï¼Œç”¨ä¸€ä¸ªæ™®é€šçš„è¡¨è¾¾å¼ æ¥ä»£æ›¿æ˜¾å¼çš„é—­åŒ…ã€‚ // customersInLine is [\"Ewa\", \"Barry\", \"Daniella\"] func serve(customer customerProvider: @autoclosure () -\u003e String) { print(\"Now serving \\(customerProvider())!\") } serve(customer: customersInLine.remove(at: 0)) // æ‰“å° \"Now serving Ewa!\" @autoclosure å¹¶ä¸æ”¯æŒå¸¦æœ‰è¾“å…¥å‚æ•°çš„å†™æ³•ï¼Œä¹Ÿå°±æ˜¯è¯´åªæœ‰å½¢å¦‚ () -\u003e T çš„å‚æ•°æ‰èƒ½ç®€åŒ–ã€‚ é€šè¿‡å°†å‚æ•°æ ‡è®°ä¸º @autoclosure æ¥æ¥æ”¶ä¸€ä¸ªè‡ªåŠ¨é—­åŒ…ã€‚**ç°åœ¨ä½ å¯ä»¥å°†è¯¥å‡½æ•°å½“ä½œæ¥å— String ç±»å‹å‚æ•°ï¼ˆè€Œéé—­åŒ…ï¼‰ çš„å‡½æ•°æ¥è°ƒç”¨ï¼Œä¹Ÿå°±æ˜¯ä¸Šé¢çœ‹åˆ°çš„serve(customer: \"string\")ï¼Œå¯ä»¥ç›´æ¥ä¼ é€’å­—ç¬¦ä¸²å‚æ•°ï¼Œè€Œä¸æ˜¯é—­åŒ…æˆ–å‡½æ•°ï¼Œå› ä¸ºSwiftå°†ä¼šæŠŠå‚æ•° \"string\" è‡ªåŠ¨è½¬æ¢ä¸º () -\u003e Stringã€‚ customerProvider å‚æ•°å°†è‡ªåŠ¨è½¬åŒ–ä¸ºä¸€ä¸ªé—­åŒ…ï¼Œå› ä¸ºè¯¥å‚æ•°è¢«æ ‡è®°äº† @autoclosure ç‰¹æ€§ã€‚ @autoclosure å’Œ ?? @autoclosure what, why and when {}() : é€šè¿‡é—­åŒ…æˆ–å‡½æ•°è®¾ç½®å±æ€§çš„é»˜è®¤å€¼ï¼š å¦‚æœæŸä¸ªå­˜å‚¨å‹å±æ€§çš„é»˜è®¤å€¼éœ€è¦ä¸€äº›å®šåˆ¶æˆ–è®¾ç½®ï¼Œä½ å¯ä»¥ä½¿ç”¨é—­åŒ…æˆ–å…¨å±€å‡½æ•°ä¸ºå…¶æä¾›å®šåˆ¶çš„é»˜è®¤å€¼ã€‚æ¯å½“æŸä¸ªå±æ€§æ‰€åœ¨ç±»å‹çš„æ–°å®ä¾‹è¢«åˆ›å»ºæ—¶ï¼Œå¯¹åº”çš„é—­åŒ…æˆ–å‡½æ•°ä¼šè¢«è°ƒç”¨ï¼Œè€Œå®ƒä»¬çš„è¿”å›å€¼ä¼šå½“åšé»˜è®¤å€¼èµ‹å€¼ç»™è¿™ä¸ªå±æ€§ã€‚ è¿™ç§ç±»å‹çš„é—­åŒ…æˆ–å‡½æ•°é€šå¸¸ä¼šåˆ›å»ºä¸€ä¸ªè·Ÿå±æ€§ç±»å‹ç›¸åŒçš„ä¸´æ—¶å˜é‡ï¼Œç„¶åä¿®æ”¹å®ƒçš„å€¼ä»¥æ»¡è¶³é¢„æœŸçš„åˆå§‹çŠ¶æ€ï¼Œæœ€ åè¿”å›è¿™ä¸ªä¸´æ—¶å˜é‡ï¼Œä½œä¸ºå±æ€§çš„é»˜è®¤å€¼ã€‚ class SomeClass { let someProperty: SomeType = { // åœ¨è¿™ä¸ªé—­åŒ…ä¸­ç»™ someProperty åˆ›å»ºä¸€ä¸ªé»˜è®¤å€¼ // someValue å¿…é¡»å’Œ SomeType ç±»å‹ç›¸åŒ return someValue }() } æ³¨æ„ æ³¨æ„é—­åŒ…ç»“å°¾çš„å¤§æ‹¬å·åé¢æ¥äº†ä¸€å¯¹ç©ºçš„å°æ‹¬å·ã€‚è¿™ç”¨æ¥å‘Šè¯‰ Swift ç«‹å³æ‰§è¡Œæ­¤é—­åŒ…ã€‚å¦‚æœä½ å¿½ç•¥äº†è¿™å¯¹æ‹¬ å·ï¼Œç›¸å½“äºå°†é—­åŒ…æœ¬èº«ä½œä¸ºå€¼èµ‹å€¼ç»™äº†å±æ€§ï¼Œè€Œä¸æ˜¯å°†é—­åŒ…çš„è¿”å›å€¼èµ‹å€¼ç»™å±æ€§ã€‚ å¦‚æœä½ ä½¿ç”¨é—­åŒ…æ¥åˆå§‹åŒ–å±æ€§ï¼Œè¯·è®°ä½åœ¨é—­åŒ…æ‰§è¡Œæ—¶ï¼Œå®ä¾‹çš„å…¶å®ƒéƒ¨åˆ†éƒ½è¿˜æ²¡æœ‰åˆå§‹åŒ–ã€‚è¿™æ„å‘³ç€ä½ ä¸èƒ½åœ¨é—­åŒ… é‡Œè®¿é—®å…¶å®ƒå±æ€§ï¼Œå³ä½¿è¿™äº›å±æ€§æœ‰é»˜è®¤å€¼ã€‚åŒæ ·ï¼Œä½ ä¹Ÿä¸èƒ½ä½¿ç”¨éšå¼çš„ self å±æ€§ï¼Œæˆ–è€…è°ƒç”¨ä»»ä½•å®ä¾‹æ–¹æ³•ã€‚ ","date":"2016-03-01","objectID":"/swift%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/:2:0","tags":["iOS","swift"],"title":"Swiftå­¦ä¹ ç¬”è®°","uri":"/swift%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"},{"categories":["å­¦ä¹ ç¬”è®°"],"content":"æšä¸¾ å…³è”å€¼ï¼š å¯ä»¥åœ¨å®šä¹‰Swiftæšä¸¾æ¥å­˜å‚¨ä»»æ„ç±»å‹çš„å…³è”å€¼ï¼Œæ¯ä¸ªæšä¸¾æˆå‘˜çš„å…³è”å€¼ç±»å‹å¯ä»¥å„ä¸ç›¸åŒï¼› enum Barcode { case upc(Int, Int, Int, Int) case qrCode(String) } åŸå§‹å€¼çš„éšå¼èµ‹å€¼ï¼š åœ¨ä½¿ç”¨åŸå§‹å€¼ä¸ºæ•´æ•°æˆ–è€…å­—ç¬¦ä¸²ç±»å‹çš„æšä¸¾æ—¶ï¼Œä¸éœ€è¦æ˜¾å¼åœ°ä¸ºæ¯ä¸€ä¸ªæšä¸¾æˆå‘˜è®¾ç½®åŸå§‹å€¼ï¼ŒSwift å°†ä¼šè‡ªåŠ¨ä¸º ä½ èµ‹å€¼ã€‚ä¾‹å¦‚ä½¿ç”¨æ•´æ•°ä½œä¸ºåŸå§‹å€¼æ—¶ï¼Œå…¶é»˜è®¤åŸå§‹å€¼ä¸º0ï¼Œç„¶åä¸€æ¬¡é€’å¢ï¼›å½“ä½¿ç”¨å­—ç¬¦ä¸²ä½œä¸ºæšä¸¾ç±»å‹çš„åŸå§‹å€¼æ—¶ï¼Œæ¯ä¸ªæšä¸¾æˆå‘˜çš„éšå¼åŸå§‹å€¼ä¸ºè¯¥æšä¸¾æˆå‘˜çš„åç§°ã€‚ ä½¿ç”¨æšä¸¾æˆå‘˜çš„rawValueå±æ€§å¯ä»¥è®¿é—®è¯¥æšä¸¾æˆå‘˜çš„åŸå§‹å€¼ã€‚ ä½¿ç”¨åŸå§‹å€¼åˆå§‹åŒ–æšä¸¾å®ä¾‹ï¼š å¦‚æœåœ¨å®šä¹‰æšä¸¾ç±»å‹çš„æ—¶å€™ä½¿ç”¨äº†åŸå§‹å€¼ï¼Œé‚£ä¹ˆå°†ä¼šè‡ªåŠ¨è·å¾—ä¸€ä¸ªåˆå§‹åŒ–æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•æ¥æ”¶ä¸€ä¸ªå«åšrawValueçš„å‚æ•°ï¼Œå‚æ•°ç±»å‹æä¸ºåŸå§‹å€¼ç±»å‹ï¼Œè¿”å›å€¼åˆ™æ˜¯æšä¸¾æˆå‘˜æˆ–nilã€‚å› ä¸ºå¹¶éæ‰€æœ‰çš„å€¼éƒ½èƒ½åŒ¹é…åˆ°æšä¸¾å€¼ï¼Œæ‰€ä»¥ï¼ŒåŸå§‹å€¼æ¬§è‚¡æ—©èµ·æ€»æ˜¯è¿”å›ä¸€ä¸ªå¯é€‰çš„æšä¸¾æˆå‘˜ã€‚ é€’å½’æšä¸¾ï¼š å¯ä»¥åœ¨æšä¸¾ç±»å‹å¼€å¤´åŠ ä¸Šindirectå…³é”®å­—æ¥è¡¨æ˜å®ƒçš„æ‰€æœ‰æˆå‘˜éƒ½æ˜¯å¯é€’å½’çš„ï¼› indirect enum ArithmeticExpression { case number(Int) case addition(ArithmeticExpression, ArithmeticExpression) case multiplication(ArithmeticExpression, ArithmeticExpression) } ","date":"2016-03-01","objectID":"/swift%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/:3:0","tags":["iOS","swift"],"title":"Swiftå­¦ä¹ ç¬”è®°","uri":"/swift%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"},{"categories":["å­¦ä¹ ç¬”è®°"],"content":"ç±» \u0026 ç»“æ„ä½“ Swiftå…è®¸ç›´æ¥è®¾ç½®ç»“æ„ä½“å±æ€§çš„å­å±æ€§ï¼› æ‰€æœ‰çš„ç»“æ„ä½“éƒ½æœ‰ä¸€ä¸ªè‡ªåŠ¨ç”Ÿæˆçš„æˆå‘˜é€ä¸€æ„é€ å™¨ï¼Œç”¨äºåˆå§‹åŒ–æ–°ç»“æ„ä½“å®ä¾‹ä¸­æˆå‘˜çš„å±æ€§ã€‚æ–°å®ä¾‹ä¸­å„ä¸ªå±æ€§çš„åˆå§‹å€¼å¯ä»¥é€šè¿‡å±æ€§çš„åç§°ä¼ é€’åˆ°æˆå‘˜é€ä¸€æ„é€ å™¨ä¸­ï¼š let vga = Resolution(width:640, height: 480) ä¸ç»“æ„ä½“ä¸åŒï¼Œç±»å®ä¾‹æ²¡æœ‰é»˜è®¤çš„æˆå‘˜é€ä¸€æ„é€ å™¨ã€‚ æ³¨æ„: ä»¥ä¸Šæ˜¯å¯¹å­—ç¬¦ä¸²ã€æ•°ç»„ã€å­—å…¸çš„â€œæ‹·è´â€è¡Œä¸ºçš„æè¿°ã€‚åœ¨ä½ çš„ä»£ç ä¸­ï¼Œæ‹·è´è¡Œä¸ºçœ‹èµ·æ¥ä¼¼ä¹æ€»ä¼šå‘ç”Ÿã€‚ç„¶è€Œï¼ŒSwift åœ¨å¹•ååªåœ¨ç»å¯¹å¿…è¦æ—¶æ‰æ‰§è¡Œå®é™…çš„æ‹·è´ã€‚Swift ç®¡ç†æ‰€æœ‰çš„å€¼æ‹·è´ä»¥ç¡®ä¿æ€§èƒ½æœ€ä¼˜åŒ–ï¼Œæ‰€ä»¥ä½ æ²¡å¿…è¦å»å› é¿èµ‹å€¼æ¥ä¿è¯æ€§èƒ½æœ€ä¼˜åŒ–ã€‚ ","date":"2016-03-01","objectID":"/swift%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/:4:0","tags":["iOS","swift"],"title":"Swiftå­¦ä¹ ç¬”è®°","uri":"/swift%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"},{"categories":["å­¦ä¹ ç¬”è®°"],"content":"å±æ€§ è®¡ç®—å±æ€§ä¸ç›´æ¥å­˜å‚¨å€¼ï¼Œè€Œæ˜¯æä¾›ä¸€ä¸ªgetterå’Œä¸€ä¸ªå¯é€‰çš„setteræ¥é—´æ¥è·å–å’Œè®¾ç½®å…¶ä»–å±æ€§æˆ–å˜é‡çš„å€¼ã€‚è®¡ç®—å±æ€§å¯ä»¥ç”¨äºç±»ã€ç»“æ„ä½“å’Œæšä¸¾ï¼Œè€Œå­˜å‚¨å±æ€§åªèƒ½ç”¨äºç±»å’Œç»“æ„ä½“ï¼Œä¸èƒ½ç”¨äºæšä¸¾ã€‚ å¸¸é‡ç»“æ„ä½“çš„å­˜å‚¨å±æ€§ï¼šå¦‚æœåˆ›å»ºäº†ä¸€ä¸ªç»“æ„ä½“çš„å®ä¾‹å¹¶å°†å…¶å¤åˆ¶ç»™ä¸€ä¸ªå¸¸é‡ï¼Œåˆ™æ— æ³•ä¿®æ”¹è¯¥å®ä¾‹çš„ä»»ä½•å±æ€§ï¼Œå³ä½¿æœ‰å±æ€§è¢«å£°æ˜æˆå˜é‡ä¹Ÿä¸è¡Œã€‚è¿™ç§è¡Œä¸ºæ˜¯ç”±äºç»“æ„ä½“å±äºå€¼ç±»å‹ï¼Œå½“å€¼ç±»å‹çš„å®ä¾‹è¢«å£°æ˜ä¸ºå¸¸é‡çš„æ—¶å€™ï¼Œå®ƒçš„æ‰€æœ‰å±æ€§ä¹Ÿå°±æˆäº†å¸¸é‡ã€‚å±äºå¼•ç”¨ç±»å‹çš„ç±»åˆ™ä¸ä¸€æ ·ï¼ŒæŠŠä¸€ä¸ªå¼•ç”¨ç±»å‹çš„å®ä¾‹èµ‹ç»™ä¸€ä¸ªå¸¸é‡åï¼Œä»ç„¶å¯ä»¥ä¿®æ”¹è¯¥å®ä¾‹çš„å˜é‡å±æ€§ã€‚ å»¶è¿Ÿå­˜å‚¨å±æ€§ï¼š åœ¨å±æ€§å£°æ˜å‰ä½¿ç”¨lazyæ¥æ ‡ç¤ºä¸€ä¸ªå»¶è¿Ÿå­˜å‚¨å±æ€§ã€‚ å¿…é¡»å°†å»¶è¿Ÿå­˜å‚¨å±æ€§å£°æ˜ä¸ºå˜é‡ï¼ˆä½¿ç”¨varå…³é”®å­—ï¼‰ï¼Œå› ä¸ºå±æ€§çš„åˆå§‹å€¼å¯èƒ½åœ¨å®ä¾‹æ„é€ å®Œæˆä¹‹åæ‰ä¼šå¾—åˆ°ï¼Œè€Œå¸¸é‡å±æ€§åœ¨æ„é€ è¿‡ç¨‹å®Œæˆä¹‹å‰å¿…é¡»è¦æœ‰åˆå§‹å€¼ï¼Œå› æ­¤æ— æ³•å£°æ˜æˆå»¶è¿Ÿå±æ€§ã€‚ å¦‚æœä¸€ä¸ªè¢«æ ‡è®°ä¸ºlazyçš„å±æ€§åœ¨æ²¡æœ‰åˆå§‹åŒ–æ—¶å°±è¢«å¤šä¸ªçº¿ç¨‹è®¿é—®ï¼Œåˆ™æ— æ³•ä¿è¯è¯¥å±æ€§åªä¼šè¢«åˆå§‹åŒ–ä¸€æ¬¡ã€‚ Swiftä¸­çš„æ•°ä¿¡æ²¡æœ‰å¯¹åº”çš„å®ä¾‹å˜é‡ï¼Œå±æ€§çš„åç«¯å­˜å‚¨ä¹Ÿæ— æ³•ç›´æ¥è®¿é—®ã€‚ è®¡ç®—å±æ€§ï¼šç±»ã€ç»“æ„ä½“å’Œæšä¸¾å¯ä»¥å®šä¹‰è®¡ç®—å±æ€§ã€‚è®¡ç®—å±æ€§ä¸ç›´æ¥å­˜å‚¨å€¼ï¼Œè€Œæ˜¯æä¾›ä¸€ä¸ªgetterå’Œä¸€ä¸ªå¯é€‰çš„setterï¼Œæ¥é—´æ¥è·å–å’Œè®¾ç½®å…¶ä»–å±æ€§æˆ–å˜é‡çš„å€¼ã€‚ å¦‚æœè®¡ç®—å±æ€§çš„setteræ²¡æœ‰å®šä¹‰æ–°å€¼çš„å‚æ•°ï¼Œåˆ™å¯ä»¥ä½¿ç”¨é»˜è®¤åç§°newValueã€‚ å¿…é¡»ä½¿ç”¨varå…³é”®å­—å®šä¹‰è®¡ç®—å±æ€§ï¼ŒåŒ…æ‹¬åªè¯»è®¡ç®—å±æ€§ï¼Œ å› ä¸ºä»–ä»¬çš„å€¼ä¸æ˜¯å›ºå®šçš„ã€‚letå…³é”®å­—åªç”¨æ¥å£°æ˜å¸¸é‡å±æ€§ï¼Œè¡¨ç¤ºåˆå§‹åŒ–åå†ä¹Ÿæ— æ³•ä¿®æ”¹çš„å€¼ã€‚ åªè¯»è®¡ç®—å±æ€§çš„å£°æ˜å¯ä»¥å»æ‰getå…³é”®å­—å’ŒèŠ±æ‹¬å·ã€‚ å¯ä»¥ä¸ºå±æ€§æ·»åŠ å¦‚ä¸‹çš„ä¸€ä¸ªæˆ–å…¨éƒ¨è§‚å¯Ÿå™¨ï¼š willSet åœ¨æ–°çš„å€¼è¢«è®¾ç½®ä¹‹å‰è°ƒç”¨; didSet åœ¨æ–°çš„å€¼è¢«è®¾ç½®ä¹‹åç«‹å³è°ƒç”¨; willSet è§‚å¯Ÿå™¨ä¼šå°†æ–°çš„å±æ€§å€¼ä½œä¸ºå¸¸é‡å‚æ•°ä¼ å…¥ï¼Œåœ¨ willSet çš„å®ç°ä»£ç ä¸­å¯ä»¥ä¸ºè¿™ä¸ªå‚æ•°æŒ‡å®šä¸€ä¸ªåç§°ï¼Œå¦‚æœä¸æŒ‡å®šåˆ™å‚æ•°ä»ç„¶å¯ç”¨ï¼Œè¿™æ—¶ä½¿ç”¨é»˜è®¤åç§° newValue è¡¨ç¤ºã€‚ åŒæ ·ï¼ŒdidSet è§‚å¯Ÿå™¨ä¼šå°†æ—§çš„å±æ€§å€¼ä½œä¸ºå‚æ•°ä¼ å…¥ï¼Œå¯ä»¥ä¸ºè¯¥å‚æ•°å‘½åæˆ–è€…ä½¿ç”¨é»˜è®¤å‚æ•°å oldValueã€‚å¦‚æœåœ¨ didSetæ–¹æ³•ä¸­å†æ¬¡å¯¹è¯¥å±æ€§èµ‹å€¼ï¼Œé‚£ä¹ˆæ–°å€¼ä¼šè¦†ç›–æ—§çš„å€¼ã€‚ æˆ‘ä»¬å¯ä»¥ä¸ºé™¤äº†å»¶è¿Ÿè®¡ç®—å±æ€§ä¹‹å¤–çš„å…¶ä»–å­˜å‚¨å±æ€§æ·»åŠ å±æ€§è§‚å¯Ÿå™¨ï¼Œä¹Ÿå¯ä»¥é€šè¿‡é‡å†™å±æ€§çš„æ–¹å¼ ä¸ºç»§æ‰¿çš„å±æ€§ï¼ˆåŒ…æ‹¬å­˜å‚¨å±æ€§å’Œè®¡ç®—å±æ€§ï¼‰æ·»åŠ å±æ€§è§‚å¯Ÿå™¨ã€‚ ä¸éœ€è¦ä¸ºéé‡å†™çš„è®¡ç®—å±æ€§æ·»åŠ å±æ€§è§‚å¯Ÿå™¨ï¼Œå› ä¸ºå¯ä»¥é€šè¿‡å®ƒçš„ setter ç›´æ¥ç›‘æ§å’Œå“åº”å€¼çš„å˜åŒ–ã€‚ å¦‚æœåœ¨ä¸€ä¸ªå±æ€§çš„didSetè§‚å¯Ÿå™¨é‡Œä¸ºå®ƒèµ‹å€¼ï¼Œè¿™ä¸ªå€¼ä¼šæ›¿æ¢è¯¥è§‚å¯Ÿå™¨ä¹‹å‰è®¾ç½®çš„å€¼ã€‚ çˆ¶ç±»çš„å±æ€§åœ¨å­ç±»çš„æ„é€ å™¨ä¸­è¢«èµ‹å€¼æ—¶ï¼Œå®ƒåœ¨çˆ¶ç±»ä¸­çš„ willSet å’Œ didSet è§‚å¯Ÿå™¨ä¼šè¢«è°ƒç”¨ï¼Œéšåæ‰ä¼šè°ƒç”¨å­ç±»çš„è§‚å¯Ÿå™¨ã€‚åœ¨çˆ¶ç±»åˆå§‹åŒ–æ–¹æ³•è°ƒç”¨ä¹‹å‰ï¼Œå­ç±»ç»™å±æ€§èµ‹å€¼æ—¶ï¼Œè§‚å¯Ÿå™¨ä¸ä¼šè¢«è°ƒç”¨ã€‚ class StepCounter { var totalSteps: Int = 0 { willSet(newTotalSteps) { print(\"About to set totalSteps to \\(newTotalSteps)\") } didSet { if totalSteps \u003e oldValue { print(\"Added \\(totalSteps - oldValue) steps\") } } } } let stepCounter = StepCounter() stepCounter.totalSteps = 200 // About to set totalSteps to 200 // Added 200 steps stepCounter.totalSteps = 360 // About to set totalSteps to 360 // Added 160 steps stepCounter.totalSteps = 896 // About to set totalSteps to 896 // Added 536 steps StepCounter ç±»å®šä¹‰äº†ä¸€ä¸ª Int ç±»å‹çš„å±æ€§ totalStepsï¼Œå®ƒæ˜¯ä¸€ä¸ªå­˜å‚¨å±æ€§ï¼ŒåŒ…å« willSet å’Œ didSet è§‚å¯Ÿå™¨ã€‚ å½“ totalSteps è¢«è®¾ç½®æ–°å€¼çš„æ—¶å€™ï¼Œå®ƒçš„ willSet å’Œ didSet è§‚å¯Ÿå™¨éƒ½ä¼šè¢«è°ƒç”¨ï¼Œå³ä½¿æ–°å€¼å’Œå½“å‰å€¼å®Œå…¨ç›¸åŒæ—¶ä¹Ÿä¼šè¢«è°ƒç”¨ã€‚ ä¾‹å­ä¸­çš„ willSet è§‚å¯Ÿå™¨å°†è¡¨ç¤ºæ–°å€¼çš„å‚æ•°è‡ªå®šä¹‰ä¸º newTotalStepsï¼Œè¿™ä¸ªè§‚å¯Ÿå™¨åªæ˜¯ç®€å•çš„å°†æ–°çš„å€¼è¾“å‡ºã€‚ didSet è§‚å¯Ÿå™¨åœ¨ totalSteps çš„å€¼æ”¹å˜åè¢«è°ƒç”¨ï¼Œå®ƒæŠŠæ–°å€¼å’Œæ—§å€¼è¿›è¡Œå¯¹æ¯”ï¼Œå¦‚æœæ€»æ­¥æ•°å¢åŠ äº†ï¼Œå°±è¾“å‡ºä¸€ä¸ªæ¶ˆæ¯è¡¨ç¤ºå¢åŠ äº†å¤šå°‘æ­¥ã€‚didSet æ²¡æœ‰ä¸ºæ—§å€¼æä¾›è‡ªå®šä¹‰åç§°ï¼Œæ‰€ä»¥é»˜è®¤å€¼ oldValue è¡¨ç¤ºæ—§å€¼çš„å‚æ•°åã€‚ å¦‚æœå°†å±æ€§é€šè¿‡ in-out æ–¹å¼ä¼ å…¥å‡½æ•°ï¼ŒwillSet å’Œ didSet ä¹Ÿä¼šè°ƒç”¨ã€‚è¿™æ˜¯å› ä¸º in-out å‚æ•°é‡‡ç”¨äº†æ‹·å…¥æ‹·å‡ºæ¨¡å¼ï¼šå³åœ¨å‡½æ•°å†…éƒ¨ä½¿ç”¨çš„æ˜¯å‚æ•°çš„ copyï¼Œå‡½æ•°ç»“æŸåï¼Œåˆå¯¹å‚æ•°é‡æ–°èµ‹å€¼ã€‚ å…¨å±€çš„å¸¸é‡æˆ–å˜é‡éƒ½æ˜¯å»¶è¿Ÿè®¡ç®—çš„ï¼Œè·Ÿå»¶è¿Ÿå­˜å‚¨å±æ€§ç›¸ä¼¼ï¼Œä¸åŒçš„åœ°æ–¹åœ¨äºï¼Œå…¨å±€çš„å¸¸é‡æˆ–å˜é‡ä¸éœ€è¦æ ‡è®°lazyä¿®é¥°ç¬¦ã€‚å±€éƒ¨èŒƒå›´çš„å¸¸é‡æˆ–å˜é‡ä»ä¸å»¶è¿Ÿè®¡ç®—ã€‚ ç±»å‹å±æ€§æ˜¯ç”¨staticå…³é”®å­—ä¿®é¥°çš„ï¼Œä½†æ˜¯å¦‚æœæƒ³è®©å­ç±»æ”¯æŒé‡å†™çˆ¶ç±»æ–¹æ³•å®ç°ï¼Œéœ€è¦æŠŠstaticæ”¹ä¸ºclassï¼Œä½†æ˜¯classåªæ”¯æŒç±»ï¼ˆåè®®ä¸­å¥½åƒä¹Ÿå¯ä»¥ç”¨ï¼‰ï¼Œä¸æ”¯æŒç»“æ„ä½“å’Œæšä¸¾ã€‚ struct SomeStructure { static var storedTypeProperty = \"Some value.\" static var computedTypeProperty: Int { return 1 } } enum SomeEnumeration { static var storedTypeProperty = \"Some value.\" static var computedTypeProperty: Int { return 6 } } class SomeClass { static var storedTypeProperty = \"Some value.\" static var computedTypeProperty: Int { return 27 } class var overrideableComputedTypeProperty: Int { return 107 } } å­˜å‚¨å‹ç±»å‹å±æ€§å¯ä»¥æ˜¯å˜é‡æˆ–å¸¸é‡ï¼Œè®¡ç®—å‹ç±»å‹å±æ€§è·Ÿå®ä¾‹çš„è®¡ç®—å‹å±æ€§ä¸€æ ·åªèƒ½å®šä¹‰æˆå˜é‡å±æ€§ã€‚è·Ÿå®ä¾‹çš„å­˜å‚¨å‹å±æ€§ä¸åŒï¼Œå¿…é¡»ç»™å­˜å‚¨å‹ç±»å‹å±æ€§æŒ‡å®šé»˜è®¤å€¼ï¼Œå› ä¸ºç±»å‹æœ¬èº«æ²¡æœ‰æ„é€ å™¨ï¼Œä¹Ÿå°±æ— æ³•åœ¨åˆå§‹åŒ–è¿‡ç¨‹ä¸­ä½¿ç”¨æ„é€ å™¨ç»™ç±»å‹å±æ€§èµ‹å€¼ã€‚å­˜å‚¨å‹ç±»å‹å±æ€§æ˜¯å»¶è¿Ÿåˆå§‹åŒ–çš„ï¼Œå®ƒä»¬åªæœ‰åœ¨ç¬¬ä¸€æ¬¡è¢«è®¿é—®çš„æ—¶å€™æ‰ä¼šè¢«åˆå§‹åŒ–ã€‚å³ä½¿å®ƒä»¬è¢«å¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®ï¼Œç³»ç»Ÿä¹Ÿä¿è¯åªä¼šå¯¹å…¶è¿›è¡Œä¸€æ¬¡åˆå§‹åŒ–ï¼Œå¹¶ä¸”ä¸éœ€è¦å¯¹å…¶ä½¿ç”¨lazyä¿®é¥°ç¬¦ã€‚ å€¼ç±»å‹ï¼ˆç»“æ„ä½“å’Œæšä¸¾ï¼‰ä¸æ”¯æŒç»§æ‰¿ã€‚ ","date":"2016-03-01","objectID":"/swift%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/:5:0","tags":["iOS","swift"],"title":"Swiftå­¦ä¹ ç¬”è®°","uri":"/swift%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"},{"categories":["å­¦ä¹ ç¬”è®°"],"content":"æ–¹æ³• æ–¹æ³•æ˜¯ä¸æŸäº›ç‰¹å®šç±»å‹ç›¸å…³è”çš„å‡½æ•°ã€‚ å¦‚æœä½ ç¡®å®éœ€è¦åœ¨æŸä¸ªç‰¹å®šçš„æ–¹æ³•ä¸­ä¿®æ”¹ç»“æ„ä½“æˆ–è€…æšä¸¾çš„å±æ€§ï¼Œä½ å¯ä»¥ä¸ºè¿™ä¸ªæ–¹æ³•é€‰æ‹©å¯å˜(mutating)è¡Œä¸ºï¼Œç„¶åå°±å¯ä»¥ä»å…¶æ–¹æ³•å†…éƒ¨æ”¹å˜å®ƒçš„å±æ€§ï¼›å¹¶ä¸”è¿™ä¸ªæ–¹æ³•åšçš„ä»»ä½•æ”¹å˜éƒ½ä¼šåœ¨æ–¹æ³•æ‰§è¡Œç»“æŸæ—¶å†™å›åˆ°åŸå§‹ç»“æ„ä¸­ã€‚æ–¹æ³•è¿˜å¯ä»¥ç»™å®ƒéšå«çš„selfå±æ€§èµ‹äºˆä¸€ä¸ªå…¨æ–°çš„å®ä¾‹ï¼Œè¿™ä¸ªæ–°å®ä¾‹åœ¨æ–¹æ³•ç»“æŸæ—¶ä¼šæ›¿æ¢ç°å­˜å®ä¾‹ã€‚ è¦ä½¿ç”¨å¯å˜æ–¹æ³•ï¼Œå°†å…³é”®å­—mutating æ”¾åˆ°æ–¹æ³•çš„funcå…³é”®å­—ä¹‹å‰å°±å¯ä»¥äº†ã€‚ ä¸èƒ½åœ¨ç»“æ„ä½“ç±»å‹çš„å¸¸é‡ï¼ˆa constant of structure typeï¼‰ä¸Šè°ƒç”¨å¯å˜æ–¹æ³•ï¼Œå› ä¸ºå…¶å±æ€§ä¸èƒ½è¢«æ”¹å˜ï¼Œå³ä½¿å±æ€§æ˜¯å˜é‡å±æ€§ã€‚ ç±»å‹æ–¹æ³•ï¼š å¯ä»¥å®šä¹‰åœ¨ç±»å‹æœ¬èº«ä¸Šè°ƒç”¨çš„æ–¹æ³•ï¼Œè¿™ç§æ–¹æ³•å°±å«åšç±»å‹æ–¹æ³•ã€‚åœ¨æ–¹æ³•çš„funcå…³é”®å­—ä¹‹å‰åŠ ä¸Šå…³é”®å­—staticï¼Œæ¥æŒ‡å®šç±»å‹æ–¹æ³•ã€‚ç±»è¿˜å¯ä»¥ç”¨å…³é”®å­—classæ¥å…è®¸å­ç±»é‡å†™çˆ¶ç±»çš„æ–¹æ³•å®ç°ã€‚åœ¨ Objective-C ä¸­ï¼Œä½ åªèƒ½ä¸º Objective-C çš„ç±»ç±»å‹ï¼ˆclassesï¼‰å®šä¹‰ç±»å‹æ–¹æ³•ï¼ˆtype-level methodsï¼‰ã€‚åœ¨ Swift ä¸­ï¼Œä½ å¯ä»¥ä¸ºæ‰€æœ‰çš„ç±»ã€ç»“æ„ä½“å’Œæšä¸¾å®šä¹‰ç±»å‹æ–¹æ³•ã€‚æ¯ä¸€ä¸ªç±»å‹æ–¹æ³•éƒ½è¢«å®ƒæ‰€æ”¯æŒçš„ç±»å‹æ˜¾å¼åŒ…å«ã€‚ ","date":"2016-03-01","objectID":"/swift%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/:6:0","tags":["iOS","swift"],"title":"Swiftå­¦ä¹ ç¬”è®°","uri":"/swift%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"},{"categories":["å­¦ä¹ ç¬”è®°"],"content":"è¦†å†™ è¦†å†™ï¼šä½ å¯ä»¥å°†ä¸€ä¸ªç»§æ‰¿æ¥çš„åªè¯»å±æ€§é‡å†™ä¸ºä¸€ä¸ªè¯»å†™å±æ€§ï¼Œåªéœ€è¦åœ¨é‡å†™ç‰ˆæœ¬çš„å±æ€§é‡Œæä¾›getterå’Œsetterå³å¯ï¼Œä½†æ˜¯ï¼Œä¸èƒ½å°†ä¸€ä¸ªç»§æ‰¿æ¥çš„å¯è¯»å†™å±æ€§é‡å†™ä¸ºä¸€ä¸ªåªè¯»å±æ€§ã€‚å¦‚æœä½ åœ¨é‡å†™å±æ€§ä¸­æä¾›äº†setterï¼Œé‚£ä¹ˆä½ ä¹Ÿä¸€å®šè¦æä¾›getterã€‚ é‡å†™å±æ€§è§‚å¯Ÿå™¨ï¼šä½ ä¸å¯ä»¥ä¸ºç»§æ‰¿æ¥çš„å¸¸é‡å­˜å‚¨å±æ€§æˆ–è€…ç»§æ‰¿æ¥çš„åªè¯»è®¡ç®—å±æ€§æ·»åŠ å±æ€§è§‚å¯Ÿå™¨ã€‚è¿™äº›å±æ€§çš„å€¼æ˜¯ä¸å¯ä»¥è¢«è®¾ç½®çš„ï¼Œæ‰€ä»¥ï¼Œä¸ºä»–ä»¬æä¾›willSetå’ŒdidSet å®ç°æ˜¯ä¸æ°å½“çš„ã€‚æ­¤å¤–è¿˜è¦æ³¨æ„ï¼Œä½ ä¸å¯ä»¥åŒæ—¶æä¾›é‡å†™çš„setterå’Œé‡å†™çš„å±æ€§è§‚å¯Ÿå™¨ã€‚å¦‚æœä½ æƒ³è§‚å¯Ÿå±æ€§å€¼çš„å˜åŒ–ï¼Œå¹¶ä¸”ä½ å·²ç»ä¸ºé‚£ä¸ªå±æ€§æä¾›äº†å®šåˆ¶çš„setterï¼Œé‚£ä¹ˆä½ åœ¨setterä¸­å°±å¯ä»¥è§‚å¯Ÿåˆ°ä»»ä½•å˜åŒ–äº†ã€‚ ä½ å¯ä»¥é€šè¿‡æŠŠæ–¹æ³•ï¼Œå±æ€§æˆ–ä¸‹æ ‡æ ‡è®°ä¸º final æ¥é˜²æ­¢å®ƒä»¬è¢«é‡å†™ï¼Œåªéœ€è¦åœ¨å£°æ˜å…³é”®å­—å‰åŠ ä¸Š final ä¿®é¥°ç¬¦å³å¯ï¼ˆä¾‹å¦‚ï¼š final var ï¼Œ final func ï¼Œ final class func ï¼Œä»¥åŠ final subscript ï¼‰ã€‚ä½ å¯ä»¥é€šè¿‡åœ¨å…³é”®å­— class å‰æ·»åŠ  final ä¿®é¥°ç¬¦æ¥å°†æ•´ä¸ªç±»æ ‡è®°ä¸º final çš„ã€‚ ","date":"2016-03-01","objectID":"/swift%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/:7:0","tags":["iOS","swift"],"title":"Swiftå­¦ä¹ ç¬”è®°","uri":"/swift%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"},{"categories":["å­¦ä¹ ç¬”è®°"],"content":"æ„é€ è¿‡ç¨‹ ä¸Objective-Cä¸­çš„æ„é€ å™¨ä¸åŒçš„æ˜¯ï¼šSwiftçš„æ„é€ å™¨æ— éœ€è¿”å›å€¼ï¼Œä»–ä»¬çš„ä¸»è¦ä»»åŠ¡æ˜¯ä¿è¯æ–°å®ä¾‹åœ¨ç¬¬ä¸€æ¬¡ä½¿ç”¨å‰å®Œæˆæ­£ç¡®çš„åˆå§‹åŒ–ã€‚ å½“ä½ ä¸ºå­˜å‚¨å‹å±æ€§è®¾ç½®é»˜è®¤å€¼æˆ–è€…åœ¨æ„é€ å™¨ä¸­ä¸ºå…¶èµ‹å€¼æ—¶ï¼Œä»–ä»¬çš„å€¼æ˜¯è¢«ç›´æ¥è®¾ç½®çš„ï¼Œä¸ä¼šè§¦å‘ä»»ä½•å±æ€§è§‚å¯Ÿè€…ã€‚ æ„é€ è¿‡ç¨‹ä¸­å¸¸é‡å±æ€§å¯ä»¥ä¿®æ”¹ï¼šå¯¹äºç±»çš„å®ä¾‹æ¥è¯´ï¼Œå®ƒçš„å¸¸é‡å±æ€§åªèƒ½åœ¨ å®šä¹‰å®ƒçš„ç±» çš„æ„é€ è¿‡ç¨‹ä¸­ ä¿®æ”¹ï¼Œä¸èƒ½åœ¨å­ç±»ä¸­ä¿®æ”¹ã€‚ æ¯”å¦‚ï¼š // ä¿®æ”¹ä¸Šé¢çš„ SurveyQuestion ç¤ºä¾‹ï¼Œç”¨å¸¸é‡å±æ€§æ›¿ä»£å˜é‡å±æ€§ text ï¼Œè¡¨ç¤ºé—®é¢˜å†…å®¹ text åœ¨ SurveyQuestio n çš„å®ä¾‹è¢«åˆ›å»ºä¹‹åä¸ä¼šå†è¢«ä¿®æ”¹ã€‚å°½ç®¡ text å±æ€§ç°åœ¨æ˜¯å¸¸é‡ï¼Œæˆ‘ä»¬ä»ç„¶å¯ä»¥åœ¨ç±»çš„æ„é€ å™¨ä¸­è®¾ç½®å®ƒçš„å€¼ï¼š class SurveyQuestion { let text: String //å¸¸é‡å±æ€§ var response: String? init(text: String) { self.text = text } func ask() { print(text) } } let beetsQuestion = SurveyQuestion(text: \"How about beets?\") beetsQuestion.ask() // æ‰“å° \"How about beets?\" beetsQuestion.response = \"I also like beets. (But not with cheese.)\" é»˜è®¤æ„é€ å™¨ï¼šå¦‚æœ ç»“æ„ä½“æˆ–ç±»çš„æ‰€æœ‰å±æ€§éƒ½æœ‰é»˜è®¤å€¼ï¼ŒåŒæ—¶æ²¡æœ‰è‡ªå®šä¹‰çš„æ„é€ å™¨ï¼Œé‚£ä¹ˆ Swift ä¼šç»™è¿™äº›ç»“æ„ä½“æˆ–ç±»æä¾›ä¸€ä¸ªé»˜è®¤æ„é€ å™¨ï¼ˆdefault initializersï¼‰ã€‚ ç»“æ„ä½“çš„é€ä¸€æˆå‘˜æ„é€ å™¨ï¼ˆç»“æ„ä½“ç‰¹æœ‰çš„ï¼‰ï¼šé™¤äº†é»˜è®¤æ„é€ å™¨ï¼Œå¦‚æœç»“æ„ä½“æ²¡æœ‰æä¾›è‡ªå®šä¹‰çš„æ„é€ å™¨ï¼Œä»–ä»¬å°†è‡ªåŠ¨è·å¾—ä¸€ä¸ªé€ä¸€æˆå‘˜æ„é€ å™¨ï¼Œå³ä½¿ç»“æ„ä½“çš„å­˜å‚¨å±æ€§æ²¡æœ‰é»˜è®¤å€¼ã€‚ å€¼ç±»å‹çš„æ„é€ å™¨ä»£ç†ï¼šå¯¹äºå€¼ç±»å‹ï¼Œä½ å¯ä»¥ä½¿ç”¨self.initåœ¨è‡ªå®šä¹‰çš„æ„é€ å™¨ä¸­ä½¿ç”¨ç›¸åŒç±»å‹ä¸­çš„å…¶å®ƒæ„é€ å™¨ï¼Œå¹¶ä¸”ä½ åªèƒ½åœ¨æ„é€ å™¨å†…éƒ¨è°ƒç”¨self.initã€‚å¦‚æœä½ ä¸ºäº†æŸä¸ªå€¼ç±»å‹å®šä¹‰äº†ä¸€ä¸ªè‡ªå®šä¹‰æ„é€ å™¨ï¼Œä½ å°†æ— æ³•è®¿é—®é»˜è®¤æ„é€ å™¨ï¼ˆå¦‚æœæ˜¯ç»“æ„ä½“ï¼Œè¿˜å°†æ— æ³•è®¿é—®é€ä¸€æˆå‘˜æ„é€ å™¨ï¼‰ã€‚è¿™ç§é™åˆ¶å¯ä»¥é˜²æ­¢ä½ ä¸ºå€¼ç±»å‹å¢åŠ äº†ä¸€ä¸ªé¢å¤–çš„ä¸”ååˆ†å¤æ‚çš„æ„é€ å™¨ä¹‹åï¼Œä»æœ‰äººé”™è¯¯çš„ä½¿ç”¨è‡ªåŠ¨ç”Ÿæˆçš„æ„é€ å™¨ã€‚å‡å¦‚ä½ å¸Œæœ›é»˜è®¤æ„é€ å™¨ã€é€ä¸€æˆå‘˜æ„é€ å™¨ä»¥åŠä½ è‡ªå·±å®šä¹‰çš„æ„é€ å™¨éƒ½èƒ½ç”¨æ¥åˆ›å»ºå®ä¾‹ï¼Œä½ å¯ä»¥å°†è‡ªå®šä¹‰çš„æ„é€ å™¨å†™åˆ°æ‰©å±•ï¼ˆextensionï¼‰é‡Œé¢ï¼Œè€Œä¸æ˜¯å¸è½½å€¼ç±»å‹çš„åŸå§‹å®šä¹‰ä¸­ã€‚ æŒ‡å®šæ„é€ å™¨æ˜¯ç±»ä¸­æœ€é‡è¦çš„æ„é€ å™¨ã€‚æ¯ä¸€ä¸ªç±»éƒ½å¿…é¡»æ‹¥æœ‰è‡³å°‘ä¸€ä¸ªæŒ‡å®šæ„é€ å™¨ã€‚ //æŒ‡å®šæ„é€ å™¨ init(parameters) { statements } //ä¾¿åˆ©æ„é€ å™¨ï¼ˆåœ¨`init`å‰æ”¾ç½® `convenience` å…³é”®å­—ï¼‰ convenience init(parameters) { statements } ç±»çš„æ„é€ å™¨ä»£ç†è§„åˆ™ï¼š \u003e ä¸ºäº†ç®€åŒ–æŒ‡å®šæ„é€ å™¨å’Œä¾¿åˆ©æ„é€ å™¨ä¹‹é—´çš„è°ƒç”¨å…³ç³»ï¼ŒSwift é‡‡ç”¨ä»¥ä¸‹ä¸‰æ¡è§„åˆ™æ¥é™åˆ¶æ„é€ å™¨ä¹‹é—´çš„ä»£ç†è°ƒç”¨ï¼š \u003e \u003e è§„åˆ™ 1 æŒ‡å®šæ„é€ å™¨å¿…é¡»è°ƒç”¨å…¶ç›´æ¥çˆ¶ç±»çš„çš„æŒ‡å®šæ„é€ å™¨ã€‚ \u003e \u003e è§„åˆ™ 2 ä¾¿åˆ©æ„é€ å™¨å¿…é¡»è°ƒç”¨åŒç±»ä¸­ï¼ˆå³è‡ªå·±ç±»é‡Œé¢ï¼‰å®šä¹‰çš„å…¶å®ƒæ„é€ å™¨ã€‚ \u003e \u003e è§„åˆ™ 3 ä¾¿åˆ©æ„é€ å™¨å¿…é¡»æœ€ç»ˆå¯¼è‡´ä¸€ä¸ªæŒ‡å®šæ„é€ å™¨è¢«è°ƒç”¨ã€‚ \u003e \u003e ä¸€ä¸ªæ›´æ–¹ä¾¿è®°å¿†çš„æ–¹æ³•æ˜¯ï¼š â€¢ æŒ‡å®šæ„é€ å™¨å¿…é¡»æ€»æ˜¯å‘ä¸Šä»£ç† â€¢ ä¾¿åˆ©æ„é€ å™¨å¿…é¡»æ€»æ˜¯æ¨ªå‘ä»£ç† ä¸¤æ®µå¼æ„é€ è¿‡ç¨‹ï¼šSwift ä¸­ç±»çš„æ„é€ è¿‡ç¨‹åŒ…å«ä¸¤ä¸ªé˜¶æ®µã€‚ç¬¬ä¸€ä¸ªé˜¶æ®µï¼Œæ¯ä¸ªå­˜å‚¨å‹å±æ€§è¢«å¼•å…¥å®ƒä»¬çš„ç±»æŒ‡å®šä¸€ä¸ªåˆå§‹å€¼ã€‚å½“æ¯ä¸ªå­˜å‚¨å‹å±æ€§çš„åˆå§‹å€¼è¢«ç¡®å®šåï¼Œç¬¬äºŒé˜¶æ®µå¼€å§‹ï¼Œå®ƒç»™æ¯ä¸ªç±»ä¸€æ¬¡æœºä¼šï¼Œåœ¨æ–°å®ä¾‹å‡†å¤‡ä½¿ç”¨ä¹‹å‰è¿›ä¸€æ­¥å®šåˆ¶å®ƒä»¬çš„å­˜ å‚¨å‹å±æ€§ã€‚ ä¸¤æ®µå¼æ„é€ è¿‡ç¨‹çš„ä½¿ç”¨è®©æ„é€ è¿‡ç¨‹æ›´å®‰å…¨ï¼ŒåŒæ—¶åœ¨æ•´ä¸ªç±»å±‚çº§ç»“æ„ä¸­ç»™äºˆäº†æ¯ä¸ªç±»å®Œå…¨çš„çµæ´»æ€§ã€‚ä¸¤æ®µå¼æ„é€ è¿‡ ç¨‹å¯ä»¥é˜²æ­¢å±æ€§å€¼åœ¨åˆå§‹åŒ–ä¹‹å‰è¢«è®¿é—®ï¼Œä¹Ÿå¯ä»¥é˜²æ­¢å±æ€§è¢«å¦å¤–ä¸€ä¸ªæ„é€ å™¨æ„å¤–åœ°èµ‹äºˆä¸åŒçš„å€¼ã€‚ æ„é€ è¿‡ç¨‹çš„å®‰å…¨æ£€æŸ¥ï¼ˆé‡è¦ï¼‰ï¼š \u003e Swift ç¼–è¯‘å™¨å°†æ‰§è¡Œ 4 ç§æœ‰æ•ˆçš„å®‰å…¨æ£€æŸ¥ï¼Œä»¥ç¡®ä¿ä¸¤æ®µå¼æ„é€ è¿‡ç¨‹èƒ½ä¸å‡ºé”™åœ°å®Œæˆï¼š \u003e \u003e å®‰å…¨æ£€æŸ¥ 1: æŒ‡å®šæ„é€ å™¨å¿…é¡»ä¿è¯å®ƒæ‰€åœ¨ç±»å¼•å…¥çš„æ‰€æœ‰å±æ€§éƒ½å¿…é¡»å…ˆåˆå§‹åŒ–å®Œæˆï¼Œä¹‹åæ‰èƒ½å°†å…¶å®ƒæ„é€ ä»»åŠ¡å‘ä¸Šä»£ç†ç»™çˆ¶ç±»ä¸­ çš„æ„é€ å™¨ã€‚ \u003e \u003e å¦‚ä¸Šæ‰€è¿°ï¼Œä¸€ä¸ªå¯¹è±¡çš„å†…å­˜åªæœ‰åœ¨å…¶æ‰€æœ‰å­˜å‚¨å‹å±æ€§ç¡®å®šä¹‹åæ‰èƒ½å®Œå…¨åˆå§‹åŒ–ã€‚ä¸ºäº†æ»¡è¶³è¿™ä¸€è§„åˆ™ï¼ŒæŒ‡å®šæ„é€ å™¨ å¿…é¡»ä¿è¯å®ƒæ‰€åœ¨ç±»å¼•å…¥çš„å±æ€§åœ¨å®ƒå¾€ä¸Šä»£ç†ä¹‹å‰å…ˆå®Œæˆåˆå§‹åŒ–ã€‚ \u003e \u003e å®‰å…¨æ£€æŸ¥ 2: æŒ‡å®šæ„é€ å™¨å¿…é¡»å…ˆå‘ä¸Šä»£ç†è°ƒç”¨çˆ¶ç±»æ„é€ å™¨ï¼Œç„¶åå†ä¸ºç»§æ‰¿çš„å±æ€§è®¾ç½®æ–°å€¼ã€‚å¦‚æœæ²¡è¿™ä¹ˆåšï¼ŒæŒ‡å®šæ„é€ å™¨èµ‹äºˆçš„ æ–°å€¼å°†è¢«çˆ¶ç±»ä¸­çš„æ„é€ å™¨æ‰€è¦†ç›–ã€‚ \u003e \u003e å®‰å…¨æ£€æŸ¥ 3: ä¾¿åˆ©æ„é€ å™¨å¿…é¡»å…ˆä»£ç†è°ƒç”¨åŒä¸€ç±»ä¸­çš„å…¶å®ƒæ„é€ å™¨ï¼Œç„¶åå†ä¸ºä»»æ„å±æ€§èµ‹æ–°å€¼ã€‚å¦‚æœæ²¡è¿™ä¹ˆåšï¼Œä¾¿åˆ©æ„é€ å™¨èµ‹äºˆçš„æ–°å€¼å°†è¢«åŒä¸€ç±»ä¸­å…¶å®ƒæŒ‡å®šæ„é€ å™¨æ‰€è¦†ç›–ã€‚ \u003e \u003e å®‰å…¨æ£€æŸ¥ 4: æ„é€ å™¨åœ¨ç¬¬ä¸€é˜¶æ®µæ„é€ å®Œæˆä¹‹å‰ï¼Œä¸èƒ½è°ƒç”¨ä»»ä½•å®ä¾‹æ–¹æ³•ï¼Œä¸èƒ½è¯»å–ä»»ä½•å®ä¾‹å±æ€§çš„å€¼ï¼Œä¸èƒ½å¼•ç”¨ selfä½œä¸ºä¸€ä¸ªå€¼ã€‚ \u003e \u003e ç±»å®ä¾‹åœ¨ç¬¬ä¸€é˜¶æ®µç»“æŸä»¥å‰å¹¶ä¸æ˜¯å®Œå…¨æœ‰æ•ˆçš„ã€‚åªæœ‰ç¬¬ä¸€é˜¶æ®µå®Œæˆåï¼Œè¯¥å®ä¾‹æ‰ä¼šæˆä¸ºæœ‰æ•ˆå®ä¾‹ï¼Œæ‰èƒ½è®¿é—®å±æ€§ å’Œè°ƒç”¨æ–¹æ³•ã€‚ ä»¥ä¸‹æ˜¯ä¸¤æ®µå¼æ„é€ è¿‡ç¨‹ä¸­åŸºäºä¸Šè¿°å®‰å…¨æ£€æŸ¥çš„æ„é€ æµç¨‹å±•ç¤ºï¼š \u003e é˜¶æ®µ 1ï¼š \u003e \u003e - æŸä¸ªæŒ‡å®šæ„é€ å™¨æˆ–ä¾¿åˆ©æ„é€ å™¨è¢«è°ƒç”¨ã€‚ \u003e \u003e - å®Œæˆæ–°å®ä¾‹å†…å­˜çš„åˆ†é…ï¼Œä½†æ­¤æ—¶å†…å­˜è¿˜æ²¡æœ‰è¢«åˆå§‹åŒ–ã€‚ \u003e \u003e - æŒ‡å®šæ„é€ å™¨ç¡®ä¿å…¶æ‰€åœ¨ç±»å¼•å…¥çš„æ‰€æœ‰å­˜å‚¨å‹å±æ€§éƒ½å·²èµ‹åˆå€¼ã€‚å­˜å‚¨å‹å±æ€§æ‰€å±çš„å†…å­˜å®Œæˆåˆå§‹åŒ–ã€‚ \u003e \u003e - æŒ‡å®šæ„é€ å™¨å°†è°ƒç”¨çˆ¶ç±»çš„æ„é€ å™¨ï¼Œå®Œæˆçˆ¶ç±»å±æ€§çš„åˆå§‹åŒ–ã€‚ \u003e \u003e - è¿™ä¸ªè°ƒç”¨çˆ¶ç±»æ„é€ å™¨çš„è¿‡ç¨‹æ²¿ç€æ„é€ å™¨é“¾ä¸€ç›´å¾€ä¸Šæ‰§è¡Œï¼Œç›´åˆ°åˆ°è¾¾æ„é€ å™¨é“¾çš„æœ€é¡¶éƒ¨ã€‚ \u003e \u003e - å½“åˆ°è¾¾äº†æ„é€ å™¨é“¾æœ€é¡¶éƒ¨ï¼Œä¸”å·²ç¡®ä¿æ‰€æœ‰å®ä¾‹åŒ…å«çš„å­˜å‚¨å‹å±æ€§éƒ½å·²ç»èµ‹å€¼ï¼Œè¿™ä¸ªå®ä¾‹çš„å†…å­˜è¢«è®¤ä¸ºå·²ç»å®Œ å…¨åˆå§‹åŒ–ã€‚æ­¤æ—¶é˜¶æ®µ 1 å®Œæˆã€‚ \u003e \u003e é˜¶æ®µ2ï¼š \u003e \u003e - ä»é¡¶éƒ¨æ„é€ å™¨é“¾ä¸€ç›´å¾€ä¸‹ï¼Œæ¯ä¸ªæ„é€ å™¨é“¾ä¸­ç±»çš„æŒ‡å®šæ„é€ å™¨éƒ½æœ‰æœºä¼šè¿›ä¸€æ­¥å®šåˆ¶å®ä¾‹ã€‚æ„é€ å™¨æ­¤æ—¶å¯ä»¥è®¿é—® `self` ã€ä¿®æ”¹å®ƒçš„å±æ€§å¹¶è°ƒç”¨å®ä¾‹æ–¹æ³•ç­‰ç­‰ã€‚ \u003e \u003e - æœ€ç»ˆï¼Œä»»æ„æ„é€ å™¨é“¾ä¸­çš„ä¾¿åˆ©æ„é€ å™¨å¯ä»¥æœ‰æœºä¼šå®šåˆ¶å®ä¾‹å’Œä½¿ç”¨ `self `ã€‚ Swiftä¸­çš„å­ç±»é»˜è®¤æƒ…å†µä¸‹ä¸ä¼šç»§æ‰¿çˆ¶ç±»çš„æ„é€ å™¨ï¼Œçˆ¶ç±»çš„æ„é€ å™¨ä»…ä¼šåœ¨å®‰å…¨å’Œé€‚å½“çš„æƒ…å†µä¸‹è¢«ç»§æ‰¿ã€‚ ","date":"2016-03-01","objectID":"/swift%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/:8:0","tags":["iOS","swift"],"title":"Swiftå­¦ä¹ ç¬”è®°","uri":"/swift%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"},{"categories":["å­¦ä¹ ç¬”è®°"],"content":"åè®® ç±»ç±»å‹ä¸“å±åè®®ï¼š ä½ å¯ä»¥åœ¨åè®®çš„ç»§æ‰¿åˆ—è¡¨ä¸­ï¼Œé€šè¿‡æ·»åŠ  class å…³é”®å­—æ¥é™åˆ¶åè®®åªèƒ½è¢«ç±»ç±»å‹éµå¾ªï¼Œè€Œç»“æ„ä½“å’Œæšä¸¾ä¸èƒ½éµå¾ªè¯¥åè®®ã€‚class å…³é”®å­—å¿…é¡»ç¬¬ä¸€ä¸ªå‡ºç°åœ¨åè®®çš„ç»§æ‰¿åˆ—è¡¨ä¸­ï¼Œåœ¨å…¶ä»–ç»§æ‰¿çš„åè®®ä¹‹å‰ï¼š protocol SomeClassOnlyProtocol: class, SomeInheritedProtocol { // è¿™é‡Œæ˜¯ç±»ç±»å‹ä¸“å±åè®®çš„å®šä¹‰éƒ¨åˆ† } å½“åè®®å®šä¹‰çš„è¦æ±‚éœ€è¦éµå¾ªåè®®çš„ç±»å‹å¿…é¡»æ˜¯å¼•ç”¨äºˆä»¥è€Œéå€¼è¯­ä¹‰æ—¶ï¼Œåº”è¯¥é‡‡ç”¨ç±»ç±»å‹ä¸“å±åè®®ã€‚ åè®®åˆæˆï¼š åŒæ—¶é‡‡çº³å¤šä¸ªåè®®,å¤šä¸ªåè®®ä¹‹é—´ç”¨ \u0026 åˆ†éš”.åè®®çš„åˆæˆå¹¶ä¸ä¼šç”Ÿæˆæ–°çš„åè®®ç±»å‹,åªæ˜¯ä¸€ä¸ªä¸´æ—¶å±€éƒ¨çš„ã€‚ protocol Name { var name: String { get } } protocol Age { var age: Int { get } } struct People: Name, Age { // éµå®ˆname ageè¿™ä¸¤ä¸ªåè®® var name: String var age: Int } // å‚æ•°æ”¯æŒå¤šä¸ªåè®®çš„è¯ï¼Œåè®®ä¹‹é—´ç”¨`\u0026`åˆ†éš”å¼€ func say(to people: Name \u0026 Age) { // å‚æ•°ç±»å‹:Name \u0026 Age print(\"This is \\(people.name), age is \\(people.age)\") // This is Joan, age is 20 } let p = People(name: \"Joan\", age: 20) say(to: p) // åªè¦éµå®ˆè¿™ä¸¤ä¸ªåè®®çš„å¯¹è±¡éƒ½èƒ½è¢«ä¼ è¿›å» å¯é€‰çš„åè®®å‰é¢éœ€è¦åŠ  @objc å…³é”®å­—ã€‚@objc : è¡¨ç¤ºè¯¥åè®®æš´éœ²ç»™OCä»£ç ï¼Œä½†å³ä½¿ä¸ä¸OCäº¤äº’åªæƒ³å®ç°å¯é€‰åè®®è¦æ±‚ï¼Œè¿˜æ˜¯è¦åŠ @objcå…³é”®å­—ã€‚å¸¦æœ‰@objcå…³é”®å­—çš„åè®®åªèƒ½è¢«OCç±»ï¼Œæˆ–è€…å¸¦æœ‰@objcå…³é”®å­—çš„ç±»éµå®ˆï¼Œç»“æ„ä½“å’Œæšä¸¾éƒ½ä¸èƒ½éµå®ˆã€‚ @objc protocol CounterDataSource { // ç”¨äºè®¡æ•°çš„æ•°æ®æº @objc optional var fixAdd: Int { get } // å¯é€‰å±æ€§ @objc optional func addForCount(count: Int) -\u003e Int // å¯é€‰æ–¹æ³•,ç”¨äºå¢åŠ æ•°å€¼ } class Counter: CounterDataSource { var count = 0 // ç”¨æ¥å­˜å‚¨å½“å‰å€¼ var dataSource: CounterDataSource? func add() { // å¢åŠ countå€¼ // ä½¿ç”¨å¯é€‰ç»‘å®šå’Œä¸¤å±‚å¯é€‰é“¾å¼è°ƒç”¨æ¥è°ƒç”¨å¯é€‰æ–¹æ³• if let amount = dataSource?.addForCount?(count: count) { count += amount }else if let amount = dataSource?.fixAdd { count += amount } } } class ThreeSource: NSObject, CounterDataSource { let fixAdd = 3 } var counter = Counter() counter.dataSource = ThreeSource() // å°†counterçš„æ•°æ®æºè®¾ç½®ä¸ºThreeSource counter.add() // å¢åŠ 3 counter.add() // å¢åŠ 3 print(counter.count) // 6 åè®®æ‰©å±•ï¼š åè®®å¯ä»¥é€šè¿‡æ‰©å±•æ¥ä¸ºéµå¾ªåè®®çš„ç±»å‹æä¾›å±æ€§ã€æ–¹æ³•ä»¥åŠä¸‹æ ‡çš„å®ç°ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œä½ å¯ä»¥åŸºäºåè®®æœ¬èº«æ¥å®ç°è¿™äº›åŠŸèƒ½ï¼Œè€Œæ— éœ€åœ¨æ¯ä¸ªéµå¾ªåè®®çš„ç±»å‹ä¸­éƒ½é‡å¤åŒæ ·çš„å®ç°ï¼Œä¹Ÿæ— éœ€ä½¿ç”¨å…¨å±€å‡½æ•°ã€‚é€šè¿‡åè®®æ‰©å±•ï¼Œæ‰€æœ‰éµå¾ªåè®®çš„ç±»å‹ï¼Œéƒ½èƒ½è‡ªåŠ¨è·å¾—è¿™ä¸ªæ‰©å±•æ‰€å¢åŠ çš„æ–¹æ³•å®ç°ï¼Œæ— éœ€ä»»ä½•é¢å¤–ä¿®æ”¹ã€‚ æä¾›é»˜è®¤å®ç°ï¼š å¯ä»¥é€šè¿‡åè®®æ‰©å±•æ¥ä¸ºåè®®è¦æ±‚çš„å±æ€§ã€æ–¹æ³•ä»¥åŠä¸‹æ ‡æä¾›é»˜è®¤çš„å®ç°ã€‚ å¦‚æœéµå¾ªåè®®çš„ç±»å‹ä¸ºè¿™äº›è¦æ±‚æä¾›äº†è‡ªå·±çš„å®ç°ï¼Œé‚£ä¹ˆè¿™äº›è‡ªå®šä¹‰å®ç°å°†ä¼šæ›¿ä»£æ‰©å±•ä¸­çš„é»˜è®¤å®ç°è¢«ä½¿ç”¨ã€‚ é€šè¿‡æ‰©å±•æä¾›çš„é»˜è®¤å®ç°å¯ä»¥ç›´æ¥è°ƒç”¨ï¼Œè€Œæ— éœ€ä½¿ç”¨å¯é€‰é“¾å¼è°ƒç”¨ã€‚ åè®®æ‰©å±•å’Œæä¾›çš„é»˜è®¤å®ç°ï¼Œå¯ä»¥å®ç°å¤šç»§æ‰¿çš„æ•ˆæœã€‚ ","date":"2016-03-01","objectID":"/swift%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/:9:0","tags":["iOS","swift"],"title":"Swiftå­¦ä¹ ç¬”è®°","uri":"/swift%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"},{"categories":["å­¦ä¹ ç¬”è®°"],"content":"è¿ç®—ç¬¦ è¦å®ç°å‰ç¼€æˆ–è€…åç¼€è¿ç®—ç¬¦ï¼Œéœ€è¦åœ¨å£°æ˜è¿ç®—ç¬¦å‡½æ•°çš„æ—¶å€™åœ¨funcå…³é”®å­—ä¹‹å‰æŒ‡å®šprefixæˆ–è€…postfixä¿®é¥°ç¬¦ã€‚ ","date":"2016-03-01","objectID":"/swift%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/:10:0","tags":["iOS","swift"],"title":"Swiftå­¦ä¹ ç¬”è®°","uri":"/swift%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"},{"categories":["å­¦ä¹ ç¬”è®°"],"content":"è§£æƒ‘ 1. lazyä¿®é¥°çš„å®ä¾‹ä¸ºä»€ä¹ˆä¸èƒ½ç”¨lazy letï¼Ÿ åœ¨ Swift é‡Œä½ ä¸èƒ½åˆ›å»º lazy let å®ä¾‹å±æ€§ï¼Œè¿™æ˜¯ç”± lazy çš„å…·ä½“å®ç°ç»†èŠ‚å†³å®šçš„ï¼šå®ƒåœ¨æ²¡æœ‰å€¼çš„æƒ…å†µä¸‹ä»¥æŸç§æ–¹å¼è¢«åˆå§‹åŒ–ï¼Œç„¶ååœ¨è¢«è®¿é—®æ—¶æ”¹å˜è‡ªå·±çš„å€¼ï¼Œè¿™å°±è¦æ±‚è¯¥å±æ€§æ˜¯å¯å˜çš„ã€‚å› æ­¤æ— æ³•å®ç°ä¸€ä¸ªä½¿ç”¨æ—¶æ‰ä¼šè¢«è®¡ç®—çš„å¸¸é‡ã€‚ æ—¢ç„¶è¯´åˆ°äº†letï¼Œé¡ºä¾¿è¯´ä¸€æ¡æ¯”è¾ƒæœ‰æ„æ€çš„ç‰¹æ€§ï¼š è¢«å£°æ˜åœ¨å…¨å±€ä½œç”¨åŸŸä¸‹ æˆ–è€… è¢«å£°æ˜ä¸ºä¸€ä¸ªç±»å‹å±æ€§ï¼ˆå³å£°æ˜ä¸ºstatic letï¼‰çš„å¸¸é‡ï¼Œæ˜¯è‡ªåŠ¨å…·æœ‰æƒ°æ€§(lazy)çš„ï¼Œè€Œä¸”è¿˜æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ ","date":"2016-03-01","objectID":"/swift%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/:11:0","tags":["iOS","swift"],"title":"Swiftå­¦ä¹ ç¬”è®°","uri":"/swift%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"},{"categories":["å­¦ä¹ ç¬”è®°"],"content":"é‡è¦æ¦‚å¿µ å†™æ—¶å¤åˆ¶: Swift ä¸­çš„â€œå†™æ—¶å¤åˆ¶â€æ˜¯æŒ‡ï¼Œå€¼ç±»å‹åªåœ¨è¢«æ”¹åŠ¨å‰è¿›è¡Œå¤åˆ¶ã€‚ä¼ ç»Ÿæ„ä¹‰ä¸Šçš„å€¼ç±»å‹ä¼šåœ¨è¢«ä¼ é€’æˆ–è€…è¢«èµ‹å€¼ç»™å…¶ä»–å˜é‡æ—¶å°±å‘ç”Ÿå¤åˆ¶è¡Œä¸ºï¼Œä½†æ˜¯è¿™å°†ä¼šå¸¦æ¥æå¤§çš„ï¼Œä¹Ÿæ˜¯ä¸å¿…è¦çš„æ€§èƒ½æŸè€—ã€‚å†™æ—¶å¤åˆ¶å°†åœ¨å€¼è¢«ä¼ é€’å’Œèµ‹å€¼ç»™å˜é‡æ—¶é¦–å…ˆæ£€æŸ¥å…¶å¼•ç”¨è®¡æ•°ï¼Œå¦‚æœå¼•ç”¨è®¡æ•°ä¸º 1 (å”¯ä¸€å¼•ç”¨)ï¼Œé‚£ä¹ˆæ„å‘³ç€å¹¶æ²¡æœ‰å…¶ä»–å˜é‡æŒæœ‰è¯¥å€¼ï¼Œå¯¹å½“å‰å€¼çš„å¤åˆ¶ä¹Ÿå°±å¯ä»¥å®Œå…¨é¿å…ï¼Œä»¥æ­¤åœ¨ä¿æŒå€¼ç±»å‹ä¸å¯å˜æ€§çš„ä¼˜è‰¯ç‰¹æ€§çš„åŒæ—¶ï¼Œä¿è¯ä½¿ç”¨æ•ˆç‡ã€‚Swift ä¸­åƒæ˜¯ Array å’Œ Dictionary è¿™æ ·çš„ç±»å‹éƒ½æ˜¯å€¼ç±»å‹ï¼Œä½†æ˜¯åº•å±‚å®ç°ç¡®æ˜¯å¼•ç”¨ç±»å‹ï¼Œå®ƒä»¬éƒ½åˆ©ç”¨äº†å†™æ—¶å¤åˆ¶çš„æŠ€æœ¯æ¥ä¿è¯æ•ˆç‡ã€‚ ","date":"2016-03-01","objectID":"/swift%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/:12:0","tags":["iOS","swift"],"title":"Swiftå­¦ä¹ ç¬”è®°","uri":"/swift%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"},{"categories":["å­¦ä¹ ç¬”è®°"],"content":"å¤‡æ³¨ ä»¥ä¸Šå†…å®¹å…¨éƒ¨æ‘˜è‡ªThe Swift Programming Language ä¸­æ–‡ç‰ˆ ","date":"2016-03-01","objectID":"/swift%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/:13:0","tags":["iOS","swift"],"title":"Swiftå­¦ä¹ ç¬”è®°","uri":"/swift%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"},{"categories":["å­¦ä¹ ç¬”è®°"],"content":"èµ„æ–™ Swift çƒ§è„‘ä½“æ“ï¼ˆä¸€ï¼‰ - Optional çš„åµŒå¥— Swift çƒ§è„‘ä½“æ“ï¼ˆäºŒï¼‰ - å‡½æ•°çš„å‚æ•° Swift çƒ§è„‘ä½“æ“ï¼ˆä¸‰ï¼‰ - é«˜é˜¶å‡½æ•° Swift çƒ§è„‘ä½“æ“ï¼ˆå››ï¼‰ - map å’Œ flatMap Swift çƒ§è„‘ä½“æ“ï¼ˆäº”ï¼‰- Monad â€œæ‡’â€ç‚¹å„¿å¥½ Swift2.0ï¼šç†è§£flatMap è°ˆè°ˆ Swift ä¸­çš„ map å’Œ FlatMap ç¬¬äºŒç¯‡ - å¦ä¸€å±‚æ€ç»´æ–¹å¼ Swiftä¸­æšä¸¾é«˜çº§ç”¨æ³•ä¸å®è·µ Unowned è¿˜æ˜¯ Weakï¼Ÿç”Ÿå‘½å‘¨æœŸå’Œæ€§èƒ½å¯¹æ¯” æ‰€æœ‰æƒå®£è¨€ - Swift å®˜æ–¹æ–‡ç«  Ownership Manifesto è¯‘æ–‡è¯„æ³¨ç‰ˆ ","date":"2016-03-01","objectID":"/swift%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/:14:0","tags":["iOS","swift"],"title":"Swiftå­¦ä¹ ç¬”è®°","uri":"/swift%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"}]