<!doctype html><html lang=zh-CN><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>ReactiveCocoa部分简析 - Zero.D.Saber</title><meta name=Description content="简析`ReactiveCocoa`中的几个函数"><meta property="og:url" content="https://faimin.github.io/reactivecocoa%E9%83%A8%E5%88%86%E7%AE%80%E6%9E%90/">
<meta property="og:site_name" content="Zero.D.Saber"><meta property="og:title" content="ReactiveCocoa部分简析"><meta property="og:description" content="简析`ReactiveCocoa`中的几个函数"><meta property="og:locale" content="zh_CN"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2016-10-01T09:42:32+08:00"><meta property="article:modified_time" content="2022-08-27T14:15:30+08:00"><meta property="article:tag" content="IOS"><meta property="article:tag" content="Reactive"><meta property="og:image" content="https://faimin.github.io/logo/avatar.gif"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://faimin.github.io/logo/avatar.gif"><meta name=twitter:title content="ReactiveCocoa部分简析"><meta name=twitter:description content="简析`ReactiveCocoa`中的几个函数"><meta name=application-name content="LoveIt"><meta name=apple-mobile-web-app-title content="LoveIt"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel=icon href=/logo/avatar.gif><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://faimin.github.io/reactivecocoa%E9%83%A8%E5%88%86%E7%AE%80%E6%9E%90/><link rel=prev href=https://faimin.github.io/swift%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/><link rel=next href=https://faimin.github.io/cocoapods_tips/><link rel=stylesheet href=/css/style.min.css><link rel=preload href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css></noscript><link rel=preload href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"ReactiveCocoa部分简析","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/faimin.github.io\/reactivecocoa%E9%83%A8%E5%88%86%E7%AE%80%E6%9E%90\/"},"image":["https:\/\/faimin.github.io\/images\/Apple-Devices-Preview.png"],"genre":"posts","keywords":"iOS, reactive","wordcount":3475,"url":"https:\/\/faimin.github.io\/reactivecocoa%E9%83%A8%E5%88%86%E7%AE%80%E6%9E%90\/","datePublished":"2016-10-01T09:42:32+08:00","dateModified":"2022-08-27T14:15:30+08:00","license":"This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher":{"@type":"Organization","name":"Zero.D.Saber","logo":"https:\/\/faimin.github.io\/images\/avatar.png"},"author":{"@type":"Person","name":"Zero.D.Saber"},"description":"简析`ReactiveCocoa`中的几个函数"}</script></head><body data-header-desktop=fixed data-header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title=Zero.D.Saber>Zero.D.Saber's Notes</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>所有文章 </a><a class=menu-item href=/tags/>标签 </a><a class=menu-item href=/categories/>分类 </a><a class=menu-item href=/categories/documentation/>文档 </a><a class=menu-item href=/about/whoami>关于 </a><a class=menu-item href=https://github.com/faimin title=GitHub rel="noopener noreffer" target=_blank><i class='fab fa-github fa-fw' aria-hidden=true></i> </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop>
<input type=text placeholder=搜索文章标题或内容... id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=搜索><i class="fas fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=清空><i class="fas fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i>
</span></span><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题><i class="fas fa-adjust fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="menu-item language" title=选择语言><i class="fa fa-globe" aria-hidden=true></i>
<select class=language-select id=language-select-desktop onchange="location=this.value"><option value=/reactivecocoa%E9%83%A8%E5%88%86%E7%AE%80%E6%9E%90/ selected>简体中文</option></select></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title=Zero.D.Saber>Zero.D.Saber's Notes</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder=搜索文章标题或内容... id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=搜索><i class="fas fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=清空><i class="fas fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>取消</a></div><a class=menu-item href=/posts/ title>所有文章</a><a class=menu-item href=/tags/ title>标签</a><a class=menu-item href=/categories/ title>分类</a><a class=menu-item href=/categories/documentation/ title>文档</a><a class=menu-item href=/about/whoami title>关于</a><a class=menu-item href=https://github.com/faimin title=GitHub rel="noopener noreffer" target=_blank><i class='fab fa-github fa-fw' aria-hidden=true></i></a><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题>
<i class="fas fa-adjust fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class=menu-item title=选择语言><i class="fa fa-globe fa-fw" aria-hidden=true></i>
<select class=language-select onchange="location=this.value"><option value=/reactivecocoa%E9%83%A8%E5%88%86%E7%AE%80%E6%9E%90/ selected>简体中文</option></select></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>目录</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">ReactiveCocoa部分简析</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=https://github.com/faimin title=Author target=_blank rel="noopener noreffer author" class=author><i class="fas fa-user-circle fa-fw" aria-hidden=true></i>Zero.D.Saber</a></span>&nbsp;<span class=post-category>收录于 <a href=/categories/%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86/><i class="far fa-folder fa-fw" aria-hidden=true></i>实现原理</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw" aria-hidden=true></i>&nbsp;<time datetime=2016-10-01>2016-10-01</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden=true></i>&nbsp;约 3475 字&nbsp;
<i class="far fa-clock fa-fw" aria-hidden=true></i>&nbsp;预计阅读 7 分钟&nbsp;<span id=/reactivecocoa%E9%83%A8%E5%88%86%E7%AE%80%E6%9E%90/ class=leancloud_visitors data-flag-title=ReactiveCocoa部分简析>
<i class="far fa-eye fa-fw" aria-hidden=true></i>&nbsp;<span class=leancloud-visitors-count></span>&nbsp;次阅读
</span>&nbsp;</div></div><div class=featured-image><img class=lazyload src=/svg/loading.min.svg data-src=/images/rac/reactive_milim.jpg data-srcset="/images/rac/reactive_milim.jpg, /images/rac/reactive_milim.jpg 1.5x, /images/rac/reactive_milim.jpg 2x" data-sizes=auto alt=/images/rac/reactive_milim.jpg title="简析`ReactiveCocoa`中的几个函数"></div><div class="details toc" id=toc-static data-kept><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fas fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#flattenmap-与-map>flattenMap 与 map</a></li><li><a href=#multicast>multicast</a></li><li><a href=#raccommand>RACCommand</a></li><li><a href=#推荐>推荐</a></li></ul></nav></div></div><div class=content id=content><p>简析<code>ReactiveCocoa</code>中的几个函数</p><h2 id=flattenmap-与-map>flattenMap 与 map</h2><blockquote><ul><li>推荐文章：</li><li><a href=http://www.jianshu.com/p/d262f2c55fbe target=_blank rel="noopener noreffer">RAC 核心元素与信号流</a></li><li><a href=http://tech.meituan.com/talk-about-reactivecocoas-cold-signal-and-hot-signal-part-3.html target=_blank rel="noopener noreffer">细说 ReactiveCocoa 的冷信号与热信号（三）：怎么处理冷信号与热信号</a></li></ul></blockquote><ul><li><p><code>map</code> 和 <code>flatten</code> 是基于 <code>flattenMap</code>, 而 <code>flattenMap</code> 是基于 <code>bind:</code>, 所以在此之前先来看看 <code>bind</code> 函数。</p></li><li><p>具体来看源码（为方便理解，去掉了源代码中 <code>RACDisposable</code>, <code>@synchronized</code>, <code>@autoreleasepool</code> 相关代码 )。当新信号 <code>N</code> 被外部订阅时，会进入信号 <code>N</code> 的 <code>didSubscribeBlock</code> (1)，之后订阅原信号 <code>O</code> (2)，当原信号 <code>O</code> 有值输出后就用 <code>bind</code> 函数传入的 <code>bindBlock</code> 将其变换成中间信号 <code>M</code> (3), 并马上对其进行订阅 (4)，最后将中间信号 <code>M</code> 的输出作为新信号 <code>N</code> 的输出 (5)。即：当新生成的信号被订阅时，源信号也会立即被订阅。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=o>-</span> <span class=p>(</span><span class=n>RACSignal</span> <span class=o>*</span><span class=p>)</span><span class=nl>bind</span><span class=p>:(</span><span class=n>RACStreamBindBlock</span> <span class=p>(</span><span class=o>^</span><span class=p>)(</span><span class=kt>void</span><span class=p>))</span><span class=n>block</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>[</span><span class=n>RACSignal</span> <span class=nl>createSignal</span><span class=p>:</span><span class=o>^</span><span class=p>(</span><span class=n>id</span><span class=o>&lt;</span><span class=n>RACSubscriber</span><span class=o>&gt;</span> <span class=n>subscriber</span><span class=p>)</span> <span class=p>{</span><span class=c1>// (1)
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>RACStreamBindBlock</span> <span class=n>bindingBlock</span> <span class=o>=</span> <span class=n>block</span><span class=p>();</span> <span class=c1>// (MARK: 此处执行 block 回调, 生成一个 bindingBlock)
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=n>self</span> <span class=nl>subscribeNext</span><span class=p>:</span><span class=o>^</span><span class=p>(</span><span class=n>id</span> <span class=n>x</span><span class=p>)</span> <span class=p>{</span><span class=c1>// (2)
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=n>BOOL</span> <span class=n>stop</span> <span class=o>=</span> <span class=n>NO</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=n>id</span> <span class=n>middleSignal</span> <span class=o>=</span> <span class=n>bindingBlock</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>stop</span><span class=p>);</span>  <span class=c1>// (3) map 与 flatten 结果不同，问题就出在这里
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=n>middleSignal</span> <span class=o>!=</span> <span class=n>nil</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=n>RACDisposable</span> <span class=o>*</span><span class=n>disposable</span> <span class=o>=</span> <span class=p>[</span><span class=n>middleSignal</span> <span class=nl>subscribeNext</span><span class=p>:</span><span class=o>^</span><span class=p>(</span><span class=n>id</span> <span class=n>x</span><span class=p>)</span> <span class=p>{</span><span class=c1>// (4)
</span></span></span><span class=line><span class=cl><span class=c1></span>                    <span class=p>[</span><span class=n>subscriber</span> <span class=nl>sendNext</span><span class=p>:</span><span class=n>x</span><span class=p>];</span>  <span class=c1>// (5)
</span></span></span><span class=line><span class=cl><span class=c1></span>                <span class=p>}</span> <span class=nl>error</span><span class=p>:</span><span class=o>^</span><span class=p>(</span><span class=n>NSError</span> <span class=o>*</span><span class=n>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=p>[</span><span class=n>subscriber</span> <span class=nl>sendError</span><span class=p>:</span><span class=n>error</span><span class=p>];</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span> <span class=nl>completed</span><span class=p>:</span><span class=o>^</span><span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=p>[</span><span class=n>subscriber</span> <span class=n>sendCompleted</span><span class=p>];</span>
</span></span><span class=line><span class=cl>                <span class=p>}];</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span> <span class=nl>error</span><span class=p>:</span><span class=o>^</span><span class=p>(</span><span class=n>NSError</span> <span class=o>*</span><span class=n>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=p>[</span><span class=n>subscriber</span> <span class=nl>sendError</span><span class=p>:</span><span class=n>error</span><span class=p>];</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span> <span class=nl>completed</span><span class=p>:</span><span class=o>^</span><span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=p>[</span><span class=n>subscriber</span> <span class=n>sendCompleted</span><span class=p>];</span>
</span></span><span class=line><span class=cl>        <span class=p>}];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>nil</span>
</span></span><span class=line><span class=cl>    <span class=p>}];</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p><code>flattenMap</code> 其实就是对 <code>bind:</code> 方法进行了一些安全检查，它最终返回的是 <code>bindBlock</code> 执行后生成的那个中间 <code>signal</code> 又被订阅后传递出的值的信号，而 <code>map</code> 方法返回的是 <code>bindBlock</code> 的执行结果生成的那个信号，没有再加工处理（即被订阅，再发送值）</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=o>-</span> <span class=p>(</span><span class=n>instancetype</span><span class=p>)</span><span class=nl>flattenMap</span><span class=p>:(</span><span class=n>RACStream</span> <span class=o>*</span> <span class=p>(</span><span class=o>^</span><span class=p>)(</span><span class=n>id</span> <span class=n>value</span><span class=p>))</span><span class=n>block</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Class</span> <span class=k>class</span> <span class=err>= </span><span class=nc>self</span><span class=p>.</span><span class=k>class</span><span class=err>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>[[</span><span class=n>self</span> <span class=nl>bind</span><span class=p>:</span><span class=o>^</span><span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>/// @return 返回的是 RACStreamBindBlock
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=c1>/// @discussion
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=c1>///
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=c1>/// 跟 `bind：` 方法中的代码对应起来如下：
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=c1>/// BOOL stop = NO;
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=c1>/// id middleSignal = bindingBlock(x, &amp;stop);
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=c1>///
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=c1>/// 与上面 `bind:` 函数中的 (3) 对应起来,
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=c1>/// 可以看出 bindBlock 中的 x 是原信号被 subscribe 后传出的值，即对应下面的 value
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=c1>/// 也即 flattenMap block 中执行后传出的值，
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=c1>/// 即上面的 (RACStream * (^ block)(id value)) 中的 value
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=c1>/// flattenMap: 后的那个 block 其实与 bind: 后的 block 基本是一样的，参数都是原信号发出的值，返回值都是 RACStream，差别就是一个 bool 参数，所以说，flattenMap 其实就是对 bind 方法进行了一些安全检查
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=c1>/// 综上所述：*flattenMap 方法中传进来的那个 block 参数值就是原信号被订阅后发送的值*
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>return</span> <span class=o>^</span><span class=p>(</span><span class=n>id</span> <span class=n>value</span><span class=p>,</span> <span class=n>BOOL</span> <span class=o>*</span><span class=n>stop</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=c1>// 下面这个 value 并不是 flattenMap 后面 block 中的那个 value（原信号被订阅后发出去的值），而是原信号发出的值被转换为中间信号后，又被订阅后发出去的值。
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=n>id</span> <span class=n>stream</span> <span class=o>=</span> <span class=n>block</span><span class=p>(</span><span class=n>value</span><span class=p>)</span> <span class=o>?:</span> <span class=p>[</span><span class=k>class</span> <span class=nc>empty</span><span class=p>];</span>
</span></span><span class=line><span class=cl>            <span class=n>NSCAssert</span><span class=p>([</span><span class=n>stream</span> <span class=nl>isKindOfClass</span><span class=p>:</span><span class=n>RACStream</span><span class=p>.</span><span class=k>class</span><span class=err>], @&#34;</span><span class=nc>Value</span> <span class=n>returned</span> <span class=n>from</span> <span class=o>-</span><span class=nl>flattenMap</span><span class=p>:</span> <span class=n>is</span> <span class=n>not</span> <span class=n>a</span> <span class=nl>stream</span><span class=p>:</span> <span class=o>%</span><span class=err>@</span><span class=s>&#34;, stream);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>stream</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=p>}]</span> <span class=nl>setNameWithFormat</span><span class=p>:</span><span class=err>@</span><span class=s>&#34;[%@] -flattenMap:&#34;</span><span class=p>,</span> <span class=n>self</span><span class=p>.</span><span class=n>name</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p><code>map</code>: 下面是 <code>map</code> 方法的源码，可以看出，<code>map</code> 只是对 <code>flattenMap</code> 传出的 <code>vaue</code>（即原信号传出的值）进行了 <code>mapBlock</code> 操作，并没有再进行订阅操作，即并不像 <code>bind：</code> 一样再次对原信号进行 <code>bindBlock</code> 后生成的中间信号进行订阅。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=o>-</span> <span class=p>(</span><span class=n>instancetype</span><span class=p>)</span><span class=nl>map</span><span class=p>:(</span><span class=n>id</span> <span class=p>(</span><span class=o>^</span><span class=p>)(</span><span class=n>id</span> <span class=n>value</span><span class=p>))</span><span class=n>block</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>NSCParameterAssert</span><span class=p>(</span><span class=n>block</span> <span class=o>!=</span> <span class=n>nil</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>Class</span> <span class=k>class</span> <span class=err>= </span><span class=nc>self</span><span class=p>.</span><span class=k>class</span><span class=err>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>[[</span><span class=n>self</span> <span class=nl>flattenMap</span><span class=p>:</span><span class=o>^</span><span class=p>(</span><span class=n>id</span> <span class=n>value</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>[</span><span class=k>class</span> <span class=nc>return</span><span class=o>:</span><span class=n>block</span><span class=p>(</span><span class=n>value</span><span class=p>)];</span>
</span></span><span class=line><span class=cl>    <span class=p>}]</span> <span class=nl>setNameWithFormat</span><span class=p>:</span><span class=err>@</span><span class=s>&#34;[%@] -map:&#34;</span><span class=p>,</span> <span class=n>self</span><span class=p>.</span><span class=n>name</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p><code>flatten</code>: 该操作主要作用于信号的信号。原信号 O 作为信号的信号，在被订阅时输出的数据必然也是个信号 (signalValue)，这往往不是我们想要的。当我们执行 [O flatten] 操作时，因为 flatten 内部调用了 flattenMap (1)，flattenMap 里对应的中间信号就是原信号 O 输出的 signalValue (2)。按照之前分析的经验，在 flattenMap 操作中新信号 N 输出的结果就是各中间信号 M 输出的集合。因此在 flatten 操作中新信号 N 被订阅时输出的值就是原信号 O 的各个子信号输出值的集合。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=o>-</span> <span class=p>(</span><span class=n>instancetype</span><span class=p>)</span><span class=n>flatten</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>[</span><span class=n>self</span> <span class=nl>flattenMap</span><span class=p>:</span><span class=o>^</span><span class=p>(</span><span class=n>RACSignal</span> <span class=o>*</span><span class=n>signalValue</span><span class=p>)</span> <span class=p>{</span><span class=c1>// (1)
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=c1>/// 返回值作为 bind: 中的中间信号
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>return</span> <span class=n>signalValue</span><span class=p>;</span> <span class=c1>// (2)
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>};</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div></li></ul><p><strong>小结：</strong></p><p><code>flatten</code> 与 <code>map</code> 之间的区别：<code>flatten</code> 和 <code>map</code> 后面的 <code>block</code> 返回结果其实最终都会变为 <code>bind:</code> 方法中的中间信号，但是 <code>flatten:</code> 的 <code>block</code> 是直接把原信号发出的值返回来作为中间信号的，所以中间信号被订阅，其实就是原信号发出的值又被订阅，这也就是 <code>flatten:</code> 能拿到信号中的信号中的值的原因。
而 <code>map:</code> 后面的 <code>block</code> 是把原信号发出的值加工处理了的，又生成了一个新的信号，即 <code>map:</code> 方法 <code>block</code> 返回的中间信号已经不是原来的信号中的信号了，而是把原信号发出的值作为它的包含值的一个新的信号，它被订阅时，发送的是原信号发出的那个值，这就是 <code>map</code> 拿不到原信号中的信号的原因。
说白了就是 <code>flatten:</code> 操作的始终是原来的信号，而 <code>map:</code> 会生成一个包含原信号发送值的新信号。</p><hr><h2 id=multicast>multicast</h2><pre><code>- (RACMulticastConnection *)multicast:(RACSubject *)subject;
</code></pre><hr><ol><li><p>当 <code>RACSignal</code> 类的实例调用 <code>- (RACMulticastConnection *)multicast:(RACSubject *)subject</code> 时，以 <code>self</code> 和 <code>subject</code> 作为构造参数创建一个 <code>RACMulticastConnection</code> 实例。</p></li><li><p><code>RACMulticastConnection</code> 构造的时候，保存 <code>source</code> 和 <code>subject</code> 作为成员变量，创建一个 <code>RACSerialDisposable</code> 对象，用于取消订阅。</p></li><li><p>当 <code>RACMulticastConnection</code> 类的实例调用 <code>- (RACDisposable *)connect</code> 这个方法的时候，判断是否是第一次。如果是的话 用 <code>_signal</code> 这个成员变量（RACSubject 类型）来订阅 <code>sourceSignal</code>， 之后返回 <code>self.serialDisposable</code>，否则直接返回 <code>self.serialDisposable</code> 。</p></li><li><p><code>RACMulticastConnection</code> 的 <code>signal</code> 只读属性，就是一个热信号，订阅这个热信号就避免了各种副作用的问题。它会在 <code>- (RACDisposable *)connect</code> 第一次调用后，根据 <code>sourceSignal</code> 的订阅结果来传递事件。</p></li><li><p>想要确保第一次订阅就能成功订阅 <code>sourceSignal</code> ，可以使用 <code>- (RACSignal *)autoconnect</code> 这个方法，它保证了第一个订阅者触发 <code>sourceSignal</code> 的订阅，也保证了当返回的信号所有订阅者都关闭连接后 <code>sourceSignal</code> 被正确关闭连接。</p></li><li><p>这里面订阅 <code>sourceSignal</code> 是重点，<code>_signal</code> 是一个 <code>RACSubject</code> 类型，它里面维护着一个可变数组，每当它被订阅时，会把所有的<strong>订阅者</strong>保存到这个数组中。当 <code>connection.signal</code>（即 <code>_signal</code>）被订阅时，其实是 <code>_signal</code> 被订阅了。由于 <code>_signal</code> 是 <code>RACSubject</code> 类型对象，且 <code>_signal</code> 也是信号，它里面重写了订阅方法，所以会执行它自己的 <code>subscribe:</code> 方法，执行此方法之前订阅者参数是 <code>RACSubscriber</code> 类型，但是在这个 subscribe 方法中，初始化了一个 <code>RACPassthroughSubscriber</code> 实例对象，使它作为新的订阅者（其实就是对订阅者进行了一层包装），并把它存入了 <code>subject</code> 维护的那个订阅者数组里（原来的 <code>订阅者</code> 和 <code>信号</code> 被 <code>RACPassthroughSubscriber</code> 实例保存了），所以数组中最终保存的是 <code>RACPassthroughSubscriber</code> 类型的订阅者，然后它发送消息的时候调的还是它持有的 <code>subject</code> 对象进行发送消息。</p></li><li><p>当 <code>RACMulticastConnection</code> 调用 <code>connect</code> 方法时，源信号 <code>sourceSignal</code> 被 <code>_signal</code> 订阅，即执行 <code>[sourceSignal subscribe:subject]</code> 方法，然后执行订阅 <code>subscribeNext:</code>block 回调，在回调中执行 <code>sendNext:</code>，由于订阅者是 <code>RACSubject</code> 类型的实例对象，它里面也会执行 <code>sendNext:</code> 方法，此方法中会遍历它的数组中的订阅者依次发送消息。</p></li><li><p><code>connect</code> 时订阅者是 <code>RACSubject</code> 发送的 <code>sendNext:</code>，<code>subject</code> 会拿到它那个订阅者数组遍历，取出其中的 <code>RACPassthroughSubscriber</code> 对象，然后用 <code>RACPassthroughSubscriber</code> 对象中的真实的订阅者去发送数据。</p></li></ol><hr><h2 id=raccommand>RACCommand</h2><p>直接上源码:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=o>-</span> <span class=p>(</span><span class=n>id</span><span class=p>)</span><span class=nl>initWithEnabled</span><span class=p>:(</span><span class=n>RACSignal</span> <span class=o>*</span><span class=p>)</span><span class=n>enabledSignal</span> <span class=nl>signalBlock</span><span class=p>:(</span><span class=n>RACSignal</span> <span class=o>*</span> <span class=p>(</span><span class=o>^</span><span class=p>)(</span><span class=n>id</span> <span class=n>input</span><span class=p>))</span><span class=n>signalBlock</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>NSCParameterAssert</span><span class=p>(</span><span class=n>signalBlock</span> <span class=o>!=</span> <span class=n>nil</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=n>self</span> <span class=o>=</span> <span class=p>[</span><span class=n>super</span> <span class=n>init</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=p>(</span><span class=n>self</span> <span class=o>==</span> <span class=n>nil</span><span class=p>)</span> <span class=k>return</span> <span class=n>nil</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=n>_activeExecutionSignals</span> <span class=o>=</span> <span class=p>[[</span><span class=n>NSMutableArray</span> <span class=n>alloc</span><span class=p>]</span> <span class=n>init</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=n>_signalBlock</span> <span class=o>=</span> <span class=p>[</span><span class=n>signalBlock</span> <span class=n>copy</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	
</span></span><span class=line><span class=cl>	<span class=c1>// 监听 `activeExecutionSignals` 数组
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=n>RACSignal</span> <span class=o>*</span><span class=n>newActiveExecutionSignals</span> <span class=o>=</span> <span class=p>[[[[[</span><span class=n>self</span>
</span></span><span class=line><span class=cl>		<span class=nl>rac_valuesAndChangesForKeyPath</span><span class=p>:</span><span class=err>@</span><span class=n>keypath</span><span class=p>(</span><span class=n>self</span><span class=p>.</span><span class=n>activeExecutionSignals</span><span class=p>)</span> <span class=nl>options</span><span class=p>:</span><span class=n>NSKeyValueObservingOptionNew</span> <span class=nl>observer</span><span class=p>:</span><span class=n>nil</span><span class=p>]</span>
</span></span><span class=line><span class=cl>		<span class=nl>reduceEach</span><span class=p>:</span><span class=o>^</span><span class=p>(</span><span class=n>id</span> <span class=n>_</span><span class=p>,</span> <span class=n>NSDictionary</span> <span class=o>*</span><span class=n>change</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>NSArray</span> <span class=o>*</span><span class=n>signals</span> <span class=o>=</span> <span class=n>change</span><span class=p>[</span><span class=n>NSKeyValueChangeNewKey</span><span class=p>];</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span> <span class=p>(</span><span class=n>signals</span> <span class=o>==</span> <span class=n>nil</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=p>[</span><span class=n>RACSignal</span> <span class=n>empty</span><span class=p>];</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>			<span class=c1>// 把数组转换为信号发送出去
</span></span></span><span class=line><span class=cl><span class=c1></span>			<span class=k>return</span> <span class=p>[</span><span class=n>signals</span><span class=p>.</span><span class=n>rac_sequence</span> <span class=nl>signalWithScheduler</span><span class=p>:</span><span class=n>RACScheduler</span><span class=p>.</span><span class=n>immediateScheduler</span><span class=p>];</span>
</span></span><span class=line><span class=cl>		<span class=p>}]</span>
</span></span><span class=line><span class=cl>		<span class=n>concat</span><span class=p>]</span>    		<span class=c1>// 把各个信号中的信号连接起来
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=n>publish</span><span class=p>]</span>		<span class=c1>// 广播出去，可以被多个订阅者订阅
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=n>autoconnect</span><span class=p>];</span>	<span class=c1>// 有订阅了再发送广播
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>	<span class=c1>// 把上面的信号 `map` 一下, 当出现错误的时候转换成 `empty` 空信号, 并在主线程上传递
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=n>_executionSignals</span> <span class=o>=</span> <span class=p>[[[</span><span class=n>newActiveExecutionSignals</span>
</span></span><span class=line><span class=cl>		<span class=nl>map</span><span class=p>:</span><span class=o>^</span><span class=p>(</span><span class=n>RACSignal</span> <span class=o>*</span><span class=n>signal</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=p>[</span><span class=n>signal</span> <span class=nl>catchTo</span><span class=p>:[</span><span class=n>RACSignal</span> <span class=n>empty</span><span class=p>]];</span>
</span></span><span class=line><span class=cl>		<span class=p>}]</span>
</span></span><span class=line><span class=cl>		<span class=nl>deliverOn</span><span class=p>:</span><span class=n>RACScheduler</span><span class=p>.</span><span class=n>mainThreadScheduler</span><span class=p>]</span>
</span></span><span class=line><span class=cl>		<span class=nl>setNameWithFormat</span><span class=p>:</span><span class=err>@</span><span class=s>&#34;%@ -executionSignals&#34;</span><span class=p>,</span> <span class=n>self</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	
</span></span><span class=line><span class=cl>	<span class=c1>// 先通过 `ignoreValues` 方法屏蔽掉 `sendNext:` 的结果，只保留 `sendError:` 和 `sendCompleted` 结果，然后再通过 `catch:` 方法拿到所有的 `sendError:` 结果，发送给订阅者。
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=c1>// 此处用的是 `flattenMap`，可以直接获取到错误信息。
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=n>RACMulticastConnection</span> <span class=o>*</span><span class=n>errorsConnection</span> <span class=o>=</span> <span class=p>[[[</span><span class=n>newActiveExecutionSignals</span>
</span></span><span class=line><span class=cl>		<span class=nl>flattenMap</span><span class=p>:</span><span class=o>^</span><span class=p>(</span><span class=n>RACSignal</span> <span class=o>*</span><span class=n>signal</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=k>return</span> <span class=p>[[</span><span class=n>signal</span>
</span></span><span class=line><span class=cl>				<span class=n>ignoreValues</span><span class=p>]</span>
</span></span><span class=line><span class=cl>				<span class=k>catch</span><span class=o>:^</span><span class=p>(</span><span class=n>NSError</span> <span class=o>*</span><span class=n>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=k>return</span> <span class=p>[</span><span class=n>RACSignal</span> <span class=k>return</span><span class=o>:</span><span class=n>error</span><span class=p>];</span>
</span></span><span class=line><span class=cl>				<span class=p>}];</span>
</span></span><span class=line><span class=cl>		<span class=p>}]</span>
</span></span><span class=line><span class=cl>		<span class=nl>deliverOn</span><span class=p>:</span><span class=n>RACScheduler</span><span class=p>.</span><span class=n>mainThreadScheduler</span><span class=p>]</span>
</span></span><span class=line><span class=cl>		<span class=n>publish</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	
</span></span><span class=line><span class=cl>	<span class=n>_errors</span> <span class=o>=</span> <span class=p>[</span><span class=n>errorsConnection</span><span class=p>.</span><span class=n>signal</span> <span class=nl>setNameWithFormat</span><span class=p>:</span><span class=err>@</span><span class=s>&#34;%@ -errors&#34;</span><span class=p>,</span> <span class=n>self</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=p>[</span><span class=n>errorsConnection</span> <span class=n>connect</span><span class=p>];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=c1>// 根据执行信号的数量判断 `RACCommand` 当前是否正在执行
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=n>RACSignal</span> <span class=o>*</span><span class=n>immediateExecuting</span> <span class=o>=</span> <span class=p>[</span><span class=n>RACObserve</span><span class=p>(</span><span class=n>self</span><span class=p>,</span> <span class=n>activeExecutionSignals</span><span class=p>)</span> <span class=nl>map</span><span class=p>:</span><span class=o>^</span><span class=p>(</span><span class=n>NSArray</span> <span class=o>*</span><span class=n>activeSignals</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=err>@</span><span class=p>(</span><span class=n>activeSignals</span><span class=p>.</span><span class=n>count</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=p>}];</span>
</span></span><span class=line><span class=cl>	
</span></span><span class=line><span class=cl>	<span class=c1>// 是否正在执行
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=n>_executing</span> <span class=o>=</span> <span class=p>[[[[[</span><span class=n>immediateExecuting</span>
</span></span><span class=line><span class=cl>		<span class=nl>deliverOn</span><span class=p>:</span><span class=n>RACScheduler</span><span class=p>.</span><span class=n>mainThreadScheduler</span><span class=p>]</span>
</span></span><span class=line><span class=cl>		<span class=c1>// This is useful before the first value arrives on the main thread.
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=nl>startWith</span><span class=p>:</span><span class=err>@</span><span class=n>NO</span><span class=p>]</span>
</span></span><span class=line><span class=cl>		<span class=n>distinctUntilChanged</span><span class=p>]</span>
</span></span><span class=line><span class=cl>		<span class=n>replayLast</span><span class=p>]</span>
</span></span><span class=line><span class=cl>		<span class=nl>setNameWithFormat</span><span class=p>:</span><span class=err>@</span><span class=s>&#34;%@ -executing&#34;</span><span class=p>,</span> <span class=n>self</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	
</span></span><span class=line><span class=cl>	<span class=c1>// 如果允许并发执行，返回 `YES`，否则反转 `immediateExecuting` 信号的结果
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=n>RACSignal</span> <span class=o>*</span><span class=n>moreExecutionsAllowed</span> <span class=o>=</span> <span class=p>[</span><span class=n>RACSignal</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=o>:</span><span class=n>RACObserve</span><span class=p>(</span><span class=n>self</span><span class=p>,</span> <span class=n>allowsConcurrentExecution</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=nl>then</span><span class=p>:[</span><span class=n>RACSignal</span> <span class=k>return</span><span class=o>:</span><span class=err>@</span><span class=n>YES</span><span class=p>]</span>
</span></span><span class=line><span class=cl>		<span class=k>else</span><span class=o>:</span><span class=p>[</span><span class=n>immediateExecuting</span> <span class=n>not</span><span class=p>]];</span>
</span></span><span class=line><span class=cl>	
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=p>(</span><span class=n>enabledSignal</span> <span class=o>==</span> <span class=n>nil</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>enabledSignal</span> <span class=o>=</span> <span class=p>[</span><span class=n>RACSignal</span> <span class=k>return</span><span class=o>:</span><span class=err>@</span><span class=n>YES</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=n>enabledSignal</span> <span class=o>=</span> <span class=p>[[[</span><span class=n>enabledSignal</span> <span class=nl>startWith</span><span class=p>:</span><span class=err>@</span><span class=n>YES</span><span class=p>]</span> <span class=nl>takeUntil</span><span class=p>:</span><span class=n>self</span><span class=p>.</span><span class=n>rac_willDeallocSignal</span><span class=p>]</span> <span class=n>replayLast</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	
</span></span><span class=line><span class=cl>	<span class=n>_immediateEnabled</span> <span class=o>=</span> <span class=p>[[</span><span class=n>RACSignal</span>
</span></span><span class=line><span class=cl>		<span class=nl>combineLatest</span><span class=p>:</span><span class=err>@</span><span class=p>[</span><span class=n>enabledSignal</span><span class=p>,</span> <span class=n>moreExecutionsAllowed</span><span class=p>]]</span> <span class=n>and</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	
</span></span><span class=line><span class=cl>	<span class=n>_enabled</span> <span class=o>=</span> <span class=p>[[[[[</span><span class=n>self</span><span class=p>.</span><span class=n>immediateEnabled</span>
</span></span><span class=line><span class=cl>		<span class=nl>take</span><span class=p>:</span><span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl>		<span class=nl>concat</span><span class=p>:[[</span><span class=n>self</span><span class=p>.</span><span class=n>immediateEnabled</span> <span class=nl>skip</span><span class=p>:</span><span class=mi>1</span><span class=p>]</span> 
</span></span><span class=line><span class=cl>        <span class=nl>deliverOn</span><span class=p>:</span><span class=n>RACScheduler</span><span class=p>.</span><span class=n>mainThreadScheduler</span><span class=p>]]</span>
</span></span><span class=line><span class=cl>		<span class=n>distinctUntilChanged</span><span class=p>]</span>
</span></span><span class=line><span class=cl>		<span class=n>replayLast</span><span class=p>]</span>
</span></span><span class=line><span class=cl>		<span class=nl>setNameWithFormat</span><span class=p>:</span><span class=err>@</span><span class=s>&#34;%@ -enabled&#34;</span><span class=p>,</span> <span class=n>self</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=n>self</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 使用时，我们通常会去生成一个 RACCommand 对象，并传入一个返回 signal 对象的 block。每次 RACCommand execute 执行操作时，都会通过传入的这个 signal block 生成一个执行信号 E (1)，并将该信号添加到 RACCommand 内部信号数组 activeExecutionSignals 中 (2)，同时将信号 E 由冷信号转成热信号 (3)，最后订阅该热信号 (4)，并将其返回 (5)。
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>-</span> <span class=p>(</span><span class=n>RACSignal</span> <span class=o>*</span><span class=p>)</span><span class=nl>execute</span><span class=p>:(</span><span class=n>id</span><span class=p>)</span><span class=n>input</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>RACSignal</span> <span class=o>*</span><span class=n>signal</span> <span class=o>=</span> <span class=n>self</span><span class=p>.</span><span class=n>signalBlock</span><span class=p>(</span><span class=n>input</span><span class=p>);</span> <span class=c1>//（1）
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>RACMulticastConnection</span> <span class=o>*</span><span class=n>connection</span> <span class=o>=</span> <span class=na>[[signal subscribeOn:RACScheduler.mainThreadScheduler] multicast:[RACReplaySubject subject]]</span><span class=p>;</span> <span class=c1>// (3)
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>    <span class=err>@</span><span class=n>weakify</span><span class=p>(</span><span class=n>self</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=n>self</span> <span class=nl>addActiveExecutionSignal</span><span class=p>:</span><span class=n>connection</span><span class=p>.</span><span class=n>signal</span><span class=p>];</span> <span class=c1>// (2)
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=n>connection</span><span class=p>.</span><span class=n>signal</span> <span class=nl>subscribeError</span><span class=p>:</span><span class=o>^</span><span class=p>(</span><span class=n>NSError</span> <span class=o>*</span><span class=n>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=err>@</span><span class=n>strongify</span><span class=p>(</span><span class=n>self</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=n>self</span> <span class=nl>removeActiveExecutionSignal</span><span class=p>:</span><span class=n>connection</span><span class=p>.</span><span class=n>signal</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=nl>completed</span><span class=p>:</span><span class=o>^</span><span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=err>@</span><span class=n>strongify</span><span class=p>(</span><span class=n>self</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=n>self</span> <span class=nl>removeActiveExecutionSignal</span><span class=p>:</span><span class=n>connection</span><span class=p>.</span><span class=n>signal</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=p>}];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=n>connection</span> <span class=n>connect</span><span class=p>];</span> <span class=c1>// (4)
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>[</span><span class=n>connection</span><span class=p>.</span><span class=n>signal</span><span class=p>];</span> <span class=c1>// (5)
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><blockquote><p>接下来再来简单说说 <code>RACCommand</code> 中用到的几个函数</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=c1>// 以下是对 `allowsConcurrentExecution` 属性的处理方法，利用了属性的原子性，防止资源竞争，值得学习
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=err>@</span><span class=n>property</span> <span class=p>(</span><span class=n>atomic</span><span class=p>,</span> <span class=n>assign</span><span class=p>)</span> <span class=n>BOOL</span> <span class=n>allowsConcurrentExecution</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=err>@</span><span class=n>property</span> <span class=p>(</span><span class=n>atomic</span><span class=p>,</span> <span class=n>copy</span><span class=p>,</span> <span class=n>readonly</span><span class=p>)</span> <span class=n>NSArray</span> <span class=o>*</span><span class=n>activeExecutionSignals</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=c1>// The mutable array backing `activeExecutionSignals`.
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=c1>//
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=c1>// This should only be used while synchronized on `self`.
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=n>NSMutableArray</span> <span class=o>*</span><span class=n>_activeExecutionSignals</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=c1>// Atomic backing variable for `allowsConcurrentExecution`.
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=k>volatile</span> <span class=kt>uint32_t</span> <span class=n>_allowsConcurrentExecution</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>//============================================================
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=o>-</span> <span class=p>(</span><span class=n>BOOL</span><span class=p>)</span><span class=n>allowsConcurrentExecution</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>_allowsConcurrentExecution</span> <span class=o>!=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>-</span> <span class=p>(</span><span class=kt>void</span><span class=p>)</span><span class=nl>setAllowsConcurrentExecution</span><span class=p>:(</span><span class=n>BOOL</span><span class=p>)</span><span class=n>allowed</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=n>self</span> <span class=nl>willChangeValueForKey</span><span class=p>:</span><span class=err>@</span><span class=n>keypath</span><span class=p>(</span><span class=n>self</span><span class=p>.</span><span class=n>allowsConcurrentExecution</span><span class=p>)];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=p>(</span><span class=n>allowed</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=c1>// 以下函数类似于 `||`  
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=c1>// 只要前者和后者有一个为真，那么后者就为真；即：不管 `_allowsConcurrentExecution` 是否等于 `1`，它最终都会变为 `1`，因为前者是 1；
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=n>OSAtomicOr32Barrier</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>_allowsConcurrentExecution</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=c1>// 以下函数类似于 `&amp;&amp;`  
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=c1>// 前后二者必须都为真，后者才会变为真；即：不管 `_allowsConcurrentExecution` 等于 0 还是 1，它最终都会变为 `0`，因为前者是 0
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=n>OSAtomicAnd32Barrier</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>_allowsConcurrentExecution</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=c1>// 手动调用 KVO，通知监听者 `allowsConcurrentExecution` 属性改变了
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=p>[</span><span class=n>self</span> <span class=nl>didChangeValueForKey</span><span class=p>:</span><span class=err>@</span><span class=n>keypath</span><span class=p>(</span><span class=n>self</span><span class=p>.</span><span class=n>allowsConcurrentExecution</span><span class=p>)];</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>//======================== 数组属性 ================================
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>-</span> <span class=p>(</span><span class=n>NSArray</span> <span class=o>*</span><span class=p>)</span><span class=n>activeExecutionSignals</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=err>@</span><span class=n>synchronized</span> <span class=p>(</span><span class=n>self</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>[</span><span class=n>_activeExecutionSignals</span> <span class=n>copy</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>-</span> <span class=p>(</span><span class=kt>void</span><span class=p>)</span><span class=nl>addActiveExecutionSignal</span><span class=p>:(</span><span class=n>RACSignal</span> <span class=o>*</span><span class=p>)</span><span class=n>signal</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>NSCParameterAssert</span><span class=p>([</span><span class=n>signal</span> <span class=nl>isKindOfClass</span><span class=p>:</span><span class=n>RACSignal</span><span class=p>.</span><span class=k>class</span><span class=err>]);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=err>@</span><span class=n>synchronized</span> <span class=p>(</span><span class=n>self</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>NSIndexSet</span> <span class=o>*</span><span class=n>indexes</span> <span class=o>=</span> <span class=p>[</span><span class=n>NSIndexSet</span> <span class=nl>indexSetWithIndex</span><span class=p>:</span><span class=n>_activeExecutionSignals</span><span class=p>.</span><span class=n>count</span><span class=p>];</span>
</span></span><span class=line><span class=cl>		<span class=p>[</span><span class=n>self</span> <span class=nl>willChange</span><span class=p>:</span><span class=n>NSKeyValueChangeInsertion</span> <span class=nl>valuesAtIndexes</span><span class=p>:</span><span class=n>indexes</span> <span class=nl>forKey</span><span class=p>:</span><span class=err>@</span><span class=n>keypath</span><span class=p>(</span><span class=n>self</span><span class=p>.</span><span class=n>activeExecutionSignals</span><span class=p>)];</span>
</span></span><span class=line><span class=cl>		<span class=p>[</span><span class=n>_activeExecutionSignals</span> <span class=nl>addObject</span><span class=p>:</span><span class=n>signal</span><span class=p>];</span>
</span></span><span class=line><span class=cl>		<span class=p>[</span><span class=n>self</span> <span class=nl>didChange</span><span class=p>:</span><span class=n>NSKeyValueChangeInsertion</span> <span class=nl>valuesAtIndexes</span><span class=p>:</span><span class=n>indexes</span> <span class=nl>forKey</span><span class=p>:</span><span class=err>@</span><span class=n>keypath</span><span class=p>(</span><span class=n>self</span><span class=p>.</span><span class=n>activeExecutionSignals</span><span class=p>)];</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>-</span> <span class=p>(</span><span class=kt>void</span><span class=p>)</span><span class=nl>removeActiveExecutionSignal</span><span class=p>:(</span><span class=n>RACSignal</span> <span class=o>*</span><span class=p>)</span><span class=n>signal</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>NSCParameterAssert</span><span class=p>([</span><span class=n>signal</span> <span class=nl>isKindOfClass</span><span class=p>:</span><span class=n>RACSignal</span><span class=p>.</span><span class=k>class</span><span class=err>]);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=err>@</span><span class=n>synchronized</span> <span class=p>(</span><span class=n>self</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=c1>// 从当前数组中获取到要移除的对象的 indexSets，如果不存在直接返回
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=n>NSIndexSet</span> <span class=o>*</span><span class=n>indexes</span> <span class=o>=</span> <span class=p>[</span><span class=n>_activeExecutionSignals</span> <span class=nl>indexesOfObjectsPassingTest</span><span class=p>:</span><span class=o>^</span> <span class=n>BOOL</span> <span class=p>(</span><span class=n>RACSignal</span> <span class=o>*</span><span class=n>obj</span><span class=p>,</span> <span class=n>NSUInteger</span> <span class=n>index</span><span class=p>,</span> <span class=n>BOOL</span> <span class=o>*</span><span class=n>stop</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>obj</span> <span class=o>==</span> <span class=n>signal</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=p>(</span><span class=n>indexes</span><span class=p>.</span><span class=n>count</span> <span class=o>==</span> <span class=mi>0</span><span class=p>)</span> <span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=c1>// 手动调用 KVO，通知监听者 `activeExecutionSignals` 数组的改变
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=p>[</span><span class=n>self</span> <span class=nl>willChange</span><span class=p>:</span><span class=n>NSKeyValueChangeRemoval</span> <span class=nl>valuesAtIndexes</span><span class=p>:</span><span class=n>indexes</span> <span class=nl>forKey</span><span class=p>:</span><span class=err>@</span><span class=n>keypath</span><span class=p>(</span><span class=n>self</span><span class=p>.</span><span class=n>activeExecutionSignals</span><span class=p>)];</span>
</span></span><span class=line><span class=cl>		<span class=p>[</span><span class=n>_activeExecutionSignals</span> <span class=nl>removeObjectsAtIndexes</span><span class=p>:</span><span class=n>indexes</span><span class=p>];</span>
</span></span><span class=line><span class=cl>		<span class=p>[</span><span class=n>self</span> <span class=nl>didChange</span><span class=p>:</span><span class=n>NSKeyValueChangeRemoval</span> <span class=nl>valuesAtIndexes</span><span class=p>:</span><span class=n>indexes</span> <span class=nl>forKey</span><span class=p>:</span><span class=err>@</span><span class=n>keypath</span><span class=p>(</span><span class=n>self</span><span class=p>.</span><span class=n>activeExecutionSignals</span><span class=p>)];</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=推荐>推荐</h2><ul><li><a href=https://github.com/ValiantCat/FRPCheatSheeta target=_blank rel="noopener noreffer">FRPCheatSheeta</a></li></ul></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>更新于 2022-08-27</span></div></div><div class=post-info-line><div class=post-info-md><span><a class=link-to-markdown href=/reactivecocoa%E9%83%A8%E5%88%86%E7%AE%80%E6%9E%90/index.md target=_blank>阅读原始文档</a></span></div><div class=post-info-share><span><a href=javascript:void(0); title="分享到 Twitter" data-sharer=twitter data-url=https://faimin.github.io/reactivecocoa%E9%83%A8%E5%88%86%E7%AE%80%E6%9E%90/ data-title=ReactiveCocoa部分简析 data-hashtags=iOS,reactive><i class="fab fa-twitter fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="分享到 Facebook" data-sharer=facebook data-url=https://faimin.github.io/reactivecocoa%E9%83%A8%E5%88%86%E7%AE%80%E6%9E%90/ data-hashtag=iOS><i class="fab fa-facebook-square fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="分享到 Hacker News" data-sharer=hackernews data-url=https://faimin.github.io/reactivecocoa%E9%83%A8%E5%88%86%E7%AE%80%E6%9E%90/ data-title=ReactiveCocoa部分简析><i class="fab fa-hacker-news fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="分享到 Line" data-sharer=line data-url=https://faimin.github.io/reactivecocoa%E9%83%A8%E5%88%86%E7%AE%80%E6%9E%90/ data-title=ReactiveCocoa部分简析><i data-svg-src=https://cdn.jsdelivr.net/npm/simple-icons@7.3.0/icons/line.svg aria-hidden=true></i></a><a href=javascript:void(0); title="分享到 微博" data-sharer=weibo data-url=https://faimin.github.io/reactivecocoa%E9%83%A8%E5%88%86%E7%AE%80%E6%9E%90/ data-title=ReactiveCocoa部分简析 data-image=/images/rac/reactive_milim.jpg data-ralateuid=1655766025><i class="fab fa-weibo fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw" aria-hidden=true></i>&nbsp;<a href=/tags/ios/>IOS</a>,&nbsp;<a href=/tags/reactive/>Reactive</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>返回</a></span>&nbsp;|&nbsp;<span><a href=/>主页</a></span></section></div><div class=post-nav><a href=/swift%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/ class=prev rel=prev title=Swift学习笔记><i class="fas fa-angle-left fa-fw" aria-hidden=true></i>Swift学习笔记</a>
<a href=/cocoapods_tips/ class=next rel=next title=CocoaPods笔记>CocoaPods笔记<i class="fas fa-angle-right fa-fw" aria-hidden=true></i></a></div></div><div id=comments><div id=valine class=comment></div><noscript>Please enable JavaScript to view the comments powered by <a href=https://valine.js.org/>Valine</a>.</noscript></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line><span id=busuanzi_container_site_uv>本站访客数<span id=busuanzi_value_site_uv></span>人次</span> | <span id=busuanzi_container_site_pv>本站总访问量 <span id=busuanzi_value_site_pv></span>次</span></div><div class=footer-line>由 <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.134.3">Hugo</a> 强力驱动 | 主题 - <a href=https://github.com/dillonzq/LoveIt target=_blank rel="noopener noreffer" title="LoveIt 0.2.11"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden=true></i> LoveIt</a></div><div class=footer-line itemscope itemtype=http://schema.org/CreativeWork><i class="far fa-copyright fa-fw" aria-hidden=true></i><span itemprop=copyrightYear>2018 - 2024</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=https://github.com/faimin target=_blank>Zero.D.Saber</a></span>&nbsp;|&nbsp;<span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title=回到顶部><i class="fas fa-arrow-up fa-fw" aria-hidden=true></i>
</a><a href=# id=view-comments class=fixed-button title=查看评论><i class="fas fa-comment fa-fw" aria-hidden=true></i></a></div><link rel=stylesheet href=/lib/valine/valine.min.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/css/lightgallery-bundle.min.css><script type=text/javascript src=https://cdn.jsdelivr.net/npm/valine@1.5.0/dist/Valine.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/autocomplete.js@0.38.1/dist/autocomplete.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/algoliasearch@4.13.1/dist/algoliasearch-lite.umd.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/lightgallery.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/plugins/thumbnail/lg-thumbnail.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/plugins/zoom/lg-zoom.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/sharer.js@0.5.1/sharer.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"复制到剪贴板",maxShownLines:10},comment:{valine:{appId:"QGzwQXOqs5JOhN4RGPOkR2mR-MdYXbMMI",appKey:"WBmoGyJtbqUswvfLh6L8iEBr",avatar:"mp",el:"#valine",emojiCDN:"https://cdn.jsdelivr.net/npm/emoji-datasource-google@14.0.0/img/google/64/",emojiMaps:{100:"1f4af.png",alien:"1f47d.png",anger:"1f4a2.png",angry:"1f620.png",anguished:"1f627.png",astonished:"1f632.png",black_heart:"1f5a4.png",blue_heart:"1f499.png",blush:"1f60a.png",bomb:"1f4a3.png",boom:"1f4a5.png",broken_heart:"1f494.png",brown_heart:"1f90e.png",clown_face:"1f921.png",cold_face:"1f976.png",cold_sweat:"1f630.png",confounded:"1f616.png",confused:"1f615.png",cry:"1f622.png",crying_cat_face:"1f63f.png",cupid:"1f498.png",dash:"1f4a8.png",disappointed:"1f61e.png",disappointed_relieved:"1f625.png",dizzy:"1f4ab.png",dizzy_face:"1f635.png",drooling_face:"1f924.png",exploding_head:"1f92f.png",expressionless:"1f611.png",face_vomiting:"1f92e.png",face_with_cowboy_hat:"1f920.png",face_with_hand_over_mouth:"1f92d.png",face_with_head_bandage:"1f915.png",face_with_monocle:"1f9d0.png",face_with_raised_eyebrow:"1f928.png",face_with_rolling_eyes:"1f644.png",face_with_symbols_on_mouth:"1f92c.png",face_with_thermometer:"1f912.png",fearful:"1f628.png",flushed:"1f633.png",frowning:"1f626.png",ghost:"1f47b.png",gift_heart:"1f49d.png",green_heart:"1f49a.png",grimacing:"1f62c.png",grin:"1f601.png",grinning:"1f600.png",hankey:"1f4a9.png",hear_no_evil:"1f649.png",heart:"2764-fe0f.png",heart_decoration:"1f49f.png",heart_eyes:"1f60d.png",heart_eyes_cat:"1f63b.png",heartbeat:"1f493.png",heartpulse:"1f497.png",heavy_heart_exclamation_mark_ornament:"2763-fe0f.png",hole:"1f573-fe0f.png",hot_face:"1f975.png",hugging_face:"1f917.png",hushed:"1f62f.png",imp:"1f47f.png",innocent:"1f607.png",japanese_goblin:"1f47a.png",japanese_ogre:"1f479.png",joy:"1f602.png",joy_cat:"1f639.png",kiss:"1f48b.png",kissing:"1f617.png",kissing_cat:"1f63d.png",kissing_closed_eyes:"1f61a.png",kissing_heart:"1f618.png",kissing_smiling_eyes:"1f619.png",laughing:"1f606.png",left_speech_bubble:"1f5e8-fe0f.png",love_letter:"1f48c.png",lying_face:"1f925.png",mask:"1f637.png",money_mouth_face:"1f911.png",nauseated_face:"1f922.png",nerd_face:"1f913.png",neutral_face:"1f610.png",no_mouth:"1f636.png",open_mouth:"1f62e.png",orange_heart:"1f9e1.png",partying_face:"1f973.png",pensive:"1f614.png",persevere:"1f623.png",pleading_face:"1f97a.png",pouting_cat:"1f63e.png",purple_heart:"1f49c.png",rage:"1f621.png",relaxed:"263a-fe0f.png",relieved:"1f60c.png",revolving_hearts:"1f49e.png",right_anger_bubble:"1f5ef-fe0f.png",robot_face:"1f916.png",rolling_on_the_floor_laughing:"1f923.png",scream:"1f631.png",scream_cat:"1f640.png",see_no_evil:"1f648.png",shushing_face:"1f92b.png",skull:"1f480.png",skull_and_crossbones:"2620-fe0f.png",sleeping:"1f634.png",sleepy:"1f62a.png",slightly_frowning_face:"1f641.png",slightly_smiling_face:"1f642.png",smile:"1f604.png",smile_cat:"1f638.png",smiley:"1f603.png",smiley_cat:"1f63a.png",smiling_face_with_3_hearts:"1f970.png",smiling_imp:"1f608.png",smirk:"1f60f.png",smirk_cat:"1f63c.png",sneezing_face:"1f927.png",sob:"1f62d.png",space_invader:"1f47e.png",sparkling_heart:"1f496.png",speak_no_evil:"1f64a.png",speech_balloon:"1f4ac.png","star-struck":"1f929.png",stuck_out_tongue:"1f61b.png",stuck_out_tongue_closed_eyes:"1f61d.png",stuck_out_tongue_winking_eye:"1f61c.png",sunglasses:"1f60e.png",sweat:"1f613.png",sweat_drops:"1f4a6.png",sweat_smile:"1f605.png",thinking_face:"1f914.png",thought_balloon:"1f4ad.png",tired_face:"1f62b.png",triumph:"1f624.png",two_hearts:"1f495.png",unamused:"1f612.png",upside_down_face:"1f643.png",weary:"1f629.png",white_frowning_face:"2639-fe0f.png",white_heart:"1f90d.png",wink:"1f609.png",woozy_face:"1f974.png",worried:"1f61f.png",yawning_face:"1f971.png",yellow_heart:"1f49b.png",yum:"1f60b.png",zany_face:"1f92a.png",zipper_mouth_face:"1f910.png",zzz:"1f4a4.png"},enableQQ:!1,highlight:!0,lang:"zh-CN",pageSize:10,placeholder:"你的评论 ...",recordIP:!0,serverURLs:"https://leancloud.hugoloveit.com",visitor:!0}},lightgallery:!0,search:{algoliaAppID:"PASDMWALPK",algoliaIndex:"index.zh-cn",algoliaSearchKey:"b42948e51daaa93df92381c8e2ac0f93",highlightTag:"em",maxResultLength:10,noResultsFound:"没有找到结果",snippetLength:50,type:"algolia"}}</script><script type=text/javascript src=/js/theme.min.js></script></body></html>